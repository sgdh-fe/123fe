{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":1,"renderable":0},{"_id":"themes/cactus-dark/source/css/style.styl","path":"css/style.styl","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/images/apple-touch-icon.png","path":"images/apple-touch-icon.png","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/images/favicon-192x192.png","path":"images/favicon-192x192.png","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/images/favicon.ico","path":"images/favicon.ico","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/images/logo.png","path":"images/logo.png","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/js/main.js","path":"js/main.js","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/justified-gallery/jquery.justifiedGallery.min.js","path":"lib/justified-gallery/jquery.justifiedGallery.min.js","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/justified-gallery/justifiedGallery.min.css","path":"lib/justified-gallery/justifiedGallery.min.css","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/meslo-LG/styles.css","path":"lib/meslo-LG/styles.css","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/jquery/jquery.min.js","path":"lib/jquery/jquery.min.js","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/font-awesome/fonts/FontAwesome.otf","path":"lib/font-awesome/fonts/FontAwesome.otf","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","path":"lib/font-awesome/fonts/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/font-awesome/fonts/fontawesome-webfont.svg","path":"lib/font-awesome/fonts/fontawesome-webfont.svg","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGL-Italic.ttf","path":"lib/meslo-LG/fonts/MesloLGL-Italic.ttf","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGM-Italic.ttf","path":"lib/meslo-LG/fonts/MesloLGM-Italic.ttf","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGS-Italic.ttf","path":"lib/meslo-LG/fonts/MesloLGS-Italic.ttf","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGL-Bold.ttf","path":"lib/meslo-LG/fonts/MesloLGL-Bold.ttf","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGL-Regular.ttf","path":"lib/meslo-LG/fonts/MesloLGL-Regular.ttf","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGL-BoldItalic.ttf","path":"lib/meslo-LG/fonts/MesloLGL-BoldItalic.ttf","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGM-Bold.ttf","path":"lib/meslo-LG/fonts/MesloLGM-Bold.ttf","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGM-BoldItalic.ttf","path":"lib/meslo-LG/fonts/MesloLGM-BoldItalic.ttf","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGM-Regular.ttf","path":"lib/meslo-LG/fonts/MesloLGM-Regular.ttf","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGS-Bold.ttf","path":"lib/meslo-LG/fonts/MesloLGS-Bold.ttf","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGS-Regular.ttf","path":"lib/meslo-LG/fonts/MesloLGS-Regular.ttf","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGS-BoldItalic.ttf","path":"lib/meslo-LG/fonts/MesloLGS-BoldItalic.ttf","modified":1,"renderable":1},{"_id":"themes/cactus-dark/source/images/theme overview.psd","path":"images/theme overview.psd","modified":1,"renderable":1}],"Cache":[{"_id":"source/CNAME","hash":"6211c7971e7c73fcde3c235ab6183fd4fbdbcf67","modified":1534925205000},{"_id":"themes/cactus-dark/LICENSE","hash":"4d5f5f360a18c68f0fd1897bdb1eb1210c2893e3","modified":1534925205000},{"_id":"themes/cactus-dark/README.md","hash":"f38b2f4771eeccc0ae0959ac3e3c485a9d159d4a","modified":1534925205000},{"_id":"themes/cactus-dark/_config.yml","hash":"f1092ae4efec86586f1e6708d42f2aa3a40775f6","modified":1534925376000},{"_id":"source/_posts/IE-8å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„éœ².md","hash":"03e2de36c63dcdf6ec0db7df686c9fa736ea49a6","modified":1534925205000},{"_id":"source/_posts/JavaScriptå†…å­˜é‚£ç‚¹äº‹.md","hash":"0cda63b8338f8cb2f3c07e45058135f674e88c0c","modified":1534925205000},{"_id":"source/_posts/async-vs-defer.md","hash":"361e064d02650907fd6b2fb42224a3351db7d2ab","modified":1534925205000},{"_id":"source/_posts/css-zIndex.md","hash":"f9a5ed6006ddacc04cf405ea2119d8b32e09f845","modified":1534925205000},{"_id":"source/_posts/init.md","hash":"1a69967967b808bf667a6da750e5565b38bd4c0c","modified":1534925344000},{"_id":"source/_posts/requestAnimationFrame.md","hash":"9d3af6ebca126e6f58f7726ee32a934da1751926","modified":1534925205000},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹.md","hash":"2e915e4c30fd3b4961652caba2896c617b1f6d66","modified":1534925205000},{"_id":"source/_posts/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹.md","hash":"e1716a9a1f51c5608286ad841d21f03b0f9481c3","modified":1534925205000},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹Listeners.md","hash":"db5551ec99cd9b04e12dd18d8a7e2d88b72b5307","modified":1534925205000},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹jQuery-cache.md","hash":"685aeee3197e146e6bb6ba2f262cb60e540a9497","modified":1534925205000},{"_id":"source/_posts/æµè§ˆå™¨æ¸²æŸ“ç®€è¿°.md","hash":"3eb937e147af7de557c9fb1b7cc0e730c87a07ab","modified":1534925205000},{"_id":"source/about/index.html","hash":"f91db5b719c7fc7d29e7e49c5a531164185b512b","modified":1534925205000},{"_id":"themes/cactus-dark/layout/archive.ejs","hash":"ab9798bf534485a4fed4d3089011421858afdd26","modified":1534925205000},{"_id":"themes/cactus-dark/layout/index.ejs","hash":"1a16231e9ce5bd09d8ac0e3cf8f2733c4c157a12","modified":1534925205000},{"_id":"themes/cactus-dark/layout/layout.ejs","hash":"8484532ad7c4da22f46fc1394bb2fd9ded34be1f","modified":1534925205000},{"_id":"themes/cactus-dark/layout/page.ejs","hash":"b6b7b1e6dc856a0e62f35da0151f67ba41143e04","modified":1534925205000},{"_id":"themes/cactus-dark/layout/post.ejs","hash":"2731e597b5d1714a6f5a775c432e99785f02a3e3","modified":1534925205000},{"_id":"themes/cactus-dark/scripts/meta.js","hash":"fa6055a39851c9953d033e70c1614547b94dce60","modified":1534925205000},{"_id":"themes/cactus-dark/scripts/thumbnail.js","hash":"df8829fd8c3119650037eba5ec11bdce06acff9d","modified":1534925205000},{"_id":"source/_posts/JavaScriptå†…å­˜é‚£ç‚¹äº‹/cycle.png","hash":"cf9958415e58e7af46bcf695e49d4648105a1935","modified":1534925205000},{"_id":"source/_posts/JavaScriptå†…å­˜é‚£ç‚¹äº‹/life-cycle.png","hash":"36c1188b40a1faa2ada23d11bfbef3c86177660a","modified":1534925205000},{"_id":"source/_posts/JavaScriptå†…å­˜é‚£ç‚¹äº‹/no-cycle.png","hash":"5d894fa7c5911f6d3a03bc4b4fc854e2be828b7e","modified":1534925205000},{"_id":"source/_posts/async-vs-defer/legend.svg","hash":"0242b6d7f1d194fb80b2f441671def4f3014bb20","modified":1534925205000},{"_id":"source/_posts/async-vs-defer/script-async.svg","hash":"ad7dc71402604b8faeb136f3ba92170a5e704ce2","modified":1534925205000},{"_id":"source/_posts/async-vs-defer/script-defer.svg","hash":"6b02c3f7322fccd9f167c0477234d50754960edd","modified":1534925205000},{"_id":"source/_posts/async-vs-defer/script.svg","hash":"a578f6355a6b14cac35fc6e4af48d06dd7bba83f","modified":1534925205000},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.png","hash":"467242b5fe6952256f9deb21b3dddc1222da2cb3","modified":1534925205000},{"_id":"source/_posts/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure.png","hash":"4ac2598655f181befd322eae79f8d9774ac69362","modified":1534925205000},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹jQuery-cache/jquery.jpg","hash":"dfb84e73decd4b50e7455f36b88ae08a04dc9b39","modified":1534925205000},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹jQuery-cache/jquery_cache_1_x.png","hash":"65f1c5374f0a31c5a6a44502388725497ef7c27c","modified":1534925205000},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹jQuery-cache/jquery_cache_2_x.png","hash":"755ad521a6ba49a0d5b9c8eb2bd1675bfdd1e2d1","modified":1534925205000},{"_id":"source/_posts/æµè§ˆå™¨æ¸²æŸ“ç®€è¿°/render.png","hash":"635cdeb948f5954f331f6f5f663054d34bc07ce8","modified":1534925205000},{"_id":"themes/cactus-dark/layout/_partial/comments.ejs","hash":"853a4500da515ef3facc51a055886eaf8efd080d","modified":1534925205000},{"_id":"themes/cactus-dark/layout/_partial/footer.ejs","hash":"7f6b3f126a58e6734b658ab57bc6b41822bc9342","modified":1534925205000},{"_id":"themes/cactus-dark/layout/_partial/head.ejs","hash":"7782e6b1ce72fcf121f0017d383e2fb87e72c539","modified":1534925205000},{"_id":"themes/cactus-dark/layout/_partial/header.ejs","hash":"889fe54bbfd1fb3357e8c0614d57a437a72f782a","modified":1534925205000},{"_id":"themes/cactus-dark/layout/_partial/pagination.ejs","hash":"ca660c59aec56daa4a7b41715b97434d4a24c37e","modified":1534925205000},{"_id":"themes/cactus-dark/layout/_partial/scripts.ejs","hash":"6cffa3adb2f5b93a47f29549ac589c8bce8c223e","modified":1534925205000},{"_id":"themes/cactus-dark/layout/_partial/styles.ejs","hash":"e62b799d8ac369d1f1b36bd2649ecc34aec3384c","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_extend.styl","hash":"faca25132d55e8989d1c1d638e55d1e97de3c561","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_mixins.styl","hash":"c921ceb620deedddd38c9cec28190995e8764bab","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_util.styl","hash":"f8e286a21c7ec3e771d5ddeb2909ac92390af9bd","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_variables.styl","hash":"80345f77f0e601669047cbb3c44491720c3b5c13","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/style.styl","hash":"ede737ff18ca19420ca65aacd1d31399ccff2a16","modified":1534925205000},{"_id":"themes/cactus-dark/source/images/apple-touch-icon.png","hash":"57e2def34682655f41a0be2d083f16765ba7858b","modified":1534925205000},{"_id":"themes/cactus-dark/source/images/favicon-192x192.png","hash":"96e6fcbbb13a5914a6131391e210eb7dfd13d692","modified":1534925205000},{"_id":"themes/cactus-dark/source/images/favicon.ico","hash":"189f9842bcb79a6f8f9e8445bc8bbd773443826b","modified":1534925205000},{"_id":"themes/cactus-dark/source/images/logo.png","hash":"199750f3a39251ca97d36ed8317d88dfdc2dfe66","modified":1534925205000},{"_id":"themes/cactus-dark/source/js/main.js","hash":"2703a7cb4fc7056d13215b9fde675da426b9cdc4","modified":1534925205000},{"_id":"source/_posts/requestAnimationFrame/arf.png","hash":"bb24777516237651c52bf35c0deacb60637d7e4d","modified":1534925205000},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/async-network.png","hash":"5056be23b1a31e794c1d6527c383aa3563e4c90d","modified":1534925205000},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/async-network1.png","hash":"e9586915ed4c6df4fef034213d83a34821dac22f","modified":1534925205000},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/async.png","hash":"a70167fdb163e189687283c562f57c176785675a","modified":1534925205000},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/default-network.png","hash":"499e55e1146a6fe7bff0da967f2aed70688af16a","modified":1534925205000},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/media-network.png","hash":"040baff4d17cd7bcf7cc8288eac4b1bc793523c6","modified":1534925205000},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/media.png","hash":"73b6c03849561e8ac621be6dd4aa3091e7ebc5ec","modified":1534925205000},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/script-network.png","hash":"3cc9e3ca4e95a5eb444a29750346eaac0e712d6c","modified":1534925205000},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/script.png","hash":"5910b915601f4afcdac68af6ce6451d257884b90","modified":1534925205000},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet-default.png","hash":"85c33491724afcd70553522704567fee95627fcb","modified":1534925205000},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹Listeners/listener_location.png","hash":"9f9a510b333b117b4d896764cad5013391ef8d24","modified":1534925205000},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.mindnode/contents.xml","hash":"2fef4a611c3c8cf1eff16a8769a88061993574d7","modified":1534925205000},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.mindnode/viewState.plist","hash":"6f2f7999d50e8ccfa1d13c9f72ac119da517c59c","modified":1534925205000},{"_id":"source/_posts/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure2.png","hash":"091a279732357ca7d5790d6462edd1c26f02a4ff","modified":1534925205000},{"_id":"source/_posts/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure3.png","hash":"688c5eb2cfe3ef308f0b1bba0bf5f782ec951423","modified":1534925205000},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹Listeners/listeners_event.png","hash":"2dea6583ab164a3490c899db234befb253a90247","modified":1534925205000},{"_id":"themes/cactus-dark/layout/_partial/post/actions_desktop.ejs","hash":"063ae931a6902f192e086fe5cceae587d27ed196","modified":1534925205000},{"_id":"themes/cactus-dark/layout/_partial/post/actions_mobile.ejs","hash":"64d0f85480997a4fa53c99954e9454c189595e9c","modified":1534925205000},{"_id":"themes/cactus-dark/layout/_partial/post/date.ejs","hash":"12a4a7ba6334e3e5c03d9a9601d7779a27c2e082","modified":1534925205000},{"_id":"themes/cactus-dark/layout/_partial/post/gallery.ejs","hash":"9aecd8908e8a684f33dc20c02497c0f1774137c7","modified":1534925205000},{"_id":"themes/cactus-dark/layout/_partial/post/share.ejs","hash":"25a3406f97e976ec13239f0d3f32f9e512511f50","modified":1534925205000},{"_id":"themes/cactus-dark/layout/_partial/post/tag.ejs","hash":"bfab03ef986d35ccad583f2d2b575db4a8d2789e","modified":1534925205000},{"_id":"themes/cactus-dark/layout/_partial/post/title.ejs","hash":"a060f1c6e3718494a6b1d0e1981ea0bf4e549828","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/agate.styl","hash":"601eb70448a16b918df132f6fc41e891ae053653","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/androidstudio.styl","hash":"65d09f1b0e81c6a182f549fd3de51e59823c97ae","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/arta.styl","hash":"1a5accc115f41d1b669ed708ac6a29abac876599","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/atelier-cave-dark.styl","hash":"bc647b2c1d971d7cc947aa1ed66e9fd115261921","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/atelier-dune-dark.styl","hash":"df50a85a4b14c7ca6e825d665594b91229d0e460","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/atelier-estuary-dark.styl","hash":"d84382bc8298f96730757391d3e761b7e640f406","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/atelier-forest-dark.styl","hash":"57c154c6045a038dc7df0a25927853e10bf48c4a","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/atelier-heath-dark.styl","hash":"b0cf13b2233e7bc38342032d2d7296591a4c2bcf","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/atelier-lakeside-dark.styl","hash":"bb0a8c4ad0dd8e3e7de7122ddf268fc42aa94acb","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/atelier-plateau-dark.styl","hash":"09c64f1a7052aec9070c36c0431df25216afaea1","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/atelier-savanna-dark.styl","hash":"a16c919a1ccf2f845488078fb341381bec46b1f3","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/atelier-seaside-dark.styl","hash":"ce233a101daea7124cbfcd34add43ccfe2e1e1c7","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/atelier-sulphurpool-dark.styl","hash":"414b0cfc142f70afe359c16450b651e28bf7325a","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/codepen-embed.styl","hash":"f4dcc84d8e39f9831a5efe80e51923fc3054feb0","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/dark.styl","hash":"71ce56d311cc2f3a605f6e2c495ccd7236878404","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/darkula.styl","hash":"ad0d5728d21645039c9f199e7a56814170ed3bab","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/far.styl","hash":"d9928010ffe71e80b97a5afcba1a4975efdd7372","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/hopscotch.styl","hash":"b374c6550b89b4751aedc8fbc3cf98d95bd70ead","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/hybrid.styl","hash":"ea8d7ddc258b073308746385f5cb85aabb8bfb83","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/ir-black.styl","hash":"693078bbd72a2091ed30f506cc55949600b717af","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/kimbie.styl","hash":"45dbb168f22d739d0109745d2decd66b5f94e786","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/monokai-sublime.styl","hash":"25aa2fc1dbe38593e7c7ebe525438a39574d9935","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/monokai.styl","hash":"5a4fe9f957fd7a368c21b62a818403db4270452f","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/obsidian.styl","hash":"55572bbcfee1de6c31ac54681bb00336f5ae826d","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/paraiso.styl","hash":"f1537bd868579fa018ecdbfd2eb922dcf3ba2cac","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/pojoaque.styl","hash":"77dae9dc41945359d17fe84dbd317f1b40b2ee33","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/railscasts.styl","hash":"acd620f8bb7ff0e3fe5f9a22b4433ceef93a05e6","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/rainbow.styl","hash":"ce73b858fc0aba0e57ef9fb136c083082746bc1d","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/solarized-dark.styl","hash":"702b9299a48c90124e3ac1d45f1591042f2beccc","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/sunburst.styl","hash":"a0b5b5129547a23865d400cfa562ea0ac1ee3958","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/tomorrow-night-blue.styl","hash":"8b3087d4422be6eb800935a22eb11e035341c4ba","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/tomorrow-night-bright.styl","hash":"0ac6af6ecb446b5b60d6226748e4a6532db34f57","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/tomorrow-night-eighties.styl","hash":"fa57b3bb7857a160fc856dbe319b31e30cc5d771","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/tomorrow-night.styl","hash":"19b3080d4b066b40d50d7e7f297472482b5801fd","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_highlight/zenburn.styl","hash":"fc5ec840435dad80964d04519d3f882ddc03746a","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_partial/archive.styl","hash":"18fa7f84a9783c5fb56c9f450ea93bd88408e682","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_partial/article.styl","hash":"202b775a966d7bc35bf5adc693b62463dec106bb","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_partial/comments.styl","hash":"11fb41241a13971d23fc3f7e6d60315c7f248396","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_partial/footer.styl","hash":"b7570de60eaf9aa6b0192bf9c71b9172ff11bfbc","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_partial/header.styl","hash":"63707d9103a283147ca222fd6f8ff9bffbffe427","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_partial/index.styl","hash":"cf43702450ea1e5617541501886982a394cff8ec","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_partial/pagination.styl","hash":"03a1b81d60dae3dd55963b7e74a6fee83470e6bb","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/justified-gallery/jquery.justifiedGallery.min.js","hash":"b2683e7a872bc109b1756a65188a37cef7d0bd5c","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/justified-gallery/justifiedGallery.min.css","hash":"13fbcba5e97aa88b748d94d3efc4718475279907","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/meslo-LG/styles.css","hash":"eb88d0b9f1bbef99070e9627e2c96d892036bf7e","modified":1534925205000},{"_id":"source/_posts/JavaScriptå†…å­˜é‚£ç‚¹äº‹/mark-sweep.gif","hash":"fd13ddb270cd612668b97015a01cd2ec3ab937b1","modified":1534925205000},{"_id":"source/_posts/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure4.png","hash":"f765361ae7248a18c91f31b4538a36e80d8c915d","modified":1534925205000},{"_id":"source/_posts/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure5.png","hash":"56972df77d755eee3346f9bac1e0a95b32d2938d","modified":1534925205000},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹Listeners/listeners_fixed.png","hash":"4681dba3574b4da97d76177236f21b7ed06bb09b","modified":1534925205000},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹Listeners/listeners_resize.png","hash":"d4458465f2db6087b47394e7c1fcb4be64df5fd3","modified":1534925205000},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹jQuery-cache/jquery1_x.png","hash":"9b18da36937eb3a668a5752d3a8bc91684a61eb2","modified":1534925205000},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹jQuery-cache/jquery2_x.png","hash":"596199653248639e87d02b3b5b7ef5a83a4670c2","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/jquery/jquery.min.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1534925205000},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.mindnode/style.mindnodestyle/contents.xml","hash":"e1ed5eb03e419add20371f2f3aa595c7a0a18f02","modified":1534925205000},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.mindnode/style.mindnodestyle/metadata.plist","hash":"5afc7f0891e0599decc407be87bb0486b35050d2","modified":1534925205000},{"_id":"source/_posts/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure1.png","hash":"45989ef2609317ba1984647890aa2b596bfb1416","modified":1534925205000},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹Listeners/listeners_resize_after.png","hash":"7062c2446d38aa22ba84fd8b630abeeb0e25f038","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_partial/post/actions_desktop.styl","hash":"2bbbb20ae8a99bc08fb95ba0ec8f39ed6ccb8534","modified":1534925205000},{"_id":"themes/cactus-dark/source/css/_partial/post/actions_mobile.styl","hash":"e6a802d7ee1023c5fc5fac18bb0ba3dc03ef2ac8","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1534925205000},{"_id":"source/_posts/IE-8å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„éœ²/leakage.png","hash":"84d9b8945d6fc27522dc34027f7743b40261986d","modified":1534925205000},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.mindnode/QuickLook/Preview.jpg","hash":"b4656d0e7b77b48f19d5ed7a77661f8b498aecfa","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1534925205000},{"_id":"source/_posts/æµè§ˆå™¨æ¸²æŸ“ç®€è¿°/tiles.png","hash":"0f5a23cc8c42f8b38b70fba4dea5c147dca25b86","modified":1534925205000},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹Listeners/listeners_performance.png","hash":"cc4a507bdbe21b724c17db5533779f73c0f0d6e0","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGL-Italic.ttf","hash":"96c97a0a098ca40802f948ae56fa37aa6683d034","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGM-Italic.ttf","hash":"68700db02debd4b922304134da83b829cbfddfc9","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGS-Italic.ttf","hash":"7f7cdbdcc26279c04046632e22d872f111bc9399","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGL-Bold.ttf","hash":"bfa1ed9a263ed78462f06d322de13bd5bd0906b2","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGL-Regular.ttf","hash":"2b912dd13f052f645ee19951604610bb350d50af","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGL-BoldItalic.ttf","hash":"a9a431fc7a6c3a67c98021d4035c12a07a4f1070","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGM-Bold.ttf","hash":"a8a8df3393bccc365335fc5eb0a62a6b7ccd32b9","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGM-BoldItalic.ttf","hash":"65ddb11e75ee93909e845ab912a36717c48f1c94","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGM-Regular.ttf","hash":"5e220152adefe905b2197f873d7cee99eca50e91","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGS-Bold.ttf","hash":"df202ce09cbdc70bc16b81983a13ef0f94e46f10","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGS-Regular.ttf","hash":"56fa0e33a390b704afc56af93a31576ccdbbdd9e","modified":1534925205000},{"_id":"themes/cactus-dark/source/lib/meslo-LG/fonts/MesloLGS-BoldItalic.ttf","hash":"d895a1bd25e36c58b7f463ebe14de09f186d5ab4","modified":1534925205000},{"_id":"themes/cactus-dark/source/images/theme overview.psd","hash":"8dc11d9d289c247423911e962c4eb3a556dc67d1","modified":1534925205000},{"_id":"public/about/index.html","hash":"9eb8c59dda52a72d13bd3c9faa80263fd52f52f7","modified":1534925985087},{"_id":"public/2017/08/28/init/index.html","hash":"bd08df3dd636d18960a01e166ab1cad037b19e72","modified":1534925985087},{"_id":"public/archives/index.html","hash":"16a8db25065b51bdc8aad1d7ec9ba0097250e07c","modified":1534925985087},{"_id":"public/archives/page/2/index.html","hash":"90da819b713b67ad8110a8a3394c3897e012d2fd","modified":1534925985087},{"_id":"public/archives/2017/index.html","hash":"91281bfa63fecb7b0d36129e69b662f21ab15182","modified":1534925985087},{"_id":"public/archives/2017/page/2/index.html","hash":"622decaad42b074ace37046edb7fadafc3c048b9","modified":1534925985087},{"_id":"public/archives/2017/08/index.html","hash":"7efe15e25c81eb03b63d3dcd9549b1cccb51f69f","modified":1534925985087},{"_id":"public/archives/2017/09/index.html","hash":"bc916fd455106ce5ffd749c16ed1b10fb7f90999","modified":1534925985088},{"_id":"public/archives/2017/11/index.html","hash":"5f1dfe31d1120cfc87d5eb875ece234651c11df9","modified":1534925985088},{"_id":"public/categories/memory/index.html","hash":"41beb077e2ee60a2cbb9da9b33b3dd7e1a92231b","modified":1534925985088},{"_id":"public/index.html","hash":"407410405cec7d22b602d7aa10884abc5d035489","modified":1534925985088},{"_id":"public/page/2/index.html","hash":"356861c2f7e7d330ee0430085c4c6540370246fb","modified":1534925985088},{"_id":"public/tags/IE6/index.html","hash":"e867d4580a866870d7284c3db173e3f4d3f2697b","modified":1534925985088},{"_id":"public/tags/å†…å­˜æ³„éœ²/index.html","hash":"bab7ab650584b6308c649d4b1866fbf0bc615dfb","modified":1534925985088},{"_id":"public/tags/ä¼˜åŒ–/index.html","hash":"e7efb6fbd0342ef7b3ead08d17a2f2979d5fb3a2","modified":1534925985088},{"_id":"public/tags/å†…å­˜/index.html","hash":"c570176dd7b77ac1d754bccc2d613f0be1a0efef","modified":1534925985088},{"_id":"public/tags/CG/index.html","hash":"c32f8a7a9c7cccabbce9732911d460839077c5f6","modified":1534925985088},{"_id":"public/tags/åƒåœ¾å›æ”¶/index.html","hash":"28aa2ecd57c0239210ccc02806b8a13ad059a04c","modified":1534925985088},{"_id":"public/tags/defer/index.html","hash":"e4139310fe9c6ba59594b547c0a8e63b0f043ed7","modified":1534925985088},{"_id":"public/tags/async/index.html","hash":"e42c37eda05411db01a03c6568ce1f998f43e73f","modified":1534925985088},{"_id":"public/tags/css/index.html","hash":"10593f3ae6049f02a755ef54ec68bc4de8458e13","modified":1534925985088},{"_id":"public/tags/requestAnimationFrame/index.html","hash":"5677869b13531fb9c0d0de8994c804c97ed7e8b2","modified":1534925985088},{"_id":"public/tags/åŠ¨ç”»/index.html","hash":"6416d008bfce0c615ce9398e7d10bf8bbfc75dc8","modified":1534925985088},{"_id":"public/tags/style-sheet/index.html","hash":"823f0afd80e9b6db9fe46136f2266671bc819d84","modified":1534925985088},{"_id":"public/tags/é—­åŒ…/index.html","hash":"17d2dac99514167c0d6e629bbe0bc06fe257b0b3","modified":1534925985088},{"_id":"public/tags/closure/index.html","hash":"e8b96df50eb60b5b9385e4b946fab98c6f838e27","modified":1534925985089},{"_id":"public/tags/listeners/index.html","hash":"6465c3b8ee9e0c9529a8c5ab1d116ad3b8d65cba","modified":1534925985089},{"_id":"public/tags/cache/index.html","hash":"04754f1e296086f3c6d4e8f2092511944891d1d6","modified":1534925985089},{"_id":"public/tags/jquery/index.html","hash":"326f323bed0abf7d58f9cd97009d8ab1517bbaa4","modified":1534925985089},{"_id":"public/tags/æ¸²æŸ“/index.html","hash":"cd4c5d7c814c902246869288765093791c9d8329","modified":1534925985089},{"_id":"public/tags/render/index.html","hash":"5be6fa584008c97b062d45e9352466b5dbcac405","modified":1534925985089},{"_id":"public/tags/ç¡¬ä»¶åŠ é€Ÿ/index.html","hash":"be0a78b7665191c36eff321a77892d9e695915e7","modified":1534925985089},{"_id":"public/2017/11/23/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/index.html","hash":"eefed576b607524477da488fb70f7e94d2f60b89","modified":1534925985089},{"_id":"public/2017/11/23/requestAnimationFrame/index.html","hash":"02dea53bc52f48833dbcbf5198a53e15aa239e66","modified":1534925985089},{"_id":"public/2017/11/21/æµè§ˆå™¨æ¸²æŸ“ç®€è¿°/index.html","hash":"528932cb53f04f10b998a00c12af9e5a252d93d5","modified":1534925985089},{"_id":"public/2017/11/13/å†…å­˜æ³„éœ²ä¹‹jQuery-cache/index.html","hash":"8c6933b28af9861eff2991ccf6a7a46947cc626a","modified":1534925985089},{"_id":"public/2017/11/10/IE-8å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„éœ²/index.html","hash":"26f637dd3ea68a3e32d5a07fee126c93d2e0e823","modified":1534925985089},{"_id":"public/2017/11/01/å†…å­˜æ³„éœ²ä¹‹Listeners/index.html","hash":"b0502f08f55dfcf6d64ac69eaa1622ca8a6762f2","modified":1534925985089},{"_id":"public/2017/09/30/JavaScriptå†…å­˜é‚£ç‚¹äº‹/index.html","hash":"d1891ab6b932c8fa77a4614805ace635107e5415","modified":1534925985089},{"_id":"public/2017/09/19/async-vs-defer/index.html","hash":"ea1f4f23c55c6ec5ac40aab6399e6d23c3443744","modified":1534925985089},{"_id":"public/2017/09/19/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/index.html","hash":"fe6e19df465264315ca0cd4d37429e6cfb23c446","modified":1534925985089},{"_id":"public/2017/08/29/css-zIndex/index.html","hash":"865d570d17d88a51bdb22a44412c500dba22e6fd","modified":1534925985089},{"_id":"public/CNAME","hash":"6211c7971e7c73fcde3c235ab6183fd4fbdbcf67","modified":1534925985099},{"_id":"public/images/apple-touch-icon.png","hash":"57e2def34682655f41a0be2d083f16765ba7858b","modified":1534925985099},{"_id":"public/images/favicon-192x192.png","hash":"96e6fcbbb13a5914a6131391e210eb7dfd13d692","modified":1534925985099},{"_id":"public/images/favicon.ico","hash":"189f9842bcb79a6f8f9e8445bc8bbd773443826b","modified":1534925985099},{"_id":"public/images/logo.png","hash":"199750f3a39251ca97d36ed8317d88dfdc2dfe66","modified":1534925985099},{"_id":"public/2017/09/19/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.mindnode/style.mindnodestyle/contents.xml","hash":"e1ed5eb03e419add20371f2f3aa595c7a0a18f02","modified":1534925985099},{"_id":"public/2017/09/19/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.mindnode/style.mindnodestyle/metadata.plist","hash":"5afc7f0891e0599decc407be87bb0486b35050d2","modified":1534925985099},{"_id":"public/2017/11/21/æµè§ˆå™¨æ¸²æŸ“ç®€è¿°/render.png","hash":"635cdeb948f5954f331f6f5f663054d34bc07ce8","modified":1534925985099},{"_id":"public/2017/09/30/JavaScriptå†…å­˜é‚£ç‚¹äº‹/cycle.png","hash":"cf9958415e58e7af46bcf695e49d4648105a1935","modified":1534925985099},{"_id":"public/2017/09/30/JavaScriptå†…å­˜é‚£ç‚¹äº‹/life-cycle.png","hash":"36c1188b40a1faa2ada23d11bfbef3c86177660a","modified":1534925985099},{"_id":"public/2017/09/30/JavaScriptå†…å­˜é‚£ç‚¹äº‹/no-cycle.png","hash":"5d894fa7c5911f6d3a03bc4b4fc854e2be828b7e","modified":1534925985099},{"_id":"public/2017/09/19/async-vs-defer/legend.svg","hash":"0242b6d7f1d194fb80b2f441671def4f3014bb20","modified":1534925985099},{"_id":"public/2017/09/19/async-vs-defer/script-async.svg","hash":"ad7dc71402604b8faeb136f3ba92170a5e704ce2","modified":1534925985099},{"_id":"public/2017/09/19/async-vs-defer/script-defer.svg","hash":"6b02c3f7322fccd9f167c0477234d50754960edd","modified":1534925985099},{"_id":"public/2017/09/19/async-vs-defer/script.svg","hash":"a578f6355a6b14cac35fc6e4af48d06dd7bba83f","modified":1534925985100},{"_id":"public/2017/11/13/å†…å­˜æ³„éœ²ä¹‹jQuery-cache/jquery.jpg","hash":"dfb84e73decd4b50e7455f36b88ae08a04dc9b39","modified":1534925985100},{"_id":"public/2017/11/13/å†…å­˜æ³„éœ²ä¹‹jQuery-cache/jquery_cache_2_x.png","hash":"755ad521a6ba49a0d5b9c8eb2bd1675bfdd1e2d1","modified":1534925985100},{"_id":"public/2017/11/13/å†…å­˜æ³„éœ²ä¹‹jQuery-cache/jquery_cache_1_x.png","hash":"65f1c5374f0a31c5a6a44502388725497ef7c27c","modified":1534925985100},{"_id":"public/2017/11/23/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure.png","hash":"4ac2598655f181befd322eae79f8d9774ac69362","modified":1534925985100},{"_id":"public/2017/09/19/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.mindnode/contents.xml","hash":"2fef4a611c3c8cf1eff16a8769a88061993574d7","modified":1534925985100},{"_id":"public/2017/09/19/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.mindnode/viewState.plist","hash":"6f2f7999d50e8ccfa1d13c9f72ac119da517c59c","modified":1534925985100},{"_id":"public/2017/09/19/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.png","hash":"467242b5fe6952256f9deb21b3dddc1222da2cb3","modified":1534925985100},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1534925985337},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1534925985338},{"_id":"public/2017/11/23/requestAnimationFrame/arf.png","hash":"bb24777516237651c52bf35c0deacb60637d7e4d","modified":1534925985338},{"_id":"public/2017/11/01/å†…å­˜æ³„éœ²ä¹‹Listeners/listener_location.png","hash":"9f9a510b333b117b4d896764cad5013391ef8d24","modified":1534925985338},{"_id":"public/2017/09/19/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.mindnode/QuickLook/Preview.jpg","hash":"b4656d0e7b77b48f19d5ed7a77661f8b498aecfa","modified":1534925985339},{"_id":"public/2017/09/19/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/async-network.png","hash":"5056be23b1a31e794c1d6527c383aa3563e4c90d","modified":1534925985339},{"_id":"public/2017/09/19/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/async-network1.png","hash":"e9586915ed4c6df4fef034213d83a34821dac22f","modified":1534925985339},{"_id":"public/2017/09/19/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/default-network.png","hash":"499e55e1146a6fe7bff0da967f2aed70688af16a","modified":1534925985339},{"_id":"public/2017/09/19/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/async.png","hash":"a70167fdb163e189687283c562f57c176785675a","modified":1534925985339},{"_id":"public/2017/09/19/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/media-network.png","hash":"040baff4d17cd7bcf7cc8288eac4b1bc793523c6","modified":1534925985339},{"_id":"public/2017/09/19/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/media.png","hash":"73b6c03849561e8ac621be6dd4aa3091e7ebc5ec","modified":1534925985339},{"_id":"public/2017/09/19/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/script.png","hash":"5910b915601f4afcdac68af6ce6451d257884b90","modified":1534925985339},{"_id":"public/2017/09/19/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet-default.png","hash":"85c33491724afcd70553522704567fee95627fcb","modified":1534925985339},{"_id":"public/2017/09/19/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/script-network.png","hash":"3cc9e3ca4e95a5eb444a29750346eaac0e712d6c","modified":1534925985339},{"_id":"public/js/main.js","hash":"2703a7cb4fc7056d13215b9fde675da426b9cdc4","modified":1534925985345},{"_id":"public/lib/justified-gallery/justifiedGallery.min.css","hash":"13fbcba5e97aa88b748d94d3efc4718475279907","modified":1534925985345},{"_id":"public/lib/meslo-LG/styles.css","hash":"eb88d0b9f1bbef99070e9627e2c96d892036bf7e","modified":1534925985345},{"_id":"public/css/style.css","hash":"6a755b1c4149a9d0adbdca8a8496a780e43d3ad6","modified":1534925985345},{"_id":"public/lib/justified-gallery/jquery.justifiedGallery.min.js","hash":"b2683e7a872bc109b1756a65188a37cef7d0bd5c","modified":1534925985345},{"_id":"public/lib/jquery/jquery.min.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1534925985345},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1534925985345},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1534925985345},{"_id":"public/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1534925985345},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1534925985345},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1534925985345},{"_id":"public/2017/11/23/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure2.png","hash":"091a279732357ca7d5790d6462edd1c26f02a4ff","modified":1534925985345},{"_id":"public/2017/11/23/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure3.png","hash":"688c5eb2cfe3ef308f0b1bba0bf5f782ec951423","modified":1534925985345},{"_id":"public/2017/11/01/å†…å­˜æ³„éœ²ä¹‹Listeners/listeners_event.png","hash":"2dea6583ab164a3490c899db234befb253a90247","modified":1534925985346},{"_id":"public/2017/11/23/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure4.png","hash":"f765361ae7248a18c91f31b4538a36e80d8c915d","modified":1534925985352},{"_id":"public/2017/09/30/JavaScriptå†…å­˜é‚£ç‚¹äº‹/mark-sweep.gif","hash":"fd13ddb270cd612668b97015a01cd2ec3ab937b1","modified":1534925985352},{"_id":"public/2017/11/23/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure5.png","hash":"56972df77d755eee3346f9bac1e0a95b32d2938d","modified":1534925985353},{"_id":"public/2017/11/01/å†…å­˜æ³„éœ²ä¹‹Listeners/listeners_fixed.png","hash":"4681dba3574b4da97d76177236f21b7ed06bb09b","modified":1534925985353},{"_id":"public/2017/11/01/å†…å­˜æ³„éœ²ä¹‹Listeners/listeners_resize.png","hash":"d4458465f2db6087b47394e7c1fcb4be64df5fd3","modified":1534925985354},{"_id":"public/2017/11/13/å†…å­˜æ³„éœ²ä¹‹jQuery-cache/jquery1_x.png","hash":"9b18da36937eb3a668a5752d3a8bc91684a61eb2","modified":1534925985354},{"_id":"public/2017/11/13/å†…å­˜æ³„éœ²ä¹‹jQuery-cache/jquery2_x.png","hash":"596199653248639e87d02b3b5b7ef5a83a4670c2","modified":1534925985354},{"_id":"public/2017/11/23/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure1.png","hash":"45989ef2609317ba1984647890aa2b596bfb1416","modified":1534925985361},{"_id":"public/2017/11/01/å†…å­˜æ³„éœ²ä¹‹Listeners/listeners_resize_after.png","hash":"7062c2446d38aa22ba84fd8b630abeeb0e25f038","modified":1534925985362},{"_id":"public/2017/11/10/IE-8å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„éœ²/leakage.png","hash":"84d9b8945d6fc27522dc34027f7743b40261986d","modified":1534925985368},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1534925985375},{"_id":"public/2017/11/21/æµè§ˆå™¨æ¸²æŸ“ç®€è¿°/tiles.png","hash":"0f5a23cc8c42f8b38b70fba4dea5c147dca25b86","modified":1534925985400},{"_id":"public/lib/meslo-LG/fonts/MesloLGL-Italic.ttf","hash":"96c97a0a098ca40802f948ae56fa37aa6683d034","modified":1534925985406},{"_id":"public/lib/meslo-LG/fonts/MesloLGM-Italic.ttf","hash":"68700db02debd4b922304134da83b829cbfddfc9","modified":1534925985406},{"_id":"public/lib/meslo-LG/fonts/MesloLGS-Italic.ttf","hash":"7f7cdbdcc26279c04046632e22d872f111bc9399","modified":1534925985406},{"_id":"public/2017/11/01/å†…å­˜æ³„éœ²ä¹‹Listeners/listeners_performance.png","hash":"cc4a507bdbe21b724c17db5533779f73c0f0d6e0","modified":1534925985407},{"_id":"public/lib/meslo-LG/fonts/MesloLGL-Bold.ttf","hash":"bfa1ed9a263ed78462f06d322de13bd5bd0906b2","modified":1534925985411},{"_id":"public/lib/meslo-LG/fonts/MesloLGL-BoldItalic.ttf","hash":"a9a431fc7a6c3a67c98021d4035c12a07a4f1070","modified":1534925985411},{"_id":"public/lib/meslo-LG/fonts/MesloLGM-Bold.ttf","hash":"a8a8df3393bccc365335fc5eb0a62a6b7ccd32b9","modified":1534925985412},{"_id":"public/lib/meslo-LG/fonts/MesloLGL-Regular.ttf","hash":"2b912dd13f052f645ee19951604610bb350d50af","modified":1534925985413},{"_id":"public/lib/meslo-LG/fonts/MesloLGM-BoldItalic.ttf","hash":"65ddb11e75ee93909e845ab912a36717c48f1c94","modified":1534925985415},{"_id":"public/lib/meslo-LG/fonts/MesloLGM-Regular.ttf","hash":"5e220152adefe905b2197f873d7cee99eca50e91","modified":1534925985416},{"_id":"public/lib/meslo-LG/fonts/MesloLGS-Bold.ttf","hash":"df202ce09cbdc70bc16b81983a13ef0f94e46f10","modified":1534925985417},{"_id":"public/lib/meslo-LG/fonts/MesloLGS-BoldItalic.ttf","hash":"d895a1bd25e36c58b7f463ebe14de09f186d5ab4","modified":1534925985417},{"_id":"public/lib/meslo-LG/fonts/MesloLGS-Regular.ttf","hash":"56fa0e33a390b704afc56af93a31576ccdbbdd9e","modified":1534925985418},{"_id":"public/images/theme overview.psd","hash":"8dc11d9d289c247423911e962c4eb3a556dc67d1","modified":1534925985440}],"Category":[{"name":"memory","_id":"cjl4vata600041hn96fz5igqm"}],"Data":[],"Page":[{"title":"About","_content":"\n<style type=\"text/css\">\n    .type-wr{\n        padding-top: 4rem;\n    }\n    .skills {\n        width: 382px;\n        width: 100%;\n        max-width: 360px;\n        overflow: hidden;\n        border-right: .1em solid #d44375;\n        white-space: nowrap;\n        margin: 0 auto;\n        letter-spacing: .1em;\n        font-weight: 300;\n        color: #2C3E50;\n        font-size: 1.45rem;\n        \n        -webkit-box-sizing: border-box;\n        -moz-box-sizing: border-box;\n        box-sizing: border-box;\n    }\n    .skills .sg{\n        color:#d44375;\n        font-weight: bold;\n    }\n    .skills b{\n        font-weight: 700;\n        font-style: normal;\n    }\n    .skills .dot{\n        font-size: 12px;\n    }\n    .typewriter {\n        animation: typing 6s steps(40, end), blink-caret .75s step-end infinite;\n    }\n    /* The typing effect */\n    @keyframes typing {\n        from {\n            width: 0;\n        }\n        to {\n            width: 382px;\n            width: 100%;\n        }\n    }\n    /* The typewriter cursor effect */\n    @keyframes blink-caret {\n        from,\n        to {\n            border-color: transparent;\n        }\n        50% {\n            border-color: #d44375;\n        }\n    }\n    @media screen and (min-width: 320px) and (max-width: 480px) {\n        .skills{\n            font-size: 1.08rem;\n            max-width: 272px;\n        }\n    }\n</style>\n\n<div class=\"type-wr\">\n    <div class=\"skills typewriter\">Hi,<span class=\"sg\">æœç‹—</span><b>å¯¼èˆªå‰ç«¯</b>å¼€å‘ç»„ğŸ³ğŸ³<span class=\"dot\">..</span></div>\n</div>\n","source":"about/index.html","raw":"---\ntitle: About\n---\n\n<style type=\"text/css\">\n    .type-wr{\n        padding-top: 4rem;\n    }\n    .skills {\n        width: 382px;\n        width: 100%;\n        max-width: 360px;\n        overflow: hidden;\n        border-right: .1em solid #d44375;\n        white-space: nowrap;\n        margin: 0 auto;\n        letter-spacing: .1em;\n        font-weight: 300;\n        color: #2C3E50;\n        font-size: 1.45rem;\n        \n        -webkit-box-sizing: border-box;\n        -moz-box-sizing: border-box;\n        box-sizing: border-box;\n    }\n    .skills .sg{\n        color:#d44375;\n        font-weight: bold;\n    }\n    .skills b{\n        font-weight: 700;\n        font-style: normal;\n    }\n    .skills .dot{\n        font-size: 12px;\n    }\n    .typewriter {\n        animation: typing 6s steps(40, end), blink-caret .75s step-end infinite;\n    }\n    /* The typing effect */\n    @keyframes typing {\n        from {\n            width: 0;\n        }\n        to {\n            width: 382px;\n            width: 100%;\n        }\n    }\n    /* The typewriter cursor effect */\n    @keyframes blink-caret {\n        from,\n        to {\n            border-color: transparent;\n        }\n        50% {\n            border-color: #d44375;\n        }\n    }\n    @media screen and (min-width: 320px) and (max-width: 480px) {\n        .skills{\n            font-size: 1.08rem;\n            max-width: 272px;\n        }\n    }\n</style>\n\n<div class=\"type-wr\">\n    <div class=\"skills typewriter\">Hi,<span class=\"sg\">æœç‹—</span><b>å¯¼èˆªå‰ç«¯</b>å¼€å‘ç»„ğŸ³ğŸ³<span class=\"dot\">..</span></div>\n</div>\n","date":"2018-08-22T08:06:45.000Z","updated":"2018-08-22T08:06:45.000Z","path":"about/index.html","comments":1,"layout":"page","_id":"cjl4vatc3001q1hn9zhlvtf60","content":"\n<style type=\"text/css\">\n    .type-wr{\n        padding-top: 4rem;\n    }\n    .skills {\n        width: 382px;\n        width: 100%;\n        max-width: 360px;\n        overflow: hidden;\n        border-right: .1em solid #d44375;\n        white-space: nowrap;\n        margin: 0 auto;\n        letter-spacing: .1em;\n        font-weight: 300;\n        color: #2C3E50;\n        font-size: 1.45rem;\n        \n        -webkit-box-sizing: border-box;\n        -moz-box-sizing: border-box;\n        box-sizing: border-box;\n    }\n    .skills .sg{\n        color:#d44375;\n        font-weight: bold;\n    }\n    .skills b{\n        font-weight: 700;\n        font-style: normal;\n    }\n    .skills .dot{\n        font-size: 12px;\n    }\n    .typewriter {\n        animation: typing 6s steps(40, end), blink-caret .75s step-end infinite;\n    }\n    /* The typing effect */\n    @keyframes typing {\n        from {\n            width: 0;\n        }\n        to {\n            width: 382px;\n            width: 100%;\n        }\n    }\n    /* The typewriter cursor effect */\n    @keyframes blink-caret {\n        from,\n        to {\n            border-color: transparent;\n        }\n        50% {\n            border-color: #d44375;\n        }\n    }\n    @media screen and (min-width: 320px) and (max-width: 480px) {\n        .skills{\n            font-size: 1.08rem;\n            max-width: 272px;\n        }\n    }\n</style>\n\n<div class=\"type-wr\">\n    <div class=\"skills typewriter\">Hi,<span class=\"sg\">æœç‹—</span><b>å¯¼èˆªå‰ç«¯</b>å¼€å‘ç»„ğŸ³ğŸ³<span class=\"dot\">..</span></div>\n</div>\n","site":{"data":{}},"excerpt":"","more":"\n<style type=\"text/css\">\n    .type-wr{\n        padding-top: 4rem;\n    }\n    .skills {\n        width: 382px;\n        width: 100%;\n        max-width: 360px;\n        overflow: hidden;\n        border-right: .1em solid #d44375;\n        white-space: nowrap;\n        margin: 0 auto;\n        letter-spacing: .1em;\n        font-weight: 300;\n        color: #2C3E50;\n        font-size: 1.45rem;\n        \n        -webkit-box-sizing: border-box;\n        -moz-box-sizing: border-box;\n        box-sizing: border-box;\n    }\n    .skills .sg{\n        color:#d44375;\n        font-weight: bold;\n    }\n    .skills b{\n        font-weight: 700;\n        font-style: normal;\n    }\n    .skills .dot{\n        font-size: 12px;\n    }\n    .typewriter {\n        animation: typing 6s steps(40, end), blink-caret .75s step-end infinite;\n    }\n    /* The typing effect */\n    @keyframes typing {\n        from {\n            width: 0;\n        }\n        to {\n            width: 382px;\n            width: 100%;\n        }\n    }\n    /* The typewriter cursor effect */\n    @keyframes blink-caret {\n        from,\n        to {\n            border-color: transparent;\n        }\n        50% {\n            border-color: #d44375;\n        }\n    }\n    @media screen and (min-width: 320px) and (max-width: 480px) {\n        .skills{\n            font-size: 1.08rem;\n            max-width: 272px;\n        }\n    }\n</style>\n\n<div class=\"type-wr\">\n    <div class=\"skills typewriter\">Hi,<span class=\"sg\">æœç‹—</span><b>å¯¼èˆªå‰ç«¯</b>å¼€å‘ç»„ğŸ³ğŸ³<span class=\"dot\">..</span></div>\n</div>\n"}],"Post":[{"title":"IE<8å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„éœ²","date":"2017-11-10T10:05:58.000Z","author":"singsong","_content":"\n![leakage](./leakage.png)\n\nåœ¨IE<8ç‰ˆæœ¬ä¸­ï¼ŒJScriptåƒåœ¾å›æ”¶å™¨ä»…ç®¡ç†JScriptå¯¹è±¡ç”Ÿå‘½å‘¨æœŸè€Œä¸ä¼šç®¡ç†DOMå¯¹è±¡çš„(å³DOMå¯¹è±¡æœ‰è‡ªå·±çš„åƒåœ¾å›æ”¶å™¨)ã€‚å› æ­¤JScriptå›æ”¶å™¨ä¸ä¼šè§£é™¤æ‰DOMå¯¹è±¡ä¸Jscriptå¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨ï¼Œè¿™ä»è€Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚\nåœ¨IE6ä¸­ï¼Œå¾ªç¯å¼•ç”¨åªåœ¨IEæµè§ˆå™¨ç¨‹åºé€€å‡ºæ—¶æ‰ä¼šè¢«è§£é™¤ï¼Œè€Œåœ¨IE7ä¸­ï¼Œç¦»å¼€å½“å‰é¡µé¢æ—¶ï¼Œæ‰ä¼šè§£é™¤é¡µé¢ä¸­çš„å¾ªç¯å¼•ç”¨ã€‚IE8ä¿®å¤è¯¥é—®é¢˜ï¼ŒJScriptåƒåœ¾å›æ”¶å™¨ä¼šå°†å¼•ç”¨çš„DOMå¯¹è±¡è§†ä¸ºJScriptå¯¹è±¡ï¼Œä»è€Œé¿å…å¾ªç¯å¼•ç”¨ä¸èƒ½è¢«è§£é™¤çš„é—®é¢˜ï¼ˆ_æ³¨ï¼šè¿™é‡Œå¾ªç¯å¼•ç”¨è§£é™¤æ˜¯æŒ‡æµè§ˆå™¨è‡ªåŠ¨è§£é™¤å¾ªç¯å¼•ç”¨_ï¼‰ã€‚\n\nIE6-7ä¸­ç®¡ç†DOMå¯¹è±¡çš„åƒåœ¾å›æ”¶å™¨æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ï¼Œå¦‚æœDOMå¯¹è±¡ä¸jså¯¹è±¡å­˜åœ¨å¾ªç¯å¼•ç”¨ã€‚éœ€è¦å°†DOMå¯¹è±¡ä¸Šçš„expandoå±æ€§è®¾ç½®ä¸ºnullæˆ–é‡æ–°èµ‹å€¼ã€‚è¿™æ ·æ‰èƒ½å›æ”¶DOMå¯¹è±¡ã€‚(_æ³¨ï¼šè¿™é‡Œåªæ˜¯é’ˆå¯¹DOMçš„å›æ”¶_)\n```html\n<html>\n    <head>\n        <script language=\"JScript\">\n        var myGlobalObject;\n        function SetupLeak()\n        {\n            myGlobalObject = document.getElementById(\"LeakedDiv\");// â† jså¯¹è±¡å¼•ç”¨DOMå¯¹è±¡\n            document.getElementById(\"LeakedDiv\").expandoProperty = myGlobalObject;// â† DOMå¯¹è±¡çš„expandoå±æ€§å¼•ç”¨jså¯¹è±¡\n        }\n        function BreakLeak()\n        {\n            document.getElementById(\"LeakedDiv\").expandoProperty = null;// â† è®¾ç½®ä¸ºnullæˆ–é‡æ–°èµ‹æ–°å€¼\n        }\n        </script>\n    </head>\n\n    <body onload=\"SetupLeak()\" onunload=\"BreakLeak()\">\n        <div id=\"LeakedDiv\"></div>\n    </body>\n</html>\n```\nä¸Šè¿°ä»£ç çš„å¾ªç¯å¼•ç”¨ä¸æ˜¯å¾ˆå¤æ‚ï¼Œå¾ˆå®¹æ˜“å‘ç°ã€‚ä¸è¿‡å®é™…é¡¹ç›®ä¸­å¯èƒ½ä¼šå­˜åœ¨å¾ªç¯é“¾å¾ˆé•¿çš„æƒ…å†µï¼š\n```js\n    (function(){\n        var d={b:document.body}\n        var obj={doc:d}; // â† obj.doc.b === document.body\n        document.body.o=obj; // â† å¾ªç¯å¼•ç”¨: document.body.o.doc.b === document.body\n    })();\n```\nå¦å¤–ä¸€ç§å¸¸è§çš„å¾ªç¯å¼•ç”¨å‘ç”Ÿåœ¨é—­åŒ…ä¸­ï¼š\n```js\n(function(){\n    var b=document.body; // â† åˆ›å»ºä¸€ä¸ªå¼•ç”¨document.bodyçš„å˜é‡\"b\"\n    b.onclick=function() { // â† b.onclickå¼•ç”¨function\n    // é€šè¿‡é—­åŒ…èƒ½åœ¨å‡½æ•°ä¸­èƒ½è®¿é—®åˆ°\"b\"\n    // do something...\n    };\n})();\n```\n## ä¸ºä»€ä¹ˆDOMçš„åƒåœ¾å›æ”¶å™¨æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ï¼Ÿ\nIEä¸­æœ‰ä¸€éƒ¨åˆ†å¯¹è±¡å¹¶ä¸æ˜¯åŸç”Ÿjså¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå…¶å†…å­˜æ³„éœ²DOMå’ŒBOMä¸­çš„å¯¹è±¡å°±æ˜¯ä½¿ç”¨C++ä»¥COM(component object modelï¼Œç»„ä»¶å¯¹è±¡æ¨¡å‹)å¯¹è±¡çš„å½¢å¼å®ç°çš„ï¼Œè€ŒCOMå¯¹è±¡çš„åƒåœ¾å›æ”¶æœºåˆ¶é‡‡ç”¨çš„å°±æ˜¯å¼•ç”¨è®¡æ•°ç­–ç•¥ã€‚å› æ­¤ï¼Œå³ä½¿IEçš„jså¼•æ“é‡‡ç”¨æ ‡è®°æ¸…é™¤ç­–ç•¥æ¥å®ç°ï¼Œä½†jsè®¿é—®çš„COMå¯¹è±¡ä¾ç„¶æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥çš„ã€‚æ¢å¥è¯è¯´ï¼Œåªè¦åœ¨IEä¸­æ¶‰åŠCOMå¯¹è±¡ï¼Œå°±ä¼šå­˜åœ¨å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚åœ¨IE9æŠŠBOMå’ŒDOMå¯¹è±¡è½¬æ¢ä¸ºçœŸæ­£çš„jså¯¹è±¡ã€‚\n\né™¤äº†ä½ç‰ˆæœ¬çš„IEå¤–ï¼Œåœ¨ä½ç‰ˆæœ¬çš„Firefox(å¦‚Firefox3.0)ä¸­ä¹Ÿå­˜åœ¨ç±»ä¼¼é—®é¢˜ã€‚å®ƒä¹Ÿæ˜¯é€šè¿‡COMæ¥ç®¡ç†DOMï¼Œä¸Windowsçš„COMç±»ä¼¼ï¼ŒMozillaçš„XPCOMä¹Ÿæ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ã€‚\n\n## å¦‚ä½•é¿å…åŠä¿®å¤ï¼Ÿ\nå¾ªç¯å¼•ç”¨æ˜¯å¯¼è‡´ä½ç‰ˆæœ¬IEå’ŒFirefoxæµè§ˆå™¨å†…å­˜æ³„éœ²çš„çœŸæ­£åŸå› ï¼Œå› æ­¤æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯é¿å…åœ¨DOMå’ŒJSä¹‹é—´åˆ›å»ºç›¸äº’å¼•ç”¨ã€‚ç¡®ä¿æ€»æ˜¯JSå¯¹è±¡å•å‘å¼•ç”¨DOMå¯¹è±¡ï¼Œæˆ–DOMå¯¹è±¡å•å‘å¼•ç”¨JSå¯¹è±¡ã€‚è™½ç„¶è¯´èµ·æ¥ç®€å•ï¼Œä½†å®é™…æƒ…å†µæ˜¯å¾ˆéš¾åšåˆ°çš„ã€‚é‚£å¦‚ä½•ä¿®å¤å¾ªç¯å¼•ç”¨å°±å¾ˆé‡è¦äº†ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ªå­˜åœ¨å¾ªç¯å¼•ç”¨DOMå¯¹è±¡çš„é˜Ÿåˆ—ï¼Œåœ¨é¡µé¢unloadæ—¶ï¼Œåšå¦‚ä¸‹å¤„ç†ï¼š\n```js\n(function(){\n    var unLoaders=[];\n    myDomNode.object=new myObject(); // â† å‡è®¾è¿™é‡Œåˆ›å»ºä¸€ä¸ªå¾ªç¯å¼•ç”¨ï¼Œä¼šå¼•èµ·å†…å­˜æ³„éœ²\n    unLoaders.push(myDomNode); // â† ç¼“å­˜myDomNode\n\n    var unload=function(){ // â† unloadå›è°ƒå‡½æ•°\n    for(var i=unLoaders.length-1;i>-1;iâ€“){\n        unLoaders[i].object=null; // â† åˆ‡æ–­å¾ªç¯å¼•ç”¨\n    }\n    };\n    window.addEvnetListener(â€™unloadâ€™, unload); // â† ç»‘å®šunload\n})();\n```\njqueryåœ¨å¤„ç†IEä½ç‰ˆæœ¬ç±»ä¼¼é—®é¢˜æ—¶ï¼Œé‡‡ç”¨çš„ä¹Ÿæ˜¯ä¸Šè¿°æ–¹æ³•ï¼Œ[jqueryæºç ](https://github.com/jquery/jquery/blob/1.4.4rc1/src/event.js#L1169)ï¼š\n```js\n// Prevent memory leaks in IE\n// Window isn't included so as not to unbind existing unload events\n// More info:\n//  - http://isaacschlueter.com/2006/10/msie-memory-leaks/\nif ( window.attachEvent && !window.addEventListener ) {\n\tjQuery(window).bind(\"unload\", function() {\n\t\tfor ( var id in jQuery.cache ) {\n\t\t\tif ( jQuery.cache[ id ].handle ) {\n\t\t\t\t// Try/Catch is to handle iframes being unloaded, see #4280\n\t\t\t\ttry {\n\t\t\t\t\tjQuery.event.remove( jQuery.cache[ id ].handle.elem );\n\t\t\t\t} catch(e) {}\n\t\t\t}\n\t\t}\n\t});\n}\n```\n\n\n\n>This memory leak occurs because DOM objects are non-JScript objects. DOM objects are not in the mark-and-sweep garbage collection scheme of JScript. Therefore, the circular reference between the DOM objects and the JScript handlers will not be broken until the browser completely tears down the page. This memory leak will end when the browser opens a new Web page or when the browser window is closed.\n\n\n## æ€»ç»“\néšç€ç§»åŠ¨äº’è”ç½‘çš„é£é€Ÿå‘å±•ï¼ŒIEä¹Ÿå‘W3Cæ ‡å‡†é æ‹¢ï¼Œä½ç‰ˆæœ¬æµè§ˆå™¨æ­£é€æ¸è¢«æ·˜æ±°ã€‚ä¸è¿‡å®é™…ä¸šåŠ¡ä¸­ï¼Œè¿˜æ˜¯å­˜åœ¨å¯¹æŸäº›ä½ç‰ˆæœ¬è¿›è¡Œæ”¯æŒï¼Œè™½ç„¶æ¦‚ç‡å¾ˆå°‘ï¼Œä¸è¿‡ä¸ºäº†ä¿è¯ç”¨æˆ·ä½“éªŒï¼Œéœ€è¦å¯¹æœ¬æ–‡æ¶‰åŠçš„çŸ¥è¯†ç‚¹æœ‰æ‰€äº†è§£ã€‚ä¹Ÿè®¸ä½ çš„ä¸šåŠ¡ä¸­ï¼Œä¸éœ€è¦å¯¹ä½ç‰ˆæœ¬æµè§ˆå™¨æ”¯æŒã€‚é‚£å°±æŠŠæœ¬æ–‡å½“æˆæµè§ˆå™¨å‘å±•å²æ¥äº†è§£å§ï¼Œä¹Ÿå¸Œæœ›ä½ èƒ½ä»æ–‡ç« æœ‰æ‰€æ”¶è·ã€‚\n\n\n## å‚è€ƒæ–‡ç« ï¼š\n- [Circular Memory Leak Mitigation](https://msdn.microsoft.com/en-us/library/dd361842(v=vs.85).aspx)\n- [DOM: why is this a memory leak?](https://stackoverflow.com/questions/15761094/dom-why-is-this-a-memory-leak)\n- [Internet Explorer Event Handler Leaks](http://www.reigndropsfall.net/2011/01/05/internet-explorer-event-handler-leaks/)\n- [Avoiding leaks in JavaScript XPCOM components](https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Guide/Avoiding_leaks_in_JavaScript_components)\n- [JScript Memory Leaks](http://www.crockford.com/javascript/memory/leak.html)\n- [Memory Leaks in Microsoft Internet Explorer](http://isaacschlueter.com/2006/10/msie-memory-leaks/trackback/index.html)","source":"_posts/IE-8å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„éœ².md","raw":"---\ntitle: IE<8å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„éœ²\ndate: 2017-11-10 18:05:58\ntags: [IE6, å†…å­˜æ³„éœ², ä¼˜åŒ–]\nauthor: singsong\n---\n\n![leakage](./leakage.png)\n\nåœ¨IE<8ç‰ˆæœ¬ä¸­ï¼ŒJScriptåƒåœ¾å›æ”¶å™¨ä»…ç®¡ç†JScriptå¯¹è±¡ç”Ÿå‘½å‘¨æœŸè€Œä¸ä¼šç®¡ç†DOMå¯¹è±¡çš„(å³DOMå¯¹è±¡æœ‰è‡ªå·±çš„åƒåœ¾å›æ”¶å™¨)ã€‚å› æ­¤JScriptå›æ”¶å™¨ä¸ä¼šè§£é™¤æ‰DOMå¯¹è±¡ä¸Jscriptå¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨ï¼Œè¿™ä»è€Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚\nåœ¨IE6ä¸­ï¼Œå¾ªç¯å¼•ç”¨åªåœ¨IEæµè§ˆå™¨ç¨‹åºé€€å‡ºæ—¶æ‰ä¼šè¢«è§£é™¤ï¼Œè€Œåœ¨IE7ä¸­ï¼Œç¦»å¼€å½“å‰é¡µé¢æ—¶ï¼Œæ‰ä¼šè§£é™¤é¡µé¢ä¸­çš„å¾ªç¯å¼•ç”¨ã€‚IE8ä¿®å¤è¯¥é—®é¢˜ï¼ŒJScriptåƒåœ¾å›æ”¶å™¨ä¼šå°†å¼•ç”¨çš„DOMå¯¹è±¡è§†ä¸ºJScriptå¯¹è±¡ï¼Œä»è€Œé¿å…å¾ªç¯å¼•ç”¨ä¸èƒ½è¢«è§£é™¤çš„é—®é¢˜ï¼ˆ_æ³¨ï¼šè¿™é‡Œå¾ªç¯å¼•ç”¨è§£é™¤æ˜¯æŒ‡æµè§ˆå™¨è‡ªåŠ¨è§£é™¤å¾ªç¯å¼•ç”¨_ï¼‰ã€‚\n\nIE6-7ä¸­ç®¡ç†DOMå¯¹è±¡çš„åƒåœ¾å›æ”¶å™¨æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ï¼Œå¦‚æœDOMå¯¹è±¡ä¸jså¯¹è±¡å­˜åœ¨å¾ªç¯å¼•ç”¨ã€‚éœ€è¦å°†DOMå¯¹è±¡ä¸Šçš„expandoå±æ€§è®¾ç½®ä¸ºnullæˆ–é‡æ–°èµ‹å€¼ã€‚è¿™æ ·æ‰èƒ½å›æ”¶DOMå¯¹è±¡ã€‚(_æ³¨ï¼šè¿™é‡Œåªæ˜¯é’ˆå¯¹DOMçš„å›æ”¶_)\n```html\n<html>\n    <head>\n        <script language=\"JScript\">\n        var myGlobalObject;\n        function SetupLeak()\n        {\n            myGlobalObject = document.getElementById(\"LeakedDiv\");// â† jså¯¹è±¡å¼•ç”¨DOMå¯¹è±¡\n            document.getElementById(\"LeakedDiv\").expandoProperty = myGlobalObject;// â† DOMå¯¹è±¡çš„expandoå±æ€§å¼•ç”¨jså¯¹è±¡\n        }\n        function BreakLeak()\n        {\n            document.getElementById(\"LeakedDiv\").expandoProperty = null;// â† è®¾ç½®ä¸ºnullæˆ–é‡æ–°èµ‹æ–°å€¼\n        }\n        </script>\n    </head>\n\n    <body onload=\"SetupLeak()\" onunload=\"BreakLeak()\">\n        <div id=\"LeakedDiv\"></div>\n    </body>\n</html>\n```\nä¸Šè¿°ä»£ç çš„å¾ªç¯å¼•ç”¨ä¸æ˜¯å¾ˆå¤æ‚ï¼Œå¾ˆå®¹æ˜“å‘ç°ã€‚ä¸è¿‡å®é™…é¡¹ç›®ä¸­å¯èƒ½ä¼šå­˜åœ¨å¾ªç¯é“¾å¾ˆé•¿çš„æƒ…å†µï¼š\n```js\n    (function(){\n        var d={b:document.body}\n        var obj={doc:d}; // â† obj.doc.b === document.body\n        document.body.o=obj; // â† å¾ªç¯å¼•ç”¨: document.body.o.doc.b === document.body\n    })();\n```\nå¦å¤–ä¸€ç§å¸¸è§çš„å¾ªç¯å¼•ç”¨å‘ç”Ÿåœ¨é—­åŒ…ä¸­ï¼š\n```js\n(function(){\n    var b=document.body; // â† åˆ›å»ºä¸€ä¸ªå¼•ç”¨document.bodyçš„å˜é‡\"b\"\n    b.onclick=function() { // â† b.onclickå¼•ç”¨function\n    // é€šè¿‡é—­åŒ…èƒ½åœ¨å‡½æ•°ä¸­èƒ½è®¿é—®åˆ°\"b\"\n    // do something...\n    };\n})();\n```\n## ä¸ºä»€ä¹ˆDOMçš„åƒåœ¾å›æ”¶å™¨æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ï¼Ÿ\nIEä¸­æœ‰ä¸€éƒ¨åˆ†å¯¹è±¡å¹¶ä¸æ˜¯åŸç”Ÿjså¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå…¶å†…å­˜æ³„éœ²DOMå’ŒBOMä¸­çš„å¯¹è±¡å°±æ˜¯ä½¿ç”¨C++ä»¥COM(component object modelï¼Œç»„ä»¶å¯¹è±¡æ¨¡å‹)å¯¹è±¡çš„å½¢å¼å®ç°çš„ï¼Œè€ŒCOMå¯¹è±¡çš„åƒåœ¾å›æ”¶æœºåˆ¶é‡‡ç”¨çš„å°±æ˜¯å¼•ç”¨è®¡æ•°ç­–ç•¥ã€‚å› æ­¤ï¼Œå³ä½¿IEçš„jså¼•æ“é‡‡ç”¨æ ‡è®°æ¸…é™¤ç­–ç•¥æ¥å®ç°ï¼Œä½†jsè®¿é—®çš„COMå¯¹è±¡ä¾ç„¶æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥çš„ã€‚æ¢å¥è¯è¯´ï¼Œåªè¦åœ¨IEä¸­æ¶‰åŠCOMå¯¹è±¡ï¼Œå°±ä¼šå­˜åœ¨å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚åœ¨IE9æŠŠBOMå’ŒDOMå¯¹è±¡è½¬æ¢ä¸ºçœŸæ­£çš„jså¯¹è±¡ã€‚\n\né™¤äº†ä½ç‰ˆæœ¬çš„IEå¤–ï¼Œåœ¨ä½ç‰ˆæœ¬çš„Firefox(å¦‚Firefox3.0)ä¸­ä¹Ÿå­˜åœ¨ç±»ä¼¼é—®é¢˜ã€‚å®ƒä¹Ÿæ˜¯é€šè¿‡COMæ¥ç®¡ç†DOMï¼Œä¸Windowsçš„COMç±»ä¼¼ï¼ŒMozillaçš„XPCOMä¹Ÿæ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ã€‚\n\n## å¦‚ä½•é¿å…åŠä¿®å¤ï¼Ÿ\nå¾ªç¯å¼•ç”¨æ˜¯å¯¼è‡´ä½ç‰ˆæœ¬IEå’ŒFirefoxæµè§ˆå™¨å†…å­˜æ³„éœ²çš„çœŸæ­£åŸå› ï¼Œå› æ­¤æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯é¿å…åœ¨DOMå’ŒJSä¹‹é—´åˆ›å»ºç›¸äº’å¼•ç”¨ã€‚ç¡®ä¿æ€»æ˜¯JSå¯¹è±¡å•å‘å¼•ç”¨DOMå¯¹è±¡ï¼Œæˆ–DOMå¯¹è±¡å•å‘å¼•ç”¨JSå¯¹è±¡ã€‚è™½ç„¶è¯´èµ·æ¥ç®€å•ï¼Œä½†å®é™…æƒ…å†µæ˜¯å¾ˆéš¾åšåˆ°çš„ã€‚é‚£å¦‚ä½•ä¿®å¤å¾ªç¯å¼•ç”¨å°±å¾ˆé‡è¦äº†ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ªå­˜åœ¨å¾ªç¯å¼•ç”¨DOMå¯¹è±¡çš„é˜Ÿåˆ—ï¼Œåœ¨é¡µé¢unloadæ—¶ï¼Œåšå¦‚ä¸‹å¤„ç†ï¼š\n```js\n(function(){\n    var unLoaders=[];\n    myDomNode.object=new myObject(); // â† å‡è®¾è¿™é‡Œåˆ›å»ºä¸€ä¸ªå¾ªç¯å¼•ç”¨ï¼Œä¼šå¼•èµ·å†…å­˜æ³„éœ²\n    unLoaders.push(myDomNode); // â† ç¼“å­˜myDomNode\n\n    var unload=function(){ // â† unloadå›è°ƒå‡½æ•°\n    for(var i=unLoaders.length-1;i>-1;iâ€“){\n        unLoaders[i].object=null; // â† åˆ‡æ–­å¾ªç¯å¼•ç”¨\n    }\n    };\n    window.addEvnetListener(â€™unloadâ€™, unload); // â† ç»‘å®šunload\n})();\n```\njqueryåœ¨å¤„ç†IEä½ç‰ˆæœ¬ç±»ä¼¼é—®é¢˜æ—¶ï¼Œé‡‡ç”¨çš„ä¹Ÿæ˜¯ä¸Šè¿°æ–¹æ³•ï¼Œ[jqueryæºç ](https://github.com/jquery/jquery/blob/1.4.4rc1/src/event.js#L1169)ï¼š\n```js\n// Prevent memory leaks in IE\n// Window isn't included so as not to unbind existing unload events\n// More info:\n//  - http://isaacschlueter.com/2006/10/msie-memory-leaks/\nif ( window.attachEvent && !window.addEventListener ) {\n\tjQuery(window).bind(\"unload\", function() {\n\t\tfor ( var id in jQuery.cache ) {\n\t\t\tif ( jQuery.cache[ id ].handle ) {\n\t\t\t\t// Try/Catch is to handle iframes being unloaded, see #4280\n\t\t\t\ttry {\n\t\t\t\t\tjQuery.event.remove( jQuery.cache[ id ].handle.elem );\n\t\t\t\t} catch(e) {}\n\t\t\t}\n\t\t}\n\t});\n}\n```\n\n\n\n>This memory leak occurs because DOM objects are non-JScript objects. DOM objects are not in the mark-and-sweep garbage collection scheme of JScript. Therefore, the circular reference between the DOM objects and the JScript handlers will not be broken until the browser completely tears down the page. This memory leak will end when the browser opens a new Web page or when the browser window is closed.\n\n\n## æ€»ç»“\néšç€ç§»åŠ¨äº’è”ç½‘çš„é£é€Ÿå‘å±•ï¼ŒIEä¹Ÿå‘W3Cæ ‡å‡†é æ‹¢ï¼Œä½ç‰ˆæœ¬æµè§ˆå™¨æ­£é€æ¸è¢«æ·˜æ±°ã€‚ä¸è¿‡å®é™…ä¸šåŠ¡ä¸­ï¼Œè¿˜æ˜¯å­˜åœ¨å¯¹æŸäº›ä½ç‰ˆæœ¬è¿›è¡Œæ”¯æŒï¼Œè™½ç„¶æ¦‚ç‡å¾ˆå°‘ï¼Œä¸è¿‡ä¸ºäº†ä¿è¯ç”¨æˆ·ä½“éªŒï¼Œéœ€è¦å¯¹æœ¬æ–‡æ¶‰åŠçš„çŸ¥è¯†ç‚¹æœ‰æ‰€äº†è§£ã€‚ä¹Ÿè®¸ä½ çš„ä¸šåŠ¡ä¸­ï¼Œä¸éœ€è¦å¯¹ä½ç‰ˆæœ¬æµè§ˆå™¨æ”¯æŒã€‚é‚£å°±æŠŠæœ¬æ–‡å½“æˆæµè§ˆå™¨å‘å±•å²æ¥äº†è§£å§ï¼Œä¹Ÿå¸Œæœ›ä½ èƒ½ä»æ–‡ç« æœ‰æ‰€æ”¶è·ã€‚\n\n\n## å‚è€ƒæ–‡ç« ï¼š\n- [Circular Memory Leak Mitigation](https://msdn.microsoft.com/en-us/library/dd361842(v=vs.85).aspx)\n- [DOM: why is this a memory leak?](https://stackoverflow.com/questions/15761094/dom-why-is-this-a-memory-leak)\n- [Internet Explorer Event Handler Leaks](http://www.reigndropsfall.net/2011/01/05/internet-explorer-event-handler-leaks/)\n- [Avoiding leaks in JavaScript XPCOM components](https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Guide/Avoiding_leaks_in_JavaScript_components)\n- [JScript Memory Leaks](http://www.crockford.com/javascript/memory/leak.html)\n- [Memory Leaks in Microsoft Internet Explorer](http://isaacschlueter.com/2006/10/msie-memory-leaks/trackback/index.html)","slug":"IE-8å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„éœ²","published":1,"updated":"2018-08-22T08:06:45.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjl4vat9x00001hn9nsy7m8yf","content":"<p><img src=\"./leakage.png\" alt=\"leakage\"></p>\n<p>åœ¨IE&lt;8ç‰ˆæœ¬ä¸­ï¼ŒJScriptåƒåœ¾å›æ”¶å™¨ä»…ç®¡ç†JScriptå¯¹è±¡ç”Ÿå‘½å‘¨æœŸè€Œä¸ä¼šç®¡ç†DOMå¯¹è±¡çš„(å³DOMå¯¹è±¡æœ‰è‡ªå·±çš„åƒåœ¾å›æ”¶å™¨)ã€‚å› æ­¤JScriptå›æ”¶å™¨ä¸ä¼šè§£é™¤æ‰DOMå¯¹è±¡ä¸Jscriptå¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨ï¼Œè¿™ä»è€Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚<br>åœ¨IE6ä¸­ï¼Œå¾ªç¯å¼•ç”¨åªåœ¨IEæµè§ˆå™¨ç¨‹åºé€€å‡ºæ—¶æ‰ä¼šè¢«è§£é™¤ï¼Œè€Œåœ¨IE7ä¸­ï¼Œç¦»å¼€å½“å‰é¡µé¢æ—¶ï¼Œæ‰ä¼šè§£é™¤é¡µé¢ä¸­çš„å¾ªç¯å¼•ç”¨ã€‚IE8ä¿®å¤è¯¥é—®é¢˜ï¼ŒJScriptåƒåœ¾å›æ”¶å™¨ä¼šå°†å¼•ç”¨çš„DOMå¯¹è±¡è§†ä¸ºJScriptå¯¹è±¡ï¼Œä»è€Œé¿å…å¾ªç¯å¼•ç”¨ä¸èƒ½è¢«è§£é™¤çš„é—®é¢˜ï¼ˆ<em>æ³¨ï¼šè¿™é‡Œå¾ªç¯å¼•ç”¨è§£é™¤æ˜¯æŒ‡æµè§ˆå™¨è‡ªåŠ¨è§£é™¤å¾ªç¯å¼•ç”¨</em>ï¼‰ã€‚</p>\n<p>IE6-7ä¸­ç®¡ç†DOMå¯¹è±¡çš„åƒåœ¾å›æ”¶å™¨æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ï¼Œå¦‚æœDOMå¯¹è±¡ä¸jså¯¹è±¡å­˜åœ¨å¾ªç¯å¼•ç”¨ã€‚éœ€è¦å°†DOMå¯¹è±¡ä¸Šçš„expandoå±æ€§è®¾ç½®ä¸ºnullæˆ–é‡æ–°èµ‹å€¼ã€‚è¿™æ ·æ‰èƒ½å›æ”¶DOMå¯¹è±¡ã€‚(<em>æ³¨ï¼šè¿™é‡Œåªæ˜¯é’ˆå¯¹DOMçš„å›æ”¶</em>)<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">language</span>=<span class=\"string\">\"JScript\"</span>&gt;</span><span class=\"undefined\"></span></div><div class=\"line\"><span class=\"undefined\">        var myGlobalObject;</span></div><div class=\"line\"><span class=\"undefined\">        function SetupLeak()</span></div><div class=\"line\"><span class=\"undefined\">        &#123;</span></div><div class=\"line\"><span class=\"undefined\">            myGlobalObject = document.getElementById(\"LeakedDiv\");// â† jså¯¹è±¡å¼•ç”¨DOMå¯¹è±¡</span></div><div class=\"line\"><span class=\"undefined\">            document.getElementById(\"LeakedDiv\").expandoProperty = myGlobalObject;// â† DOMå¯¹è±¡çš„expandoå±æ€§å¼•ç”¨jså¯¹è±¡</span></div><div class=\"line\"><span class=\"undefined\">        &#125;</span></div><div class=\"line\"><span class=\"undefined\">        function BreakLeak()</span></div><div class=\"line\"><span class=\"undefined\">        &#123;</span></div><div class=\"line\"><span class=\"undefined\">            document.getElementById(\"LeakedDiv\").expandoProperty = null;// â† è®¾ç½®ä¸ºnullæˆ–é‡æ–°èµ‹æ–°å€¼</span></div><div class=\"line\"><span class=\"undefined\">        &#125;</span></div><div class=\"line\"><span class=\"undefined\">        </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span> <span class=\"attr\">onload</span>=<span class=\"string\">\"SetupLeak()\"</span> <span class=\"attr\">onunload</span>=<span class=\"string\">\"BreakLeak()\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"LeakedDiv\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>ä¸Šè¿°ä»£ç çš„å¾ªç¯å¼•ç”¨ä¸æ˜¯å¾ˆå¤æ‚ï¼Œå¾ˆå®¹æ˜“å‘ç°ã€‚ä¸è¿‡å®é™…é¡¹ç›®ä¸­å¯èƒ½ä¼šå­˜åœ¨å¾ªç¯é“¾å¾ˆé•¿çš„æƒ…å†µï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> d=&#123;<span class=\"attr\">b</span>:<span class=\"built_in\">document</span>.body&#125;</div><div class=\"line\">    <span class=\"keyword\">var</span> obj=&#123;<span class=\"attr\">doc</span>:d&#125;; <span class=\"comment\">// â† obj.doc.b === document.body</span></div><div class=\"line\">    <span class=\"built_in\">document</span>.body.o=obj; <span class=\"comment\">// â† å¾ªç¯å¼•ç”¨: document.body.o.doc.b === document.body</span></div><div class=\"line\">&#125;)();</div></pre></td></tr></table></figure></p>\n<p>å¦å¤–ä¸€ç§å¸¸è§çš„å¾ªç¯å¼•ç”¨å‘ç”Ÿåœ¨é—­åŒ…ä¸­ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> b=<span class=\"built_in\">document</span>.body; <span class=\"comment\">// â† åˆ›å»ºä¸€ä¸ªå¼•ç”¨document.bodyçš„å˜é‡\"b\"</span></div><div class=\"line\">    b.onclick=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; <span class=\"comment\">// â† b.onclickå¼•ç”¨function</span></div><div class=\"line\">    <span class=\"comment\">// é€šè¿‡é—­åŒ…èƒ½åœ¨å‡½æ•°ä¸­èƒ½è®¿é—®åˆ°\"b\"</span></div><div class=\"line\">    <span class=\"comment\">// do something...</span></div><div class=\"line\">    &#125;;</div><div class=\"line\">&#125;)();</div></pre></td></tr></table></figure></p>\n<h2 id=\"ä¸ºä»€ä¹ˆDOMçš„åƒåœ¾å›æ”¶å™¨æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆDOMçš„åƒåœ¾å›æ”¶å™¨æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆDOMçš„åƒåœ¾å›æ”¶å™¨æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆDOMçš„åƒåœ¾å›æ”¶å™¨æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ï¼Ÿ</h2><p>IEä¸­æœ‰ä¸€éƒ¨åˆ†å¯¹è±¡å¹¶ä¸æ˜¯åŸç”Ÿjså¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå…¶å†…å­˜æ³„éœ²DOMå’ŒBOMä¸­çš„å¯¹è±¡å°±æ˜¯ä½¿ç”¨C++ä»¥COM(component object modelï¼Œç»„ä»¶å¯¹è±¡æ¨¡å‹)å¯¹è±¡çš„å½¢å¼å®ç°çš„ï¼Œè€ŒCOMå¯¹è±¡çš„åƒåœ¾å›æ”¶æœºåˆ¶é‡‡ç”¨çš„å°±æ˜¯å¼•ç”¨è®¡æ•°ç­–ç•¥ã€‚å› æ­¤ï¼Œå³ä½¿IEçš„jså¼•æ“é‡‡ç”¨æ ‡è®°æ¸…é™¤ç­–ç•¥æ¥å®ç°ï¼Œä½†jsè®¿é—®çš„COMå¯¹è±¡ä¾ç„¶æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥çš„ã€‚æ¢å¥è¯è¯´ï¼Œåªè¦åœ¨IEä¸­æ¶‰åŠCOMå¯¹è±¡ï¼Œå°±ä¼šå­˜åœ¨å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚åœ¨IE9æŠŠBOMå’ŒDOMå¯¹è±¡è½¬æ¢ä¸ºçœŸæ­£çš„jså¯¹è±¡ã€‚</p>\n<p>é™¤äº†ä½ç‰ˆæœ¬çš„IEå¤–ï¼Œåœ¨ä½ç‰ˆæœ¬çš„Firefox(å¦‚Firefox3.0)ä¸­ä¹Ÿå­˜åœ¨ç±»ä¼¼é—®é¢˜ã€‚å®ƒä¹Ÿæ˜¯é€šè¿‡COMæ¥ç®¡ç†DOMï¼Œä¸Windowsçš„COMç±»ä¼¼ï¼ŒMozillaçš„XPCOMä¹Ÿæ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ã€‚</p>\n<h2 id=\"å¦‚ä½•é¿å…åŠä¿®å¤ï¼Ÿ\"><a href=\"#å¦‚ä½•é¿å…åŠä¿®å¤ï¼Ÿ\" class=\"headerlink\" title=\"å¦‚ä½•é¿å…åŠä¿®å¤ï¼Ÿ\"></a>å¦‚ä½•é¿å…åŠä¿®å¤ï¼Ÿ</h2><p>å¾ªç¯å¼•ç”¨æ˜¯å¯¼è‡´ä½ç‰ˆæœ¬IEå’ŒFirefoxæµè§ˆå™¨å†…å­˜æ³„éœ²çš„çœŸæ­£åŸå› ï¼Œå› æ­¤æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯é¿å…åœ¨DOMå’ŒJSä¹‹é—´åˆ›å»ºç›¸äº’å¼•ç”¨ã€‚ç¡®ä¿æ€»æ˜¯JSå¯¹è±¡å•å‘å¼•ç”¨DOMå¯¹è±¡ï¼Œæˆ–DOMå¯¹è±¡å•å‘å¼•ç”¨JSå¯¹è±¡ã€‚è™½ç„¶è¯´èµ·æ¥ç®€å•ï¼Œä½†å®é™…æƒ…å†µæ˜¯å¾ˆéš¾åšåˆ°çš„ã€‚é‚£å¦‚ä½•ä¿®å¤å¾ªç¯å¼•ç”¨å°±å¾ˆé‡è¦äº†ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ªå­˜åœ¨å¾ªç¯å¼•ç”¨DOMå¯¹è±¡çš„é˜Ÿåˆ—ï¼Œåœ¨é¡µé¢unloadæ—¶ï¼Œåšå¦‚ä¸‹å¤„ç†ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> unLoaders=[];</div><div class=\"line\">    myDomNode.object=<span class=\"keyword\">new</span> myObject(); <span class=\"comment\">// â† å‡è®¾è¿™é‡Œåˆ›å»ºä¸€ä¸ªå¾ªç¯å¼•ç”¨ï¼Œä¼šå¼•èµ·å†…å­˜æ³„éœ²</span></div><div class=\"line\">    unLoaders.push(myDomNode); <span class=\"comment\">// â† ç¼“å­˜myDomNode</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">var</span> unload=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; <span class=\"comment\">// â† unloadå›è°ƒå‡½æ•°</span></div><div class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=unLoaders.length<span class=\"number\">-1</span>;i&gt;<span class=\"number\">-1</span>;iâ€“)&#123;</div><div class=\"line\">        unLoaders[i].object=<span class=\"literal\">null</span>; <span class=\"comment\">// â† åˆ‡æ–­å¾ªç¯å¼•ç”¨</span></div><div class=\"line\">    &#125;</div><div class=\"line\">    &#125;;</div><div class=\"line\">    <span class=\"built_in\">window</span>.addEvnetListener(â€™unloadâ€™, unload); <span class=\"comment\">// â† ç»‘å®šunload</span></div><div class=\"line\">&#125;)();</div></pre></td></tr></table></figure></p>\n<p>jqueryåœ¨å¤„ç†IEä½ç‰ˆæœ¬ç±»ä¼¼é—®é¢˜æ—¶ï¼Œé‡‡ç”¨çš„ä¹Ÿæ˜¯ä¸Šè¿°æ–¹æ³•ï¼Œ<a href=\"https://github.com/jquery/jquery/blob/1.4.4rc1/src/event.js#L1169\" target=\"_blank\" rel=\"external\">jqueryæºç </a>ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Prevent memory leaks in IE</span></div><div class=\"line\"><span class=\"comment\">// Window isn't included so as not to unbind existing unload events</span></div><div class=\"line\"><span class=\"comment\">// More info:</span></div><div class=\"line\"><span class=\"comment\">//  - http://isaacschlueter.com/2006/10/msie-memory-leaks/</span></div><div class=\"line\"><span class=\"keyword\">if</span> ( <span class=\"built_in\">window</span>.attachEvent &amp;&amp; !<span class=\"built_in\">window</span>.addEventListener ) &#123;</div><div class=\"line\">\tjQuery(<span class=\"built_in\">window</span>).bind(<span class=\"string\">\"unload\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> ( <span class=\"keyword\">var</span> id <span class=\"keyword\">in</span> jQuery.cache ) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> ( jQuery.cache[ id ].handle ) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"comment\">// Try/Catch is to handle iframes being unloaded, see #4280</span></div><div class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\tjQuery.event.remove( jQuery.cache[ id ].handle.elem );</div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span>(e) &#123;&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<blockquote>\n<p>This memory leak occurs because DOM objects are non-JScript objects. DOM objects are not in the mark-and-sweep garbage collection scheme of JScript. Therefore, the circular reference between the DOM objects and the JScript handlers will not be broken until the browser completely tears down the page. This memory leak will end when the browser opens a new Web page or when the browser window is closed.</p>\n</blockquote>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>éšç€ç§»åŠ¨äº’è”ç½‘çš„é£é€Ÿå‘å±•ï¼ŒIEä¹Ÿå‘W3Cæ ‡å‡†é æ‹¢ï¼Œä½ç‰ˆæœ¬æµè§ˆå™¨æ­£é€æ¸è¢«æ·˜æ±°ã€‚ä¸è¿‡å®é™…ä¸šåŠ¡ä¸­ï¼Œè¿˜æ˜¯å­˜åœ¨å¯¹æŸäº›ä½ç‰ˆæœ¬è¿›è¡Œæ”¯æŒï¼Œè™½ç„¶æ¦‚ç‡å¾ˆå°‘ï¼Œä¸è¿‡ä¸ºäº†ä¿è¯ç”¨æˆ·ä½“éªŒï¼Œéœ€è¦å¯¹æœ¬æ–‡æ¶‰åŠçš„çŸ¥è¯†ç‚¹æœ‰æ‰€äº†è§£ã€‚ä¹Ÿè®¸ä½ çš„ä¸šåŠ¡ä¸­ï¼Œä¸éœ€è¦å¯¹ä½ç‰ˆæœ¬æµè§ˆå™¨æ”¯æŒã€‚é‚£å°±æŠŠæœ¬æ–‡å½“æˆæµè§ˆå™¨å‘å±•å²æ¥äº†è§£å§ï¼Œä¹Ÿå¸Œæœ›ä½ èƒ½ä»æ–‡ç« æœ‰æ‰€æ”¶è·ã€‚</p>\n<h2 id=\"å‚è€ƒæ–‡ç« ï¼š\"><a href=\"#å‚è€ƒæ–‡ç« ï¼š\" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« ï¼š\"></a>å‚è€ƒæ–‡ç« ï¼š</h2><ul>\n<li><a href=\"https://msdn.microsoft.com/en-us/library/dd361842(v=vs.85\" target=\"_blank\" rel=\"external\">Circular Memory Leak Mitigation</a>.aspx)</li>\n<li><a href=\"https://stackoverflow.com/questions/15761094/dom-why-is-this-a-memory-leak\" target=\"_blank\" rel=\"external\">DOM: why is this a memory leak?</a></li>\n<li><a href=\"http://www.reigndropsfall.net/2011/01/05/internet-explorer-event-handler-leaks/\" target=\"_blank\" rel=\"external\">Internet Explorer Event Handler Leaks</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Guide/Avoiding_leaks_in_JavaScript_components\" target=\"_blank\" rel=\"external\">Avoiding leaks in JavaScript XPCOM components</a></li>\n<li><a href=\"http://www.crockford.com/javascript/memory/leak.html\" target=\"_blank\" rel=\"external\">JScript Memory Leaks</a></li>\n<li><a href=\"http://isaacschlueter.com/2006/10/msie-memory-leaks/trackback/index.html\" target=\"_blank\" rel=\"external\">Memory Leaks in Microsoft Internet Explorer</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"./leakage.png\" alt=\"leakage\"></p>\n<p>åœ¨IE&lt;8ç‰ˆæœ¬ä¸­ï¼ŒJScriptåƒåœ¾å›æ”¶å™¨ä»…ç®¡ç†JScriptå¯¹è±¡ç”Ÿå‘½å‘¨æœŸè€Œä¸ä¼šç®¡ç†DOMå¯¹è±¡çš„(å³DOMå¯¹è±¡æœ‰è‡ªå·±çš„åƒåœ¾å›æ”¶å™¨)ã€‚å› æ­¤JScriptå›æ”¶å™¨ä¸ä¼šè§£é™¤æ‰DOMå¯¹è±¡ä¸Jscriptå¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨ï¼Œè¿™ä»è€Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚<br>åœ¨IE6ä¸­ï¼Œå¾ªç¯å¼•ç”¨åªåœ¨IEæµè§ˆå™¨ç¨‹åºé€€å‡ºæ—¶æ‰ä¼šè¢«è§£é™¤ï¼Œè€Œåœ¨IE7ä¸­ï¼Œç¦»å¼€å½“å‰é¡µé¢æ—¶ï¼Œæ‰ä¼šè§£é™¤é¡µé¢ä¸­çš„å¾ªç¯å¼•ç”¨ã€‚IE8ä¿®å¤è¯¥é—®é¢˜ï¼ŒJScriptåƒåœ¾å›æ”¶å™¨ä¼šå°†å¼•ç”¨çš„DOMå¯¹è±¡è§†ä¸ºJScriptå¯¹è±¡ï¼Œä»è€Œé¿å…å¾ªç¯å¼•ç”¨ä¸èƒ½è¢«è§£é™¤çš„é—®é¢˜ï¼ˆ<em>æ³¨ï¼šè¿™é‡Œå¾ªç¯å¼•ç”¨è§£é™¤æ˜¯æŒ‡æµè§ˆå™¨è‡ªåŠ¨è§£é™¤å¾ªç¯å¼•ç”¨</em>ï¼‰ã€‚</p>\n<p>IE6-7ä¸­ç®¡ç†DOMå¯¹è±¡çš„åƒåœ¾å›æ”¶å™¨æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ï¼Œå¦‚æœDOMå¯¹è±¡ä¸jså¯¹è±¡å­˜åœ¨å¾ªç¯å¼•ç”¨ã€‚éœ€è¦å°†DOMå¯¹è±¡ä¸Šçš„expandoå±æ€§è®¾ç½®ä¸ºnullæˆ–é‡æ–°èµ‹å€¼ã€‚è¿™æ ·æ‰èƒ½å›æ”¶DOMå¯¹è±¡ã€‚(<em>æ³¨ï¼šè¿™é‡Œåªæ˜¯é’ˆå¯¹DOMçš„å›æ”¶</em>)<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">language</span>=<span class=\"string\">\"JScript\"</span>&gt;</span><span class=\"undefined\"></span></div><div class=\"line\"><span class=\"undefined\">        var myGlobalObject;</span></div><div class=\"line\"><span class=\"undefined\">        function SetupLeak()</span></div><div class=\"line\"><span class=\"undefined\">        &#123;</span></div><div class=\"line\"><span class=\"undefined\">            myGlobalObject = document.getElementById(\"LeakedDiv\");// â† jså¯¹è±¡å¼•ç”¨DOMå¯¹è±¡</span></div><div class=\"line\"><span class=\"undefined\">            document.getElementById(\"LeakedDiv\").expandoProperty = myGlobalObject;// â† DOMå¯¹è±¡çš„expandoå±æ€§å¼•ç”¨jså¯¹è±¡</span></div><div class=\"line\"><span class=\"undefined\">        &#125;</span></div><div class=\"line\"><span class=\"undefined\">        function BreakLeak()</span></div><div class=\"line\"><span class=\"undefined\">        &#123;</span></div><div class=\"line\"><span class=\"undefined\">            document.getElementById(\"LeakedDiv\").expandoProperty = null;// â† è®¾ç½®ä¸ºnullæˆ–é‡æ–°èµ‹æ–°å€¼</span></div><div class=\"line\"><span class=\"undefined\">        &#125;</span></div><div class=\"line\"><span class=\"undefined\">        </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span> <span class=\"attr\">onload</span>=<span class=\"string\">\"SetupLeak()\"</span> <span class=\"attr\">onunload</span>=<span class=\"string\">\"BreakLeak()\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"LeakedDiv\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>ä¸Šè¿°ä»£ç çš„å¾ªç¯å¼•ç”¨ä¸æ˜¯å¾ˆå¤æ‚ï¼Œå¾ˆå®¹æ˜“å‘ç°ã€‚ä¸è¿‡å®é™…é¡¹ç›®ä¸­å¯èƒ½ä¼šå­˜åœ¨å¾ªç¯é“¾å¾ˆé•¿çš„æƒ…å†µï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> d=&#123;<span class=\"attr\">b</span>:<span class=\"built_in\">document</span>.body&#125;</div><div class=\"line\">    <span class=\"keyword\">var</span> obj=&#123;<span class=\"attr\">doc</span>:d&#125;; <span class=\"comment\">// â† obj.doc.b === document.body</span></div><div class=\"line\">    <span class=\"built_in\">document</span>.body.o=obj; <span class=\"comment\">// â† å¾ªç¯å¼•ç”¨: document.body.o.doc.b === document.body</span></div><div class=\"line\">&#125;)();</div></pre></td></tr></table></figure></p>\n<p>å¦å¤–ä¸€ç§å¸¸è§çš„å¾ªç¯å¼•ç”¨å‘ç”Ÿåœ¨é—­åŒ…ä¸­ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> b=<span class=\"built_in\">document</span>.body; <span class=\"comment\">// â† åˆ›å»ºä¸€ä¸ªå¼•ç”¨document.bodyçš„å˜é‡\"b\"</span></div><div class=\"line\">    b.onclick=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; <span class=\"comment\">// â† b.onclickå¼•ç”¨function</span></div><div class=\"line\">    <span class=\"comment\">// é€šè¿‡é—­åŒ…èƒ½åœ¨å‡½æ•°ä¸­èƒ½è®¿é—®åˆ°\"b\"</span></div><div class=\"line\">    <span class=\"comment\">// do something...</span></div><div class=\"line\">    &#125;;</div><div class=\"line\">&#125;)();</div></pre></td></tr></table></figure></p>\n<h2 id=\"ä¸ºä»€ä¹ˆDOMçš„åƒåœ¾å›æ”¶å™¨æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆDOMçš„åƒåœ¾å›æ”¶å™¨æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆDOMçš„åƒåœ¾å›æ”¶å™¨æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆDOMçš„åƒåœ¾å›æ”¶å™¨æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ï¼Ÿ</h2><p>IEä¸­æœ‰ä¸€éƒ¨åˆ†å¯¹è±¡å¹¶ä¸æ˜¯åŸç”Ÿjså¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå…¶å†…å­˜æ³„éœ²DOMå’ŒBOMä¸­çš„å¯¹è±¡å°±æ˜¯ä½¿ç”¨C++ä»¥COM(component object modelï¼Œç»„ä»¶å¯¹è±¡æ¨¡å‹)å¯¹è±¡çš„å½¢å¼å®ç°çš„ï¼Œè€ŒCOMå¯¹è±¡çš„åƒåœ¾å›æ”¶æœºåˆ¶é‡‡ç”¨çš„å°±æ˜¯å¼•ç”¨è®¡æ•°ç­–ç•¥ã€‚å› æ­¤ï¼Œå³ä½¿IEçš„jså¼•æ“é‡‡ç”¨æ ‡è®°æ¸…é™¤ç­–ç•¥æ¥å®ç°ï¼Œä½†jsè®¿é—®çš„COMå¯¹è±¡ä¾ç„¶æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥çš„ã€‚æ¢å¥è¯è¯´ï¼Œåªè¦åœ¨IEä¸­æ¶‰åŠCOMå¯¹è±¡ï¼Œå°±ä¼šå­˜åœ¨å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚åœ¨IE9æŠŠBOMå’ŒDOMå¯¹è±¡è½¬æ¢ä¸ºçœŸæ­£çš„jså¯¹è±¡ã€‚</p>\n<p>é™¤äº†ä½ç‰ˆæœ¬çš„IEå¤–ï¼Œåœ¨ä½ç‰ˆæœ¬çš„Firefox(å¦‚Firefox3.0)ä¸­ä¹Ÿå­˜åœ¨ç±»ä¼¼é—®é¢˜ã€‚å®ƒä¹Ÿæ˜¯é€šè¿‡COMæ¥ç®¡ç†DOMï¼Œä¸Windowsçš„COMç±»ä¼¼ï¼ŒMozillaçš„XPCOMä¹Ÿæ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç­–ç•¥ã€‚</p>\n<h2 id=\"å¦‚ä½•é¿å…åŠä¿®å¤ï¼Ÿ\"><a href=\"#å¦‚ä½•é¿å…åŠä¿®å¤ï¼Ÿ\" class=\"headerlink\" title=\"å¦‚ä½•é¿å…åŠä¿®å¤ï¼Ÿ\"></a>å¦‚ä½•é¿å…åŠä¿®å¤ï¼Ÿ</h2><p>å¾ªç¯å¼•ç”¨æ˜¯å¯¼è‡´ä½ç‰ˆæœ¬IEå’ŒFirefoxæµè§ˆå™¨å†…å­˜æ³„éœ²çš„çœŸæ­£åŸå› ï¼Œå› æ­¤æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯é¿å…åœ¨DOMå’ŒJSä¹‹é—´åˆ›å»ºç›¸äº’å¼•ç”¨ã€‚ç¡®ä¿æ€»æ˜¯JSå¯¹è±¡å•å‘å¼•ç”¨DOMå¯¹è±¡ï¼Œæˆ–DOMå¯¹è±¡å•å‘å¼•ç”¨JSå¯¹è±¡ã€‚è™½ç„¶è¯´èµ·æ¥ç®€å•ï¼Œä½†å®é™…æƒ…å†µæ˜¯å¾ˆéš¾åšåˆ°çš„ã€‚é‚£å¦‚ä½•ä¿®å¤å¾ªç¯å¼•ç”¨å°±å¾ˆé‡è¦äº†ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ªå­˜åœ¨å¾ªç¯å¼•ç”¨DOMå¯¹è±¡çš„é˜Ÿåˆ—ï¼Œåœ¨é¡µé¢unloadæ—¶ï¼Œåšå¦‚ä¸‹å¤„ç†ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> unLoaders=[];</div><div class=\"line\">    myDomNode.object=<span class=\"keyword\">new</span> myObject(); <span class=\"comment\">// â† å‡è®¾è¿™é‡Œåˆ›å»ºä¸€ä¸ªå¾ªç¯å¼•ç”¨ï¼Œä¼šå¼•èµ·å†…å­˜æ³„éœ²</span></div><div class=\"line\">    unLoaders.push(myDomNode); <span class=\"comment\">// â† ç¼“å­˜myDomNode</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">var</span> unload=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; <span class=\"comment\">// â† unloadå›è°ƒå‡½æ•°</span></div><div class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=unLoaders.length<span class=\"number\">-1</span>;i&gt;<span class=\"number\">-1</span>;iâ€“)&#123;</div><div class=\"line\">        unLoaders[i].object=<span class=\"literal\">null</span>; <span class=\"comment\">// â† åˆ‡æ–­å¾ªç¯å¼•ç”¨</span></div><div class=\"line\">    &#125;</div><div class=\"line\">    &#125;;</div><div class=\"line\">    <span class=\"built_in\">window</span>.addEvnetListener(â€™unloadâ€™, unload); <span class=\"comment\">// â† ç»‘å®šunload</span></div><div class=\"line\">&#125;)();</div></pre></td></tr></table></figure></p>\n<p>jqueryåœ¨å¤„ç†IEä½ç‰ˆæœ¬ç±»ä¼¼é—®é¢˜æ—¶ï¼Œé‡‡ç”¨çš„ä¹Ÿæ˜¯ä¸Šè¿°æ–¹æ³•ï¼Œ<a href=\"https://github.com/jquery/jquery/blob/1.4.4rc1/src/event.js#L1169\" target=\"_blank\" rel=\"external\">jqueryæºç </a>ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Prevent memory leaks in IE</span></div><div class=\"line\"><span class=\"comment\">// Window isn't included so as not to unbind existing unload events</span></div><div class=\"line\"><span class=\"comment\">// More info:</span></div><div class=\"line\"><span class=\"comment\">//  - http://isaacschlueter.com/2006/10/msie-memory-leaks/</span></div><div class=\"line\"><span class=\"keyword\">if</span> ( <span class=\"built_in\">window</span>.attachEvent &amp;&amp; !<span class=\"built_in\">window</span>.addEventListener ) &#123;</div><div class=\"line\">\tjQuery(<span class=\"built_in\">window</span>).bind(<span class=\"string\">\"unload\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> ( <span class=\"keyword\">var</span> id <span class=\"keyword\">in</span> jQuery.cache ) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> ( jQuery.cache[ id ].handle ) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"comment\">// Try/Catch is to handle iframes being unloaded, see #4280</span></div><div class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t\tjQuery.event.remove( jQuery.cache[ id ].handle.elem );</div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span>(e) &#123;&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<blockquote>\n<p>This memory leak occurs because DOM objects are non-JScript objects. DOM objects are not in the mark-and-sweep garbage collection scheme of JScript. Therefore, the circular reference between the DOM objects and the JScript handlers will not be broken until the browser completely tears down the page. This memory leak will end when the browser opens a new Web page or when the browser window is closed.</p>\n</blockquote>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>éšç€ç§»åŠ¨äº’è”ç½‘çš„é£é€Ÿå‘å±•ï¼ŒIEä¹Ÿå‘W3Cæ ‡å‡†é æ‹¢ï¼Œä½ç‰ˆæœ¬æµè§ˆå™¨æ­£é€æ¸è¢«æ·˜æ±°ã€‚ä¸è¿‡å®é™…ä¸šåŠ¡ä¸­ï¼Œè¿˜æ˜¯å­˜åœ¨å¯¹æŸäº›ä½ç‰ˆæœ¬è¿›è¡Œæ”¯æŒï¼Œè™½ç„¶æ¦‚ç‡å¾ˆå°‘ï¼Œä¸è¿‡ä¸ºäº†ä¿è¯ç”¨æˆ·ä½“éªŒï¼Œéœ€è¦å¯¹æœ¬æ–‡æ¶‰åŠçš„çŸ¥è¯†ç‚¹æœ‰æ‰€äº†è§£ã€‚ä¹Ÿè®¸ä½ çš„ä¸šåŠ¡ä¸­ï¼Œä¸éœ€è¦å¯¹ä½ç‰ˆæœ¬æµè§ˆå™¨æ”¯æŒã€‚é‚£å°±æŠŠæœ¬æ–‡å½“æˆæµè§ˆå™¨å‘å±•å²æ¥äº†è§£å§ï¼Œä¹Ÿå¸Œæœ›ä½ èƒ½ä»æ–‡ç« æœ‰æ‰€æ”¶è·ã€‚</p>\n<h2 id=\"å‚è€ƒæ–‡ç« ï¼š\"><a href=\"#å‚è€ƒæ–‡ç« ï¼š\" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« ï¼š\"></a>å‚è€ƒæ–‡ç« ï¼š</h2><ul>\n<li><a href=\"https://msdn.microsoft.com/en-us/library/dd361842(v=vs.85\" target=\"_blank\" rel=\"external\">Circular Memory Leak Mitigation</a>.aspx)</li>\n<li><a href=\"https://stackoverflow.com/questions/15761094/dom-why-is-this-a-memory-leak\" target=\"_blank\" rel=\"external\">DOM: why is this a memory leak?</a></li>\n<li><a href=\"http://www.reigndropsfall.net/2011/01/05/internet-explorer-event-handler-leaks/\" target=\"_blank\" rel=\"external\">Internet Explorer Event Handler Leaks</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Guide/Avoiding_leaks_in_JavaScript_components\" target=\"_blank\" rel=\"external\">Avoiding leaks in JavaScript XPCOM components</a></li>\n<li><a href=\"http://www.crockford.com/javascript/memory/leak.html\" target=\"_blank\" rel=\"external\">JScript Memory Leaks</a></li>\n<li><a href=\"http://isaacschlueter.com/2006/10/msie-memory-leaks/trackback/index.html\" target=\"_blank\" rel=\"external\">Memory Leaks in Microsoft Internet Explorer</a></li>\n</ul>\n"},{"title":"JavaScriptå†…å­˜é‚£ç‚¹äº‹","date":"2017-09-30T08:28:53.000Z","author":"singsong","_content":"\nCã€C++è¯­è¨€éœ€è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…ä¸é‡Šæ”¾ï¼ˆå¸¸ç”¨æ–¹æ³•ï¼šmalloc(), calloc(), realloc()å’Œfree()ç­‰ï¼‰ã€‚è€ŒJavaScriptä¸Javaã€C#ç›¸ä¼¼ï¼Œå†…ç½®äº†åƒåœ¾å›æ”¶å™¨ï¼Œèƒ½è‡ªåŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…ä¸é‡Šæ”¾ã€‚\n\n## å†…å­˜ç”Ÿå‘½å‘¨æœŸ:\n\n1. åˆ†é…å†…å­˜\n2. ä½¿ç”¨åˆ†é…çš„å†…å­˜(è¯»ä¸å†™æ“ä½œ)\n3. å½“åº”ç”¨ç¨‹åºä¸å†éœ€è¦æ—¶ï¼Œé‡Šæ”¾æ‰\bå·²åˆ†é…çš„å†…å­˜\n\n![lifecycle](./life-cycle.png)\n\n\bè™½ç„¶\b\bå†…å­˜è‡ªåŠ¨è¿›è¡Œ\båˆ†é…ã€é‡Šæ”¾ï¼Œä½†å¹¶ä¸æ„å‘³ç€\bå¼€å‘è€…ä¸éœ€è¦å…³æ³¨å†…å­˜ç®¡ç†\bã€‚\bå› ä¸ºä¸€äº›ä¸å¥½çš„ç¼–ç ä¼šå¯¼è‡´\b[å†…å­˜æ³„éœ²](https://en.wikipedia.org/wiki/Memory_leak#Reference_counting_and_cyclic_references)ï¼Œå³åº”ç”¨ç¨‹åºä¸å†\béœ€è¦çš„å†…å­˜æ²¡æœ‰è¢«é‡Šæ”¾æ‰ã€‚å› æ­¤äº†è§£å†…å­˜ç®¡ç†æ˜¯å¾ˆé‡è¦çš„\n\n\n## Javascriptä¸­çš„\bå†…å­˜åˆ†é…\n\n\nå½“å£°æ˜å˜é‡æ—¶ï¼ŒJavaScriptä¼šè‡ªåŠ¨ä¸ºå˜é‡åˆ†é…å†…å­˜\n```js\nvar numberVar = 100; //ä¸º\bæ•´æ•°åˆ†é…å†…å­˜\nvar stringVar = 'node simplified';  // ä¸ºå­—ç¬¦ä¸²åˆ†é…å†…å­˜ \nvar objectVar = {a: 1}; // ä¸ºå¯¹è±¡åˆ†é…å†…å­˜\nvar a = [1, null, 'abra']; // ä¸ºæ•°ç»„åˆ†é…å†…å­˜\nfunction f(a) {\n  return a + 2;\n} // ä¸ºå‡½æ•°\båˆ†é…å†…å­˜ \n```\n\bå½“å†…å­˜ä¸å†éœ€è¦æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾æ‰ã€‚å†…å­˜æ³„éœ²å’Œåœ¨é‡Šæ”¾å†…å­˜æ—¶å‡ºç°çš„å¤§éƒ¨åˆ†ä¸å†…å­˜ç›¸å…³çš„é—®é¢˜ï¼Œè€Œè¦æ‰¾å‡ºé‚£äº›è¢«åƒåœ¾å›æ”¶å™¨è·Ÿè¸ª\bä¸å†éœ€è¦çš„è€Œåˆæ²¡æœ‰è¢«é‡Šæ”¾çš„å†…å­˜æ˜¯å¾ˆå›°éš¾çš„ã€‚\n\n## GC(Garbage collection)\n\båƒåœ¾å›æ”¶æ˜¯è¿½è¸ªå¹¶é‡Šæ”¾åº”ç”¨ç¨‹åºä¸å†\bä½¿ç”¨çš„å†…å­˜è¿‡ç¨‹ã€‚åƒåœ¾å›æ”¶å™¨é€š\bè¿‡ç®—æ³•æ¥å®ç°è¿½è¸ªåº”ç”¨ç¨‹åºä¸å†ä½¿ç”¨çš„å†…å­˜ã€‚\b\bä¸»è¦æ¶‰åŠçš„åƒåœ¾å›æ”¶ç®—æ³•å¦‚ä¸‹ï¼š\n\n- Reference-counting garbage collectionï¼ˆå¼•ç”¨è®¡æ•°ï¼‰\n- Mark-and-sweep algorithmï¼ˆæ ‡è®°æ¸…é™¤ï¼‰\n\n### Reference-counting garbage collectionï¼ˆå¼•ç”¨è®¡æ•°ï¼‰\nå¼•ç”¨è®¡æ•°ç®—æ³•æ˜¯\bä¸€ç§æœ€åŸºç¡€çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œå½“ä¸€ä¸ª\bå¯¹è±¡çš„å¼•ç”¨æ•°ä¸ºé›¶æ—¶ï¼Œä¼šè¢«è‡ªåŠ¨å›æ”¶ã€‚è¯¥ç®—æ³•å°†\b\bä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æ•°ä¸º0æ—¶è§†ä¸ºåº”ç”¨ç¨‹åºä¸å†\béœ€è¦çš„\bå†…å­˜ã€‚\n\n```js\n!function (){\n  var o1 = {a: {b: 2}},// ä¸¤ä¸ªå¯¹è±¡è¢«åˆ›å»ºA:{a: {b: 2}}ï¼ŒB:{b: 2}ï¼Œå¯¹è±¡Bè¢«å¯¹è±¡Açš„å±æ€§aå¼•ç”¨ï¼Œå¯¹è±¡Aè¢«\b\bèµ‹å€¼ç»™å˜é‡o1ã€‚\bAå’ŒBçš„å¼•ç”¨æ•°éƒ½ä¸º1ï¼Œå› æ­¤ä¸èƒ½è¢«å›æ”¶ã€‚\n      o2 = o1; // å°†å¯¹è±¡Aèµ‹ç»™\bå˜é‡o2ã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º2ï¼ŒB\bå¼•ç”¨æ•°1ã€‚\n      o1 = 1;// \bå°†å˜é‡o1å¯¹å¯¹è±¡Aå¼•ç”¨åˆ‡æ–­ã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º1ï¼ŒBå¼•ç”¨æ•°1ã€‚\n  var oa = o2.a; // å°†å¯¹è±¡Bèµ‹å€¼ç»™å˜é‡oaã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º1ï¼ŒBå¼•ç”¨æ•°2ã€‚\n      o2 = 'foo'; // å°†å˜é‡o2å¯¹å¯¹è±¡A\bå¼•ç”¨åˆ‡æ–­ã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º0ï¼ŒBå¼•ç”¨æ•°1ã€‚å› ä¸ºå¯¹è±¡Açš„a\bå±æ€§è¢«\bå˜é‡oaå¼•ç”¨ï¼Œå› æ­¤å¯¹è±¡Aä¸èƒ½è¢«é‡Šæ”¾ã€‚\n      oa = null; // å°†å˜é‡oaå¯¹å¯¹è±¡Bå¼•ç”¨åˆ‡æ–­ã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º0ï¼ŒBå¼•ç”¨æ•°\b0ã€‚Aä¸Bä¼šè¢«\bå›æ”¶ã€‚\n}()\n```\n\n#### å¼•ç”¨è®¡æ•°çš„\bé™åˆ¶ï¼šå¾ªç¯å¼•ç”¨\n  å¾ªç¯å¼•ç”¨å­˜åœ¨ä¸€ä¸ªé™åˆ¶ã€‚å¦‚ä¸‹å®ä¾‹ï¼Œä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ï¼Œå½¢æˆä¸€ä¸ªå¾ªç¯å¼•ç”¨ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“å‡½æ•°\bæ‰§è¡Œå®Œåï¼Œ\bå¯¹åº”çš„å†…å­˜\b\bä¼šè¢«é‡Šæ”¾æ‰ã€‚è€Œ\b**å¼•ç”¨è®¡æ•°ç®—æ³•**ä¼šå°†å¾ªç¯å¼•ç”¨å¯¹è±¡çš„å¼•ç”¨æ•°éƒ½è§†ä¸ºè‡³å°‘ä¸º1ï¼Œå› æ­¤ä¸èƒ½è¢«å›æ”¶ã€‚\n\n```js\nfunction f() {\n  var o = {};\n  var o2 = {};\n  o.a = o2; // o references o2\n  o2.a = o; // o2 references o\n\n  return 'azerty';\n}\n\nf();\n```\n![cycle](./cycle.png)\n\n\n#### å¸¸è§é—®é¢˜å®ä¾‹\n\n  IE6-7\bçš„DOMå¯¹è±¡æ˜¯åŸºäºè®¡æ•°å¼•ç”¨\b\b\bç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶çš„ã€‚è€Œå¾ªç¯å¼•ç”¨é€šå¸¸ä¼šå¯¼è‡´å†…å­˜\bæ³„éœ²ï¼š\n\n```js\nvar div;\nwindow.onload = function() {\n  div = document.getElementById('myDivElement');\n  div.circularReference = div;\n  div.lotsOfData = new Array(10000).join('*');\n};\n```\nå¦‚ä¸Šè¿°å®ä¾‹ï¼ŒDOMå…ƒç´ divé€šè¿‡è‡ªèº«çš„â€œcircularReferenceâ€å±æ€§å¾ªç¯å¼•ç”¨è‡ªå·±ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼å°†è¯¥å±æ€§åˆ é™¤æˆ–\bè®¾ä¸ºnullï¼Œ\bè®¡æ•°å¼•ç”¨åƒåœ¾å›æ”¶å™¨ä¼š\bå§‹ç»ˆæŒæœ‰\bè‡³å°‘ä¸€ä¸ªå¼•ç”¨ã€‚å³ä½¿DOMå…ƒç´ ä»DOMæ ‘ç§\bç§»é™¤ï¼ŒDOMå…ƒç´ çš„å†…å­˜\bä¼šä¸€ç›´å­˜åœ¨ã€‚å¦‚æœDOMå…ƒç´ æŒæœ‰ä¸€äº›æ•°æ®ï¼ˆå¦‚å®ä¾‹ä¸­â€œlotsDataâ€å±æ€§ï¼‰ï¼Œè¯¥æ•°æ®å¯¹åº”çš„å†…å­˜ä¹Ÿæ— æ³•\bè¢«é‡Šæ”¾ã€‚\n\b\n\n### Mark-and-sweep algorithmï¼ˆæ ‡è®°æ¸…é™¤ï¼‰\n\nè¯¥ç®—æ³•å°†â€œå¯¹è±¡ä¸å†éœ€è¦â€çš„å®šä¹‰\bç®€åŒ–ä¸ºâ€œå¯¹è±¡ä¸å¯åˆ°è¾¾â€ã€‚\nè¿™ä¸ªç®—æ³•å‡è®¾æœ‰ä¸€ç»„\bè¢«ç§°ä¸ºrootsçš„å¯¹è±¡ï¼ˆåœ¨JavaScriptä¸­ï¼Œrootå°±æ˜¯å…¨å±€å¯¹è±¡ï¼‰ã€‚åƒåœ¾å›æ”¶å™¨ä¼š\bå®šæœŸåœ°\bä»è¿™äº›rootså¼€å§‹ï¼ŒæŸ¥æ‰¾æ‰€æœ‰ä»æ ¹å¼€å§‹å¼•ç”¨çš„å¯¹è±¡ï¼Œç„¶åæŸ¥æ‰¾è¿™äº›å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡â€¦â€¦ã€‚\bä»\brootså¼€å§‹ï¼Œåƒåœ¾å›æ”¶å™¨ä¼š\bæŸ¥æ‰¾æ‰€æœ‰å¯åˆ°è¾¾å¯¹è±¡ï¼Œå¹¶å›æ”¶ä¸å¯åˆ°è¾¾çš„å¯¹è±¡ã€‚\n\nä¸ºäº†ç¡®å®šå¯¹è±¡æ˜¯å¦éœ€è¦ï¼Œè¯¥ç®—æ³•è¦ç¡®å®šå¯¹è±¡æ˜¯å¦å¯åˆ°è¾¾ã€‚ç”±å¦‚ä¸‹æ­¥éª¤ç»„æˆï¼š\n\n1. åƒåœ¾å›æ”¶å™¨ä¼š\båˆ›å»ºä¸€ç»„rootsï¼Œrootsé€šå¸¸æ˜¯æŒæœ‰å¼•ç”¨çš„å…¨å±€å˜é‡ã€‚åœ¨JavaScriptä¸­ï¼Œwindowå¯¹è±¡å°±å¯ä½œä¸ºrootçš„å…¨å±€å˜é‡ã€‚\n2. åƒåœ¾å›æ”¶å™¨ä¼šæ£€æŸ¥æ‰€æœ‰çš„rootså¹¶æ ‡è®°ä¸ºæ´»è·ƒçŠ¶æ€ã€‚ç„¶å\bé€’å½’éå†æ‰€æœ‰çš„å­å˜é‡ã€‚\båªè¦ä»rootä¸èƒ½åˆ°è¾¾çš„éƒ½è¢«æ ‡è®°ä¸ºåƒåœ¾ã€‚\n3. \bæ‰€æœ‰æ²¡æœ‰è¢«æ ‡è®°ä¸ºæ´»è·ƒçŠ¶æ€çš„å†…å­˜å—\béƒ½è¢«è§†ä¸ºåƒåœ¾ã€‚\båƒåœ¾å›æ”¶å™¨å°±å¯ä»¥é‡Šæ”¾\bè¿™éƒ¨åˆ†å†…å­˜å¹¶æŠŠé‡Šæ”¾çš„å†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚\n\n![](./mark-sweep.gif)\n\n\nè¿™ä¸ªç®—æ³•æ¯”å¼•ç”¨è®¡æ•°ç®—æ³•æ›´ä¼˜ï¼Œå› ä¸ºâ€œ\b\bé›¶å¼•\bç”¨çš„å¯¹è±¡â€æ€»æ˜¯ä¸å¯åˆ°è¾¾çš„ï¼Œä½†\bå\bä¹‹åˆ™ä¸ä¸€å®šï¼Œå¦‚\bå¾ªç¯å¼•ç”¨ã€‚\næˆªè‡³2012å¹´ï¼Œæ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½å†…ç½®äº†\b**æ ‡è®°æ¸…é™¤åƒåœ¾å›æ”¶å™¨**ã€‚\b\b\båœ¨è¿‡å»å‡ å¹´é‡Œæ‰€æœ‰å¯¹JavaScriptåƒåœ¾å›æ”¶çš„æ”¹è¿›ï¼ˆ[generational/incremental/concurrent/parallel garbage collection](http://www.memorymanagement.org/glossary/g.html#term-generational-garbage-collection)ï¼‰éƒ½æ˜¯åŸºäº**æ ‡è®°æ¸…é™¤ç®—æ³•**æ¥å®ç°çš„ï¼Œå¹¶æ²¡æœ‰æ”¹å˜**æ ‡è®°æ¸…é™¤ç®—æ³•**æœ¬èº«å’Œå®ƒå¯¹â€œå¯¹è±¡ä¸å†éœ€è¦â€å®šä¹‰çš„ç®€åŒ–ã€‚\n\b\n#### å¾ªç¯å¼•ç”¨ä¸å†\bæ˜¯é—®é¢˜\n\b\bå‰é¢å¾ªç¯å¼•ç”¨çš„å®ä¾‹ä¸­ï¼Œåœ¨å‡½æ•°æ‰§è¡Œå®Œåï¼Œä¸¤ä¸ªå¯¹è±¡ä¸å†è¢«å…¨å±€å¯¹è±¡\bå¯è®¿é—®çš„å¯¹è±¡å¼•ç”¨ã€‚å› æ­¤\b\bè¿™ä¸¤\bä¸ªå¯¹è±¡è¢«\båƒåœ¾å›æ”¶å™¨æ ‡è®°ä¸ºä¸å¯åˆ°è¾¾\bï¼Œæ¥ç€è¢«å›æ”¶æ‰ã€‚\n![](./no-cycle.png)\n\n#### é™åˆ¶ï¼šéœ€è¦æ˜ç¡®æ— æ³•åˆ°è¾¾çš„å¯¹è±¡\n\bå°½ç®¡è¿™æ˜¯ä¸€ä¸ª\bé™åˆ¶ï¼Œä½†å®è·µä¸­å¾ˆå°‘é‡è§è¿™ç§æƒ…å†µï¼Œæ‰€ä»¥å¼€å‘è€…ä¸å¤ªä¼šå»å…³å¿ƒåƒåœ¾å›æ”¶æœºåˆ¶ã€‚\n\n\n## å‚è€ƒæ–‡ç« ï¼š\n\n- [Memory Management And Garbage Collection In Javascript](http://www.nodesimplified.com/2017/08/javascript-memory-management-and.html)\n- [Memory Management](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management)\n- [How JavaScript works: memory management + how to handle 4 common memory leaks](https://blog.sessionstack.com/how-javascript-works-memory-management-how-to-handle-4-common-memory-leaks-3f28b94cfbec)\n- [Memory Management Reference](http://www.memorymanagement.org/glossary/g.html#term-generational-garbage-collection)\n\n---\n\n> å£°æ˜:æœ¬èµ„æ–™ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ä½¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”! å¦‚éœ€è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚\n\n---","source":"_posts/JavaScriptå†…å­˜é‚£ç‚¹äº‹.md","raw":"---\ntitle: JavaScriptå†…å­˜é‚£ç‚¹äº‹\ndate: 2017-09-30 16:28:53\ncategory: memory\nauthor: singsong\ntags: [å†…å­˜, CG, åƒåœ¾å›æ”¶]\n---\n\nCã€C++è¯­è¨€éœ€è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…ä¸é‡Šæ”¾ï¼ˆå¸¸ç”¨æ–¹æ³•ï¼šmalloc(), calloc(), realloc()å’Œfree()ç­‰ï¼‰ã€‚è€ŒJavaScriptä¸Javaã€C#ç›¸ä¼¼ï¼Œå†…ç½®äº†åƒåœ¾å›æ”¶å™¨ï¼Œèƒ½è‡ªåŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…ä¸é‡Šæ”¾ã€‚\n\n## å†…å­˜ç”Ÿå‘½å‘¨æœŸ:\n\n1. åˆ†é…å†…å­˜\n2. ä½¿ç”¨åˆ†é…çš„å†…å­˜(è¯»ä¸å†™æ“ä½œ)\n3. å½“åº”ç”¨ç¨‹åºä¸å†éœ€è¦æ—¶ï¼Œé‡Šæ”¾æ‰\bå·²åˆ†é…çš„å†…å­˜\n\n![lifecycle](./life-cycle.png)\n\n\bè™½ç„¶\b\bå†…å­˜è‡ªåŠ¨è¿›è¡Œ\båˆ†é…ã€é‡Šæ”¾ï¼Œä½†å¹¶ä¸æ„å‘³ç€\bå¼€å‘è€…ä¸éœ€è¦å…³æ³¨å†…å­˜ç®¡ç†\bã€‚\bå› ä¸ºä¸€äº›ä¸å¥½çš„ç¼–ç ä¼šå¯¼è‡´\b[å†…å­˜æ³„éœ²](https://en.wikipedia.org/wiki/Memory_leak#Reference_counting_and_cyclic_references)ï¼Œå³åº”ç”¨ç¨‹åºä¸å†\béœ€è¦çš„å†…å­˜æ²¡æœ‰è¢«é‡Šæ”¾æ‰ã€‚å› æ­¤äº†è§£å†…å­˜ç®¡ç†æ˜¯å¾ˆé‡è¦çš„\n\n\n## Javascriptä¸­çš„\bå†…å­˜åˆ†é…\n\n\nå½“å£°æ˜å˜é‡æ—¶ï¼ŒJavaScriptä¼šè‡ªåŠ¨ä¸ºå˜é‡åˆ†é…å†…å­˜\n```js\nvar numberVar = 100; //ä¸º\bæ•´æ•°åˆ†é…å†…å­˜\nvar stringVar = 'node simplified';  // ä¸ºå­—ç¬¦ä¸²åˆ†é…å†…å­˜ \nvar objectVar = {a: 1}; // ä¸ºå¯¹è±¡åˆ†é…å†…å­˜\nvar a = [1, null, 'abra']; // ä¸ºæ•°ç»„åˆ†é…å†…å­˜\nfunction f(a) {\n  return a + 2;\n} // ä¸ºå‡½æ•°\båˆ†é…å†…å­˜ \n```\n\bå½“å†…å­˜ä¸å†éœ€è¦æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾æ‰ã€‚å†…å­˜æ³„éœ²å’Œåœ¨é‡Šæ”¾å†…å­˜æ—¶å‡ºç°çš„å¤§éƒ¨åˆ†ä¸å†…å­˜ç›¸å…³çš„é—®é¢˜ï¼Œè€Œè¦æ‰¾å‡ºé‚£äº›è¢«åƒåœ¾å›æ”¶å™¨è·Ÿè¸ª\bä¸å†éœ€è¦çš„è€Œåˆæ²¡æœ‰è¢«é‡Šæ”¾çš„å†…å­˜æ˜¯å¾ˆå›°éš¾çš„ã€‚\n\n## GC(Garbage collection)\n\båƒåœ¾å›æ”¶æ˜¯è¿½è¸ªå¹¶é‡Šæ”¾åº”ç”¨ç¨‹åºä¸å†\bä½¿ç”¨çš„å†…å­˜è¿‡ç¨‹ã€‚åƒåœ¾å›æ”¶å™¨é€š\bè¿‡ç®—æ³•æ¥å®ç°è¿½è¸ªåº”ç”¨ç¨‹åºä¸å†ä½¿ç”¨çš„å†…å­˜ã€‚\b\bä¸»è¦æ¶‰åŠçš„åƒåœ¾å›æ”¶ç®—æ³•å¦‚ä¸‹ï¼š\n\n- Reference-counting garbage collectionï¼ˆå¼•ç”¨è®¡æ•°ï¼‰\n- Mark-and-sweep algorithmï¼ˆæ ‡è®°æ¸…é™¤ï¼‰\n\n### Reference-counting garbage collectionï¼ˆå¼•ç”¨è®¡æ•°ï¼‰\nå¼•ç”¨è®¡æ•°ç®—æ³•æ˜¯\bä¸€ç§æœ€åŸºç¡€çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œå½“ä¸€ä¸ª\bå¯¹è±¡çš„å¼•ç”¨æ•°ä¸ºé›¶æ—¶ï¼Œä¼šè¢«è‡ªåŠ¨å›æ”¶ã€‚è¯¥ç®—æ³•å°†\b\bä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æ•°ä¸º0æ—¶è§†ä¸ºåº”ç”¨ç¨‹åºä¸å†\béœ€è¦çš„\bå†…å­˜ã€‚\n\n```js\n!function (){\n  var o1 = {a: {b: 2}},// ä¸¤ä¸ªå¯¹è±¡è¢«åˆ›å»ºA:{a: {b: 2}}ï¼ŒB:{b: 2}ï¼Œå¯¹è±¡Bè¢«å¯¹è±¡Açš„å±æ€§aå¼•ç”¨ï¼Œå¯¹è±¡Aè¢«\b\bèµ‹å€¼ç»™å˜é‡o1ã€‚\bAå’ŒBçš„å¼•ç”¨æ•°éƒ½ä¸º1ï¼Œå› æ­¤ä¸èƒ½è¢«å›æ”¶ã€‚\n      o2 = o1; // å°†å¯¹è±¡Aèµ‹ç»™\bå˜é‡o2ã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º2ï¼ŒB\bå¼•ç”¨æ•°1ã€‚\n      o1 = 1;// \bå°†å˜é‡o1å¯¹å¯¹è±¡Aå¼•ç”¨åˆ‡æ–­ã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º1ï¼ŒBå¼•ç”¨æ•°1ã€‚\n  var oa = o2.a; // å°†å¯¹è±¡Bèµ‹å€¼ç»™å˜é‡oaã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º1ï¼ŒBå¼•ç”¨æ•°2ã€‚\n      o2 = 'foo'; // å°†å˜é‡o2å¯¹å¯¹è±¡A\bå¼•ç”¨åˆ‡æ–­ã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º0ï¼ŒBå¼•ç”¨æ•°1ã€‚å› ä¸ºå¯¹è±¡Açš„a\bå±æ€§è¢«\bå˜é‡oaå¼•ç”¨ï¼Œå› æ­¤å¯¹è±¡Aä¸èƒ½è¢«é‡Šæ”¾ã€‚\n      oa = null; // å°†å˜é‡oaå¯¹å¯¹è±¡Bå¼•ç”¨åˆ‡æ–­ã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º0ï¼ŒBå¼•ç”¨æ•°\b0ã€‚Aä¸Bä¼šè¢«\bå›æ”¶ã€‚\n}()\n```\n\n#### å¼•ç”¨è®¡æ•°çš„\bé™åˆ¶ï¼šå¾ªç¯å¼•ç”¨\n  å¾ªç¯å¼•ç”¨å­˜åœ¨ä¸€ä¸ªé™åˆ¶ã€‚å¦‚ä¸‹å®ä¾‹ï¼Œä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ï¼Œå½¢æˆä¸€ä¸ªå¾ªç¯å¼•ç”¨ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“å‡½æ•°\bæ‰§è¡Œå®Œåï¼Œ\bå¯¹åº”çš„å†…å­˜\b\bä¼šè¢«é‡Šæ”¾æ‰ã€‚è€Œ\b**å¼•ç”¨è®¡æ•°ç®—æ³•**ä¼šå°†å¾ªç¯å¼•ç”¨å¯¹è±¡çš„å¼•ç”¨æ•°éƒ½è§†ä¸ºè‡³å°‘ä¸º1ï¼Œå› æ­¤ä¸èƒ½è¢«å›æ”¶ã€‚\n\n```js\nfunction f() {\n  var o = {};\n  var o2 = {};\n  o.a = o2; // o references o2\n  o2.a = o; // o2 references o\n\n  return 'azerty';\n}\n\nf();\n```\n![cycle](./cycle.png)\n\n\n#### å¸¸è§é—®é¢˜å®ä¾‹\n\n  IE6-7\bçš„DOMå¯¹è±¡æ˜¯åŸºäºè®¡æ•°å¼•ç”¨\b\b\bç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶çš„ã€‚è€Œå¾ªç¯å¼•ç”¨é€šå¸¸ä¼šå¯¼è‡´å†…å­˜\bæ³„éœ²ï¼š\n\n```js\nvar div;\nwindow.onload = function() {\n  div = document.getElementById('myDivElement');\n  div.circularReference = div;\n  div.lotsOfData = new Array(10000).join('*');\n};\n```\nå¦‚ä¸Šè¿°å®ä¾‹ï¼ŒDOMå…ƒç´ divé€šè¿‡è‡ªèº«çš„â€œcircularReferenceâ€å±æ€§å¾ªç¯å¼•ç”¨è‡ªå·±ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼å°†è¯¥å±æ€§åˆ é™¤æˆ–\bè®¾ä¸ºnullï¼Œ\bè®¡æ•°å¼•ç”¨åƒåœ¾å›æ”¶å™¨ä¼š\bå§‹ç»ˆæŒæœ‰\bè‡³å°‘ä¸€ä¸ªå¼•ç”¨ã€‚å³ä½¿DOMå…ƒç´ ä»DOMæ ‘ç§\bç§»é™¤ï¼ŒDOMå…ƒç´ çš„å†…å­˜\bä¼šä¸€ç›´å­˜åœ¨ã€‚å¦‚æœDOMå…ƒç´ æŒæœ‰ä¸€äº›æ•°æ®ï¼ˆå¦‚å®ä¾‹ä¸­â€œlotsDataâ€å±æ€§ï¼‰ï¼Œè¯¥æ•°æ®å¯¹åº”çš„å†…å­˜ä¹Ÿæ— æ³•\bè¢«é‡Šæ”¾ã€‚\n\b\n\n### Mark-and-sweep algorithmï¼ˆæ ‡è®°æ¸…é™¤ï¼‰\n\nè¯¥ç®—æ³•å°†â€œå¯¹è±¡ä¸å†éœ€è¦â€çš„å®šä¹‰\bç®€åŒ–ä¸ºâ€œå¯¹è±¡ä¸å¯åˆ°è¾¾â€ã€‚\nè¿™ä¸ªç®—æ³•å‡è®¾æœ‰ä¸€ç»„\bè¢«ç§°ä¸ºrootsçš„å¯¹è±¡ï¼ˆåœ¨JavaScriptä¸­ï¼Œrootå°±æ˜¯å…¨å±€å¯¹è±¡ï¼‰ã€‚åƒåœ¾å›æ”¶å™¨ä¼š\bå®šæœŸåœ°\bä»è¿™äº›rootså¼€å§‹ï¼ŒæŸ¥æ‰¾æ‰€æœ‰ä»æ ¹å¼€å§‹å¼•ç”¨çš„å¯¹è±¡ï¼Œç„¶åæŸ¥æ‰¾è¿™äº›å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡â€¦â€¦ã€‚\bä»\brootså¼€å§‹ï¼Œåƒåœ¾å›æ”¶å™¨ä¼š\bæŸ¥æ‰¾æ‰€æœ‰å¯åˆ°è¾¾å¯¹è±¡ï¼Œå¹¶å›æ”¶ä¸å¯åˆ°è¾¾çš„å¯¹è±¡ã€‚\n\nä¸ºäº†ç¡®å®šå¯¹è±¡æ˜¯å¦éœ€è¦ï¼Œè¯¥ç®—æ³•è¦ç¡®å®šå¯¹è±¡æ˜¯å¦å¯åˆ°è¾¾ã€‚ç”±å¦‚ä¸‹æ­¥éª¤ç»„æˆï¼š\n\n1. åƒåœ¾å›æ”¶å™¨ä¼š\båˆ›å»ºä¸€ç»„rootsï¼Œrootsé€šå¸¸æ˜¯æŒæœ‰å¼•ç”¨çš„å…¨å±€å˜é‡ã€‚åœ¨JavaScriptä¸­ï¼Œwindowå¯¹è±¡å°±å¯ä½œä¸ºrootçš„å…¨å±€å˜é‡ã€‚\n2. åƒåœ¾å›æ”¶å™¨ä¼šæ£€æŸ¥æ‰€æœ‰çš„rootså¹¶æ ‡è®°ä¸ºæ´»è·ƒçŠ¶æ€ã€‚ç„¶å\bé€’å½’éå†æ‰€æœ‰çš„å­å˜é‡ã€‚\båªè¦ä»rootä¸èƒ½åˆ°è¾¾çš„éƒ½è¢«æ ‡è®°ä¸ºåƒåœ¾ã€‚\n3. \bæ‰€æœ‰æ²¡æœ‰è¢«æ ‡è®°ä¸ºæ´»è·ƒçŠ¶æ€çš„å†…å­˜å—\béƒ½è¢«è§†ä¸ºåƒåœ¾ã€‚\båƒåœ¾å›æ”¶å™¨å°±å¯ä»¥é‡Šæ”¾\bè¿™éƒ¨åˆ†å†…å­˜å¹¶æŠŠé‡Šæ”¾çš„å†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚\n\n![](./mark-sweep.gif)\n\n\nè¿™ä¸ªç®—æ³•æ¯”å¼•ç”¨è®¡æ•°ç®—æ³•æ›´ä¼˜ï¼Œå› ä¸ºâ€œ\b\bé›¶å¼•\bç”¨çš„å¯¹è±¡â€æ€»æ˜¯ä¸å¯åˆ°è¾¾çš„ï¼Œä½†\bå\bä¹‹åˆ™ä¸ä¸€å®šï¼Œå¦‚\bå¾ªç¯å¼•ç”¨ã€‚\næˆªè‡³2012å¹´ï¼Œæ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½å†…ç½®äº†\b**æ ‡è®°æ¸…é™¤åƒåœ¾å›æ”¶å™¨**ã€‚\b\b\båœ¨è¿‡å»å‡ å¹´é‡Œæ‰€æœ‰å¯¹JavaScriptåƒåœ¾å›æ”¶çš„æ”¹è¿›ï¼ˆ[generational/incremental/concurrent/parallel garbage collection](http://www.memorymanagement.org/glossary/g.html#term-generational-garbage-collection)ï¼‰éƒ½æ˜¯åŸºäº**æ ‡è®°æ¸…é™¤ç®—æ³•**æ¥å®ç°çš„ï¼Œå¹¶æ²¡æœ‰æ”¹å˜**æ ‡è®°æ¸…é™¤ç®—æ³•**æœ¬èº«å’Œå®ƒå¯¹â€œå¯¹è±¡ä¸å†éœ€è¦â€å®šä¹‰çš„ç®€åŒ–ã€‚\n\b\n#### å¾ªç¯å¼•ç”¨ä¸å†\bæ˜¯é—®é¢˜\n\b\bå‰é¢å¾ªç¯å¼•ç”¨çš„å®ä¾‹ä¸­ï¼Œåœ¨å‡½æ•°æ‰§è¡Œå®Œåï¼Œä¸¤ä¸ªå¯¹è±¡ä¸å†è¢«å…¨å±€å¯¹è±¡\bå¯è®¿é—®çš„å¯¹è±¡å¼•ç”¨ã€‚å› æ­¤\b\bè¿™ä¸¤\bä¸ªå¯¹è±¡è¢«\båƒåœ¾å›æ”¶å™¨æ ‡è®°ä¸ºä¸å¯åˆ°è¾¾\bï¼Œæ¥ç€è¢«å›æ”¶æ‰ã€‚\n![](./no-cycle.png)\n\n#### é™åˆ¶ï¼šéœ€è¦æ˜ç¡®æ— æ³•åˆ°è¾¾çš„å¯¹è±¡\n\bå°½ç®¡è¿™æ˜¯ä¸€ä¸ª\bé™åˆ¶ï¼Œä½†å®è·µä¸­å¾ˆå°‘é‡è§è¿™ç§æƒ…å†µï¼Œæ‰€ä»¥å¼€å‘è€…ä¸å¤ªä¼šå»å…³å¿ƒåƒåœ¾å›æ”¶æœºåˆ¶ã€‚\n\n\n## å‚è€ƒæ–‡ç« ï¼š\n\n- [Memory Management And Garbage Collection In Javascript](http://www.nodesimplified.com/2017/08/javascript-memory-management-and.html)\n- [Memory Management](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management)\n- [How JavaScript works: memory management + how to handle 4 common memory leaks](https://blog.sessionstack.com/how-javascript-works-memory-management-how-to-handle-4-common-memory-leaks-3f28b94cfbec)\n- [Memory Management Reference](http://www.memorymanagement.org/glossary/g.html#term-generational-garbage-collection)\n\n---\n\n> å£°æ˜:æœ¬èµ„æ–™ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ä½¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”! å¦‚éœ€è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚\n\n---","slug":"JavaScriptå†…å­˜é‚£ç‚¹äº‹","published":1,"updated":"2018-08-22T08:06:45.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjl4vata000011hn9mizjdgi0","content":"<p>Cã€C++è¯­è¨€éœ€è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…ä¸é‡Šæ”¾ï¼ˆå¸¸ç”¨æ–¹æ³•ï¼šmalloc(), calloc(), realloc()å’Œfree()ç­‰ï¼‰ã€‚è€ŒJavaScriptä¸Javaã€C#ç›¸ä¼¼ï¼Œå†…ç½®äº†åƒåœ¾å›æ”¶å™¨ï¼Œèƒ½è‡ªåŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…ä¸é‡Šæ”¾ã€‚</p>\n<h2 id=\"å†…å­˜ç”Ÿå‘½å‘¨æœŸ\"><a href=\"#å†…å­˜ç”Ÿå‘½å‘¨æœŸ\" class=\"headerlink\" title=\"å†…å­˜ç”Ÿå‘½å‘¨æœŸ:\"></a>å†…å­˜ç”Ÿå‘½å‘¨æœŸ:</h2><ol>\n<li>åˆ†é…å†…å­˜</li>\n<li>ä½¿ç”¨åˆ†é…çš„å†…å­˜(è¯»ä¸å†™æ“ä½œ)</li>\n<li>å½“åº”ç”¨ç¨‹åºä¸å†éœ€è¦æ—¶ï¼Œé‡Šæ”¾æ‰\bå·²åˆ†é…çš„å†…å­˜</li>\n</ol>\n<p><img src=\"./life-cycle.png\" alt=\"lifecycle\"></p>\n<p>\bè™½ç„¶\b\bå†…å­˜è‡ªåŠ¨è¿›è¡Œ\båˆ†é…ã€é‡Šæ”¾ï¼Œä½†å¹¶ä¸æ„å‘³ç€\bå¼€å‘è€…ä¸éœ€è¦å…³æ³¨å†…å­˜ç®¡ç†\bã€‚\bå› ä¸ºä¸€äº›ä¸å¥½çš„ç¼–ç ä¼šå¯¼è‡´\b<a href=\"https://en.wikipedia.org/wiki/Memory_leak#Reference_counting_and_cyclic_references\" target=\"_blank\" rel=\"external\">å†…å­˜æ³„éœ²</a>ï¼Œå³åº”ç”¨ç¨‹åºä¸å†\béœ€è¦çš„å†…å­˜æ²¡æœ‰è¢«é‡Šæ”¾æ‰ã€‚å› æ­¤äº†è§£å†…å­˜ç®¡ç†æ˜¯å¾ˆé‡è¦çš„</p>\n<h2 id=\"Javascriptä¸­çš„å†…å­˜åˆ†é…\"><a href=\"#Javascriptä¸­çš„å†…å­˜åˆ†é…\" class=\"headerlink\" title=\"Javascriptä¸­çš„\bå†…å­˜åˆ†é…\"></a>Javascriptä¸­çš„\bå†…å­˜åˆ†é…</h2><p>å½“å£°æ˜å˜é‡æ—¶ï¼ŒJavaScriptä¼šè‡ªåŠ¨ä¸ºå˜é‡åˆ†é…å†…å­˜<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> numberVar = <span class=\"number\">100</span>; <span class=\"comment\">//ä¸º\bæ•´æ•°åˆ†é…å†…å­˜</span></div><div class=\"line\"><span class=\"keyword\">var</span> stringVar = <span class=\"string\">'node simplified'</span>;  <span class=\"comment\">// ä¸ºå­—ç¬¦ä¸²åˆ†é…å†…å­˜ </span></div><div class=\"line\"><span class=\"keyword\">var</span> objectVar = &#123;<span class=\"attr\">a</span>: <span class=\"number\">1</span>&#125;; <span class=\"comment\">// ä¸ºå¯¹è±¡åˆ†é…å†…å­˜</span></div><div class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>, <span class=\"literal\">null</span>, <span class=\"string\">'abra'</span>]; <span class=\"comment\">// ä¸ºæ•°ç»„åˆ†é…å†…å­˜</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\">a</span>) </span>&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> a + <span class=\"number\">2</span>;</div><div class=\"line\">&#125; <span class=\"comment\">// ä¸ºå‡½æ•°\båˆ†é…å†…å­˜</span></div></pre></td></tr></table></figure></p>\n<p>\bå½“å†…å­˜ä¸å†éœ€è¦æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾æ‰ã€‚å†…å­˜æ³„éœ²å’Œåœ¨é‡Šæ”¾å†…å­˜æ—¶å‡ºç°çš„å¤§éƒ¨åˆ†ä¸å†…å­˜ç›¸å…³çš„é—®é¢˜ï¼Œè€Œè¦æ‰¾å‡ºé‚£äº›è¢«åƒåœ¾å›æ”¶å™¨è·Ÿè¸ª\bä¸å†éœ€è¦çš„è€Œåˆæ²¡æœ‰è¢«é‡Šæ”¾çš„å†…å­˜æ˜¯å¾ˆå›°éš¾çš„ã€‚</p>\n<h2 id=\"GC-Garbage-collection\"><a href=\"#GC-Garbage-collection\" class=\"headerlink\" title=\"GC(Garbage collection)\"></a>GC(Garbage collection)</h2><p>\båƒåœ¾å›æ”¶æ˜¯è¿½è¸ªå¹¶é‡Šæ”¾åº”ç”¨ç¨‹åºä¸å†\bä½¿ç”¨çš„å†…å­˜è¿‡ç¨‹ã€‚åƒåœ¾å›æ”¶å™¨é€š\bè¿‡ç®—æ³•æ¥å®ç°è¿½è¸ªåº”ç”¨ç¨‹åºä¸å†ä½¿ç”¨çš„å†…å­˜ã€‚\b\bä¸»è¦æ¶‰åŠçš„åƒåœ¾å›æ”¶ç®—æ³•å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>Reference-counting garbage collectionï¼ˆå¼•ç”¨è®¡æ•°ï¼‰</li>\n<li>Mark-and-sweep algorithmï¼ˆæ ‡è®°æ¸…é™¤ï¼‰</li>\n</ul>\n<h3 id=\"Reference-counting-garbage-collectionï¼ˆå¼•ç”¨è®¡æ•°ï¼‰\"><a href=\"#Reference-counting-garbage-collectionï¼ˆå¼•ç”¨è®¡æ•°ï¼‰\" class=\"headerlink\" title=\"Reference-counting garbage collectionï¼ˆå¼•ç”¨è®¡æ•°ï¼‰\"></a>Reference-counting garbage collectionï¼ˆå¼•ç”¨è®¡æ•°ï¼‰</h3><p>å¼•ç”¨è®¡æ•°ç®—æ³•æ˜¯\bä¸€ç§æœ€åŸºç¡€çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œå½“ä¸€ä¸ª\bå¯¹è±¡çš„å¼•ç”¨æ•°ä¸ºé›¶æ—¶ï¼Œä¼šè¢«è‡ªåŠ¨å›æ”¶ã€‚è¯¥ç®—æ³•å°†\b\bä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æ•°ä¸º0æ—¶è§†ä¸ºåº”ç”¨ç¨‹åºä¸å†\béœ€è¦çš„\bå†…å­˜ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">!<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">  <span class=\"keyword\">var</span> o1 = &#123;<span class=\"attr\">a</span>: &#123;<span class=\"attr\">b</span>: <span class=\"number\">2</span>&#125;&#125;,<span class=\"comment\">// ä¸¤ä¸ªå¯¹è±¡è¢«åˆ›å»ºA:&#123;a: &#123;b: 2&#125;&#125;ï¼ŒB:&#123;b: 2&#125;ï¼Œå¯¹è±¡Bè¢«å¯¹è±¡Açš„å±æ€§aå¼•ç”¨ï¼Œå¯¹è±¡Aè¢«\b\bèµ‹å€¼ç»™å˜é‡o1ã€‚\bAå’ŒBçš„å¼•ç”¨æ•°éƒ½ä¸º1ï¼Œå› æ­¤ä¸èƒ½è¢«å›æ”¶ã€‚</span></div><div class=\"line\">      o2 = o1; <span class=\"comment\">// å°†å¯¹è±¡Aèµ‹ç»™\bå˜é‡o2ã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º2ï¼ŒB\bå¼•ç”¨æ•°1ã€‚</span></div><div class=\"line\">      o1 = <span class=\"number\">1</span>;<span class=\"comment\">// \bå°†å˜é‡o1å¯¹å¯¹è±¡Aå¼•ç”¨åˆ‡æ–­ã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º1ï¼ŒBå¼•ç”¨æ•°1ã€‚</span></div><div class=\"line\">  <span class=\"keyword\">var</span> oa = o2.a; <span class=\"comment\">// å°†å¯¹è±¡Bèµ‹å€¼ç»™å˜é‡oaã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º1ï¼ŒBå¼•ç”¨æ•°2ã€‚</span></div><div class=\"line\">      o2 = <span class=\"string\">'foo'</span>; <span class=\"comment\">// å°†å˜é‡o2å¯¹å¯¹è±¡A\bå¼•ç”¨åˆ‡æ–­ã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º0ï¼ŒBå¼•ç”¨æ•°1ã€‚å› ä¸ºå¯¹è±¡Açš„a\bå±æ€§è¢«\bå˜é‡oaå¼•ç”¨ï¼Œå› æ­¤å¯¹è±¡Aä¸èƒ½è¢«é‡Šæ”¾ã€‚</span></div><div class=\"line\">      oa = <span class=\"literal\">null</span>; <span class=\"comment\">// å°†å˜é‡oaå¯¹å¯¹è±¡Bå¼•ç”¨åˆ‡æ–­ã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º0ï¼ŒBå¼•ç”¨æ•°\b0ã€‚Aä¸Bä¼šè¢«\bå›æ”¶ã€‚</span></div><div class=\"line\">&#125;()</div></pre></td></tr></table></figure>\n<h4 id=\"å¼•ç”¨è®¡æ•°çš„é™åˆ¶ï¼šå¾ªç¯å¼•ç”¨\"><a href=\"#å¼•ç”¨è®¡æ•°çš„é™åˆ¶ï¼šå¾ªç¯å¼•ç”¨\" class=\"headerlink\" title=\"å¼•ç”¨è®¡æ•°çš„\bé™åˆ¶ï¼šå¾ªç¯å¼•ç”¨\"></a>å¼•ç”¨è®¡æ•°çš„\bé™åˆ¶ï¼šå¾ªç¯å¼•ç”¨</h4><p>  å¾ªç¯å¼•ç”¨å­˜åœ¨ä¸€ä¸ªé™åˆ¶ã€‚å¦‚ä¸‹å®ä¾‹ï¼Œä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ï¼Œå½¢æˆä¸€ä¸ªå¾ªç¯å¼•ç”¨ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“å‡½æ•°\bæ‰§è¡Œå®Œåï¼Œ\bå¯¹åº”çš„å†…å­˜\b\bä¼šè¢«é‡Šæ”¾æ‰ã€‚è€Œ\b<strong>å¼•ç”¨è®¡æ•°ç®—æ³•</strong>ä¼šå°†å¾ªç¯å¼•ç”¨å¯¹è±¡çš„å¼•ç”¨æ•°éƒ½è§†ä¸ºè‡³å°‘ä¸º1ï¼Œå› æ­¤ä¸èƒ½è¢«å›æ”¶ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">  <span class=\"keyword\">var</span> o = &#123;&#125;;</div><div class=\"line\">  <span class=\"keyword\">var</span> o2 = &#123;&#125;;</div><div class=\"line\">  o.a = o2; <span class=\"comment\">// o references o2</span></div><div class=\"line\">  o2.a = o; <span class=\"comment\">// o2 references o</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">'azerty'</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">f();</div></pre></td></tr></table></figure>\n<p><img src=\"./cycle.png\" alt=\"cycle\"></p>\n<h4 id=\"å¸¸è§é—®é¢˜å®ä¾‹\"><a href=\"#å¸¸è§é—®é¢˜å®ä¾‹\" class=\"headerlink\" title=\"å¸¸è§é—®é¢˜å®ä¾‹\"></a>å¸¸è§é—®é¢˜å®ä¾‹</h4><p>  IE6-7\bçš„DOMå¯¹è±¡æ˜¯åŸºäºè®¡æ•°å¼•ç”¨\b\b\bç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶çš„ã€‚è€Œå¾ªç¯å¼•ç”¨é€šå¸¸ä¼šå¯¼è‡´å†…å­˜\bæ³„éœ²ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> div;</div><div class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">  div = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'myDivElement'</span>);</div><div class=\"line\">  div.circularReference = div;</div><div class=\"line\">  div.lotsOfData = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>(<span class=\"number\">10000</span>).join(<span class=\"string\">'*'</span>);</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure>\n<p>å¦‚ä¸Šè¿°å®ä¾‹ï¼ŒDOMå…ƒç´ divé€šè¿‡è‡ªèº«çš„â€œcircularReferenceâ€å±æ€§å¾ªç¯å¼•ç”¨è‡ªå·±ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼å°†è¯¥å±æ€§åˆ é™¤æˆ–\bè®¾ä¸ºnullï¼Œ\bè®¡æ•°å¼•ç”¨åƒåœ¾å›æ”¶å™¨ä¼š\bå§‹ç»ˆæŒæœ‰\bè‡³å°‘ä¸€ä¸ªå¼•ç”¨ã€‚å³ä½¿DOMå…ƒç´ ä»DOMæ ‘ç§\bç§»é™¤ï¼ŒDOMå…ƒç´ çš„å†…å­˜\bä¼šä¸€ç›´å­˜åœ¨ã€‚å¦‚æœDOMå…ƒç´ æŒæœ‰ä¸€äº›æ•°æ®ï¼ˆå¦‚å®ä¾‹ä¸­â€œlotsDataâ€å±æ€§ï¼‰ï¼Œè¯¥æ•°æ®å¯¹åº”çš„å†…å­˜ä¹Ÿæ— æ³•\bè¢«é‡Šæ”¾ã€‚<br>\b</p>\n<h3 id=\"Mark-and-sweep-algorithmï¼ˆæ ‡è®°æ¸…é™¤ï¼‰\"><a href=\"#Mark-and-sweep-algorithmï¼ˆæ ‡è®°æ¸…é™¤ï¼‰\" class=\"headerlink\" title=\"Mark-and-sweep algorithmï¼ˆæ ‡è®°æ¸…é™¤ï¼‰\"></a>Mark-and-sweep algorithmï¼ˆæ ‡è®°æ¸…é™¤ï¼‰</h3><p>è¯¥ç®—æ³•å°†â€œå¯¹è±¡ä¸å†éœ€è¦â€çš„å®šä¹‰\bç®€åŒ–ä¸ºâ€œå¯¹è±¡ä¸å¯åˆ°è¾¾â€ã€‚<br>è¿™ä¸ªç®—æ³•å‡è®¾æœ‰ä¸€ç»„\bè¢«ç§°ä¸ºrootsçš„å¯¹è±¡ï¼ˆåœ¨JavaScriptä¸­ï¼Œrootå°±æ˜¯å…¨å±€å¯¹è±¡ï¼‰ã€‚åƒåœ¾å›æ”¶å™¨ä¼š\bå®šæœŸåœ°\bä»è¿™äº›rootså¼€å§‹ï¼ŒæŸ¥æ‰¾æ‰€æœ‰ä»æ ¹å¼€å§‹å¼•ç”¨çš„å¯¹è±¡ï¼Œç„¶åæŸ¥æ‰¾è¿™äº›å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡â€¦â€¦ã€‚\bä»\brootså¼€å§‹ï¼Œåƒåœ¾å›æ”¶å™¨ä¼š\bæŸ¥æ‰¾æ‰€æœ‰å¯åˆ°è¾¾å¯¹è±¡ï¼Œå¹¶å›æ”¶ä¸å¯åˆ°è¾¾çš„å¯¹è±¡ã€‚</p>\n<p>ä¸ºäº†ç¡®å®šå¯¹è±¡æ˜¯å¦éœ€è¦ï¼Œè¯¥ç®—æ³•è¦ç¡®å®šå¯¹è±¡æ˜¯å¦å¯åˆ°è¾¾ã€‚ç”±å¦‚ä¸‹æ­¥éª¤ç»„æˆï¼š</p>\n<ol>\n<li>åƒåœ¾å›æ”¶å™¨ä¼š\båˆ›å»ºä¸€ç»„rootsï¼Œrootsé€šå¸¸æ˜¯æŒæœ‰å¼•ç”¨çš„å…¨å±€å˜é‡ã€‚åœ¨JavaScriptä¸­ï¼Œwindowå¯¹è±¡å°±å¯ä½œä¸ºrootçš„å…¨å±€å˜é‡ã€‚</li>\n<li>åƒåœ¾å›æ”¶å™¨ä¼šæ£€æŸ¥æ‰€æœ‰çš„rootså¹¶æ ‡è®°ä¸ºæ´»è·ƒçŠ¶æ€ã€‚ç„¶å\bé€’å½’éå†æ‰€æœ‰çš„å­å˜é‡ã€‚\båªè¦ä»rootä¸èƒ½åˆ°è¾¾çš„éƒ½è¢«æ ‡è®°ä¸ºåƒåœ¾ã€‚</li>\n<li>\bæ‰€æœ‰æ²¡æœ‰è¢«æ ‡è®°ä¸ºæ´»è·ƒçŠ¶æ€çš„å†…å­˜å—\béƒ½è¢«è§†ä¸ºåƒåœ¾ã€‚\båƒåœ¾å›æ”¶å™¨å°±å¯ä»¥é‡Šæ”¾\bè¿™éƒ¨åˆ†å†…å­˜å¹¶æŠŠé‡Šæ”¾çš„å†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚</li>\n</ol>\n<p><img src=\"./mark-sweep.gif\" alt=\"\"></p>\n<p>è¿™ä¸ªç®—æ³•æ¯”å¼•ç”¨è®¡æ•°ç®—æ³•æ›´ä¼˜ï¼Œå› ä¸ºâ€œ\b\bé›¶å¼•\bç”¨çš„å¯¹è±¡â€æ€»æ˜¯ä¸å¯åˆ°è¾¾çš„ï¼Œä½†\bå\bä¹‹åˆ™ä¸ä¸€å®šï¼Œå¦‚\bå¾ªç¯å¼•ç”¨ã€‚<br>æˆªè‡³2012å¹´ï¼Œæ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½å†…ç½®äº†\b<strong>æ ‡è®°æ¸…é™¤åƒåœ¾å›æ”¶å™¨</strong>ã€‚\b\b\båœ¨è¿‡å»å‡ å¹´é‡Œæ‰€æœ‰å¯¹JavaScriptåƒåœ¾å›æ”¶çš„æ”¹è¿›ï¼ˆ<a href=\"http://www.memorymanagement.org/glossary/g.html#term-generational-garbage-collection\" target=\"_blank\" rel=\"external\">generational/incremental/concurrent/parallel garbage collection</a>ï¼‰éƒ½æ˜¯åŸºäº<strong>æ ‡è®°æ¸…é™¤ç®—æ³•</strong>æ¥å®ç°çš„ï¼Œå¹¶æ²¡æœ‰æ”¹å˜<strong>æ ‡è®°æ¸…é™¤ç®—æ³•</strong>æœ¬èº«å’Œå®ƒå¯¹â€œå¯¹è±¡ä¸å†éœ€è¦â€å®šä¹‰çš„ç®€åŒ–ã€‚<br>\b</p>\n<h4 id=\"å¾ªç¯å¼•ç”¨ä¸å†æ˜¯é—®é¢˜\"><a href=\"#å¾ªç¯å¼•ç”¨ä¸å†æ˜¯é—®é¢˜\" class=\"headerlink\" title=\"å¾ªç¯å¼•ç”¨ä¸å†\bæ˜¯é—®é¢˜\"></a>å¾ªç¯å¼•ç”¨ä¸å†\bæ˜¯é—®é¢˜</h4><p>\b\bå‰é¢å¾ªç¯å¼•ç”¨çš„å®ä¾‹ä¸­ï¼Œåœ¨å‡½æ•°æ‰§è¡Œå®Œåï¼Œä¸¤ä¸ªå¯¹è±¡ä¸å†è¢«å…¨å±€å¯¹è±¡\bå¯è®¿é—®çš„å¯¹è±¡å¼•ç”¨ã€‚å› æ­¤\b\bè¿™ä¸¤\bä¸ªå¯¹è±¡è¢«\båƒåœ¾å›æ”¶å™¨æ ‡è®°ä¸ºä¸å¯åˆ°è¾¾\bï¼Œæ¥ç€è¢«å›æ”¶æ‰ã€‚<br><img src=\"./no-cycle.png\" alt=\"\"></p>\n<h4 id=\"é™åˆ¶ï¼šéœ€è¦æ˜ç¡®æ— æ³•åˆ°è¾¾çš„å¯¹è±¡\"><a href=\"#é™åˆ¶ï¼šéœ€è¦æ˜ç¡®æ— æ³•åˆ°è¾¾çš„å¯¹è±¡\" class=\"headerlink\" title=\"é™åˆ¶ï¼šéœ€è¦æ˜ç¡®æ— æ³•åˆ°è¾¾çš„å¯¹è±¡\"></a>é™åˆ¶ï¼šéœ€è¦æ˜ç¡®æ— æ³•åˆ°è¾¾çš„å¯¹è±¡</h4><p>\bå°½ç®¡è¿™æ˜¯ä¸€ä¸ª\bé™åˆ¶ï¼Œä½†å®è·µä¸­å¾ˆå°‘é‡è§è¿™ç§æƒ…å†µï¼Œæ‰€ä»¥å¼€å‘è€…ä¸å¤ªä¼šå»å…³å¿ƒåƒåœ¾å›æ”¶æœºåˆ¶ã€‚</p>\n<h2 id=\"å‚è€ƒæ–‡ç« ï¼š\"><a href=\"#å‚è€ƒæ–‡ç« ï¼š\" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« ï¼š\"></a>å‚è€ƒæ–‡ç« ï¼š</h2><ul>\n<li><a href=\"http://www.nodesimplified.com/2017/08/javascript-memory-management-and.html\" target=\"_blank\" rel=\"external\">Memory Management And Garbage Collection In Javascript</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management\" target=\"_blank\" rel=\"external\">Memory Management</a></li>\n<li><a href=\"https://blog.sessionstack.com/how-javascript-works-memory-management-how-to-handle-4-common-memory-leaks-3f28b94cfbec\" target=\"_blank\" rel=\"external\">How JavaScript works: memory management + how to handle 4 common memory leaks</a></li>\n<li><a href=\"http://www.memorymanagement.org/glossary/g.html#term-generational-garbage-collection\" target=\"_blank\" rel=\"external\">Memory Management Reference</a></li>\n</ul>\n<hr>\n<blockquote>\n<p>å£°æ˜:æœ¬èµ„æ–™ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ä½¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”! å¦‚éœ€è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>\n</blockquote>\n<hr>\n","site":{"data":{}},"excerpt":"","more":"<p>Cã€C++è¯­è¨€éœ€è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…ä¸é‡Šæ”¾ï¼ˆå¸¸ç”¨æ–¹æ³•ï¼šmalloc(), calloc(), realloc()å’Œfree()ç­‰ï¼‰ã€‚è€ŒJavaScriptä¸Javaã€C#ç›¸ä¼¼ï¼Œå†…ç½®äº†åƒåœ¾å›æ”¶å™¨ï¼Œèƒ½è‡ªåŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…ä¸é‡Šæ”¾ã€‚</p>\n<h2 id=\"å†…å­˜ç”Ÿå‘½å‘¨æœŸ\"><a href=\"#å†…å­˜ç”Ÿå‘½å‘¨æœŸ\" class=\"headerlink\" title=\"å†…å­˜ç”Ÿå‘½å‘¨æœŸ:\"></a>å†…å­˜ç”Ÿå‘½å‘¨æœŸ:</h2><ol>\n<li>åˆ†é…å†…å­˜</li>\n<li>ä½¿ç”¨åˆ†é…çš„å†…å­˜(è¯»ä¸å†™æ“ä½œ)</li>\n<li>å½“åº”ç”¨ç¨‹åºä¸å†éœ€è¦æ—¶ï¼Œé‡Šæ”¾æ‰\bå·²åˆ†é…çš„å†…å­˜</li>\n</ol>\n<p><img src=\"./life-cycle.png\" alt=\"lifecycle\"></p>\n<p>\bè™½ç„¶\b\bå†…å­˜è‡ªåŠ¨è¿›è¡Œ\båˆ†é…ã€é‡Šæ”¾ï¼Œä½†å¹¶ä¸æ„å‘³ç€\bå¼€å‘è€…ä¸éœ€è¦å…³æ³¨å†…å­˜ç®¡ç†\bã€‚\bå› ä¸ºä¸€äº›ä¸å¥½çš„ç¼–ç ä¼šå¯¼è‡´\b<a href=\"https://en.wikipedia.org/wiki/Memory_leak#Reference_counting_and_cyclic_references\" target=\"_blank\" rel=\"external\">å†…å­˜æ³„éœ²</a>ï¼Œå³åº”ç”¨ç¨‹åºä¸å†\béœ€è¦çš„å†…å­˜æ²¡æœ‰è¢«é‡Šæ”¾æ‰ã€‚å› æ­¤äº†è§£å†…å­˜ç®¡ç†æ˜¯å¾ˆé‡è¦çš„</p>\n<h2 id=\"Javascriptä¸­çš„å†…å­˜åˆ†é…\"><a href=\"#Javascriptä¸­çš„å†…å­˜åˆ†é…\" class=\"headerlink\" title=\"Javascriptä¸­çš„\bå†…å­˜åˆ†é…\"></a>Javascriptä¸­çš„\bå†…å­˜åˆ†é…</h2><p>å½“å£°æ˜å˜é‡æ—¶ï¼ŒJavaScriptä¼šè‡ªåŠ¨ä¸ºå˜é‡åˆ†é…å†…å­˜<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> numberVar = <span class=\"number\">100</span>; <span class=\"comment\">//ä¸º\bæ•´æ•°åˆ†é…å†…å­˜</span></div><div class=\"line\"><span class=\"keyword\">var</span> stringVar = <span class=\"string\">'node simplified'</span>;  <span class=\"comment\">// ä¸ºå­—ç¬¦ä¸²åˆ†é…å†…å­˜ </span></div><div class=\"line\"><span class=\"keyword\">var</span> objectVar = &#123;<span class=\"attr\">a</span>: <span class=\"number\">1</span>&#125;; <span class=\"comment\">// ä¸ºå¯¹è±¡åˆ†é…å†…å­˜</span></div><div class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>, <span class=\"literal\">null</span>, <span class=\"string\">'abra'</span>]; <span class=\"comment\">// ä¸ºæ•°ç»„åˆ†é…å†…å­˜</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\">a</span>) </span>&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> a + <span class=\"number\">2</span>;</div><div class=\"line\">&#125; <span class=\"comment\">// ä¸ºå‡½æ•°\båˆ†é…å†…å­˜</span></div></pre></td></tr></table></figure></p>\n<p>\bå½“å†…å­˜ä¸å†éœ€è¦æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾æ‰ã€‚å†…å­˜æ³„éœ²å’Œåœ¨é‡Šæ”¾å†…å­˜æ—¶å‡ºç°çš„å¤§éƒ¨åˆ†ä¸å†…å­˜ç›¸å…³çš„é—®é¢˜ï¼Œè€Œè¦æ‰¾å‡ºé‚£äº›è¢«åƒåœ¾å›æ”¶å™¨è·Ÿè¸ª\bä¸å†éœ€è¦çš„è€Œåˆæ²¡æœ‰è¢«é‡Šæ”¾çš„å†…å­˜æ˜¯å¾ˆå›°éš¾çš„ã€‚</p>\n<h2 id=\"GC-Garbage-collection\"><a href=\"#GC-Garbage-collection\" class=\"headerlink\" title=\"GC(Garbage collection)\"></a>GC(Garbage collection)</h2><p>\båƒåœ¾å›æ”¶æ˜¯è¿½è¸ªå¹¶é‡Šæ”¾åº”ç”¨ç¨‹åºä¸å†\bä½¿ç”¨çš„å†…å­˜è¿‡ç¨‹ã€‚åƒåœ¾å›æ”¶å™¨é€š\bè¿‡ç®—æ³•æ¥å®ç°è¿½è¸ªåº”ç”¨ç¨‹åºä¸å†ä½¿ç”¨çš„å†…å­˜ã€‚\b\bä¸»è¦æ¶‰åŠçš„åƒåœ¾å›æ”¶ç®—æ³•å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>Reference-counting garbage collectionï¼ˆå¼•ç”¨è®¡æ•°ï¼‰</li>\n<li>Mark-and-sweep algorithmï¼ˆæ ‡è®°æ¸…é™¤ï¼‰</li>\n</ul>\n<h3 id=\"Reference-counting-garbage-collectionï¼ˆå¼•ç”¨è®¡æ•°ï¼‰\"><a href=\"#Reference-counting-garbage-collectionï¼ˆå¼•ç”¨è®¡æ•°ï¼‰\" class=\"headerlink\" title=\"Reference-counting garbage collectionï¼ˆå¼•ç”¨è®¡æ•°ï¼‰\"></a>Reference-counting garbage collectionï¼ˆå¼•ç”¨è®¡æ•°ï¼‰</h3><p>å¼•ç”¨è®¡æ•°ç®—æ³•æ˜¯\bä¸€ç§æœ€åŸºç¡€çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œå½“ä¸€ä¸ª\bå¯¹è±¡çš„å¼•ç”¨æ•°ä¸ºé›¶æ—¶ï¼Œä¼šè¢«è‡ªåŠ¨å›æ”¶ã€‚è¯¥ç®—æ³•å°†\b\bä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æ•°ä¸º0æ—¶è§†ä¸ºåº”ç”¨ç¨‹åºä¸å†\béœ€è¦çš„\bå†…å­˜ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">!<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">  <span class=\"keyword\">var</span> o1 = &#123;<span class=\"attr\">a</span>: &#123;<span class=\"attr\">b</span>: <span class=\"number\">2</span>&#125;&#125;,<span class=\"comment\">// ä¸¤ä¸ªå¯¹è±¡è¢«åˆ›å»ºA:&#123;a: &#123;b: 2&#125;&#125;ï¼ŒB:&#123;b: 2&#125;ï¼Œå¯¹è±¡Bè¢«å¯¹è±¡Açš„å±æ€§aå¼•ç”¨ï¼Œå¯¹è±¡Aè¢«\b\bèµ‹å€¼ç»™å˜é‡o1ã€‚\bAå’ŒBçš„å¼•ç”¨æ•°éƒ½ä¸º1ï¼Œå› æ­¤ä¸èƒ½è¢«å›æ”¶ã€‚</span></div><div class=\"line\">      o2 = o1; <span class=\"comment\">// å°†å¯¹è±¡Aèµ‹ç»™\bå˜é‡o2ã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º2ï¼ŒB\bå¼•ç”¨æ•°1ã€‚</span></div><div class=\"line\">      o1 = <span class=\"number\">1</span>;<span class=\"comment\">// \bå°†å˜é‡o1å¯¹å¯¹è±¡Aå¼•ç”¨åˆ‡æ–­ã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º1ï¼ŒBå¼•ç”¨æ•°1ã€‚</span></div><div class=\"line\">  <span class=\"keyword\">var</span> oa = o2.a; <span class=\"comment\">// å°†å¯¹è±¡Bèµ‹å€¼ç»™å˜é‡oaã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º1ï¼ŒBå¼•ç”¨æ•°2ã€‚</span></div><div class=\"line\">      o2 = <span class=\"string\">'foo'</span>; <span class=\"comment\">// å°†å˜é‡o2å¯¹å¯¹è±¡A\bå¼•ç”¨åˆ‡æ–­ã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º0ï¼ŒBå¼•ç”¨æ•°1ã€‚å› ä¸ºå¯¹è±¡Açš„a\bå±æ€§è¢«\bå˜é‡oaå¼•ç”¨ï¼Œå› æ­¤å¯¹è±¡Aä¸èƒ½è¢«é‡Šæ”¾ã€‚</span></div><div class=\"line\">      oa = <span class=\"literal\">null</span>; <span class=\"comment\">// å°†å˜é‡oaå¯¹å¯¹è±¡Bå¼•ç”¨åˆ‡æ–­ã€‚æ­¤æ—¶Aå¼•ç”¨æ•°ä¸º0ï¼ŒBå¼•ç”¨æ•°\b0ã€‚Aä¸Bä¼šè¢«\bå›æ”¶ã€‚</span></div><div class=\"line\">&#125;()</div></pre></td></tr></table></figure>\n<h4 id=\"å¼•ç”¨è®¡æ•°çš„é™åˆ¶ï¼šå¾ªç¯å¼•ç”¨\"><a href=\"#å¼•ç”¨è®¡æ•°çš„é™åˆ¶ï¼šå¾ªç¯å¼•ç”¨\" class=\"headerlink\" title=\"å¼•ç”¨è®¡æ•°çš„\bé™åˆ¶ï¼šå¾ªç¯å¼•ç”¨\"></a>å¼•ç”¨è®¡æ•°çš„\bé™åˆ¶ï¼šå¾ªç¯å¼•ç”¨</h4><p>  å¾ªç¯å¼•ç”¨å­˜åœ¨ä¸€ä¸ªé™åˆ¶ã€‚å¦‚ä¸‹å®ä¾‹ï¼Œä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ï¼Œå½¢æˆä¸€ä¸ªå¾ªç¯å¼•ç”¨ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“å‡½æ•°\bæ‰§è¡Œå®Œåï¼Œ\bå¯¹åº”çš„å†…å­˜\b\bä¼šè¢«é‡Šæ”¾æ‰ã€‚è€Œ\b<strong>å¼•ç”¨è®¡æ•°ç®—æ³•</strong>ä¼šå°†å¾ªç¯å¼•ç”¨å¯¹è±¡çš„å¼•ç”¨æ•°éƒ½è§†ä¸ºè‡³å°‘ä¸º1ï¼Œå› æ­¤ä¸èƒ½è¢«å›æ”¶ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">  <span class=\"keyword\">var</span> o = &#123;&#125;;</div><div class=\"line\">  <span class=\"keyword\">var</span> o2 = &#123;&#125;;</div><div class=\"line\">  o.a = o2; <span class=\"comment\">// o references o2</span></div><div class=\"line\">  o2.a = o; <span class=\"comment\">// o2 references o</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">'azerty'</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">f();</div></pre></td></tr></table></figure>\n<p><img src=\"./cycle.png\" alt=\"cycle\"></p>\n<h4 id=\"å¸¸è§é—®é¢˜å®ä¾‹\"><a href=\"#å¸¸è§é—®é¢˜å®ä¾‹\" class=\"headerlink\" title=\"å¸¸è§é—®é¢˜å®ä¾‹\"></a>å¸¸è§é—®é¢˜å®ä¾‹</h4><p>  IE6-7\bçš„DOMå¯¹è±¡æ˜¯åŸºäºè®¡æ•°å¼•ç”¨\b\b\bç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶çš„ã€‚è€Œå¾ªç¯å¼•ç”¨é€šå¸¸ä¼šå¯¼è‡´å†…å­˜\bæ³„éœ²ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> div;</div><div class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">  div = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'myDivElement'</span>);</div><div class=\"line\">  div.circularReference = div;</div><div class=\"line\">  div.lotsOfData = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>(<span class=\"number\">10000</span>).join(<span class=\"string\">'*'</span>);</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure>\n<p>å¦‚ä¸Šè¿°å®ä¾‹ï¼ŒDOMå…ƒç´ divé€šè¿‡è‡ªèº«çš„â€œcircularReferenceâ€å±æ€§å¾ªç¯å¼•ç”¨è‡ªå·±ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼å°†è¯¥å±æ€§åˆ é™¤æˆ–\bè®¾ä¸ºnullï¼Œ\bè®¡æ•°å¼•ç”¨åƒåœ¾å›æ”¶å™¨ä¼š\bå§‹ç»ˆæŒæœ‰\bè‡³å°‘ä¸€ä¸ªå¼•ç”¨ã€‚å³ä½¿DOMå…ƒç´ ä»DOMæ ‘ç§\bç§»é™¤ï¼ŒDOMå…ƒç´ çš„å†…å­˜\bä¼šä¸€ç›´å­˜åœ¨ã€‚å¦‚æœDOMå…ƒç´ æŒæœ‰ä¸€äº›æ•°æ®ï¼ˆå¦‚å®ä¾‹ä¸­â€œlotsDataâ€å±æ€§ï¼‰ï¼Œè¯¥æ•°æ®å¯¹åº”çš„å†…å­˜ä¹Ÿæ— æ³•\bè¢«é‡Šæ”¾ã€‚<br>\b</p>\n<h3 id=\"Mark-and-sweep-algorithmï¼ˆæ ‡è®°æ¸…é™¤ï¼‰\"><a href=\"#Mark-and-sweep-algorithmï¼ˆæ ‡è®°æ¸…é™¤ï¼‰\" class=\"headerlink\" title=\"Mark-and-sweep algorithmï¼ˆæ ‡è®°æ¸…é™¤ï¼‰\"></a>Mark-and-sweep algorithmï¼ˆæ ‡è®°æ¸…é™¤ï¼‰</h3><p>è¯¥ç®—æ³•å°†â€œå¯¹è±¡ä¸å†éœ€è¦â€çš„å®šä¹‰\bç®€åŒ–ä¸ºâ€œå¯¹è±¡ä¸å¯åˆ°è¾¾â€ã€‚<br>è¿™ä¸ªç®—æ³•å‡è®¾æœ‰ä¸€ç»„\bè¢«ç§°ä¸ºrootsçš„å¯¹è±¡ï¼ˆåœ¨JavaScriptä¸­ï¼Œrootå°±æ˜¯å…¨å±€å¯¹è±¡ï¼‰ã€‚åƒåœ¾å›æ”¶å™¨ä¼š\bå®šæœŸåœ°\bä»è¿™äº›rootså¼€å§‹ï¼ŒæŸ¥æ‰¾æ‰€æœ‰ä»æ ¹å¼€å§‹å¼•ç”¨çš„å¯¹è±¡ï¼Œç„¶åæŸ¥æ‰¾è¿™äº›å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡â€¦â€¦ã€‚\bä»\brootså¼€å§‹ï¼Œåƒåœ¾å›æ”¶å™¨ä¼š\bæŸ¥æ‰¾æ‰€æœ‰å¯åˆ°è¾¾å¯¹è±¡ï¼Œå¹¶å›æ”¶ä¸å¯åˆ°è¾¾çš„å¯¹è±¡ã€‚</p>\n<p>ä¸ºäº†ç¡®å®šå¯¹è±¡æ˜¯å¦éœ€è¦ï¼Œè¯¥ç®—æ³•è¦ç¡®å®šå¯¹è±¡æ˜¯å¦å¯åˆ°è¾¾ã€‚ç”±å¦‚ä¸‹æ­¥éª¤ç»„æˆï¼š</p>\n<ol>\n<li>åƒåœ¾å›æ”¶å™¨ä¼š\båˆ›å»ºä¸€ç»„rootsï¼Œrootsé€šå¸¸æ˜¯æŒæœ‰å¼•ç”¨çš„å…¨å±€å˜é‡ã€‚åœ¨JavaScriptä¸­ï¼Œwindowå¯¹è±¡å°±å¯ä½œä¸ºrootçš„å…¨å±€å˜é‡ã€‚</li>\n<li>åƒåœ¾å›æ”¶å™¨ä¼šæ£€æŸ¥æ‰€æœ‰çš„rootså¹¶æ ‡è®°ä¸ºæ´»è·ƒçŠ¶æ€ã€‚ç„¶å\bé€’å½’éå†æ‰€æœ‰çš„å­å˜é‡ã€‚\båªè¦ä»rootä¸èƒ½åˆ°è¾¾çš„éƒ½è¢«æ ‡è®°ä¸ºåƒåœ¾ã€‚</li>\n<li>\bæ‰€æœ‰æ²¡æœ‰è¢«æ ‡è®°ä¸ºæ´»è·ƒçŠ¶æ€çš„å†…å­˜å—\béƒ½è¢«è§†ä¸ºåƒåœ¾ã€‚\båƒåœ¾å›æ”¶å™¨å°±å¯ä»¥é‡Šæ”¾\bè¿™éƒ¨åˆ†å†…å­˜å¹¶æŠŠé‡Šæ”¾çš„å†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚</li>\n</ol>\n<p><img src=\"./mark-sweep.gif\" alt=\"\"></p>\n<p>è¿™ä¸ªç®—æ³•æ¯”å¼•ç”¨è®¡æ•°ç®—æ³•æ›´ä¼˜ï¼Œå› ä¸ºâ€œ\b\bé›¶å¼•\bç”¨çš„å¯¹è±¡â€æ€»æ˜¯ä¸å¯åˆ°è¾¾çš„ï¼Œä½†\bå\bä¹‹åˆ™ä¸ä¸€å®šï¼Œå¦‚\bå¾ªç¯å¼•ç”¨ã€‚<br>æˆªè‡³2012å¹´ï¼Œæ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½å†…ç½®äº†\b<strong>æ ‡è®°æ¸…é™¤åƒåœ¾å›æ”¶å™¨</strong>ã€‚\b\b\båœ¨è¿‡å»å‡ å¹´é‡Œæ‰€æœ‰å¯¹JavaScriptåƒåœ¾å›æ”¶çš„æ”¹è¿›ï¼ˆ<a href=\"http://www.memorymanagement.org/glossary/g.html#term-generational-garbage-collection\" target=\"_blank\" rel=\"external\">generational/incremental/concurrent/parallel garbage collection</a>ï¼‰éƒ½æ˜¯åŸºäº<strong>æ ‡è®°æ¸…é™¤ç®—æ³•</strong>æ¥å®ç°çš„ï¼Œå¹¶æ²¡æœ‰æ”¹å˜<strong>æ ‡è®°æ¸…é™¤ç®—æ³•</strong>æœ¬èº«å’Œå®ƒå¯¹â€œå¯¹è±¡ä¸å†éœ€è¦â€å®šä¹‰çš„ç®€åŒ–ã€‚<br>\b</p>\n<h4 id=\"å¾ªç¯å¼•ç”¨ä¸å†æ˜¯é—®é¢˜\"><a href=\"#å¾ªç¯å¼•ç”¨ä¸å†æ˜¯é—®é¢˜\" class=\"headerlink\" title=\"å¾ªç¯å¼•ç”¨ä¸å†\bæ˜¯é—®é¢˜\"></a>å¾ªç¯å¼•ç”¨ä¸å†\bæ˜¯é—®é¢˜</h4><p>\b\bå‰é¢å¾ªç¯å¼•ç”¨çš„å®ä¾‹ä¸­ï¼Œåœ¨å‡½æ•°æ‰§è¡Œå®Œåï¼Œä¸¤ä¸ªå¯¹è±¡ä¸å†è¢«å…¨å±€å¯¹è±¡\bå¯è®¿é—®çš„å¯¹è±¡å¼•ç”¨ã€‚å› æ­¤\b\bè¿™ä¸¤\bä¸ªå¯¹è±¡è¢«\båƒåœ¾å›æ”¶å™¨æ ‡è®°ä¸ºä¸å¯åˆ°è¾¾\bï¼Œæ¥ç€è¢«å›æ”¶æ‰ã€‚<br><img src=\"./no-cycle.png\" alt=\"\"></p>\n<h4 id=\"é™åˆ¶ï¼šéœ€è¦æ˜ç¡®æ— æ³•åˆ°è¾¾çš„å¯¹è±¡\"><a href=\"#é™åˆ¶ï¼šéœ€è¦æ˜ç¡®æ— æ³•åˆ°è¾¾çš„å¯¹è±¡\" class=\"headerlink\" title=\"é™åˆ¶ï¼šéœ€è¦æ˜ç¡®æ— æ³•åˆ°è¾¾çš„å¯¹è±¡\"></a>é™åˆ¶ï¼šéœ€è¦æ˜ç¡®æ— æ³•åˆ°è¾¾çš„å¯¹è±¡</h4><p>\bå°½ç®¡è¿™æ˜¯ä¸€ä¸ª\bé™åˆ¶ï¼Œä½†å®è·µä¸­å¾ˆå°‘é‡è§è¿™ç§æƒ…å†µï¼Œæ‰€ä»¥å¼€å‘è€…ä¸å¤ªä¼šå»å…³å¿ƒåƒåœ¾å›æ”¶æœºåˆ¶ã€‚</p>\n<h2 id=\"å‚è€ƒæ–‡ç« ï¼š\"><a href=\"#å‚è€ƒæ–‡ç« ï¼š\" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« ï¼š\"></a>å‚è€ƒæ–‡ç« ï¼š</h2><ul>\n<li><a href=\"http://www.nodesimplified.com/2017/08/javascript-memory-management-and.html\" target=\"_blank\" rel=\"external\">Memory Management And Garbage Collection In Javascript</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management\" target=\"_blank\" rel=\"external\">Memory Management</a></li>\n<li><a href=\"https://blog.sessionstack.com/how-javascript-works-memory-management-how-to-handle-4-common-memory-leaks-3f28b94cfbec\" target=\"_blank\" rel=\"external\">How JavaScript works: memory management + how to handle 4 common memory leaks</a></li>\n<li><a href=\"http://www.memorymanagement.org/glossary/g.html#term-generational-garbage-collection\" target=\"_blank\" rel=\"external\">Memory Management Reference</a></li>\n</ul>\n<hr>\n<blockquote>\n<p>å£°æ˜:æœ¬èµ„æ–™ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ä½¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”! å¦‚éœ€è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>\n</blockquote>\n<hr>\n"},{"title":"async-vs-defer","date":"2017-09-19T11:16:04.000Z","author":"singsong","_content":"\n> **async**ä¸**defer**éƒ½æ˜¯ç”¨æ¥å»¶è¿Ÿï¼ˆå¼‚æ­¥ï¼‰åŠ è½½è„šæœ¬ï¼Œä½†ä¸¤è€…ä¹‹é—´è¿˜æ˜¯å­˜åœ¨ä¸€äº›åŒºåˆ«çš„ï¼Œå› æ­¤ä½¿ç”¨åœºæ™¯ä¹Ÿæœ‰æ‰€ä¸åŒã€‚\n\n\n## Legend\n\n![legend](./legend.svg)\n\n\n## script\nscriptæ ‡ç­¾ä¸å¸¦\b**async**æˆ–**defer**ç‰¹æ€§æ—¶ã€‚å½“æµè§ˆå™¨è§£æHTMLé‡åˆ°è¯¥scriptæ ‡ç­¾æ—¶ï¼Œä¼šæš‚åœè§£æå·¥ä½œã€‚ç„¶åä¼šå‘èµ·è„šæœ¬è¯·æ±‚ï¼Œåœ¨è„šæœ¬ä¸‹è½½å®Œä¾¿å¼€å§‹æ‰§è¡Œï¼Œåªæœ‰åœ¨\bè„šæœ¬æ‰§è¡Œå®Œä¹‹åæ‰æ¢å¤\b\b\b\bHTMLè§£æã€‚\n\n\n![script](./script.svg)\n\n## script with async\n\nscriptæ ‡ç­¾å¸¦**async**ç‰¹æ€§æ—¶ã€‚å½“æµè§ˆå™¨è§£æHTMLé‡åˆ°è¯¥scriptæ ‡ç­¾æ—¶ï¼Œæ­¤æ—¶è„šæœ¬çš„ä¸‹è½½ä¸ä¼šé˜»å¡HTMLçš„è§£æï¼Œåªæœ‰åœ¨è„šæœ¬ä¸‹è½½å®Œ\bå¼€å§‹æ‰§è¡Œæ—¶ï¼Œæ‰ä¼šé˜»å¡HTMLçš„è§£æã€‚**async**å¯ä»¥ä¸èƒ½ä¿è¯è„šæœ¬æ‰§è¡Œé¡ºåºï¼ˆåœ¨æ–‡æ¡£ä¸­å‡ºç°çš„\bé¡ºåºï¼‰ï¼Œå› ä¸ºæ‰§è¡Œé¡ºåºå–å†³äºä¸‹è½½å®Œçš„\bé¡ºåºã€‚\n\n\n![script](./script-async.svg)\n\n## script with defer\n\nscriptæ ‡ç­¾å¸¦**defer**ç‰¹æ€§æ—¶ã€‚å½“æµè§ˆå™¨è§£æHTMLé‡åˆ°è¯¥scriptæ ‡ç­¾æ—¶ï¼Œæ­¤æ—¶è„šæœ¬çš„ä¸‹è½½ä¸ä¼šé˜»å¡HTMLçš„è§£æï¼Œè„šæœ¬\u001fåªæœ‰åœ¨\bHTMLè§£æå®Œä¹‹åæ‰å¼€å§‹æ‰§è¡Œã€‚**defer**å¯ä»¥ä¿è¯è„šæœ¬æ‰§è¡Œé¡ºåºï¼ˆåœ¨æ–‡æ¡£ä¸­å‡ºç°çš„\bé¡ºåºï¼‰ã€‚\n\n![script](./script-defer.svg)\n\n## å¯¹æ¯”\n\n- ### ç›¸åŒä¹‹å¤„ï¼š\n  - åœ¨è„šæœ¬ä¸‹è½½æ—¶ï¼Œéƒ½ä¸ä¼šé˜»å¡æ–‡æ¡£è§£æ\n  - æ”¯æŒonloadäº‹ä»¶å›è°ƒå¤„ç†ï¼Œç”¨äºä¸€äº›åˆå§‹åŒ–å·¥ä½œ\n  - å¯¹å†…è”è„šæœ¬æ— æ•ˆ\n  - è„šæœ¬ä¸­ä¸èƒ½è°ƒç”¨document.write()\n- ### ä¸åŒä¹‹å¤„ï¼š\n  å¸¦æœ‰asyncç‰¹æ€§çš„è„šæœ¬ä¼šåœ¨è„šæœ¬ä¸‹è½½å®Œåç«‹å³æ‰§è¡Œï¼Œä¸”åœ¨loadäº‹ä»¶ä¹‹å‰ï¼Œæ‰€ä»¥ä¸èƒ½ç¡®ä¿è„šæœ¬åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„é¡ºåºæ¥æ‰§è¡Œã€‚è€Œå¸¦æœ‰deferç‰¹æ€§çš„è„šæœ¬ä¼šåœ¨æ–‡æ¡£è§£æå®ŒåæŒ‰ç…§åœ¨æ–‡æ¡£å‡ºç°çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œä¸”åœ¨DOMContentLoadedäº‹ä»¶ä¹‹å‰ã€‚\n\n## ä½¿ç”¨è§„åˆ™\nä¸€èˆ¬å°½å¯èƒ½ä½¿ç”¨**async**ï¼Œç„¶åè€ƒè™‘**defer**ï¼Œæœ€åä¸ä½¿ç”¨ä»»ä½•ç‰¹æ€§\n- å¦‚æœ\bè„šæœ¬æ˜¯ä¸€ä¸ªæ¨¡å—å¹¶ä¸”æ²¡æœ‰ä¾èµ–äºå…¶ä»–\bè„šæœ¬æ—¶ï¼Œ\bä½¿ç”¨**async**\n- å¦‚æœè„šæœ¬ä¾èµ–äºå…¶ä»–è„šæœ¬æˆ–è¢«å…¶ä»–è„šæœ¬ä¾èµ–æ—¶ï¼Œä½¿ç”¨**defer**\n- å¦‚æœè„šæœ¬è¾ƒå°ï¼Œå¹¶ä¸”\bè¢«\bå…¶ä»–å¸¦**async**çš„è„šæœ¬ä¾èµ–ï¼Œå¯ä»¥å°†è¯¥è„šæœ¬ç›´æ¥\bå†…è”scriptæ ‡ç­¾ä¸­ï¼Œå¹¶æ”¾ç½®åœ¨**async**è„šæœ¬ä¹‹\bå‰\n\n\b\n## å…¼å®¹\n\nåœ¨<=IE9\bæµè§ˆå™¨å¯¹**defer**çš„å®ç°å­˜åœ¨ä¸€äº›bugï¼Œå¦‚deferä¸èƒ½ä¿è¯scriptçš„æ‰§è¡Œé¡ºåºï¼Œå¦‚æœéœ€è¦æ”¯æŒ\b<=IE9ï¼Œä¸å»ºè®®ä½¿ç”¨**defer**ï¼Œå¦‚æœ\bscirptsçš„æ‰§è¡Œé¡ºåºé‡è¦ï¼Œå¯ä»¥ä¸è®¾ç½®ä»»ä½•ç‰¹æ€§ï¼Œ[äº†è§£æ›´å¤š](https://github.com/h5bp/lazyweb-requests/issues/42)ã€‚\n\n## å‚è€ƒæ–‡ç« ï¼š\n- [async vs defer attributes](http://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html)\n\n---\n\n> å£°æ˜:æœ¬èµ„æ–™ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ä½¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”! å¦‚éœ€è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚\n\n---","source":"_posts/async-vs-defer.md","raw":"---\ntitle: async-vs-defer\ndate: 2017-09-19 19:16:04\ntags: [defer, async, ä¼˜åŒ–]\nauthor: singsong\n---\n\n> **async**ä¸**defer**éƒ½æ˜¯ç”¨æ¥å»¶è¿Ÿï¼ˆå¼‚æ­¥ï¼‰åŠ è½½è„šæœ¬ï¼Œä½†ä¸¤è€…ä¹‹é—´è¿˜æ˜¯å­˜åœ¨ä¸€äº›åŒºåˆ«çš„ï¼Œå› æ­¤ä½¿ç”¨åœºæ™¯ä¹Ÿæœ‰æ‰€ä¸åŒã€‚\n\n\n## Legend\n\n![legend](./legend.svg)\n\n\n## script\nscriptæ ‡ç­¾ä¸å¸¦\b**async**æˆ–**defer**ç‰¹æ€§æ—¶ã€‚å½“æµè§ˆå™¨è§£æHTMLé‡åˆ°è¯¥scriptæ ‡ç­¾æ—¶ï¼Œä¼šæš‚åœè§£æå·¥ä½œã€‚ç„¶åä¼šå‘èµ·è„šæœ¬è¯·æ±‚ï¼Œåœ¨è„šæœ¬ä¸‹è½½å®Œä¾¿å¼€å§‹æ‰§è¡Œï¼Œåªæœ‰åœ¨\bè„šæœ¬æ‰§è¡Œå®Œä¹‹åæ‰æ¢å¤\b\b\b\bHTMLè§£æã€‚\n\n\n![script](./script.svg)\n\n## script with async\n\nscriptæ ‡ç­¾å¸¦**async**ç‰¹æ€§æ—¶ã€‚å½“æµè§ˆå™¨è§£æHTMLé‡åˆ°è¯¥scriptæ ‡ç­¾æ—¶ï¼Œæ­¤æ—¶è„šæœ¬çš„ä¸‹è½½ä¸ä¼šé˜»å¡HTMLçš„è§£æï¼Œåªæœ‰åœ¨è„šæœ¬ä¸‹è½½å®Œ\bå¼€å§‹æ‰§è¡Œæ—¶ï¼Œæ‰ä¼šé˜»å¡HTMLçš„è§£æã€‚**async**å¯ä»¥ä¸èƒ½ä¿è¯è„šæœ¬æ‰§è¡Œé¡ºåºï¼ˆåœ¨æ–‡æ¡£ä¸­å‡ºç°çš„\bé¡ºåºï¼‰ï¼Œå› ä¸ºæ‰§è¡Œé¡ºåºå–å†³äºä¸‹è½½å®Œçš„\bé¡ºåºã€‚\n\n\n![script](./script-async.svg)\n\n## script with defer\n\nscriptæ ‡ç­¾å¸¦**defer**ç‰¹æ€§æ—¶ã€‚å½“æµè§ˆå™¨è§£æHTMLé‡åˆ°è¯¥scriptæ ‡ç­¾æ—¶ï¼Œæ­¤æ—¶è„šæœ¬çš„ä¸‹è½½ä¸ä¼šé˜»å¡HTMLçš„è§£æï¼Œè„šæœ¬\u001fåªæœ‰åœ¨\bHTMLè§£æå®Œä¹‹åæ‰å¼€å§‹æ‰§è¡Œã€‚**defer**å¯ä»¥ä¿è¯è„šæœ¬æ‰§è¡Œé¡ºåºï¼ˆåœ¨æ–‡æ¡£ä¸­å‡ºç°çš„\bé¡ºåºï¼‰ã€‚\n\n![script](./script-defer.svg)\n\n## å¯¹æ¯”\n\n- ### ç›¸åŒä¹‹å¤„ï¼š\n  - åœ¨è„šæœ¬ä¸‹è½½æ—¶ï¼Œéƒ½ä¸ä¼šé˜»å¡æ–‡æ¡£è§£æ\n  - æ”¯æŒonloadäº‹ä»¶å›è°ƒå¤„ç†ï¼Œç”¨äºä¸€äº›åˆå§‹åŒ–å·¥ä½œ\n  - å¯¹å†…è”è„šæœ¬æ— æ•ˆ\n  - è„šæœ¬ä¸­ä¸èƒ½è°ƒç”¨document.write()\n- ### ä¸åŒä¹‹å¤„ï¼š\n  å¸¦æœ‰asyncç‰¹æ€§çš„è„šæœ¬ä¼šåœ¨è„šæœ¬ä¸‹è½½å®Œåç«‹å³æ‰§è¡Œï¼Œä¸”åœ¨loadäº‹ä»¶ä¹‹å‰ï¼Œæ‰€ä»¥ä¸èƒ½ç¡®ä¿è„šæœ¬åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„é¡ºåºæ¥æ‰§è¡Œã€‚è€Œå¸¦æœ‰deferç‰¹æ€§çš„è„šæœ¬ä¼šåœ¨æ–‡æ¡£è§£æå®ŒåæŒ‰ç…§åœ¨æ–‡æ¡£å‡ºç°çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œä¸”åœ¨DOMContentLoadedäº‹ä»¶ä¹‹å‰ã€‚\n\n## ä½¿ç”¨è§„åˆ™\nä¸€èˆ¬å°½å¯èƒ½ä½¿ç”¨**async**ï¼Œç„¶åè€ƒè™‘**defer**ï¼Œæœ€åä¸ä½¿ç”¨ä»»ä½•ç‰¹æ€§\n- å¦‚æœ\bè„šæœ¬æ˜¯ä¸€ä¸ªæ¨¡å—å¹¶ä¸”æ²¡æœ‰ä¾èµ–äºå…¶ä»–\bè„šæœ¬æ—¶ï¼Œ\bä½¿ç”¨**async**\n- å¦‚æœè„šæœ¬ä¾èµ–äºå…¶ä»–è„šæœ¬æˆ–è¢«å…¶ä»–è„šæœ¬ä¾èµ–æ—¶ï¼Œä½¿ç”¨**defer**\n- å¦‚æœè„šæœ¬è¾ƒå°ï¼Œå¹¶ä¸”\bè¢«\bå…¶ä»–å¸¦**async**çš„è„šæœ¬ä¾èµ–ï¼Œå¯ä»¥å°†è¯¥è„šæœ¬ç›´æ¥\bå†…è”scriptæ ‡ç­¾ä¸­ï¼Œå¹¶æ”¾ç½®åœ¨**async**è„šæœ¬ä¹‹\bå‰\n\n\b\n## å…¼å®¹\n\nåœ¨<=IE9\bæµè§ˆå™¨å¯¹**defer**çš„å®ç°å­˜åœ¨ä¸€äº›bugï¼Œå¦‚deferä¸èƒ½ä¿è¯scriptçš„æ‰§è¡Œé¡ºåºï¼Œå¦‚æœéœ€è¦æ”¯æŒ\b<=IE9ï¼Œä¸å»ºè®®ä½¿ç”¨**defer**ï¼Œå¦‚æœ\bscirptsçš„æ‰§è¡Œé¡ºåºé‡è¦ï¼Œå¯ä»¥ä¸è®¾ç½®ä»»ä½•ç‰¹æ€§ï¼Œ[äº†è§£æ›´å¤š](https://github.com/h5bp/lazyweb-requests/issues/42)ã€‚\n\n## å‚è€ƒæ–‡ç« ï¼š\n- [async vs defer attributes](http://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html)\n\n---\n\n> å£°æ˜:æœ¬èµ„æ–™ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ä½¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”! å¦‚éœ€è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚\n\n---","slug":"async-vs-defer","published":1,"updated":"2018-08-22T08:06:45.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjl4vata400031hn9uzcj3lzi","content":"<blockquote>\n<p><strong>async</strong>ä¸<strong>defer</strong>éƒ½æ˜¯ç”¨æ¥å»¶è¿Ÿï¼ˆå¼‚æ­¥ï¼‰åŠ è½½è„šæœ¬ï¼Œä½†ä¸¤è€…ä¹‹é—´è¿˜æ˜¯å­˜åœ¨ä¸€äº›åŒºåˆ«çš„ï¼Œå› æ­¤ä½¿ç”¨åœºæ™¯ä¹Ÿæœ‰æ‰€ä¸åŒã€‚</p>\n</blockquote>\n<h2 id=\"Legend\"><a href=\"#Legend\" class=\"headerlink\" title=\"Legend\"></a>Legend</h2><p><img src=\"./legend.svg\" alt=\"legend\"></p>\n<h2 id=\"script\"><a href=\"#script\" class=\"headerlink\" title=\"script\"></a>script</h2><p>scriptæ ‡ç­¾ä¸å¸¦\b<strong>async</strong>æˆ–<strong>defer</strong>ç‰¹æ€§æ—¶ã€‚å½“æµè§ˆå™¨è§£æHTMLé‡åˆ°è¯¥scriptæ ‡ç­¾æ—¶ï¼Œä¼šæš‚åœè§£æå·¥ä½œã€‚ç„¶åä¼šå‘èµ·è„šæœ¬è¯·æ±‚ï¼Œåœ¨è„šæœ¬ä¸‹è½½å®Œä¾¿å¼€å§‹æ‰§è¡Œï¼Œåªæœ‰åœ¨\bè„šæœ¬æ‰§è¡Œå®Œä¹‹åæ‰æ¢å¤\b\b\b\bHTMLè§£æã€‚</p>\n<p><img src=\"./script.svg\" alt=\"script\"></p>\n<h2 id=\"script-with-async\"><a href=\"#script-with-async\" class=\"headerlink\" title=\"script with async\"></a>script with async</h2><p>scriptæ ‡ç­¾å¸¦<strong>async</strong>ç‰¹æ€§æ—¶ã€‚å½“æµè§ˆå™¨è§£æHTMLé‡åˆ°è¯¥scriptæ ‡ç­¾æ—¶ï¼Œæ­¤æ—¶è„šæœ¬çš„ä¸‹è½½ä¸ä¼šé˜»å¡HTMLçš„è§£æï¼Œåªæœ‰åœ¨è„šæœ¬ä¸‹è½½å®Œ\bå¼€å§‹æ‰§è¡Œæ—¶ï¼Œæ‰ä¼šé˜»å¡HTMLçš„è§£æã€‚<strong>async</strong>å¯ä»¥ä¸èƒ½ä¿è¯è„šæœ¬æ‰§è¡Œé¡ºåºï¼ˆåœ¨æ–‡æ¡£ä¸­å‡ºç°çš„\bé¡ºåºï¼‰ï¼Œå› ä¸ºæ‰§è¡Œé¡ºåºå–å†³äºä¸‹è½½å®Œçš„\bé¡ºåºã€‚</p>\n<p><img src=\"./script-async.svg\" alt=\"script\"></p>\n<h2 id=\"script-with-defer\"><a href=\"#script-with-defer\" class=\"headerlink\" title=\"script with defer\"></a>script with defer</h2><p>scriptæ ‡ç­¾å¸¦<strong>defer</strong>ç‰¹æ€§æ—¶ã€‚å½“æµè§ˆå™¨è§£æHTMLé‡åˆ°è¯¥scriptæ ‡ç­¾æ—¶ï¼Œæ­¤æ—¶è„šæœ¬çš„ä¸‹è½½ä¸ä¼šé˜»å¡HTMLçš„è§£æï¼Œè„šæœ¬\u001fåªæœ‰åœ¨\bHTMLè§£æå®Œä¹‹åæ‰å¼€å§‹æ‰§è¡Œã€‚<strong>defer</strong>å¯ä»¥ä¿è¯è„šæœ¬æ‰§è¡Œé¡ºåºï¼ˆåœ¨æ–‡æ¡£ä¸­å‡ºç°çš„\bé¡ºåºï¼‰ã€‚</p>\n<p><img src=\"./script-defer.svg\" alt=\"script\"></p>\n<h2 id=\"å¯¹æ¯”\"><a href=\"#å¯¹æ¯”\" class=\"headerlink\" title=\"å¯¹æ¯”\"></a>å¯¹æ¯”</h2><ul>\n<li><h3 id=\"ç›¸åŒä¹‹å¤„ï¼š\"><a href=\"#ç›¸åŒä¹‹å¤„ï¼š\" class=\"headerlink\" title=\"ç›¸åŒä¹‹å¤„ï¼š\"></a>ç›¸åŒä¹‹å¤„ï¼š</h3><ul>\n<li>åœ¨è„šæœ¬ä¸‹è½½æ—¶ï¼Œéƒ½ä¸ä¼šé˜»å¡æ–‡æ¡£è§£æ</li>\n<li>æ”¯æŒonloadäº‹ä»¶å›è°ƒå¤„ç†ï¼Œç”¨äºä¸€äº›åˆå§‹åŒ–å·¥ä½œ</li>\n<li>å¯¹å†…è”è„šæœ¬æ— æ•ˆ</li>\n<li>è„šæœ¬ä¸­ä¸èƒ½è°ƒç”¨document.write()</li>\n</ul>\n</li>\n<li><h3 id=\"ä¸åŒä¹‹å¤„ï¼š\"><a href=\"#ä¸åŒä¹‹å¤„ï¼š\" class=\"headerlink\" title=\"ä¸åŒä¹‹å¤„ï¼š\"></a>ä¸åŒä¹‹å¤„ï¼š</h3>å¸¦æœ‰asyncç‰¹æ€§çš„è„šæœ¬ä¼šåœ¨è„šæœ¬ä¸‹è½½å®Œåç«‹å³æ‰§è¡Œï¼Œä¸”åœ¨loadäº‹ä»¶ä¹‹å‰ï¼Œæ‰€ä»¥ä¸èƒ½ç¡®ä¿è„šæœ¬åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„é¡ºåºæ¥æ‰§è¡Œã€‚è€Œå¸¦æœ‰deferç‰¹æ€§çš„è„šæœ¬ä¼šåœ¨æ–‡æ¡£è§£æå®ŒåæŒ‰ç…§åœ¨æ–‡æ¡£å‡ºç°çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œä¸”åœ¨DOMContentLoadedäº‹ä»¶ä¹‹å‰ã€‚</li>\n</ul>\n<h2 id=\"ä½¿ç”¨è§„åˆ™\"><a href=\"#ä½¿ç”¨è§„åˆ™\" class=\"headerlink\" title=\"ä½¿ç”¨è§„åˆ™\"></a>ä½¿ç”¨è§„åˆ™</h2><p>ä¸€èˆ¬å°½å¯èƒ½ä½¿ç”¨<strong>async</strong>ï¼Œç„¶åè€ƒè™‘<strong>defer</strong>ï¼Œæœ€åä¸ä½¿ç”¨ä»»ä½•ç‰¹æ€§</p>\n<ul>\n<li>å¦‚æœ\bè„šæœ¬æ˜¯ä¸€ä¸ªæ¨¡å—å¹¶ä¸”æ²¡æœ‰ä¾èµ–äºå…¶ä»–\bè„šæœ¬æ—¶ï¼Œ\bä½¿ç”¨<strong>async</strong></li>\n<li>å¦‚æœè„šæœ¬ä¾èµ–äºå…¶ä»–è„šæœ¬æˆ–è¢«å…¶ä»–è„šæœ¬ä¾èµ–æ—¶ï¼Œä½¿ç”¨<strong>defer</strong></li>\n<li>å¦‚æœè„šæœ¬è¾ƒå°ï¼Œå¹¶ä¸”\bè¢«\bå…¶ä»–å¸¦<strong>async</strong>çš„è„šæœ¬ä¾èµ–ï¼Œå¯ä»¥å°†è¯¥è„šæœ¬ç›´æ¥\bå†…è”scriptæ ‡ç­¾ä¸­ï¼Œå¹¶æ”¾ç½®åœ¨<strong>async</strong>è„šæœ¬ä¹‹\bå‰</li>\n</ul>\n<p>\b</p>\n<h2 id=\"å…¼å®¹\"><a href=\"#å…¼å®¹\" class=\"headerlink\" title=\"å…¼å®¹\"></a>å…¼å®¹</h2><p>åœ¨&lt;=IE9\bæµè§ˆå™¨å¯¹<strong>defer</strong>çš„å®ç°å­˜åœ¨ä¸€äº›bugï¼Œå¦‚deferä¸èƒ½ä¿è¯scriptçš„æ‰§è¡Œé¡ºåºï¼Œå¦‚æœéœ€è¦æ”¯æŒ\b&lt;=IE9ï¼Œä¸å»ºè®®ä½¿ç”¨<strong>defer</strong>ï¼Œå¦‚æœ\bscirptsçš„æ‰§è¡Œé¡ºåºé‡è¦ï¼Œå¯ä»¥ä¸è®¾ç½®ä»»ä½•ç‰¹æ€§ï¼Œ<a href=\"https://github.com/h5bp/lazyweb-requests/issues/42\" target=\"_blank\" rel=\"external\">äº†è§£æ›´å¤š</a>ã€‚</p>\n<h2 id=\"å‚è€ƒæ–‡ç« ï¼š\"><a href=\"#å‚è€ƒæ–‡ç« ï¼š\" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« ï¼š\"></a>å‚è€ƒæ–‡ç« ï¼š</h2><ul>\n<li><a href=\"http://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html\" target=\"_blank\" rel=\"external\">async vs defer attributes</a></li>\n</ul>\n<hr>\n<blockquote>\n<p>å£°æ˜:æœ¬èµ„æ–™ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ä½¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”! å¦‚éœ€è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>\n</blockquote>\n<hr>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p><strong>async</strong>ä¸<strong>defer</strong>éƒ½æ˜¯ç”¨æ¥å»¶è¿Ÿï¼ˆå¼‚æ­¥ï¼‰åŠ è½½è„šæœ¬ï¼Œä½†ä¸¤è€…ä¹‹é—´è¿˜æ˜¯å­˜åœ¨ä¸€äº›åŒºåˆ«çš„ï¼Œå› æ­¤ä½¿ç”¨åœºæ™¯ä¹Ÿæœ‰æ‰€ä¸åŒã€‚</p>\n</blockquote>\n<h2 id=\"Legend\"><a href=\"#Legend\" class=\"headerlink\" title=\"Legend\"></a>Legend</h2><p><img src=\"./legend.svg\" alt=\"legend\"></p>\n<h2 id=\"script\"><a href=\"#script\" class=\"headerlink\" title=\"script\"></a>script</h2><p>scriptæ ‡ç­¾ä¸å¸¦\b<strong>async</strong>æˆ–<strong>defer</strong>ç‰¹æ€§æ—¶ã€‚å½“æµè§ˆå™¨è§£æHTMLé‡åˆ°è¯¥scriptæ ‡ç­¾æ—¶ï¼Œä¼šæš‚åœè§£æå·¥ä½œã€‚ç„¶åä¼šå‘èµ·è„šæœ¬è¯·æ±‚ï¼Œåœ¨è„šæœ¬ä¸‹è½½å®Œä¾¿å¼€å§‹æ‰§è¡Œï¼Œåªæœ‰åœ¨\bè„šæœ¬æ‰§è¡Œå®Œä¹‹åæ‰æ¢å¤\b\b\b\bHTMLè§£æã€‚</p>\n<p><img src=\"./script.svg\" alt=\"script\"></p>\n<h2 id=\"script-with-async\"><a href=\"#script-with-async\" class=\"headerlink\" title=\"script with async\"></a>script with async</h2><p>scriptæ ‡ç­¾å¸¦<strong>async</strong>ç‰¹æ€§æ—¶ã€‚å½“æµè§ˆå™¨è§£æHTMLé‡åˆ°è¯¥scriptæ ‡ç­¾æ—¶ï¼Œæ­¤æ—¶è„šæœ¬çš„ä¸‹è½½ä¸ä¼šé˜»å¡HTMLçš„è§£æï¼Œåªæœ‰åœ¨è„šæœ¬ä¸‹è½½å®Œ\bå¼€å§‹æ‰§è¡Œæ—¶ï¼Œæ‰ä¼šé˜»å¡HTMLçš„è§£æã€‚<strong>async</strong>å¯ä»¥ä¸èƒ½ä¿è¯è„šæœ¬æ‰§è¡Œé¡ºåºï¼ˆåœ¨æ–‡æ¡£ä¸­å‡ºç°çš„\bé¡ºåºï¼‰ï¼Œå› ä¸ºæ‰§è¡Œé¡ºåºå–å†³äºä¸‹è½½å®Œçš„\bé¡ºåºã€‚</p>\n<p><img src=\"./script-async.svg\" alt=\"script\"></p>\n<h2 id=\"script-with-defer\"><a href=\"#script-with-defer\" class=\"headerlink\" title=\"script with defer\"></a>script with defer</h2><p>scriptæ ‡ç­¾å¸¦<strong>defer</strong>ç‰¹æ€§æ—¶ã€‚å½“æµè§ˆå™¨è§£æHTMLé‡åˆ°è¯¥scriptæ ‡ç­¾æ—¶ï¼Œæ­¤æ—¶è„šæœ¬çš„ä¸‹è½½ä¸ä¼šé˜»å¡HTMLçš„è§£æï¼Œè„šæœ¬\u001fåªæœ‰åœ¨\bHTMLè§£æå®Œä¹‹åæ‰å¼€å§‹æ‰§è¡Œã€‚<strong>defer</strong>å¯ä»¥ä¿è¯è„šæœ¬æ‰§è¡Œé¡ºåºï¼ˆåœ¨æ–‡æ¡£ä¸­å‡ºç°çš„\bé¡ºåºï¼‰ã€‚</p>\n<p><img src=\"./script-defer.svg\" alt=\"script\"></p>\n<h2 id=\"å¯¹æ¯”\"><a href=\"#å¯¹æ¯”\" class=\"headerlink\" title=\"å¯¹æ¯”\"></a>å¯¹æ¯”</h2><ul>\n<li><h3 id=\"ç›¸åŒä¹‹å¤„ï¼š\"><a href=\"#ç›¸åŒä¹‹å¤„ï¼š\" class=\"headerlink\" title=\"ç›¸åŒä¹‹å¤„ï¼š\"></a>ç›¸åŒä¹‹å¤„ï¼š</h3><ul>\n<li>åœ¨è„šæœ¬ä¸‹è½½æ—¶ï¼Œéƒ½ä¸ä¼šé˜»å¡æ–‡æ¡£è§£æ</li>\n<li>æ”¯æŒonloadäº‹ä»¶å›è°ƒå¤„ç†ï¼Œç”¨äºä¸€äº›åˆå§‹åŒ–å·¥ä½œ</li>\n<li>å¯¹å†…è”è„šæœ¬æ— æ•ˆ</li>\n<li>è„šæœ¬ä¸­ä¸èƒ½è°ƒç”¨document.write()</li>\n</ul>\n</li>\n<li><h3 id=\"ä¸åŒä¹‹å¤„ï¼š\"><a href=\"#ä¸åŒä¹‹å¤„ï¼š\" class=\"headerlink\" title=\"ä¸åŒä¹‹å¤„ï¼š\"></a>ä¸åŒä¹‹å¤„ï¼š</h3>å¸¦æœ‰asyncç‰¹æ€§çš„è„šæœ¬ä¼šåœ¨è„šæœ¬ä¸‹è½½å®Œåç«‹å³æ‰§è¡Œï¼Œä¸”åœ¨loadäº‹ä»¶ä¹‹å‰ï¼Œæ‰€ä»¥ä¸èƒ½ç¡®ä¿è„šæœ¬åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„é¡ºåºæ¥æ‰§è¡Œã€‚è€Œå¸¦æœ‰deferç‰¹æ€§çš„è„šæœ¬ä¼šåœ¨æ–‡æ¡£è§£æå®ŒåæŒ‰ç…§åœ¨æ–‡æ¡£å‡ºç°çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œä¸”åœ¨DOMContentLoadedäº‹ä»¶ä¹‹å‰ã€‚</li>\n</ul>\n<h2 id=\"ä½¿ç”¨è§„åˆ™\"><a href=\"#ä½¿ç”¨è§„åˆ™\" class=\"headerlink\" title=\"ä½¿ç”¨è§„åˆ™\"></a>ä½¿ç”¨è§„åˆ™</h2><p>ä¸€èˆ¬å°½å¯èƒ½ä½¿ç”¨<strong>async</strong>ï¼Œç„¶åè€ƒè™‘<strong>defer</strong>ï¼Œæœ€åä¸ä½¿ç”¨ä»»ä½•ç‰¹æ€§</p>\n<ul>\n<li>å¦‚æœ\bè„šæœ¬æ˜¯ä¸€ä¸ªæ¨¡å—å¹¶ä¸”æ²¡æœ‰ä¾èµ–äºå…¶ä»–\bè„šæœ¬æ—¶ï¼Œ\bä½¿ç”¨<strong>async</strong></li>\n<li>å¦‚æœè„šæœ¬ä¾èµ–äºå…¶ä»–è„šæœ¬æˆ–è¢«å…¶ä»–è„šæœ¬ä¾èµ–æ—¶ï¼Œä½¿ç”¨<strong>defer</strong></li>\n<li>å¦‚æœè„šæœ¬è¾ƒå°ï¼Œå¹¶ä¸”\bè¢«\bå…¶ä»–å¸¦<strong>async</strong>çš„è„šæœ¬ä¾èµ–ï¼Œå¯ä»¥å°†è¯¥è„šæœ¬ç›´æ¥\bå†…è”scriptæ ‡ç­¾ä¸­ï¼Œå¹¶æ”¾ç½®åœ¨<strong>async</strong>è„šæœ¬ä¹‹\bå‰</li>\n</ul>\n<p>\b</p>\n<h2 id=\"å…¼å®¹\"><a href=\"#å…¼å®¹\" class=\"headerlink\" title=\"å…¼å®¹\"></a>å…¼å®¹</h2><p>åœ¨&lt;=IE9\bæµè§ˆå™¨å¯¹<strong>defer</strong>çš„å®ç°å­˜åœ¨ä¸€äº›bugï¼Œå¦‚deferä¸èƒ½ä¿è¯scriptçš„æ‰§è¡Œé¡ºåºï¼Œå¦‚æœéœ€è¦æ”¯æŒ\b&lt;=IE9ï¼Œä¸å»ºè®®ä½¿ç”¨<strong>defer</strong>ï¼Œå¦‚æœ\bscirptsçš„æ‰§è¡Œé¡ºåºé‡è¦ï¼Œå¯ä»¥ä¸è®¾ç½®ä»»ä½•ç‰¹æ€§ï¼Œ<a href=\"https://github.com/h5bp/lazyweb-requests/issues/42\" target=\"_blank\" rel=\"external\">äº†è§£æ›´å¤š</a>ã€‚</p>\n<h2 id=\"å‚è€ƒæ–‡ç« ï¼š\"><a href=\"#å‚è€ƒæ–‡ç« ï¼š\" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« ï¼š\"></a>å‚è€ƒæ–‡ç« ï¼š</h2><ul>\n<li><a href=\"http://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html\" target=\"_blank\" rel=\"external\">async vs defer attributes</a></li>\n</ul>\n<hr>\n<blockquote>\n<p>å£°æ˜:æœ¬èµ„æ–™ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ä½¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”! å¦‚éœ€è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>\n</blockquote>\n<hr>\n"},{"title":"å…³äºz-indexçš„ä¸€äº›äº‹","date":"2017-08-29T06:14:24.000Z","author":"Singsong","_content":"\nä¸€èˆ¬**z-index\b**å¤±æ•ˆåŸºæœ¬ä¸Šéƒ½æ˜¯ä¸äº†è§£**z-index**æ˜¯å¦‚ä½•å·¥ä½œå¯¼è‡´çš„ï¼ˆè¿™æ²¡æœ‰çœ‹è¿™ç¯‡[blog\b](https://philipwalton.com/articles/what-no-one-told-you-about-z-index/)ä¹‹å‰ï¼Œè‡³å°‘æˆ‘ä¹Ÿæ˜¯è¿™æ ·çš„ï¼‰ã€‚å®ƒä¸å¤æ‚ï¼Œä½†å¦‚æœä¸èŠ±æ—¶é—´å»æŸ¥çœ‹z-indexæ–‡æ¡£ï¼Œå¯èƒ½ä¼šä¸äº†è§£ä¸€äº›å…³é”®æŠ€æœ¯ç‚¹ã€‚\n\nä¸ä¿¡ï¼Ÿ\bèƒ½å¦è§£ç­”å¦‚ä¸‹é—®é¢˜ï¼Œä½œä¸ºæ£€éªŒä½ æ˜¯å¦çœŸæ­£äº†è§£**z-index**ï¼š\n\n## é—®é¢˜ï¼š\n\nHTMLç»“æ„å¦‚ä¸‹ï¼š\n\n```HTML\n<div>\n  <span class=\"red\">Red</span>\n</div>\n<div>\n  <span class=\"green\">Green</span>\n</div>\n<div>\n  <span class=\"blue\">Blue</span>\n</div>\n```\nCSSå¦‚ä¸‹ï¼š\n\n```css\n.red, .green, .blue {\n  position: absolute;\n}\n.red {\n  background: red;\n  z-index: 1;\n}\n.green {\n  background: green;\n}\n.blue {\n  background: blue;\n}\n```\n\n### å¦‚ä½•å°†â€œçº¢è‰²å—â€æ”¾ç½®â€œç»¿è‰²å—â€ä¹‹åï¼Œéœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š\n\n- ä¸èƒ½ä¿®æ”¹htmlç»“æ„\n- ä¸èƒ½ä¿®æ”¹ä»»ä½•å…ƒç´ çš„z-indexå±æ€§\n- ä¸èƒ½ä¿®æ”¹ä»»ä½•å…ƒç´ çš„positionå±æ€§\n\n### codepen\bï¼š\n<iframe height='320' scrolling='no' title='JyNRxj' src='//codepen.io/zhansingsong/embed/JyNRxj/?height=330&theme-id=dark&default-tab=css,result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/zhansingsong/pen/JyNRxj/'>JyNRxj</a> by zhansingsong (<a href='https://codepen.io/zhansingsong'>@zhansingsong</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\n## è§£å†³æ–¹æ³•\n\nç»™\bç¬¬ä¸€ä¸ª`div`ï¼ˆå³\b\b\bâ€œ\bçº¢è‰²å—â€çš„\bçˆ¶èŠ‚ç‚¹ï¼‰æ·»åŠ å¦‚ä¸‹æ ·å¼ï¼š\n\n```css\n  div:first-child {\n    opacity: .99;\n  }\n```\n\næˆ–è®¸ä½ ä¼š\bå¥½å¥‡ä¸ºä»€ä¹ˆè¿™ä¸ª`opacity`ä¼šè®©\bâ€œçº¢è‰²å—â€ç½®äºâ€œç»¿è‰²å—â€ä¹‹åï¼ˆå½“æ—¶æˆ‘çœ‹è¿™ä¸ªç­”æ¡ˆä¹Ÿæ˜¯ä¸€è„¸æ‡µé€¼äº†\bğŸ˜‘\bï¼‰ã€‚å¸Œæœ›ä¸‹æ–‡èƒ½è§£æƒ‘ä½ çš„å¥½å¥‡ã€‚\n\n### z-index [specification](https://www.w3.org/TR/CSS2/visuren.html#propdef-z-index)\n**z-index**åªå¯¹**positionedå…ƒç´ **ï¼ˆå³è¯¥å…ƒç´ çš„`position`ä¸ç­‰äºé»˜è®¤`static`å¤–çš„å€¼ï¼‰èµ·ä½œç”¨ã€‚å¯¹åº”`positoned box`ï¼ˆpositionedå…ƒç´ )ï¼Œ**z-index**ä¸»è¦ï¼š\n1. æŒ‡å®šè¯¥å…ƒç´ åœ¨å½“å‰**stacking context**çš„stackå±‚çº§\n2. è¯¥å…ƒç´ æ˜¯å¦åˆ›å»ºæ–°çš„**stacking context**\n\n**z-index**å¯ä»¥å–å¦‚ä¸‹å€¼ï¼š\n\n- **(integer)æ•´æ•°**ï¼šè¡¨ç¤ºå½“å‰å…ƒç´ åœ¨å½“å‰çš„**stacking context**çš„stackå±‚çº§ï¼Œå¹¶ä¼šè®©å½“å‰å…ƒç´ åˆ›å»ºä¸€ä¸ªæ–°çš„**stacking context**\n\n- **auto**: è¡¨ç¤ºå½“å‰å…ƒç´ åœ¨å½“å‰çš„**stacking context**çš„stackå±‚çº§ä¸º0ï¼Œå¦‚æœè¯¥å…ƒç´ ä¸æ˜¯**root**å…ƒç´ ï¼Œå°±ä¸ä¼šåˆ›å»ºæ–°çš„**stacking context**\n\n\n### stacking order\n**stacking context**å¯ä»¥ç›¸äº’åµŒå¥—ï¼Œæ¯ä¸ªå…ƒç´ ï¼ˆboxï¼‰éƒ½å±äºä¸€ä¸ª**stacking context**ï¼ˆè‡ªåŒ…å«ï¼‰ï¼Œæ¯ä¸ª`positoned box`åœ¨ä¸€ä¸ª**stacking context**ä¸­éƒ½æœ‰ä¸€ä¸ªæ•´æ•°çš„stackå±‚çº§ï¼Œå®ƒè¡¨ç¤ºåœ¨åŒä¸€ä¸ª**stacking context**ä¸­çš„zè½´æ–¹å‘stackå±‚çº§ä½ç½®ã€‚stackå±‚çº§è¶Šå¤§åœ¨**stacking context**ä¸­çš„ä½ç½®è¶Šé å‰ã€‚å¦‚æœstackå±‚çº§ç›¸åŒï¼ŒæŒ‰å…¶åœ¨DOMæ–‡æ¡£ä¸­å‡ºç°é¡ºåºç»˜åˆ¶ã€‚\n\n### stacking context\n>**The stacking context** is a three-dimensional conceptualization of HTML elements along an imaginary z-axis relative to the user who is assumed to be facing the viewport or the webpage. HTML elements occupy this space in priority order based on element attributes.â€”â€”MDN\n\n\n\n**stacking context**çš„å½¢æˆæ¡ä»¶ï¼š\n\n* æ–‡æ¡£æ ¹èŠ‚ç‚¹ï¼ˆHTMLï¼‰| Root element of document (HTML).\n* å…ƒç´ çš„positionå±æ€§å€¼ä¸º`absolute`æˆ–`relative`ï¼Œå¹¶ä¸”z-indexå±æ€§ä¸ºé™¤`auto`å¤–çš„å€¼ | Element with a position value \"absolute\" or \"relative\" and z-index value other than \"auto\".\n* å…ƒç´ çš„positionå±æ€§å€¼ä¸º`fixed`æˆ–`sticky` | Element with a position value \"fixed\" or \"sticky\" (sticky for all mobile browsers, but not older desktop).\n* å…ƒç´ æ˜¯flexboxå®¹å™¨çš„å­å…ƒç´ ï¼Œå¸¦æœ‰z-indexå±æ€§ï¼Œä¸”å€¼ä¸ºé™¤`auto`å¤–çš„å€¼ | Element that is a child of a flex (flexbox) container, with z-index value other than \"auto\".\n* å…ƒç´ çš„opcityå±æ€§å€¼å°äº1 | Element with a opacity value less than 1 (See the specification for opacity).\n* å…ƒç´ çš„[mix-blend-mode](https://developer.mozilla.org/en-US/docs/Web/CSS/mix-blend-mode)å±æ€§å€¼ä¸ºé™¤`normal`å¤–çš„å€¼ | Element with a mix-blend-mode value other than \"normal\".\n* å…ƒç´ çš„å¦‚ä¸‹å±æ€§å€¼ä¸ºé™¤`none`å¤–çš„å€¼ | Element with any of the following properties with value other than \"none\":\n    * [transform](https://developer.mozilla.org/en-US/docs/Web/CSS/transform)\n    * [filter](https://developer.mozilla.org/en-US/docs/Web/CSS/filter)\n    * [perspective](https://developer.mozilla.org/en-US/docs/Web/CSS/perspective)\n    * [clip-path](https://developer.mozilla.org/en-US/docs/Web/CSS/clip-path)\n    * [mask](https://developer.mozilla.org/en-US/docs/Web/CSS/mask) / [mask-image](https://developer.mozilla.org/en-US/docs/Web/CSS/mask-image) / [mask-border](https://developer.mozilla.org/en-US/docs/Web/CSS/mask-border)\n* å…ƒç´ çš„isolationå±æ€§å€¼ä¸º`isolate` | Element with a [isolation](https://developer.mozilla.org/en-US/docs/Web/CSS/isolation) value \"isolate\".\n* å…ƒç´ çš„-webkit-overflow-scrollingå±æ€§å€¼ä¸º`touch` | Element with a -webkit-overflow-scrolling value \"touch\".\n* å…ƒç´ å¸¦æœ‰[will-change](https://developer.mozilla.org/en-US/docs/Web/CSS/will-change)å±æ€§ | Element with a will-change value specifying any property that would create a stacking context on non-initial value (see this post).\n\n### painted order in stacking context\n\n  1. å½¢æˆ**stacking context**å…ƒç´ çš„`background`å’Œ`borders` | the background and borders of the element forming the stacking context.\n  2. è´Ÿæ•°çš„stackå±‚çº§çš„**child stacking context**(è´Ÿæ•°å€¼è¶Šå¤§è¶Šå‰) | the child stacking contexts with negative stack levels (most negative first).\n  3. æ–‡æ¡£æµä¸­éinlineçº§ã€épositionedå­èŠ‚ç‚¹ | the in-flow, non-inline-level, non-positioned descendants.\n  4. épositionedæµ®åŠ¨å­èŠ‚ç‚¹ | the non-positioned floats.\n  5. æ–‡æ¡£æµä¸­épositionedçš„inlineçº§å­èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬inline tableså’Œinline blocksï¼‰ | the in-flow, inline-level, non-positioned descendants, including inline tables and inline blocks.\n  6. stackå±‚çº§ä¸º0çš„**child stacking context**å’Œpositonedå­èŠ‚ç‚¹ | the child stacking contexts with stack level 0 and the positioned descendants with stack level 0.\n  7. stackå±‚çº§ä¸ºæ­£æ•´æ•°çš„**child stacking context** | the child stacking contexts with positive stack levels (least positive first).\n  ### Example\n  <iframe height='265' scrolling='no' title='stackLevel' src='//codepen.io/zhansingsong/embed/WEMrNK/?height=265&theme-id=dark&default-tab=css,result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/zhansingsong/pen/WEMrNK/'>stackLevel</a> by zhansingsong (<a href='https://codepen.io/zhansingsong'>@zhansingsong</a>) on <a href='https://codepen.io'>CodePen</a>.\n  </iframe>\n\n\n## å‚è€ƒæ–‡ç« ï¼š\n- [What No One Told You About Z-Index](https://philipwalton.com/articles/what-no-one-told-you-about-z-index/)\n- [The stacking context](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context)\n- [Specifying the stack level: the 'z-index' property](https://www.w3.org/TR/CSS2/visuren.html#propdef-z-index)\n\n\n</br>\n\n---\n\n> å£°æ˜:æœ¬èµ„æ–™ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ä½¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”! å¦‚éœ€è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚\n\n---","source":"_posts/css-zIndex.md","raw":"---\ntitle: å…³äºz-indexçš„ä¸€äº›äº‹\ndate: 2017-08-29 14:14:24\nauthor: Singsong\ntags: css\n---\n\nä¸€èˆ¬**z-index\b**å¤±æ•ˆåŸºæœ¬ä¸Šéƒ½æ˜¯ä¸äº†è§£**z-index**æ˜¯å¦‚ä½•å·¥ä½œå¯¼è‡´çš„ï¼ˆè¿™æ²¡æœ‰çœ‹è¿™ç¯‡[blog\b](https://philipwalton.com/articles/what-no-one-told-you-about-z-index/)ä¹‹å‰ï¼Œè‡³å°‘æˆ‘ä¹Ÿæ˜¯è¿™æ ·çš„ï¼‰ã€‚å®ƒä¸å¤æ‚ï¼Œä½†å¦‚æœä¸èŠ±æ—¶é—´å»æŸ¥çœ‹z-indexæ–‡æ¡£ï¼Œå¯èƒ½ä¼šä¸äº†è§£ä¸€äº›å…³é”®æŠ€æœ¯ç‚¹ã€‚\n\nä¸ä¿¡ï¼Ÿ\bèƒ½å¦è§£ç­”å¦‚ä¸‹é—®é¢˜ï¼Œä½œä¸ºæ£€éªŒä½ æ˜¯å¦çœŸæ­£äº†è§£**z-index**ï¼š\n\n## é—®é¢˜ï¼š\n\nHTMLç»“æ„å¦‚ä¸‹ï¼š\n\n```HTML\n<div>\n  <span class=\"red\">Red</span>\n</div>\n<div>\n  <span class=\"green\">Green</span>\n</div>\n<div>\n  <span class=\"blue\">Blue</span>\n</div>\n```\nCSSå¦‚ä¸‹ï¼š\n\n```css\n.red, .green, .blue {\n  position: absolute;\n}\n.red {\n  background: red;\n  z-index: 1;\n}\n.green {\n  background: green;\n}\n.blue {\n  background: blue;\n}\n```\n\n### å¦‚ä½•å°†â€œçº¢è‰²å—â€æ”¾ç½®â€œç»¿è‰²å—â€ä¹‹åï¼Œéœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š\n\n- ä¸èƒ½ä¿®æ”¹htmlç»“æ„\n- ä¸èƒ½ä¿®æ”¹ä»»ä½•å…ƒç´ çš„z-indexå±æ€§\n- ä¸èƒ½ä¿®æ”¹ä»»ä½•å…ƒç´ çš„positionå±æ€§\n\n### codepen\bï¼š\n<iframe height='320' scrolling='no' title='JyNRxj' src='//codepen.io/zhansingsong/embed/JyNRxj/?height=330&theme-id=dark&default-tab=css,result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/zhansingsong/pen/JyNRxj/'>JyNRxj</a> by zhansingsong (<a href='https://codepen.io/zhansingsong'>@zhansingsong</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\n## è§£å†³æ–¹æ³•\n\nç»™\bç¬¬ä¸€ä¸ª`div`ï¼ˆå³\b\b\bâ€œ\bçº¢è‰²å—â€çš„\bçˆ¶èŠ‚ç‚¹ï¼‰æ·»åŠ å¦‚ä¸‹æ ·å¼ï¼š\n\n```css\n  div:first-child {\n    opacity: .99;\n  }\n```\n\næˆ–è®¸ä½ ä¼š\bå¥½å¥‡ä¸ºä»€ä¹ˆè¿™ä¸ª`opacity`ä¼šè®©\bâ€œçº¢è‰²å—â€ç½®äºâ€œç»¿è‰²å—â€ä¹‹åï¼ˆå½“æ—¶æˆ‘çœ‹è¿™ä¸ªç­”æ¡ˆä¹Ÿæ˜¯ä¸€è„¸æ‡µé€¼äº†\bğŸ˜‘\bï¼‰ã€‚å¸Œæœ›ä¸‹æ–‡èƒ½è§£æƒ‘ä½ çš„å¥½å¥‡ã€‚\n\n### z-index [specification](https://www.w3.org/TR/CSS2/visuren.html#propdef-z-index)\n**z-index**åªå¯¹**positionedå…ƒç´ **ï¼ˆå³è¯¥å…ƒç´ çš„`position`ä¸ç­‰äºé»˜è®¤`static`å¤–çš„å€¼ï¼‰èµ·ä½œç”¨ã€‚å¯¹åº”`positoned box`ï¼ˆpositionedå…ƒç´ )ï¼Œ**z-index**ä¸»è¦ï¼š\n1. æŒ‡å®šè¯¥å…ƒç´ åœ¨å½“å‰**stacking context**çš„stackå±‚çº§\n2. è¯¥å…ƒç´ æ˜¯å¦åˆ›å»ºæ–°çš„**stacking context**\n\n**z-index**å¯ä»¥å–å¦‚ä¸‹å€¼ï¼š\n\n- **(integer)æ•´æ•°**ï¼šè¡¨ç¤ºå½“å‰å…ƒç´ åœ¨å½“å‰çš„**stacking context**çš„stackå±‚çº§ï¼Œå¹¶ä¼šè®©å½“å‰å…ƒç´ åˆ›å»ºä¸€ä¸ªæ–°çš„**stacking context**\n\n- **auto**: è¡¨ç¤ºå½“å‰å…ƒç´ åœ¨å½“å‰çš„**stacking context**çš„stackå±‚çº§ä¸º0ï¼Œå¦‚æœè¯¥å…ƒç´ ä¸æ˜¯**root**å…ƒç´ ï¼Œå°±ä¸ä¼šåˆ›å»ºæ–°çš„**stacking context**\n\n\n### stacking order\n**stacking context**å¯ä»¥ç›¸äº’åµŒå¥—ï¼Œæ¯ä¸ªå…ƒç´ ï¼ˆboxï¼‰éƒ½å±äºä¸€ä¸ª**stacking context**ï¼ˆè‡ªåŒ…å«ï¼‰ï¼Œæ¯ä¸ª`positoned box`åœ¨ä¸€ä¸ª**stacking context**ä¸­éƒ½æœ‰ä¸€ä¸ªæ•´æ•°çš„stackå±‚çº§ï¼Œå®ƒè¡¨ç¤ºåœ¨åŒä¸€ä¸ª**stacking context**ä¸­çš„zè½´æ–¹å‘stackå±‚çº§ä½ç½®ã€‚stackå±‚çº§è¶Šå¤§åœ¨**stacking context**ä¸­çš„ä½ç½®è¶Šé å‰ã€‚å¦‚æœstackå±‚çº§ç›¸åŒï¼ŒæŒ‰å…¶åœ¨DOMæ–‡æ¡£ä¸­å‡ºç°é¡ºåºç»˜åˆ¶ã€‚\n\n### stacking context\n>**The stacking context** is a three-dimensional conceptualization of HTML elements along an imaginary z-axis relative to the user who is assumed to be facing the viewport or the webpage. HTML elements occupy this space in priority order based on element attributes.â€”â€”MDN\n\n\n\n**stacking context**çš„å½¢æˆæ¡ä»¶ï¼š\n\n* æ–‡æ¡£æ ¹èŠ‚ç‚¹ï¼ˆHTMLï¼‰| Root element of document (HTML).\n* å…ƒç´ çš„positionå±æ€§å€¼ä¸º`absolute`æˆ–`relative`ï¼Œå¹¶ä¸”z-indexå±æ€§ä¸ºé™¤`auto`å¤–çš„å€¼ | Element with a position value \"absolute\" or \"relative\" and z-index value other than \"auto\".\n* å…ƒç´ çš„positionå±æ€§å€¼ä¸º`fixed`æˆ–`sticky` | Element with a position value \"fixed\" or \"sticky\" (sticky for all mobile browsers, but not older desktop).\n* å…ƒç´ æ˜¯flexboxå®¹å™¨çš„å­å…ƒç´ ï¼Œå¸¦æœ‰z-indexå±æ€§ï¼Œä¸”å€¼ä¸ºé™¤`auto`å¤–çš„å€¼ | Element that is a child of a flex (flexbox) container, with z-index value other than \"auto\".\n* å…ƒç´ çš„opcityå±æ€§å€¼å°äº1 | Element with a opacity value less than 1 (See the specification for opacity).\n* å…ƒç´ çš„[mix-blend-mode](https://developer.mozilla.org/en-US/docs/Web/CSS/mix-blend-mode)å±æ€§å€¼ä¸ºé™¤`normal`å¤–çš„å€¼ | Element with a mix-blend-mode value other than \"normal\".\n* å…ƒç´ çš„å¦‚ä¸‹å±æ€§å€¼ä¸ºé™¤`none`å¤–çš„å€¼ | Element with any of the following properties with value other than \"none\":\n    * [transform](https://developer.mozilla.org/en-US/docs/Web/CSS/transform)\n    * [filter](https://developer.mozilla.org/en-US/docs/Web/CSS/filter)\n    * [perspective](https://developer.mozilla.org/en-US/docs/Web/CSS/perspective)\n    * [clip-path](https://developer.mozilla.org/en-US/docs/Web/CSS/clip-path)\n    * [mask](https://developer.mozilla.org/en-US/docs/Web/CSS/mask) / [mask-image](https://developer.mozilla.org/en-US/docs/Web/CSS/mask-image) / [mask-border](https://developer.mozilla.org/en-US/docs/Web/CSS/mask-border)\n* å…ƒç´ çš„isolationå±æ€§å€¼ä¸º`isolate` | Element with a [isolation](https://developer.mozilla.org/en-US/docs/Web/CSS/isolation) value \"isolate\".\n* å…ƒç´ çš„-webkit-overflow-scrollingå±æ€§å€¼ä¸º`touch` | Element with a -webkit-overflow-scrolling value \"touch\".\n* å…ƒç´ å¸¦æœ‰[will-change](https://developer.mozilla.org/en-US/docs/Web/CSS/will-change)å±æ€§ | Element with a will-change value specifying any property that would create a stacking context on non-initial value (see this post).\n\n### painted order in stacking context\n\n  1. å½¢æˆ**stacking context**å…ƒç´ çš„`background`å’Œ`borders` | the background and borders of the element forming the stacking context.\n  2. è´Ÿæ•°çš„stackå±‚çº§çš„**child stacking context**(è´Ÿæ•°å€¼è¶Šå¤§è¶Šå‰) | the child stacking contexts with negative stack levels (most negative first).\n  3. æ–‡æ¡£æµä¸­éinlineçº§ã€épositionedå­èŠ‚ç‚¹ | the in-flow, non-inline-level, non-positioned descendants.\n  4. épositionedæµ®åŠ¨å­èŠ‚ç‚¹ | the non-positioned floats.\n  5. æ–‡æ¡£æµä¸­épositionedçš„inlineçº§å­èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬inline tableså’Œinline blocksï¼‰ | the in-flow, inline-level, non-positioned descendants, including inline tables and inline blocks.\n  6. stackå±‚çº§ä¸º0çš„**child stacking context**å’Œpositonedå­èŠ‚ç‚¹ | the child stacking contexts with stack level 0 and the positioned descendants with stack level 0.\n  7. stackå±‚çº§ä¸ºæ­£æ•´æ•°çš„**child stacking context** | the child stacking contexts with positive stack levels (least positive first).\n  ### Example\n  <iframe height='265' scrolling='no' title='stackLevel' src='//codepen.io/zhansingsong/embed/WEMrNK/?height=265&theme-id=dark&default-tab=css,result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/zhansingsong/pen/WEMrNK/'>stackLevel</a> by zhansingsong (<a href='https://codepen.io/zhansingsong'>@zhansingsong</a>) on <a href='https://codepen.io'>CodePen</a>.\n  </iframe>\n\n\n## å‚è€ƒæ–‡ç« ï¼š\n- [What No One Told You About Z-Index](https://philipwalton.com/articles/what-no-one-told-you-about-z-index/)\n- [The stacking context](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context)\n- [Specifying the stack level: the 'z-index' property](https://www.w3.org/TR/CSS2/visuren.html#propdef-z-index)\n\n\n</br>\n\n---\n\n> å£°æ˜:æœ¬èµ„æ–™ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ä½¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”! å¦‚éœ€è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚\n\n---","slug":"css-zIndex","published":1,"updated":"2018-08-22T08:06:45.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjl4vata700051hn94qwnhaqt","content":"<p>ä¸€èˆ¬<strong>z-index\b</strong>å¤±æ•ˆåŸºæœ¬ä¸Šéƒ½æ˜¯ä¸äº†è§£<strong>z-index</strong>æ˜¯å¦‚ä½•å·¥ä½œå¯¼è‡´çš„ï¼ˆè¿™æ²¡æœ‰çœ‹è¿™ç¯‡<a href=\"https://philipwalton.com/articles/what-no-one-told-you-about-z-index/\" target=\"_blank\" rel=\"external\">blog\b</a>ä¹‹å‰ï¼Œè‡³å°‘æˆ‘ä¹Ÿæ˜¯è¿™æ ·çš„ï¼‰ã€‚å®ƒä¸å¤æ‚ï¼Œä½†å¦‚æœä¸èŠ±æ—¶é—´å»æŸ¥çœ‹z-indexæ–‡æ¡£ï¼Œå¯èƒ½ä¼šä¸äº†è§£ä¸€äº›å…³é”®æŠ€æœ¯ç‚¹ã€‚</p>\n<p>ä¸ä¿¡ï¼Ÿ\bèƒ½å¦è§£ç­”å¦‚ä¸‹é—®é¢˜ï¼Œä½œä¸ºæ£€éªŒä½ æ˜¯å¦çœŸæ­£äº†è§£<strong>z-index</strong>ï¼š</p>\n<h2 id=\"é—®é¢˜ï¼š\"><a href=\"#é—®é¢˜ï¼š\" class=\"headerlink\" title=\"é—®é¢˜ï¼š\"></a>é—®é¢˜ï¼š</h2><p>HTMLç»“æ„å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"red\"</span>&gt;</span>Red<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"green\"</span>&gt;</span>Green<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"blue\"</span>&gt;</span>Blue<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>CSSå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-class\">.red</span>, <span class=\"selector-class\">.green</span>, <span class=\"selector-class\">.blue</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">position</span>: absolute;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"selector-class\">.red</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">background</span>: red;</div><div class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">1</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"selector-class\">.green</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">background</span>: green;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"selector-class\">.blue</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">background</span>: blue;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"å¦‚ä½•å°†â€œçº¢è‰²å—â€æ”¾ç½®â€œç»¿è‰²å—â€ä¹‹åï¼Œéœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š\"><a href=\"#å¦‚ä½•å°†â€œçº¢è‰²å—â€æ”¾ç½®â€œç»¿è‰²å—â€ä¹‹åï¼Œéœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š\" class=\"headerlink\" title=\"å¦‚ä½•å°†â€œçº¢è‰²å—â€æ”¾ç½®â€œç»¿è‰²å—â€ä¹‹åï¼Œéœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š\"></a>å¦‚ä½•å°†â€œçº¢è‰²å—â€æ”¾ç½®â€œç»¿è‰²å—â€ä¹‹åï¼Œéœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š</h3><ul>\n<li>ä¸èƒ½ä¿®æ”¹htmlç»“æ„</li>\n<li>ä¸èƒ½ä¿®æ”¹ä»»ä½•å…ƒç´ çš„z-indexå±æ€§</li>\n<li>ä¸èƒ½ä¿®æ”¹ä»»ä½•å…ƒç´ çš„positionå±æ€§</li>\n</ul>\n<h3 id=\"codepenï¼š\"><a href=\"#codepenï¼š\" class=\"headerlink\" title=\"codepen\bï¼š\"></a>codepen\bï¼š</h3><iframe height=\"320\" scrolling=\"no\" title=\"JyNRxj\" src=\"//codepen.io/zhansingsong/embed/JyNRxj/?height=330&theme-id=dark&default-tab=css,result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/zhansingsong/pen/JyNRxj/\" target=\"_blank\" rel=\"external\">JyNRxj</a> by zhansingsong (<a href=\"https://codepen.io/zhansingsong\" target=\"_blank\" rel=\"external\">@zhansingsong</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"external\">CodePen</a>.<br></iframe>\n\n<h2 id=\"è§£å†³æ–¹æ³•\"><a href=\"#è§£å†³æ–¹æ³•\" class=\"headerlink\" title=\"è§£å†³æ–¹æ³•\"></a>è§£å†³æ–¹æ³•</h2><p>ç»™\bç¬¬ä¸€ä¸ª<code>div</code>ï¼ˆå³\b\b\bâ€œ\bçº¢è‰²å—â€çš„\bçˆ¶èŠ‚ç‚¹ï¼‰æ·»åŠ å¦‚ä¸‹æ ·å¼ï¼š</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">div</span><span class=\"selector-pseudo\">:first-child</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">opacity</span>: .<span class=\"number\">99</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>æˆ–è®¸ä½ ä¼š\bå¥½å¥‡ä¸ºä»€ä¹ˆè¿™ä¸ª<code>opacity</code>ä¼šè®©\bâ€œçº¢è‰²å—â€ç½®äºâ€œç»¿è‰²å—â€ä¹‹åï¼ˆå½“æ—¶æˆ‘çœ‹è¿™ä¸ªç­”æ¡ˆä¹Ÿæ˜¯ä¸€è„¸æ‡µé€¼äº†\bğŸ˜‘\bï¼‰ã€‚å¸Œæœ›ä¸‹æ–‡èƒ½è§£æƒ‘ä½ çš„å¥½å¥‡ã€‚</p>\n<h3 id=\"z-index-specification\"><a href=\"#z-index-specification\" class=\"headerlink\" title=\"z-index specification\"></a>z-index <a href=\"https://www.w3.org/TR/CSS2/visuren.html#propdef-z-index\" target=\"_blank\" rel=\"external\">specification</a></h3><p><strong>z-index</strong>åªå¯¹<strong>positionedå…ƒç´ </strong>ï¼ˆå³è¯¥å…ƒç´ çš„<code>position</code>ä¸ç­‰äºé»˜è®¤<code>static</code>å¤–çš„å€¼ï¼‰èµ·ä½œç”¨ã€‚å¯¹åº”<code>positoned box</code>ï¼ˆpositionedå…ƒç´ )ï¼Œ<strong>z-index</strong>ä¸»è¦ï¼š</p>\n<ol>\n<li>æŒ‡å®šè¯¥å…ƒç´ åœ¨å½“å‰<strong>stacking context</strong>çš„stackå±‚çº§</li>\n<li>è¯¥å…ƒç´ æ˜¯å¦åˆ›å»ºæ–°çš„<strong>stacking context</strong></li>\n</ol>\n<p><strong>z-index</strong>å¯ä»¥å–å¦‚ä¸‹å€¼ï¼š</p>\n<ul>\n<li><p><strong>(integer)æ•´æ•°</strong>ï¼šè¡¨ç¤ºå½“å‰å…ƒç´ åœ¨å½“å‰çš„<strong>stacking context</strong>çš„stackå±‚çº§ï¼Œå¹¶ä¼šè®©å½“å‰å…ƒç´ åˆ›å»ºä¸€ä¸ªæ–°çš„<strong>stacking context</strong></p>\n</li>\n<li><p><strong>auto</strong>: è¡¨ç¤ºå½“å‰å…ƒç´ åœ¨å½“å‰çš„<strong>stacking context</strong>çš„stackå±‚çº§ä¸º0ï¼Œå¦‚æœè¯¥å…ƒç´ ä¸æ˜¯<strong>root</strong>å…ƒç´ ï¼Œå°±ä¸ä¼šåˆ›å»ºæ–°çš„<strong>stacking context</strong></p>\n</li>\n</ul>\n<h3 id=\"stacking-order\"><a href=\"#stacking-order\" class=\"headerlink\" title=\"stacking order\"></a>stacking order</h3><p><strong>stacking context</strong>å¯ä»¥ç›¸äº’åµŒå¥—ï¼Œæ¯ä¸ªå…ƒç´ ï¼ˆboxï¼‰éƒ½å±äºä¸€ä¸ª<strong>stacking context</strong>ï¼ˆè‡ªåŒ…å«ï¼‰ï¼Œæ¯ä¸ª<code>positoned box</code>åœ¨ä¸€ä¸ª<strong>stacking context</strong>ä¸­éƒ½æœ‰ä¸€ä¸ªæ•´æ•°çš„stackå±‚çº§ï¼Œå®ƒè¡¨ç¤ºåœ¨åŒä¸€ä¸ª<strong>stacking context</strong>ä¸­çš„zè½´æ–¹å‘stackå±‚çº§ä½ç½®ã€‚stackå±‚çº§è¶Šå¤§åœ¨<strong>stacking context</strong>ä¸­çš„ä½ç½®è¶Šé å‰ã€‚å¦‚æœstackå±‚çº§ç›¸åŒï¼ŒæŒ‰å…¶åœ¨DOMæ–‡æ¡£ä¸­å‡ºç°é¡ºåºç»˜åˆ¶ã€‚</p>\n<h3 id=\"stacking-context\"><a href=\"#stacking-context\" class=\"headerlink\" title=\"stacking context\"></a>stacking context</h3><blockquote>\n<p><strong>The stacking context</strong> is a three-dimensional conceptualization of HTML elements along an imaginary z-axis relative to the user who is assumed to be facing the viewport or the webpage. HTML elements occupy this space in priority order based on element attributes.â€”â€”MDN</p>\n</blockquote>\n<p><strong>stacking context</strong>çš„å½¢æˆæ¡ä»¶ï¼š</p>\n<ul>\n<li>æ–‡æ¡£æ ¹èŠ‚ç‚¹ï¼ˆHTMLï¼‰| Root element of document (HTML).</li>\n<li>å…ƒç´ çš„positionå±æ€§å€¼ä¸º<code>absolute</code>æˆ–<code>relative</code>ï¼Œå¹¶ä¸”z-indexå±æ€§ä¸ºé™¤<code>auto</code>å¤–çš„å€¼ | Element with a position value â€œabsoluteâ€ or â€œrelativeâ€ and z-index value other than â€œautoâ€.</li>\n<li>å…ƒç´ çš„positionå±æ€§å€¼ä¸º<code>fixed</code>æˆ–<code>sticky</code> | Element with a position value â€œfixedâ€ or â€œstickyâ€ (sticky for all mobile browsers, but not older desktop).</li>\n<li>å…ƒç´ æ˜¯flexboxå®¹å™¨çš„å­å…ƒç´ ï¼Œå¸¦æœ‰z-indexå±æ€§ï¼Œä¸”å€¼ä¸ºé™¤<code>auto</code>å¤–çš„å€¼ | Element that is a child of a flex (flexbox) container, with z-index value other than â€œautoâ€.</li>\n<li>å…ƒç´ çš„opcityå±æ€§å€¼å°äº1 | Element with a opacity value less than 1 (See the specification for opacity).</li>\n<li>å…ƒç´ çš„<a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/mix-blend-mode\" target=\"_blank\" rel=\"external\">mix-blend-mode</a>å±æ€§å€¼ä¸ºé™¤<code>normal</code>å¤–çš„å€¼ | Element with a mix-blend-mode value other than â€œnormalâ€.</li>\n<li>å…ƒç´ çš„å¦‚ä¸‹å±æ€§å€¼ä¸ºé™¤<code>none</code>å¤–çš„å€¼ | Element with any of the following properties with value other than â€œnoneâ€:<ul>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/transform\" target=\"_blank\" rel=\"external\">transform</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/filter\" target=\"_blank\" rel=\"external\">filter</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/perspective\" target=\"_blank\" rel=\"external\">perspective</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/clip-path\" target=\"_blank\" rel=\"external\">clip-path</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/mask\" target=\"_blank\" rel=\"external\">mask</a> / <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/mask-image\" target=\"_blank\" rel=\"external\">mask-image</a> / <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/mask-border\" target=\"_blank\" rel=\"external\">mask-border</a></li>\n</ul>\n</li>\n<li>å…ƒç´ çš„isolationå±æ€§å€¼ä¸º<code>isolate</code> | Element with a <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/isolation\" target=\"_blank\" rel=\"external\">isolation</a> value â€œisolateâ€.</li>\n<li>å…ƒç´ çš„-webkit-overflow-scrollingå±æ€§å€¼ä¸º<code>touch</code> | Element with a -webkit-overflow-scrolling value â€œtouchâ€.</li>\n<li>å…ƒç´ å¸¦æœ‰<a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/will-change\" target=\"_blank\" rel=\"external\">will-change</a>å±æ€§ | Element with a will-change value specifying any property that would create a stacking context on non-initial value (see this post).</li>\n</ul>\n<h3 id=\"painted-order-in-stacking-context\"><a href=\"#painted-order-in-stacking-context\" class=\"headerlink\" title=\"painted order in stacking context\"></a>painted order in stacking context</h3><ol>\n<li>å½¢æˆ<strong>stacking context</strong>å…ƒç´ çš„<code>background</code>å’Œ<code>borders</code> | the background and borders of the element forming the stacking context.</li>\n<li>è´Ÿæ•°çš„stackå±‚çº§çš„<strong>child stacking context</strong>(è´Ÿæ•°å€¼è¶Šå¤§è¶Šå‰) | the child stacking contexts with negative stack levels (most negative first).</li>\n<li>æ–‡æ¡£æµä¸­éinlineçº§ã€épositionedå­èŠ‚ç‚¹ | the in-flow, non-inline-level, non-positioned descendants.</li>\n<li>épositionedæµ®åŠ¨å­èŠ‚ç‚¹ | the non-positioned floats.</li>\n<li>æ–‡æ¡£æµä¸­épositionedçš„inlineçº§å­èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬inline tableså’Œinline blocksï¼‰ | the in-flow, inline-level, non-positioned descendants, including inline tables and inline blocks.</li>\n<li>stackå±‚çº§ä¸º0çš„<strong>child stacking context</strong>å’Œpositonedå­èŠ‚ç‚¹ | the child stacking contexts with stack level 0 and the positioned descendants with stack level 0.</li>\n<li>stackå±‚çº§ä¸ºæ­£æ•´æ•°çš„<strong>child stacking context</strong> | the child stacking contexts with positive stack levels (least positive first).<h3 id=\"Example\"><a href=\"#Example\" class=\"headerlink\" title=\"Example\"></a>Example</h3><iframe height=\"265\" scrolling=\"no\" title=\"stackLevel\" src=\"//codepen.io/zhansingsong/embed/WEMrNK/?height=265&theme-id=dark&default-tab=css,result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/zhansingsong/pen/WEMrNK/\" target=\"_blank\" rel=\"external\">stackLevel</a> by zhansingsong (<a href=\"https://codepen.io/zhansingsong\" target=\"_blank\" rel=\"external\">@zhansingsong</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"external\">CodePen</a>.<br></iframe>\n\n\n</li>\n</ol>\n<h2 id=\"å‚è€ƒæ–‡ç« ï¼š\"><a href=\"#å‚è€ƒæ–‡ç« ï¼š\" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« ï¼š\"></a>å‚è€ƒæ–‡ç« ï¼š</h2><ul>\n<li><a href=\"https://philipwalton.com/articles/what-no-one-told-you-about-z-index/\" target=\"_blank\" rel=\"external\">What No One Told You About Z-Index</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context\" target=\"_blank\" rel=\"external\">The stacking context</a></li>\n<li><a href=\"https://www.w3.org/TR/CSS2/visuren.html#propdef-z-index\" target=\"_blank\" rel=\"external\">Specifying the stack level: the â€˜z-indexâ€™ property</a></li>\n</ul>\n<p><br></p>\n<hr>\n<blockquote>\n<p>å£°æ˜:æœ¬èµ„æ–™ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ä½¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”! å¦‚éœ€è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>\n</blockquote>\n<hr>\n","site":{"data":{}},"excerpt":"","more":"<p>ä¸€èˆ¬<strong>z-index\b</strong>å¤±æ•ˆåŸºæœ¬ä¸Šéƒ½æ˜¯ä¸äº†è§£<strong>z-index</strong>æ˜¯å¦‚ä½•å·¥ä½œå¯¼è‡´çš„ï¼ˆè¿™æ²¡æœ‰çœ‹è¿™ç¯‡<a href=\"https://philipwalton.com/articles/what-no-one-told-you-about-z-index/\" target=\"_blank\" rel=\"external\">blog\b</a>ä¹‹å‰ï¼Œè‡³å°‘æˆ‘ä¹Ÿæ˜¯è¿™æ ·çš„ï¼‰ã€‚å®ƒä¸å¤æ‚ï¼Œä½†å¦‚æœä¸èŠ±æ—¶é—´å»æŸ¥çœ‹z-indexæ–‡æ¡£ï¼Œå¯èƒ½ä¼šä¸äº†è§£ä¸€äº›å…³é”®æŠ€æœ¯ç‚¹ã€‚</p>\n<p>ä¸ä¿¡ï¼Ÿ\bèƒ½å¦è§£ç­”å¦‚ä¸‹é—®é¢˜ï¼Œä½œä¸ºæ£€éªŒä½ æ˜¯å¦çœŸæ­£äº†è§£<strong>z-index</strong>ï¼š</p>\n<h2 id=\"é—®é¢˜ï¼š\"><a href=\"#é—®é¢˜ï¼š\" class=\"headerlink\" title=\"é—®é¢˜ï¼š\"></a>é—®é¢˜ï¼š</h2><p>HTMLç»“æ„å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"red\"</span>&gt;</span>Red<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"green\"</span>&gt;</span>Green<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"blue\"</span>&gt;</span>Blue<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>CSSå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-class\">.red</span>, <span class=\"selector-class\">.green</span>, <span class=\"selector-class\">.blue</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">position</span>: absolute;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"selector-class\">.red</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">background</span>: red;</div><div class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">1</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"selector-class\">.green</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">background</span>: green;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"selector-class\">.blue</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">background</span>: blue;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"å¦‚ä½•å°†â€œçº¢è‰²å—â€æ”¾ç½®â€œç»¿è‰²å—â€ä¹‹åï¼Œéœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š\"><a href=\"#å¦‚ä½•å°†â€œçº¢è‰²å—â€æ”¾ç½®â€œç»¿è‰²å—â€ä¹‹åï¼Œéœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š\" class=\"headerlink\" title=\"å¦‚ä½•å°†â€œçº¢è‰²å—â€æ”¾ç½®â€œç»¿è‰²å—â€ä¹‹åï¼Œéœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š\"></a>å¦‚ä½•å°†â€œçº¢è‰²å—â€æ”¾ç½®â€œç»¿è‰²å—â€ä¹‹åï¼Œéœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š</h3><ul>\n<li>ä¸èƒ½ä¿®æ”¹htmlç»“æ„</li>\n<li>ä¸èƒ½ä¿®æ”¹ä»»ä½•å…ƒç´ çš„z-indexå±æ€§</li>\n<li>ä¸èƒ½ä¿®æ”¹ä»»ä½•å…ƒç´ çš„positionå±æ€§</li>\n</ul>\n<h3 id=\"codepenï¼š\"><a href=\"#codepenï¼š\" class=\"headerlink\" title=\"codepen\bï¼š\"></a>codepen\bï¼š</h3><iframe height=\"320\" scrolling=\"no\" title=\"JyNRxj\" src=\"//codepen.io/zhansingsong/embed/JyNRxj/?height=330&theme-id=dark&default-tab=css,result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/zhansingsong/pen/JyNRxj/\" target=\"_blank\" rel=\"external\">JyNRxj</a> by zhansingsong (<a href=\"https://codepen.io/zhansingsong\" target=\"_blank\" rel=\"external\">@zhansingsong</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"external\">CodePen</a>.<br></iframe>\n\n<h2 id=\"è§£å†³æ–¹æ³•\"><a href=\"#è§£å†³æ–¹æ³•\" class=\"headerlink\" title=\"è§£å†³æ–¹æ³•\"></a>è§£å†³æ–¹æ³•</h2><p>ç»™\bç¬¬ä¸€ä¸ª<code>div</code>ï¼ˆå³\b\b\bâ€œ\bçº¢è‰²å—â€çš„\bçˆ¶èŠ‚ç‚¹ï¼‰æ·»åŠ å¦‚ä¸‹æ ·å¼ï¼š</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">div</span><span class=\"selector-pseudo\">:first-child</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">opacity</span>: .<span class=\"number\">99</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>æˆ–è®¸ä½ ä¼š\bå¥½å¥‡ä¸ºä»€ä¹ˆè¿™ä¸ª<code>opacity</code>ä¼šè®©\bâ€œçº¢è‰²å—â€ç½®äºâ€œç»¿è‰²å—â€ä¹‹åï¼ˆå½“æ—¶æˆ‘çœ‹è¿™ä¸ªç­”æ¡ˆä¹Ÿæ˜¯ä¸€è„¸æ‡µé€¼äº†\bğŸ˜‘\bï¼‰ã€‚å¸Œæœ›ä¸‹æ–‡èƒ½è§£æƒ‘ä½ çš„å¥½å¥‡ã€‚</p>\n<h3 id=\"z-index-specification\"><a href=\"#z-index-specification\" class=\"headerlink\" title=\"z-index specification\"></a>z-index <a href=\"https://www.w3.org/TR/CSS2/visuren.html#propdef-z-index\" target=\"_blank\" rel=\"external\">specification</a></h3><p><strong>z-index</strong>åªå¯¹<strong>positionedå…ƒç´ </strong>ï¼ˆå³è¯¥å…ƒç´ çš„<code>position</code>ä¸ç­‰äºé»˜è®¤<code>static</code>å¤–çš„å€¼ï¼‰èµ·ä½œç”¨ã€‚å¯¹åº”<code>positoned box</code>ï¼ˆpositionedå…ƒç´ )ï¼Œ<strong>z-index</strong>ä¸»è¦ï¼š</p>\n<ol>\n<li>æŒ‡å®šè¯¥å…ƒç´ åœ¨å½“å‰<strong>stacking context</strong>çš„stackå±‚çº§</li>\n<li>è¯¥å…ƒç´ æ˜¯å¦åˆ›å»ºæ–°çš„<strong>stacking context</strong></li>\n</ol>\n<p><strong>z-index</strong>å¯ä»¥å–å¦‚ä¸‹å€¼ï¼š</p>\n<ul>\n<li><p><strong>(integer)æ•´æ•°</strong>ï¼šè¡¨ç¤ºå½“å‰å…ƒç´ åœ¨å½“å‰çš„<strong>stacking context</strong>çš„stackå±‚çº§ï¼Œå¹¶ä¼šè®©å½“å‰å…ƒç´ åˆ›å»ºä¸€ä¸ªæ–°çš„<strong>stacking context</strong></p>\n</li>\n<li><p><strong>auto</strong>: è¡¨ç¤ºå½“å‰å…ƒç´ åœ¨å½“å‰çš„<strong>stacking context</strong>çš„stackå±‚çº§ä¸º0ï¼Œå¦‚æœè¯¥å…ƒç´ ä¸æ˜¯<strong>root</strong>å…ƒç´ ï¼Œå°±ä¸ä¼šåˆ›å»ºæ–°çš„<strong>stacking context</strong></p>\n</li>\n</ul>\n<h3 id=\"stacking-order\"><a href=\"#stacking-order\" class=\"headerlink\" title=\"stacking order\"></a>stacking order</h3><p><strong>stacking context</strong>å¯ä»¥ç›¸äº’åµŒå¥—ï¼Œæ¯ä¸ªå…ƒç´ ï¼ˆboxï¼‰éƒ½å±äºä¸€ä¸ª<strong>stacking context</strong>ï¼ˆè‡ªåŒ…å«ï¼‰ï¼Œæ¯ä¸ª<code>positoned box</code>åœ¨ä¸€ä¸ª<strong>stacking context</strong>ä¸­éƒ½æœ‰ä¸€ä¸ªæ•´æ•°çš„stackå±‚çº§ï¼Œå®ƒè¡¨ç¤ºåœ¨åŒä¸€ä¸ª<strong>stacking context</strong>ä¸­çš„zè½´æ–¹å‘stackå±‚çº§ä½ç½®ã€‚stackå±‚çº§è¶Šå¤§åœ¨<strong>stacking context</strong>ä¸­çš„ä½ç½®è¶Šé å‰ã€‚å¦‚æœstackå±‚çº§ç›¸åŒï¼ŒæŒ‰å…¶åœ¨DOMæ–‡æ¡£ä¸­å‡ºç°é¡ºåºç»˜åˆ¶ã€‚</p>\n<h3 id=\"stacking-context\"><a href=\"#stacking-context\" class=\"headerlink\" title=\"stacking context\"></a>stacking context</h3><blockquote>\n<p><strong>The stacking context</strong> is a three-dimensional conceptualization of HTML elements along an imaginary z-axis relative to the user who is assumed to be facing the viewport or the webpage. HTML elements occupy this space in priority order based on element attributes.â€”â€”MDN</p>\n</blockquote>\n<p><strong>stacking context</strong>çš„å½¢æˆæ¡ä»¶ï¼š</p>\n<ul>\n<li>æ–‡æ¡£æ ¹èŠ‚ç‚¹ï¼ˆHTMLï¼‰| Root element of document (HTML).</li>\n<li>å…ƒç´ çš„positionå±æ€§å€¼ä¸º<code>absolute</code>æˆ–<code>relative</code>ï¼Œå¹¶ä¸”z-indexå±æ€§ä¸ºé™¤<code>auto</code>å¤–çš„å€¼ | Element with a position value â€œabsoluteâ€ or â€œrelativeâ€ and z-index value other than â€œautoâ€.</li>\n<li>å…ƒç´ çš„positionå±æ€§å€¼ä¸º<code>fixed</code>æˆ–<code>sticky</code> | Element with a position value â€œfixedâ€ or â€œstickyâ€ (sticky for all mobile browsers, but not older desktop).</li>\n<li>å…ƒç´ æ˜¯flexboxå®¹å™¨çš„å­å…ƒç´ ï¼Œå¸¦æœ‰z-indexå±æ€§ï¼Œä¸”å€¼ä¸ºé™¤<code>auto</code>å¤–çš„å€¼ | Element that is a child of a flex (flexbox) container, with z-index value other than â€œautoâ€.</li>\n<li>å…ƒç´ çš„opcityå±æ€§å€¼å°äº1 | Element with a opacity value less than 1 (See the specification for opacity).</li>\n<li>å…ƒç´ çš„<a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/mix-blend-mode\" target=\"_blank\" rel=\"external\">mix-blend-mode</a>å±æ€§å€¼ä¸ºé™¤<code>normal</code>å¤–çš„å€¼ | Element with a mix-blend-mode value other than â€œnormalâ€.</li>\n<li>å…ƒç´ çš„å¦‚ä¸‹å±æ€§å€¼ä¸ºé™¤<code>none</code>å¤–çš„å€¼ | Element with any of the following properties with value other than â€œnoneâ€:<ul>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/transform\" target=\"_blank\" rel=\"external\">transform</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/filter\" target=\"_blank\" rel=\"external\">filter</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/perspective\" target=\"_blank\" rel=\"external\">perspective</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/clip-path\" target=\"_blank\" rel=\"external\">clip-path</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/mask\" target=\"_blank\" rel=\"external\">mask</a> / <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/mask-image\" target=\"_blank\" rel=\"external\">mask-image</a> / <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/mask-border\" target=\"_blank\" rel=\"external\">mask-border</a></li>\n</ul>\n</li>\n<li>å…ƒç´ çš„isolationå±æ€§å€¼ä¸º<code>isolate</code> | Element with a <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/isolation\" target=\"_blank\" rel=\"external\">isolation</a> value â€œisolateâ€.</li>\n<li>å…ƒç´ çš„-webkit-overflow-scrollingå±æ€§å€¼ä¸º<code>touch</code> | Element with a -webkit-overflow-scrolling value â€œtouchâ€.</li>\n<li>å…ƒç´ å¸¦æœ‰<a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/will-change\" target=\"_blank\" rel=\"external\">will-change</a>å±æ€§ | Element with a will-change value specifying any property that would create a stacking context on non-initial value (see this post).</li>\n</ul>\n<h3 id=\"painted-order-in-stacking-context\"><a href=\"#painted-order-in-stacking-context\" class=\"headerlink\" title=\"painted order in stacking context\"></a>painted order in stacking context</h3><ol>\n<li>å½¢æˆ<strong>stacking context</strong>å…ƒç´ çš„<code>background</code>å’Œ<code>borders</code> | the background and borders of the element forming the stacking context.</li>\n<li>è´Ÿæ•°çš„stackå±‚çº§çš„<strong>child stacking context</strong>(è´Ÿæ•°å€¼è¶Šå¤§è¶Šå‰) | the child stacking contexts with negative stack levels (most negative first).</li>\n<li>æ–‡æ¡£æµä¸­éinlineçº§ã€épositionedå­èŠ‚ç‚¹ | the in-flow, non-inline-level, non-positioned descendants.</li>\n<li>épositionedæµ®åŠ¨å­èŠ‚ç‚¹ | the non-positioned floats.</li>\n<li>æ–‡æ¡£æµä¸­épositionedçš„inlineçº§å­èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬inline tableså’Œinline blocksï¼‰ | the in-flow, inline-level, non-positioned descendants, including inline tables and inline blocks.</li>\n<li>stackå±‚çº§ä¸º0çš„<strong>child stacking context</strong>å’Œpositonedå­èŠ‚ç‚¹ | the child stacking contexts with stack level 0 and the positioned descendants with stack level 0.</li>\n<li>stackå±‚çº§ä¸ºæ­£æ•´æ•°çš„<strong>child stacking context</strong> | the child stacking contexts with positive stack levels (least positive first).<h3 id=\"Example\"><a href=\"#Example\" class=\"headerlink\" title=\"Example\"></a>Example</h3><iframe height=\"265\" scrolling=\"no\" title=\"stackLevel\" src=\"//codepen.io/zhansingsong/embed/WEMrNK/?height=265&theme-id=dark&default-tab=css,result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/zhansingsong/pen/WEMrNK/\" target=\"_blank\" rel=\"external\">stackLevel</a> by zhansingsong (<a href=\"https://codepen.io/zhansingsong\" target=\"_blank\" rel=\"external\">@zhansingsong</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"external\">CodePen</a>.<br></iframe>\n\n\n</li>\n</ol>\n<h2 id=\"å‚è€ƒæ–‡ç« ï¼š\"><a href=\"#å‚è€ƒæ–‡ç« ï¼š\" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« ï¼š\"></a>å‚è€ƒæ–‡ç« ï¼š</h2><ul>\n<li><a href=\"https://philipwalton.com/articles/what-no-one-told-you-about-z-index/\" target=\"_blank\" rel=\"external\">What No One Told You About Z-Index</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context\" target=\"_blank\" rel=\"external\">The stacking context</a></li>\n<li><a href=\"https://www.w3.org/TR/CSS2/visuren.html#propdef-z-index\" target=\"_blank\" rel=\"external\">Specifying the stack level: the â€˜z-indexâ€™ property</a></li>\n</ul>\n<p><br></p>\n<hr>\n<blockquote>\n<p>å£°æ˜:æœ¬èµ„æ–™ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ä½¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”! å¦‚éœ€è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>\n</blockquote>\n<hr>\n"},{"title":"âœ¨ Init âœ¨","date":"2017-08-28T03:13:14.000Z","author":"Kun","_content":"\n\nåšå®¢ç”±[Hexo](https://hexo.io/)æ­å»ºï¼Œhexoæ˜¯ä¸€æ¬¾åŸºäºNode.jsçš„é™æ€åšå®¢æ¡†æ¶ã€‚\n\né…åˆ[GitHub Pages](https://pages.github.com/)ï¼Œå°†èµ„æºæ‰˜ç®¡åœ¨æ‰˜ç®¡åœ¨ GitHub ä¸Šã€‚\n\n## å¿«é€Ÿå¼€å§‹\n``` bash\nnpm install\n```\n\n### åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« \n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nmore: [ğŸ³](https://hexo.io/zh-cn/docs/writing.html)\n\n### å¯åŠ¨æœåŠ¡å™¨ (:4000)\n\n``` bash\n$ hexo server\n```\n\nmore: [ğŸ¹](https://hexo.io/zh-cn/docs/server.html)\n\n### ç”Ÿæˆé™æ€èµ„æº\n\n``` bash\n$ hexo generate\n```\n\nmore: [ğŸ˜](https://hexo.io/zh-cn/docs/generating.html)\n\n### è‡ªåŠ¨éƒ¨ç½²åˆ°Github\n\n``` bash\n$ sh push.sh\n```\n","source":"_posts/init.md","raw":"---\ntitle: âœ¨ Init âœ¨\ndate: 2017-08-28 11:13:14\nauthor: Kun\n---\n\n\nåšå®¢ç”±[Hexo](https://hexo.io/)æ­å»ºï¼Œhexoæ˜¯ä¸€æ¬¾åŸºäºNode.jsçš„é™æ€åšå®¢æ¡†æ¶ã€‚\n\né…åˆ[GitHub Pages](https://pages.github.com/)ï¼Œå°†èµ„æºæ‰˜ç®¡åœ¨æ‰˜ç®¡åœ¨ GitHub ä¸Šã€‚\n\n## å¿«é€Ÿå¼€å§‹\n``` bash\nnpm install\n```\n\n### åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« \n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nmore: [ğŸ³](https://hexo.io/zh-cn/docs/writing.html)\n\n### å¯åŠ¨æœåŠ¡å™¨ (:4000)\n\n``` bash\n$ hexo server\n```\n\nmore: [ğŸ¹](https://hexo.io/zh-cn/docs/server.html)\n\n### ç”Ÿæˆé™æ€èµ„æº\n\n``` bash\n$ hexo generate\n```\n\nmore: [ğŸ˜](https://hexo.io/zh-cn/docs/generating.html)\n\n### è‡ªåŠ¨éƒ¨ç½²åˆ°Github\n\n``` bash\n$ sh push.sh\n```\n","slug":"init","published":1,"updated":"2018-08-22T08:09:04.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjl4vataa00061hn9l067wtjh","content":"<p>åšå®¢ç”±<a href=\"https://hexo.io/\" target=\"_blank\" rel=\"external\">Hexo</a>æ­å»ºï¼Œhexoæ˜¯ä¸€æ¬¾åŸºäºNode.jsçš„é™æ€åšå®¢æ¡†æ¶ã€‚</p>\n<p>é…åˆ<a href=\"https://pages.github.com/\" target=\"_blank\" rel=\"external\">GitHub Pages</a>ï¼Œå°†èµ„æºæ‰˜ç®¡åœ¨æ‰˜ç®¡åœ¨ GitHub ä¸Šã€‚</p>\n<h2 id=\"å¿«é€Ÿå¼€å§‹\"><a href=\"#å¿«é€Ÿå¼€å§‹\" class=\"headerlink\" title=\"å¿«é€Ÿå¼€å§‹\"></a>å¿«é€Ÿå¼€å§‹</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">npm install</div></pre></td></tr></table></figure>\n<h3 id=\"åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« \"><a href=\"#åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« \" class=\"headerlink\" title=\"åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« \"></a>åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« </h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></div></pre></td></tr></table></figure>\n<p>more: <a href=\"https://hexo.io/zh-cn/docs/writing.html\" target=\"_blank\" rel=\"external\">ğŸ³</a></p>\n<h3 id=\"å¯åŠ¨æœåŠ¡å™¨-4000\"><a href=\"#å¯åŠ¨æœåŠ¡å™¨-4000\" class=\"headerlink\" title=\"å¯åŠ¨æœåŠ¡å™¨ (:4000)\"></a>å¯åŠ¨æœåŠ¡å™¨ (:4000)</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo server</div></pre></td></tr></table></figure>\n<p>more: <a href=\"https://hexo.io/zh-cn/docs/server.html\" target=\"_blank\" rel=\"external\">ğŸ¹</a></p>\n<h3 id=\"ç”Ÿæˆé™æ€èµ„æº\"><a href=\"#ç”Ÿæˆé™æ€èµ„æº\" class=\"headerlink\" title=\"ç”Ÿæˆé™æ€èµ„æº\"></a>ç”Ÿæˆé™æ€èµ„æº</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo generate</div></pre></td></tr></table></figure>\n<p>more: <a href=\"https://hexo.io/zh-cn/docs/generating.html\" target=\"_blank\" rel=\"external\">ğŸ˜</a></p>\n<h3 id=\"è‡ªåŠ¨éƒ¨ç½²åˆ°Github\"><a href=\"#è‡ªåŠ¨éƒ¨ç½²åˆ°Github\" class=\"headerlink\" title=\"è‡ªåŠ¨éƒ¨ç½²åˆ°Github\"></a>è‡ªåŠ¨éƒ¨ç½²åˆ°Github</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ sh push.sh</div></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p>åšå®¢ç”±<a href=\"https://hexo.io/\" target=\"_blank\" rel=\"external\">Hexo</a>æ­å»ºï¼Œhexoæ˜¯ä¸€æ¬¾åŸºäºNode.jsçš„é™æ€åšå®¢æ¡†æ¶ã€‚</p>\n<p>é…åˆ<a href=\"https://pages.github.com/\" target=\"_blank\" rel=\"external\">GitHub Pages</a>ï¼Œå°†èµ„æºæ‰˜ç®¡åœ¨æ‰˜ç®¡åœ¨ GitHub ä¸Šã€‚</p>\n<h2 id=\"å¿«é€Ÿå¼€å§‹\"><a href=\"#å¿«é€Ÿå¼€å§‹\" class=\"headerlink\" title=\"å¿«é€Ÿå¼€å§‹\"></a>å¿«é€Ÿå¼€å§‹</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">npm install</div></pre></td></tr></table></figure>\n<h3 id=\"åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« \"><a href=\"#åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« \" class=\"headerlink\" title=\"åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« \"></a>åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« </h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></div></pre></td></tr></table></figure>\n<p>more: <a href=\"https://hexo.io/zh-cn/docs/writing.html\" target=\"_blank\" rel=\"external\">ğŸ³</a></p>\n<h3 id=\"å¯åŠ¨æœåŠ¡å™¨-4000\"><a href=\"#å¯åŠ¨æœåŠ¡å™¨-4000\" class=\"headerlink\" title=\"å¯åŠ¨æœåŠ¡å™¨ (:4000)\"></a>å¯åŠ¨æœåŠ¡å™¨ (:4000)</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo server</div></pre></td></tr></table></figure>\n<p>more: <a href=\"https://hexo.io/zh-cn/docs/server.html\" target=\"_blank\" rel=\"external\">ğŸ¹</a></p>\n<h3 id=\"ç”Ÿæˆé™æ€èµ„æº\"><a href=\"#ç”Ÿæˆé™æ€èµ„æº\" class=\"headerlink\" title=\"ç”Ÿæˆé™æ€èµ„æº\"></a>ç”Ÿæˆé™æ€èµ„æº</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo generate</div></pre></td></tr></table></figure>\n<p>more: <a href=\"https://hexo.io/zh-cn/docs/generating.html\" target=\"_blank\" rel=\"external\">ğŸ˜</a></p>\n<h3 id=\"è‡ªåŠ¨éƒ¨ç½²åˆ°Github\"><a href=\"#è‡ªåŠ¨éƒ¨ç½²åˆ°Github\" class=\"headerlink\" title=\"è‡ªåŠ¨éƒ¨ç½²åˆ°Github\"></a>è‡ªåŠ¨éƒ¨ç½²åˆ°Github</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ sh push.sh</div></pre></td></tr></table></figure>\n"},{"title":"requestAnimationFrame","date":"2017-11-23T07:38:33.000Z","author":"singsong","_content":"\n![arf](./arf.png)\n\n## setTimeout\n\n**è¯­æ³•**ï¼šsetTimeout(function,delay)\n\n**å®šä¹‰**ï¼šsetTimeout()æ–¹æ³•ç”¨äºåœ¨delayæ¯«ç§’æ•°ä¹‹åè°ƒç”¨å‡½æ•°æˆ–è®¡ç®—è¡¨è¾¾å¼ã€‚\n\n<u>setTimeout()æŒ‡å®šçš„æ—¶é—´é—´éš”è¡¨ç¤ºä½•æ—¶å°†å®šæ—¶å™¨çš„ä»£ç æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œè€Œä¸æ˜¯ä½•æ—¶æ‰§è¡Œä»£ç ã€‚</u>\n\n\n## setInterval\n\n**è¯­æ³•**ï¼šsetInterval(function,delay)\n\n**å®šä¹‰**ï¼šsetInterval()æ–¹æ³•å¯æŒ‰ç…§æŒ‡å®šçš„delayå‘¨æœŸï¼ˆä»¥æ¯«ç§’è®¡ï¼‰æ¥è°ƒç”¨å‡½æ•°æˆ–è®¡ç®—è¡¨è¾¾å¼ã€‚ã€€\n\n<u>ä½¿ç”¨setInerval()åˆ›å»ºçš„å®šæ—¶å™¨ç¡®ä¿å®šæ—¶å™¨ä»£ç è§„åˆ™åœ°æ’å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚ä¸è¿‡ä»…å½“æ²¡æœ‰è¯¥å®šæ—¶å™¨çš„ä»»ä½•å…¶ä»–ä»£ç å®ä¾‹æ—¶ï¼Œæ‰å°†å®šæ—¶å™¨ä»£ç æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚è¿™ç¡®ä¿äº†å®šæ—¶å™¨ä»£ç åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­çš„æœ€å°æ—¶é—´é—´éš”ä¸ºæŒ‡å®šé—´éš”ã€‚</u>è¿™ç§é‡å¤å®šæ—¶å™¨ä¼šå­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š\n\n- åœ¨æŸäº›é—´éš”ä¼šè¢«è·³è¿‡\n- å¤šä¸ªå®šæ—¶å™¨çš„ä»£ç æ‰§è¡Œä¹‹é—´çš„é—´éš”å¯èƒ½ä¼šè¢«é¢„æœŸçš„å°\n\nå¯ä»¥é€šè¿‡å¦‚ä¸‹é“¾å¼setTimeout()è°ƒç”¨æ¨¡å¼æ¥é¿å…ç±»ä¼¼é—®é¢˜ï¼š\n\n```js\nsetTimeout(function() {\n  // do something. . . .\n  setTimeout(arguments.callee, interval);\n}, interval);\n```\n\n**ä¸è¿‡setInterval()ä¼šä¸åœåœ°è°ƒç”¨å‡½æ•°ï¼Œç›´åˆ°çª—å£å…³é—­æˆ–è°ƒç”¨clearInterval()ã€‚å½“ç„¶å¦‚æœé“¾å¼setTimeout()è°ƒç”¨æ¨¡å¼æ²¡æœ‰ç»ˆæ­¢é€»è¾‘ï¼Œä¹Ÿä¼šä¸€ç›´è¿è¡Œä¸‹å»ã€‚å› æ­¤å†ä¸éœ€è¦é‡å¤å®šæ—¶å™¨æ—¶ï¼Œç¡®ä¿å¯¹å®šæ—¶å™¨è¿›è¡Œæ¸…é™¤ï¼Œé¿å…å ç”¨ç³»ç»Ÿèµ„æºã€‚**\n\n## requestAnimationFrame\n\n>åœ¨JavaScriptä¸­åˆ›å»ºåŠ¨ç”»çš„å…¸å‹æ–¹å¼å°±æ˜¯ä½¿ç”¨setInterval()æ–¹æ³•æ¥æ§åˆ¶æ‰€æœ‰åŠ¨ç”»ï¼ˆæˆ–é“¾å¼setTimeout()è°ƒç”¨æ¨¡å¼ï¼‰ã€‚ç¼–å†™è¿™ç§åŠ¨ç”»å¾ªç¯çš„å…³é”®æ˜¯è¦çŸ¥é“å»¶è¿Ÿæ—¶é—´å¤šé•¿é€‚åˆã€‚ä¸€æ–¹é¢ï¼Œå¾ªç¯é—´éš”å¿…é¡»è¶³å¤ŸçŸ­ï¼Œè¿™æ ·æ‰èƒ½è®©ä¸åŒçš„åŠ¨ç”»æ•ˆæœæ˜¾å¾—æ›´å¹³æ»‘æµç•…ï¼›å¦ä¸€æ–¹é¢ï¼Œå¾ªç¯é—´éš”è¿˜è¦è¶³å¤Ÿé•¿ï¼Œè¿™æ ·æ‰èƒ½ç¡®ä¿æµè§ˆå™¨æœ‰èƒ½åŠ›æ¸²æŸ“äº§ç”Ÿçš„å˜åŒ–ã€‚é€šå¸¸ç”µè„‘æ˜¾ç¤ºå™¨çš„åˆ·æ–°é¢‘ç‡æ˜¯60Hzï¼Œå¤§æ¦‚ç›¸å½“äºæ¯ç§’é‡ç»˜60æ¬¡ï¼Œå¹³å‡æ¯æ¬¡çº¦ç­‰äº17ms(1000ms/60)ï¼Œä»¥è¿™ä¸ªå¾ªç¯é—´éš”é‡ç»˜åŠ¨ç”»å¯åˆ°è¾¾æœ€å¹³æ»‘æ•ˆæœã€‚\nè™½ç„¶ä¸ä½¿ç”¨å¤šç»„setTimeout()çš„å¾ªç¯æ–¹å¼ç›¸æ¯”ï¼Œä½¿ç”¨setInterval()çš„åŠ¨ç”»å¾ªç¯æ•ˆç‡æ›´é«˜ï¼Œä½†åè€…ä¹Ÿä¸æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚æ— è®ºæ˜¯setInterval()è¿˜æ˜¯setTimeout()éƒ½ä¸ååˆ†ç²¾ç¡®ã€‚<u>ä¼ é€’ç»™å®ƒä»¬çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®é™…ä¸Šåªæ˜¯æŒ‡å®šäº†æŠŠåŠ¨ç”»ä»£ç æ·»åŠ åˆ°æµè§ˆå™¨UIçº¿ç¨‹é˜Ÿåˆ—ä¸­ä»¥ç­‰å¾…æ‰§è¡Œçš„æ—¶é—´ç‚¹ã€‚å¦‚æœé˜Ÿåˆ—å‰é¢å·²ç»åŠ å…¥äº†å…¶ä»–çš„ä»»åŠ¡ï¼Œé‚£åŠ¨ç”»ä»£ç å°±è¦ç­‰å¾…å‰é¢çš„ä»»åŠ¡å®Œæˆåå†æ‰§è¡Œã€‚å¦å¤–ï¼Œè¦ä¿è¯åŠ¨ç”»å¹³æ»‘çš„å…³é”®æ˜¯è¦çŸ¥é“ä¸‹ä¸€å¸§çš„ç»˜åˆ¶æ—¶é—´ç‚¹ï¼Œè€Œå¼€å‘äººå‘˜æ²¡æœ‰åŠæ³•ç¡®ä¿æµè§ˆå™¨æŒ‰æ—¶ç»˜åˆ¶ä¸‹ä¸€å¸§ã€‚åŠ ä¸Šæµè§ˆå™¨ä½¿ç”¨çš„[è®¡æ—¶å™¨å¹¶éç²¾ç¡®åˆ°æ¯«ç§’çº§åˆ«](http://www.ituring.com.cn/article/1828)ã€‚</u>\n\n>CSSçš„transitionå’Œanimationæ•ˆæœä¼˜äºJavaScriptå®ç°çš„åŠ¨ç”»æ•ˆæœï¼ŒåŸå› åœ¨äºCSSçŸ¥é“åŠ¨ç”»ä»€ä¹ˆæ—¶å€™å¼€å§‹ï¼Œä¼šè®¡ç®—å‡ºæ­£ç¡®çš„å¾ªç¯é—´éš”ï¼Œåœ¨é€‚åˆçš„æ—¶å€™åˆ·æ–°UIã€‚åŸºäºè¯¥é—®é¢˜ï¼Œæµè§ˆå™¨ä¸ºäº†JavaScriptåŠ¨ç”»æ·»åŠ äº†ä¸€ä¸ªæ–°APIï¼Œå³requestAnimationFrame()ã€‚\n\n\n\n**è¯­æ³•**ï¼š[requestAnimationFrame(callback)](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame);\n\n**å®šä¹‰**ï¼šå‘Šè¯‰æµè§ˆå™¨å¸Œæœ›æ‰§è¡ŒåŠ¨ç”»ï¼Œå¹¶è¯·æ±‚æµè§ˆå™¨è°ƒç”¨æŒ‡å®šçš„å‡½æ•°åœ¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ›´æ–°åŠ¨ç”»ã€‚\n\nè¯¥æ–¹æ³•ä½¿ç”¨ä¸€ä¸ªå›è°ƒå‡½æ•°callbackä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°callbackä¼šåœ¨æµè§ˆå™¨é‡ç»˜ä¹‹å‰è°ƒç”¨ã€‚å›è°ƒé¢‘ç‡é€šå¸¸æ˜¯æ¯ç§’60æ¬¡ã€‚å›è°ƒå‡½æ•°callbackä¼šè¢«ä¼ å…¥ä¸€ä¸ªå‚æ•°[DOMHighResTimeStamp](https://developer.mozilla.org/zh-CN/docs/Web/API/DOMHighResTimeStamp)ï¼ŒæŒ‡ç¤ºä»è§¦å‘requestAnimationFrameå›è°ƒåˆ°ç°åœ¨çš„æ—¶é—´ã€‚`requestAnimationFrame(callback)`ä¼šè¿”å›ä¸€ä¸ªlongæ•´æ•°ï¼Œè¯·æ±‚IDï¼Œä¹Ÿæ˜¯å›è°ƒåˆ—è¡¨ä¸­å”¯ä¸€çš„æ ‡è¯†ï¼Œä¸€ä¸ªéé›¶å€¼ï¼Œå¯ä»¥ä¼ æ­¤å€¼åˆ° [ancelAnimationFrame(requestID)](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/cancelAnimationFrame)ä»¥å–æ¶ˆå›è°ƒå‡½æ•°ã€‚\n\nrequestAnimationFrameåŸºæœ¬æ€æƒ³æ˜¯åˆ©ç”¨æ˜¾ç¤ºå™¨çš„åˆ·æ–°æœºåˆ¶ï¼Œä¸åˆ·æ–°é¢‘ç‡ä¿æŒåŒæ­¥ï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªåˆ·æ–°é¢‘ç‡è¿›è¡Œé¡µé¢é‡ç»˜æ›´æ–°ã€‚ä¸è¿‡éœ€è¦æ³¨æ„ï¼š_å› ä¸ºJavaScriptå•çº¿ç¨‹å·¥ä½œæœºåˆ¶ï¼Œå¦‚æœä¸»çº¿ç¨‹ä¸€ç›´å¤„äºç¹å¿™çŠ¶æ€ï¼Œé‚£ä¹ˆrequestAnimationFrameçš„åŠ¨ç”»æ•ˆæœä¹Ÿä¼šå—å½±å“çš„ã€‚_\n\n### ä½¿ç”¨\nä½¿ç”¨requestAnimationFrameçš„æ—¶å€™ï¼Œåªéœ€åå¤è°ƒç”¨å®ƒå³å¯ï¼š\n\n```js\nfunction animation() {\n  // do something ....\n  requestAnimationFrame(animation);\n}\n\nrequestAnimationFrame(animation);\n```\n\n### ä¼˜åŠ¿\nä¸setTimeoutå’ŒsetIntervalç›¸æ¯”ï¼ŒrequestAnimationFrameæœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š\n\n- åœ¨åå°æ ‡ç­¾é¡µã€ä¸æ´»åŠ¨æ ‡ç­¾é¡µã€æœ€å°åŒ–çª—å£ä¸­ï¼ŒrequestAnimationFrameä¼šè‡ªåŠ¨æš‚åœï¼ŒèŠ‚çœç³»ç»Ÿèµ„æºä¸ºå…¶ä»–ä»»åŠ¡ã€‚\n- åœ¨ä¸€ä¸ªå¸§ä¸­å¯¹DOMçš„æ‰€æœ‰æ“ä½œï¼Œåªè¿›è¡Œä¸€æ¬¡Layoutå’ŒPaintæ›´æ–°ã€‚\n- åˆ©ç”¨æ˜¾ç¤ºå™¨çš„åˆ·æ–°æœºåˆ¶ï¼ŒçŸ¥é“åŠ¨ç”»ä½•æ—¶å¼€å§‹ï¼Œèƒ½ç¡®å®šåŠ¨ç”»æœ€ä½³å¾ªç¯é—´éš”æ—¶é—´åŠä»£ç ä½•æ—¶æ‰§è¡Œï¼Œå¹¶åœ¨é€‚åˆçš„æ—¶å€™åˆ·æ–°UIã€‚\n\n\nä¸æ´»åŠ¨æ ‡ç­¾é¡µä¸­ï¼ŒsetIntervalä¸requestAnimationFrameçš„æ´»åŠ¨çŠ¶æ€ï¼š\n\n|           | setInterval |            requestAnimationFrame            |\n|:---------:|:-----------:|:-------------------------------------------:|\n|    IE9-   |      no     |                 no supported                |\n|   IE10+   |      no     |                    paused                   |\n|  Chrome9- |      no     |                 no supported                |\n|  Chrome10 |      no     |                    paused                   |\n| Chrome10+ |   >=1000ms  |                    paused                   |\n| Firefox3- |      no     |                 no supported                |\n|  Firefox4 |      no     |                      1s                     |\n| Firefox5+ |   >=1000ms  | 2ns (n = number of frames since inactivity) |\n|  Safari5- |      no     |                 no supported                |\n|  Safari6  |      no     |                    paused                   |\n|  Safari7+ |   >=1000ms  |                    paused                   |\n|  Opera12- |      no     |                 no supported                |\n|  Opera15+ |   >=1000ms  |                    paused                   |\n\næ³¨ï¼š\n- **-**: <= \n- **+**: >=\n- **no**: æ²¡å½±å“\n- **no supported**: ä¸æ”¯æŒ\n- **paused**: æš‚åœ\n- **>=1000ms**: æ—¶é—´é—´éš”å¤§äºç­‰äº1000msï¼Œå³å¦‚æœæ—¶é—´é—´éš”å°äº1000msä¼šè¢«è°ƒæ•´ä¸º1000msï¼Œå¦‚æœæ—¶é—´é—´éš”å¤§äºç­‰äº1000msä¼šç”¨æŒ‡å®šæ—¶é—´é—´éš”\n- **1s | 2ns**: æ—¶é—´é—´éš”ï¼ˆåœ¨Firefoxä¸æ´»åŠ¨æ ‡ç­¾é¡µä¸­ï¼ŒrequestAnimationFrameæ¯å¸§æ¶ˆè€—æ—¶é—´ä»¥2çš„æ¬¡æ–¹ä¾æ¬¡é€’å¢ï¼š1sã€2sã€4sã€8s.....ï¼‰\n\n \n\n### [å…¼å®¹æ€§ï¼š](https://caniuse.com/#feat=requestanimationframe)\n\n<iframe height='540' title='caniuse-requestAnimationFrame' src='https://caniuse.com/#feat=requestanimationframe' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'></iframe>\n\n### [polyfillï¼š](https://gist.github.com/paulirish/1579671)\n\n```js\n// http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n\n// requestAnimationFrame polyfill by Erik MÃ¶ller. fixes from Paul Irish and Tino Zijdel\n\n// MIT license\n\n(function() {\n    var lastTime = 0;\n    var vendors = ['ms', 'moz', 'webkit', 'o'];\n    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n        window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];\n        window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame'] \n                                   || window[vendors[x]+'CancelRequestAnimationFrame'];\n    }\n \n    if (!window.requestAnimationFrame)\n        window.requestAnimationFrame = function(callback, element) {\n            var currTime = new Date().getTime();\n            var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n            var id = window.setTimeout(function() { callback(currTime + timeToCall); }, \n              timeToCall);\n            lastTime = currTime + timeToCall;\n            return id;\n        };\n \n    if (!window.cancelAnimationFrame)\n        window.cancelAnimationFrame = function(id) {\n            clearTimeout(id);\n        };\n}());\n```\n\n## å‚è€ƒæ–‡ç« \n\n- [Animating with javascript: from setInterval to requestAnimationFrame](https://hacks.mozilla.org/2011/08/animating-with-javascript-from-setinterval-to-requestanimationframe/)\n- [How do browsers behave when tab or window is not active?](http://satheeq.blogspot.com/2015/12/how-do-browsers-pausechange-javascript.html)\n- [Jank Busting for Better Rendering Performance](https://www.html5rocks.com/en/tutorials/speed/rendering/)","source":"_posts/requestAnimationFrame.md","raw":"---\ntitle: requestAnimationFrame\ndate: 2017-11-23 15:38:33\ntags: [requestAnimationFrame, åŠ¨ç”»]\nauthor: singsong\n---\n\n![arf](./arf.png)\n\n## setTimeout\n\n**è¯­æ³•**ï¼šsetTimeout(function,delay)\n\n**å®šä¹‰**ï¼šsetTimeout()æ–¹æ³•ç”¨äºåœ¨delayæ¯«ç§’æ•°ä¹‹åè°ƒç”¨å‡½æ•°æˆ–è®¡ç®—è¡¨è¾¾å¼ã€‚\n\n<u>setTimeout()æŒ‡å®šçš„æ—¶é—´é—´éš”è¡¨ç¤ºä½•æ—¶å°†å®šæ—¶å™¨çš„ä»£ç æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œè€Œä¸æ˜¯ä½•æ—¶æ‰§è¡Œä»£ç ã€‚</u>\n\n\n## setInterval\n\n**è¯­æ³•**ï¼šsetInterval(function,delay)\n\n**å®šä¹‰**ï¼šsetInterval()æ–¹æ³•å¯æŒ‰ç…§æŒ‡å®šçš„delayå‘¨æœŸï¼ˆä»¥æ¯«ç§’è®¡ï¼‰æ¥è°ƒç”¨å‡½æ•°æˆ–è®¡ç®—è¡¨è¾¾å¼ã€‚ã€€\n\n<u>ä½¿ç”¨setInerval()åˆ›å»ºçš„å®šæ—¶å™¨ç¡®ä¿å®šæ—¶å™¨ä»£ç è§„åˆ™åœ°æ’å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚ä¸è¿‡ä»…å½“æ²¡æœ‰è¯¥å®šæ—¶å™¨çš„ä»»ä½•å…¶ä»–ä»£ç å®ä¾‹æ—¶ï¼Œæ‰å°†å®šæ—¶å™¨ä»£ç æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚è¿™ç¡®ä¿äº†å®šæ—¶å™¨ä»£ç åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­çš„æœ€å°æ—¶é—´é—´éš”ä¸ºæŒ‡å®šé—´éš”ã€‚</u>è¿™ç§é‡å¤å®šæ—¶å™¨ä¼šå­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š\n\n- åœ¨æŸäº›é—´éš”ä¼šè¢«è·³è¿‡\n- å¤šä¸ªå®šæ—¶å™¨çš„ä»£ç æ‰§è¡Œä¹‹é—´çš„é—´éš”å¯èƒ½ä¼šè¢«é¢„æœŸçš„å°\n\nå¯ä»¥é€šè¿‡å¦‚ä¸‹é“¾å¼setTimeout()è°ƒç”¨æ¨¡å¼æ¥é¿å…ç±»ä¼¼é—®é¢˜ï¼š\n\n```js\nsetTimeout(function() {\n  // do something. . . .\n  setTimeout(arguments.callee, interval);\n}, interval);\n```\n\n**ä¸è¿‡setInterval()ä¼šä¸åœåœ°è°ƒç”¨å‡½æ•°ï¼Œç›´åˆ°çª—å£å…³é—­æˆ–è°ƒç”¨clearInterval()ã€‚å½“ç„¶å¦‚æœé“¾å¼setTimeout()è°ƒç”¨æ¨¡å¼æ²¡æœ‰ç»ˆæ­¢é€»è¾‘ï¼Œä¹Ÿä¼šä¸€ç›´è¿è¡Œä¸‹å»ã€‚å› æ­¤å†ä¸éœ€è¦é‡å¤å®šæ—¶å™¨æ—¶ï¼Œç¡®ä¿å¯¹å®šæ—¶å™¨è¿›è¡Œæ¸…é™¤ï¼Œé¿å…å ç”¨ç³»ç»Ÿèµ„æºã€‚**\n\n## requestAnimationFrame\n\n>åœ¨JavaScriptä¸­åˆ›å»ºåŠ¨ç”»çš„å…¸å‹æ–¹å¼å°±æ˜¯ä½¿ç”¨setInterval()æ–¹æ³•æ¥æ§åˆ¶æ‰€æœ‰åŠ¨ç”»ï¼ˆæˆ–é“¾å¼setTimeout()è°ƒç”¨æ¨¡å¼ï¼‰ã€‚ç¼–å†™è¿™ç§åŠ¨ç”»å¾ªç¯çš„å…³é”®æ˜¯è¦çŸ¥é“å»¶è¿Ÿæ—¶é—´å¤šé•¿é€‚åˆã€‚ä¸€æ–¹é¢ï¼Œå¾ªç¯é—´éš”å¿…é¡»è¶³å¤ŸçŸ­ï¼Œè¿™æ ·æ‰èƒ½è®©ä¸åŒçš„åŠ¨ç”»æ•ˆæœæ˜¾å¾—æ›´å¹³æ»‘æµç•…ï¼›å¦ä¸€æ–¹é¢ï¼Œå¾ªç¯é—´éš”è¿˜è¦è¶³å¤Ÿé•¿ï¼Œè¿™æ ·æ‰èƒ½ç¡®ä¿æµè§ˆå™¨æœ‰èƒ½åŠ›æ¸²æŸ“äº§ç”Ÿçš„å˜åŒ–ã€‚é€šå¸¸ç”µè„‘æ˜¾ç¤ºå™¨çš„åˆ·æ–°é¢‘ç‡æ˜¯60Hzï¼Œå¤§æ¦‚ç›¸å½“äºæ¯ç§’é‡ç»˜60æ¬¡ï¼Œå¹³å‡æ¯æ¬¡çº¦ç­‰äº17ms(1000ms/60)ï¼Œä»¥è¿™ä¸ªå¾ªç¯é—´éš”é‡ç»˜åŠ¨ç”»å¯åˆ°è¾¾æœ€å¹³æ»‘æ•ˆæœã€‚\nè™½ç„¶ä¸ä½¿ç”¨å¤šç»„setTimeout()çš„å¾ªç¯æ–¹å¼ç›¸æ¯”ï¼Œä½¿ç”¨setInterval()çš„åŠ¨ç”»å¾ªç¯æ•ˆç‡æ›´é«˜ï¼Œä½†åè€…ä¹Ÿä¸æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚æ— è®ºæ˜¯setInterval()è¿˜æ˜¯setTimeout()éƒ½ä¸ååˆ†ç²¾ç¡®ã€‚<u>ä¼ é€’ç»™å®ƒä»¬çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®é™…ä¸Šåªæ˜¯æŒ‡å®šäº†æŠŠåŠ¨ç”»ä»£ç æ·»åŠ åˆ°æµè§ˆå™¨UIçº¿ç¨‹é˜Ÿåˆ—ä¸­ä»¥ç­‰å¾…æ‰§è¡Œçš„æ—¶é—´ç‚¹ã€‚å¦‚æœé˜Ÿåˆ—å‰é¢å·²ç»åŠ å…¥äº†å…¶ä»–çš„ä»»åŠ¡ï¼Œé‚£åŠ¨ç”»ä»£ç å°±è¦ç­‰å¾…å‰é¢çš„ä»»åŠ¡å®Œæˆåå†æ‰§è¡Œã€‚å¦å¤–ï¼Œè¦ä¿è¯åŠ¨ç”»å¹³æ»‘çš„å…³é”®æ˜¯è¦çŸ¥é“ä¸‹ä¸€å¸§çš„ç»˜åˆ¶æ—¶é—´ç‚¹ï¼Œè€Œå¼€å‘äººå‘˜æ²¡æœ‰åŠæ³•ç¡®ä¿æµè§ˆå™¨æŒ‰æ—¶ç»˜åˆ¶ä¸‹ä¸€å¸§ã€‚åŠ ä¸Šæµè§ˆå™¨ä½¿ç”¨çš„[è®¡æ—¶å™¨å¹¶éç²¾ç¡®åˆ°æ¯«ç§’çº§åˆ«](http://www.ituring.com.cn/article/1828)ã€‚</u>\n\n>CSSçš„transitionå’Œanimationæ•ˆæœä¼˜äºJavaScriptå®ç°çš„åŠ¨ç”»æ•ˆæœï¼ŒåŸå› åœ¨äºCSSçŸ¥é“åŠ¨ç”»ä»€ä¹ˆæ—¶å€™å¼€å§‹ï¼Œä¼šè®¡ç®—å‡ºæ­£ç¡®çš„å¾ªç¯é—´éš”ï¼Œåœ¨é€‚åˆçš„æ—¶å€™åˆ·æ–°UIã€‚åŸºäºè¯¥é—®é¢˜ï¼Œæµè§ˆå™¨ä¸ºäº†JavaScriptåŠ¨ç”»æ·»åŠ äº†ä¸€ä¸ªæ–°APIï¼Œå³requestAnimationFrame()ã€‚\n\n\n\n**è¯­æ³•**ï¼š[requestAnimationFrame(callback)](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame);\n\n**å®šä¹‰**ï¼šå‘Šè¯‰æµè§ˆå™¨å¸Œæœ›æ‰§è¡ŒåŠ¨ç”»ï¼Œå¹¶è¯·æ±‚æµè§ˆå™¨è°ƒç”¨æŒ‡å®šçš„å‡½æ•°åœ¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ›´æ–°åŠ¨ç”»ã€‚\n\nè¯¥æ–¹æ³•ä½¿ç”¨ä¸€ä¸ªå›è°ƒå‡½æ•°callbackä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°callbackä¼šåœ¨æµè§ˆå™¨é‡ç»˜ä¹‹å‰è°ƒç”¨ã€‚å›è°ƒé¢‘ç‡é€šå¸¸æ˜¯æ¯ç§’60æ¬¡ã€‚å›è°ƒå‡½æ•°callbackä¼šè¢«ä¼ å…¥ä¸€ä¸ªå‚æ•°[DOMHighResTimeStamp](https://developer.mozilla.org/zh-CN/docs/Web/API/DOMHighResTimeStamp)ï¼ŒæŒ‡ç¤ºä»è§¦å‘requestAnimationFrameå›è°ƒåˆ°ç°åœ¨çš„æ—¶é—´ã€‚`requestAnimationFrame(callback)`ä¼šè¿”å›ä¸€ä¸ªlongæ•´æ•°ï¼Œè¯·æ±‚IDï¼Œä¹Ÿæ˜¯å›è°ƒåˆ—è¡¨ä¸­å”¯ä¸€çš„æ ‡è¯†ï¼Œä¸€ä¸ªéé›¶å€¼ï¼Œå¯ä»¥ä¼ æ­¤å€¼åˆ° [ancelAnimationFrame(requestID)](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/cancelAnimationFrame)ä»¥å–æ¶ˆå›è°ƒå‡½æ•°ã€‚\n\nrequestAnimationFrameåŸºæœ¬æ€æƒ³æ˜¯åˆ©ç”¨æ˜¾ç¤ºå™¨çš„åˆ·æ–°æœºåˆ¶ï¼Œä¸åˆ·æ–°é¢‘ç‡ä¿æŒåŒæ­¥ï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªåˆ·æ–°é¢‘ç‡è¿›è¡Œé¡µé¢é‡ç»˜æ›´æ–°ã€‚ä¸è¿‡éœ€è¦æ³¨æ„ï¼š_å› ä¸ºJavaScriptå•çº¿ç¨‹å·¥ä½œæœºåˆ¶ï¼Œå¦‚æœä¸»çº¿ç¨‹ä¸€ç›´å¤„äºç¹å¿™çŠ¶æ€ï¼Œé‚£ä¹ˆrequestAnimationFrameçš„åŠ¨ç”»æ•ˆæœä¹Ÿä¼šå—å½±å“çš„ã€‚_\n\n### ä½¿ç”¨\nä½¿ç”¨requestAnimationFrameçš„æ—¶å€™ï¼Œåªéœ€åå¤è°ƒç”¨å®ƒå³å¯ï¼š\n\n```js\nfunction animation() {\n  // do something ....\n  requestAnimationFrame(animation);\n}\n\nrequestAnimationFrame(animation);\n```\n\n### ä¼˜åŠ¿\nä¸setTimeoutå’ŒsetIntervalç›¸æ¯”ï¼ŒrequestAnimationFrameæœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š\n\n- åœ¨åå°æ ‡ç­¾é¡µã€ä¸æ´»åŠ¨æ ‡ç­¾é¡µã€æœ€å°åŒ–çª—å£ä¸­ï¼ŒrequestAnimationFrameä¼šè‡ªåŠ¨æš‚åœï¼ŒèŠ‚çœç³»ç»Ÿèµ„æºä¸ºå…¶ä»–ä»»åŠ¡ã€‚\n- åœ¨ä¸€ä¸ªå¸§ä¸­å¯¹DOMçš„æ‰€æœ‰æ“ä½œï¼Œåªè¿›è¡Œä¸€æ¬¡Layoutå’ŒPaintæ›´æ–°ã€‚\n- åˆ©ç”¨æ˜¾ç¤ºå™¨çš„åˆ·æ–°æœºåˆ¶ï¼ŒçŸ¥é“åŠ¨ç”»ä½•æ—¶å¼€å§‹ï¼Œèƒ½ç¡®å®šåŠ¨ç”»æœ€ä½³å¾ªç¯é—´éš”æ—¶é—´åŠä»£ç ä½•æ—¶æ‰§è¡Œï¼Œå¹¶åœ¨é€‚åˆçš„æ—¶å€™åˆ·æ–°UIã€‚\n\n\nä¸æ´»åŠ¨æ ‡ç­¾é¡µä¸­ï¼ŒsetIntervalä¸requestAnimationFrameçš„æ´»åŠ¨çŠ¶æ€ï¼š\n\n|           | setInterval |            requestAnimationFrame            |\n|:---------:|:-----------:|:-------------------------------------------:|\n|    IE9-   |      no     |                 no supported                |\n|   IE10+   |      no     |                    paused                   |\n|  Chrome9- |      no     |                 no supported                |\n|  Chrome10 |      no     |                    paused                   |\n| Chrome10+ |   >=1000ms  |                    paused                   |\n| Firefox3- |      no     |                 no supported                |\n|  Firefox4 |      no     |                      1s                     |\n| Firefox5+ |   >=1000ms  | 2ns (n = number of frames since inactivity) |\n|  Safari5- |      no     |                 no supported                |\n|  Safari6  |      no     |                    paused                   |\n|  Safari7+ |   >=1000ms  |                    paused                   |\n|  Opera12- |      no     |                 no supported                |\n|  Opera15+ |   >=1000ms  |                    paused                   |\n\næ³¨ï¼š\n- **-**: <= \n- **+**: >=\n- **no**: æ²¡å½±å“\n- **no supported**: ä¸æ”¯æŒ\n- **paused**: æš‚åœ\n- **>=1000ms**: æ—¶é—´é—´éš”å¤§äºç­‰äº1000msï¼Œå³å¦‚æœæ—¶é—´é—´éš”å°äº1000msä¼šè¢«è°ƒæ•´ä¸º1000msï¼Œå¦‚æœæ—¶é—´é—´éš”å¤§äºç­‰äº1000msä¼šç”¨æŒ‡å®šæ—¶é—´é—´éš”\n- **1s | 2ns**: æ—¶é—´é—´éš”ï¼ˆåœ¨Firefoxä¸æ´»åŠ¨æ ‡ç­¾é¡µä¸­ï¼ŒrequestAnimationFrameæ¯å¸§æ¶ˆè€—æ—¶é—´ä»¥2çš„æ¬¡æ–¹ä¾æ¬¡é€’å¢ï¼š1sã€2sã€4sã€8s.....ï¼‰\n\n \n\n### [å…¼å®¹æ€§ï¼š](https://caniuse.com/#feat=requestanimationframe)\n\n<iframe height='540' title='caniuse-requestAnimationFrame' src='https://caniuse.com/#feat=requestanimationframe' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'></iframe>\n\n### [polyfillï¼š](https://gist.github.com/paulirish/1579671)\n\n```js\n// http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n\n// requestAnimationFrame polyfill by Erik MÃ¶ller. fixes from Paul Irish and Tino Zijdel\n\n// MIT license\n\n(function() {\n    var lastTime = 0;\n    var vendors = ['ms', 'moz', 'webkit', 'o'];\n    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n        window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];\n        window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame'] \n                                   || window[vendors[x]+'CancelRequestAnimationFrame'];\n    }\n \n    if (!window.requestAnimationFrame)\n        window.requestAnimationFrame = function(callback, element) {\n            var currTime = new Date().getTime();\n            var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n            var id = window.setTimeout(function() { callback(currTime + timeToCall); }, \n              timeToCall);\n            lastTime = currTime + timeToCall;\n            return id;\n        };\n \n    if (!window.cancelAnimationFrame)\n        window.cancelAnimationFrame = function(id) {\n            clearTimeout(id);\n        };\n}());\n```\n\n## å‚è€ƒæ–‡ç« \n\n- [Animating with javascript: from setInterval to requestAnimationFrame](https://hacks.mozilla.org/2011/08/animating-with-javascript-from-setinterval-to-requestanimationframe/)\n- [How do browsers behave when tab or window is not active?](http://satheeq.blogspot.com/2015/12/how-do-browsers-pausechange-javascript.html)\n- [Jank Busting for Better Rendering Performance](https://www.html5rocks.com/en/tutorials/speed/rendering/)","slug":"requestAnimationFrame","published":1,"updated":"2018-08-22T08:06:45.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjl4vatae00081hn93k24rqhh","content":"<p><img src=\"./arf.png\" alt=\"arf\"></p>\n<h2 id=\"setTimeout\"><a href=\"#setTimeout\" class=\"headerlink\" title=\"setTimeout\"></a>setTimeout</h2><p><strong>è¯­æ³•</strong>ï¼šsetTimeout(function,delay)</p>\n<p><strong>å®šä¹‰</strong>ï¼šsetTimeout()æ–¹æ³•ç”¨äºåœ¨delayæ¯«ç§’æ•°ä¹‹åè°ƒç”¨å‡½æ•°æˆ–è®¡ç®—è¡¨è¾¾å¼ã€‚</p>\n<p><u>setTimeout()æŒ‡å®šçš„æ—¶é—´é—´éš”è¡¨ç¤ºä½•æ—¶å°†å®šæ—¶å™¨çš„ä»£ç æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œè€Œä¸æ˜¯ä½•æ—¶æ‰§è¡Œä»£ç ã€‚</u></p>\n<h2 id=\"setInterval\"><a href=\"#setInterval\" class=\"headerlink\" title=\"setInterval\"></a>setInterval</h2><p><strong>è¯­æ³•</strong>ï¼šsetInterval(function,delay)</p>\n<p><strong>å®šä¹‰</strong>ï¼šsetInterval()æ–¹æ³•å¯æŒ‰ç…§æŒ‡å®šçš„delayå‘¨æœŸï¼ˆä»¥æ¯«ç§’è®¡ï¼‰æ¥è°ƒç”¨å‡½æ•°æˆ–è®¡ç®—è¡¨è¾¾å¼ã€‚ã€€</p>\n<p><u>ä½¿ç”¨setInerval()åˆ›å»ºçš„å®šæ—¶å™¨ç¡®ä¿å®šæ—¶å™¨ä»£ç è§„åˆ™åœ°æ’å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚ä¸è¿‡ä»…å½“æ²¡æœ‰è¯¥å®šæ—¶å™¨çš„ä»»ä½•å…¶ä»–ä»£ç å®ä¾‹æ—¶ï¼Œæ‰å°†å®šæ—¶å™¨ä»£ç æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚è¿™ç¡®ä¿äº†å®šæ—¶å™¨ä»£ç åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­çš„æœ€å°æ—¶é—´é—´éš”ä¸ºæŒ‡å®šé—´éš”ã€‚</u>è¿™ç§é‡å¤å®šæ—¶å™¨ä¼šå­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š</p>\n<ul>\n<li>åœ¨æŸäº›é—´éš”ä¼šè¢«è·³è¿‡</li>\n<li>å¤šä¸ªå®šæ—¶å™¨çš„ä»£ç æ‰§è¡Œä¹‹é—´çš„é—´éš”å¯èƒ½ä¼šè¢«é¢„æœŸçš„å°</li>\n</ul>\n<p>å¯ä»¥é€šè¿‡å¦‚ä¸‹é“¾å¼setTimeout()è°ƒç”¨æ¨¡å¼æ¥é¿å…ç±»ä¼¼é—®é¢˜ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">  <span class=\"comment\">// do something. . . .</span></div><div class=\"line\">  setTimeout(<span class=\"built_in\">arguments</span>.callee, interval);</div><div class=\"line\">&#125;, interval);</div></pre></td></tr></table></figure>\n<p><strong>ä¸è¿‡setInterval()ä¼šä¸åœåœ°è°ƒç”¨å‡½æ•°ï¼Œç›´åˆ°çª—å£å…³é—­æˆ–è°ƒç”¨clearInterval()ã€‚å½“ç„¶å¦‚æœé“¾å¼setTimeout()è°ƒç”¨æ¨¡å¼æ²¡æœ‰ç»ˆæ­¢é€»è¾‘ï¼Œä¹Ÿä¼šä¸€ç›´è¿è¡Œä¸‹å»ã€‚å› æ­¤å†ä¸éœ€è¦é‡å¤å®šæ—¶å™¨æ—¶ï¼Œç¡®ä¿å¯¹å®šæ—¶å™¨è¿›è¡Œæ¸…é™¤ï¼Œé¿å…å ç”¨ç³»ç»Ÿèµ„æºã€‚</strong></p>\n<h2 id=\"requestAnimationFrame\"><a href=\"#requestAnimationFrame\" class=\"headerlink\" title=\"requestAnimationFrame\"></a>requestAnimationFrame</h2><blockquote>\n<p>åœ¨JavaScriptä¸­åˆ›å»ºåŠ¨ç”»çš„å…¸å‹æ–¹å¼å°±æ˜¯ä½¿ç”¨setInterval()æ–¹æ³•æ¥æ§åˆ¶æ‰€æœ‰åŠ¨ç”»ï¼ˆæˆ–é“¾å¼setTimeout()è°ƒç”¨æ¨¡å¼ï¼‰ã€‚ç¼–å†™è¿™ç§åŠ¨ç”»å¾ªç¯çš„å…³é”®æ˜¯è¦çŸ¥é“å»¶è¿Ÿæ—¶é—´å¤šé•¿é€‚åˆã€‚ä¸€æ–¹é¢ï¼Œå¾ªç¯é—´éš”å¿…é¡»è¶³å¤ŸçŸ­ï¼Œè¿™æ ·æ‰èƒ½è®©ä¸åŒçš„åŠ¨ç”»æ•ˆæœæ˜¾å¾—æ›´å¹³æ»‘æµç•…ï¼›å¦ä¸€æ–¹é¢ï¼Œå¾ªç¯é—´éš”è¿˜è¦è¶³å¤Ÿé•¿ï¼Œè¿™æ ·æ‰èƒ½ç¡®ä¿æµè§ˆå™¨æœ‰èƒ½åŠ›æ¸²æŸ“äº§ç”Ÿçš„å˜åŒ–ã€‚é€šå¸¸ç”µè„‘æ˜¾ç¤ºå™¨çš„åˆ·æ–°é¢‘ç‡æ˜¯60Hzï¼Œå¤§æ¦‚ç›¸å½“äºæ¯ç§’é‡ç»˜60æ¬¡ï¼Œå¹³å‡æ¯æ¬¡çº¦ç­‰äº17ms(1000ms/60)ï¼Œä»¥è¿™ä¸ªå¾ªç¯é—´éš”é‡ç»˜åŠ¨ç”»å¯åˆ°è¾¾æœ€å¹³æ»‘æ•ˆæœã€‚<br>è™½ç„¶ä¸ä½¿ç”¨å¤šç»„setTimeout()çš„å¾ªç¯æ–¹å¼ç›¸æ¯”ï¼Œä½¿ç”¨setInterval()çš„åŠ¨ç”»å¾ªç¯æ•ˆç‡æ›´é«˜ï¼Œä½†åè€…ä¹Ÿä¸æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚æ— è®ºæ˜¯setInterval()è¿˜æ˜¯setTimeout()éƒ½ä¸ååˆ†ç²¾ç¡®ã€‚<u>ä¼ é€’ç»™å®ƒä»¬çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®é™…ä¸Šåªæ˜¯æŒ‡å®šäº†æŠŠåŠ¨ç”»ä»£ç æ·»åŠ åˆ°æµè§ˆå™¨UIçº¿ç¨‹é˜Ÿåˆ—ä¸­ä»¥ç­‰å¾…æ‰§è¡Œçš„æ—¶é—´ç‚¹ã€‚å¦‚æœé˜Ÿåˆ—å‰é¢å·²ç»åŠ å…¥äº†å…¶ä»–çš„ä»»åŠ¡ï¼Œé‚£åŠ¨ç”»ä»£ç å°±è¦ç­‰å¾…å‰é¢çš„ä»»åŠ¡å®Œæˆåå†æ‰§è¡Œã€‚å¦å¤–ï¼Œè¦ä¿è¯åŠ¨ç”»å¹³æ»‘çš„å…³é”®æ˜¯è¦çŸ¥é“ä¸‹ä¸€å¸§çš„ç»˜åˆ¶æ—¶é—´ç‚¹ï¼Œè€Œå¼€å‘äººå‘˜æ²¡æœ‰åŠæ³•ç¡®ä¿æµè§ˆå™¨æŒ‰æ—¶ç»˜åˆ¶ä¸‹ä¸€å¸§ã€‚åŠ ä¸Šæµè§ˆå™¨ä½¿ç”¨çš„<a href=\"http://www.ituring.com.cn/article/1828\" target=\"_blank\" rel=\"external\">è®¡æ—¶å™¨å¹¶éç²¾ç¡®åˆ°æ¯«ç§’çº§åˆ«</a>ã€‚</u></p>\n</blockquote>\n<blockquote>\n<p>CSSçš„transitionå’Œanimationæ•ˆæœä¼˜äºJavaScriptå®ç°çš„åŠ¨ç”»æ•ˆæœï¼ŒåŸå› åœ¨äºCSSçŸ¥é“åŠ¨ç”»ä»€ä¹ˆæ—¶å€™å¼€å§‹ï¼Œä¼šè®¡ç®—å‡ºæ­£ç¡®çš„å¾ªç¯é—´éš”ï¼Œåœ¨é€‚åˆçš„æ—¶å€™åˆ·æ–°UIã€‚åŸºäºè¯¥é—®é¢˜ï¼Œæµè§ˆå™¨ä¸ºäº†JavaScriptåŠ¨ç”»æ·»åŠ äº†ä¸€ä¸ªæ–°APIï¼Œå³requestAnimationFrame()ã€‚</p>\n</blockquote>\n<p><strong>è¯­æ³•</strong>ï¼š<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame\" target=\"_blank\" rel=\"external\">requestAnimationFrame(callback)</a>;</p>\n<p><strong>å®šä¹‰</strong>ï¼šå‘Šè¯‰æµè§ˆå™¨å¸Œæœ›æ‰§è¡ŒåŠ¨ç”»ï¼Œå¹¶è¯·æ±‚æµè§ˆå™¨è°ƒç”¨æŒ‡å®šçš„å‡½æ•°åœ¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ›´æ–°åŠ¨ç”»ã€‚</p>\n<p>è¯¥æ–¹æ³•ä½¿ç”¨ä¸€ä¸ªå›è°ƒå‡½æ•°callbackä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°callbackä¼šåœ¨æµè§ˆå™¨é‡ç»˜ä¹‹å‰è°ƒç”¨ã€‚å›è°ƒé¢‘ç‡é€šå¸¸æ˜¯æ¯ç§’60æ¬¡ã€‚å›è°ƒå‡½æ•°callbackä¼šè¢«ä¼ å…¥ä¸€ä¸ªå‚æ•°<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/DOMHighResTimeStamp\" target=\"_blank\" rel=\"external\">DOMHighResTimeStamp</a>ï¼ŒæŒ‡ç¤ºä»è§¦å‘requestAnimationFrameå›è°ƒåˆ°ç°åœ¨çš„æ—¶é—´ã€‚<code>requestAnimationFrame(callback)</code>ä¼šè¿”å›ä¸€ä¸ªlongæ•´æ•°ï¼Œè¯·æ±‚IDï¼Œä¹Ÿæ˜¯å›è°ƒåˆ—è¡¨ä¸­å”¯ä¸€çš„æ ‡è¯†ï¼Œä¸€ä¸ªéé›¶å€¼ï¼Œå¯ä»¥ä¼ æ­¤å€¼åˆ° <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/cancelAnimationFrame\" target=\"_blank\" rel=\"external\">ancelAnimationFrame(requestID)</a>ä»¥å–æ¶ˆå›è°ƒå‡½æ•°ã€‚</p>\n<p>requestAnimationFrameåŸºæœ¬æ€æƒ³æ˜¯åˆ©ç”¨æ˜¾ç¤ºå™¨çš„åˆ·æ–°æœºåˆ¶ï¼Œä¸åˆ·æ–°é¢‘ç‡ä¿æŒåŒæ­¥ï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªåˆ·æ–°é¢‘ç‡è¿›è¡Œé¡µé¢é‡ç»˜æ›´æ–°ã€‚ä¸è¿‡éœ€è¦æ³¨æ„ï¼š<em>å› ä¸ºJavaScriptå•çº¿ç¨‹å·¥ä½œæœºåˆ¶ï¼Œå¦‚æœä¸»çº¿ç¨‹ä¸€ç›´å¤„äºç¹å¿™çŠ¶æ€ï¼Œé‚£ä¹ˆrequestAnimationFrameçš„åŠ¨ç”»æ•ˆæœä¹Ÿä¼šå—å½±å“çš„ã€‚</em></p>\n<h3 id=\"ä½¿ç”¨\"><a href=\"#ä½¿ç”¨\" class=\"headerlink\" title=\"ä½¿ç”¨\"></a>ä½¿ç”¨</h3><p>ä½¿ç”¨requestAnimationFrameçš„æ—¶å€™ï¼Œåªéœ€åå¤è°ƒç”¨å®ƒå³å¯ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">animation</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">  <span class=\"comment\">// do something ....</span></div><div class=\"line\">  requestAnimationFrame(animation);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">requestAnimationFrame(animation);</div></pre></td></tr></table></figure>\n<h3 id=\"ä¼˜åŠ¿\"><a href=\"#ä¼˜åŠ¿\" class=\"headerlink\" title=\"ä¼˜åŠ¿\"></a>ä¼˜åŠ¿</h3><p>ä¸setTimeoutå’ŒsetIntervalç›¸æ¯”ï¼ŒrequestAnimationFrameæœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p>\n<ul>\n<li>åœ¨åå°æ ‡ç­¾é¡µã€ä¸æ´»åŠ¨æ ‡ç­¾é¡µã€æœ€å°åŒ–çª—å£ä¸­ï¼ŒrequestAnimationFrameä¼šè‡ªåŠ¨æš‚åœï¼ŒèŠ‚çœç³»ç»Ÿèµ„æºä¸ºå…¶ä»–ä»»åŠ¡ã€‚</li>\n<li>åœ¨ä¸€ä¸ªå¸§ä¸­å¯¹DOMçš„æ‰€æœ‰æ“ä½œï¼Œåªè¿›è¡Œä¸€æ¬¡Layoutå’ŒPaintæ›´æ–°ã€‚</li>\n<li>åˆ©ç”¨æ˜¾ç¤ºå™¨çš„åˆ·æ–°æœºåˆ¶ï¼ŒçŸ¥é“åŠ¨ç”»ä½•æ—¶å¼€å§‹ï¼Œèƒ½ç¡®å®šåŠ¨ç”»æœ€ä½³å¾ªç¯é—´éš”æ—¶é—´åŠä»£ç ä½•æ—¶æ‰§è¡Œï¼Œå¹¶åœ¨é€‚åˆçš„æ—¶å€™åˆ·æ–°UIã€‚</li>\n</ul>\n<p>ä¸æ´»åŠ¨æ ‡ç­¾é¡µä¸­ï¼ŒsetIntervalä¸requestAnimationFrameçš„æ´»åŠ¨çŠ¶æ€ï¼š</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\"></th>\n<th style=\"text-align:center\">setInterval</th>\n<th style=\"text-align:center\">requestAnimationFrame</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">IE9-</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">no supported</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">IE10+</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">paused</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Chrome9-</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">no supported</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Chrome10</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">paused</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Chrome10+</td>\n<td style=\"text-align:center\">&gt;=1000ms</td>\n<td style=\"text-align:center\">paused</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Firefox3-</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">no supported</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Firefox4</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">1s</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Firefox5+</td>\n<td style=\"text-align:center\">&gt;=1000ms</td>\n<td style=\"text-align:center\">2ns (n = number of frames since inactivity)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Safari5-</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">no supported</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Safari6</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">paused</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Safari7+</td>\n<td style=\"text-align:center\">&gt;=1000ms</td>\n<td style=\"text-align:center\">paused</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Opera12-</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">no supported</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Opera15+</td>\n<td style=\"text-align:center\">&gt;=1000ms</td>\n<td style=\"text-align:center\">paused</td>\n</tr>\n</tbody>\n</table>\n<p>æ³¨ï¼š</p>\n<ul>\n<li><strong>-</strong>: &lt;= </li>\n<li><strong>+</strong>: &gt;=</li>\n<li><strong>no</strong>: æ²¡å½±å“</li>\n<li><strong>no supported</strong>: ä¸æ”¯æŒ</li>\n<li><strong>paused</strong>: æš‚åœ</li>\n<li><strong>&gt;=1000ms</strong>: æ—¶é—´é—´éš”å¤§äºç­‰äº1000msï¼Œå³å¦‚æœæ—¶é—´é—´éš”å°äº1000msä¼šè¢«è°ƒæ•´ä¸º1000msï¼Œå¦‚æœæ—¶é—´é—´éš”å¤§äºç­‰äº1000msä¼šç”¨æŒ‡å®šæ—¶é—´é—´éš”</li>\n<li><strong>1s | 2ns</strong>: æ—¶é—´é—´éš”ï¼ˆåœ¨Firefoxä¸æ´»åŠ¨æ ‡ç­¾é¡µä¸­ï¼ŒrequestAnimationFrameæ¯å¸§æ¶ˆè€—æ—¶é—´ä»¥2çš„æ¬¡æ–¹ä¾æ¬¡é€’å¢ï¼š1sã€2sã€4sã€8sâ€¦..ï¼‰</li>\n</ul>\n<h3 id=\"å…¼å®¹æ€§ï¼š\"><a href=\"#å…¼å®¹æ€§ï¼š\" class=\"headerlink\" title=\"å…¼å®¹æ€§ï¼š\"></a><a href=\"https://caniuse.com/#feat=requestanimationframe\" target=\"_blank\" rel=\"external\">å…¼å®¹æ€§ï¼š</a></h3><iframe height=\"540\" title=\"caniuse-requestAnimationFrame\" src=\"https://caniuse.com/#feat=requestanimationframe\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\"></iframe>\n\n<h3 id=\"polyfillï¼š\"><a href=\"#polyfillï¼š\" class=\"headerlink\" title=\"polyfillï¼š\"></a><a href=\"https://gist.github.com/paulirish/1579671\" target=\"_blank\" rel=\"external\">polyfillï¼š</a></h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// http://paulirish.com/2011/requestanimationframe-for-smart-animating/</span></div><div class=\"line\"><span class=\"comment\">// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// requestAnimationFrame polyfill by Erik MÃ¶ller. fixes from Paul Irish and Tino Zijdel</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// MIT license</span></div><div class=\"line\"></div><div class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> lastTime = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">var</span> vendors = [<span class=\"string\">'ms'</span>, <span class=\"string\">'moz'</span>, <span class=\"string\">'webkit'</span>, <span class=\"string\">'o'</span>];</div><div class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> x = <span class=\"number\">0</span>; x &lt; vendors.length &amp;&amp; !<span class=\"built_in\">window</span>.requestAnimationFrame; ++x) &#123;</div><div class=\"line\">        <span class=\"built_in\">window</span>.requestAnimationFrame = <span class=\"built_in\">window</span>[vendors[x]+<span class=\"string\">'RequestAnimationFrame'</span>];</div><div class=\"line\">        <span class=\"built_in\">window</span>.cancelAnimationFrame = <span class=\"built_in\">window</span>[vendors[x]+<span class=\"string\">'CancelAnimationFrame'</span>] </div><div class=\"line\">                                   || <span class=\"built_in\">window</span>[vendors[x]+<span class=\"string\">'CancelRequestAnimationFrame'</span>];</div><div class=\"line\">    &#125;</div><div class=\"line\"> </div><div class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">window</span>.requestAnimationFrame)</div><div class=\"line\">        <span class=\"built_in\">window</span>.requestAnimationFrame = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback, element</span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">var</span> currTime = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</div><div class=\"line\">            <span class=\"keyword\">var</span> timeToCall = <span class=\"built_in\">Math</span>.max(<span class=\"number\">0</span>, <span class=\"number\">16</span> - (currTime - lastTime));</div><div class=\"line\">            <span class=\"keyword\">var</span> id = <span class=\"built_in\">window</span>.setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; callback(currTime + timeToCall); &#125;, </div><div class=\"line\">              timeToCall);</div><div class=\"line\">            lastTime = currTime + timeToCall;</div><div class=\"line\">            <span class=\"keyword\">return</span> id;</div><div class=\"line\">        &#125;;</div><div class=\"line\"> </div><div class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">window</span>.cancelAnimationFrame)</div><div class=\"line\">        <span class=\"built_in\">window</span>.cancelAnimationFrame = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">id</span>) </span>&#123;</div><div class=\"line\">            clearTimeout(id);</div><div class=\"line\">        &#125;;</div><div class=\"line\">&#125;());</div></pre></td></tr></table></figure>\n<h2 id=\"å‚è€ƒæ–‡ç« \"><a href=\"#å‚è€ƒæ–‡ç« \" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« \"></a>å‚è€ƒæ–‡ç« </h2><ul>\n<li><a href=\"https://hacks.mozilla.org/2011/08/animating-with-javascript-from-setinterval-to-requestanimationframe/\" target=\"_blank\" rel=\"external\">Animating with javascript: from setInterval to requestAnimationFrame</a></li>\n<li><a href=\"http://satheeq.blogspot.com/2015/12/how-do-browsers-pausechange-javascript.html\" target=\"_blank\" rel=\"external\">How do browsers behave when tab or window is not active?</a></li>\n<li><a href=\"https://www.html5rocks.com/en/tutorials/speed/rendering/\" target=\"_blank\" rel=\"external\">Jank Busting for Better Rendering Performance</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"./arf.png\" alt=\"arf\"></p>\n<h2 id=\"setTimeout\"><a href=\"#setTimeout\" class=\"headerlink\" title=\"setTimeout\"></a>setTimeout</h2><p><strong>è¯­æ³•</strong>ï¼šsetTimeout(function,delay)</p>\n<p><strong>å®šä¹‰</strong>ï¼šsetTimeout()æ–¹æ³•ç”¨äºåœ¨delayæ¯«ç§’æ•°ä¹‹åè°ƒç”¨å‡½æ•°æˆ–è®¡ç®—è¡¨è¾¾å¼ã€‚</p>\n<p><u>setTimeout()æŒ‡å®šçš„æ—¶é—´é—´éš”è¡¨ç¤ºä½•æ—¶å°†å®šæ—¶å™¨çš„ä»£ç æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œè€Œä¸æ˜¯ä½•æ—¶æ‰§è¡Œä»£ç ã€‚</u></p>\n<h2 id=\"setInterval\"><a href=\"#setInterval\" class=\"headerlink\" title=\"setInterval\"></a>setInterval</h2><p><strong>è¯­æ³•</strong>ï¼šsetInterval(function,delay)</p>\n<p><strong>å®šä¹‰</strong>ï¼šsetInterval()æ–¹æ³•å¯æŒ‰ç…§æŒ‡å®šçš„delayå‘¨æœŸï¼ˆä»¥æ¯«ç§’è®¡ï¼‰æ¥è°ƒç”¨å‡½æ•°æˆ–è®¡ç®—è¡¨è¾¾å¼ã€‚ã€€</p>\n<p><u>ä½¿ç”¨setInerval()åˆ›å»ºçš„å®šæ—¶å™¨ç¡®ä¿å®šæ—¶å™¨ä»£ç è§„åˆ™åœ°æ’å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚ä¸è¿‡ä»…å½“æ²¡æœ‰è¯¥å®šæ—¶å™¨çš„ä»»ä½•å…¶ä»–ä»£ç å®ä¾‹æ—¶ï¼Œæ‰å°†å®šæ—¶å™¨ä»£ç æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚è¿™ç¡®ä¿äº†å®šæ—¶å™¨ä»£ç åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­çš„æœ€å°æ—¶é—´é—´éš”ä¸ºæŒ‡å®šé—´éš”ã€‚</u>è¿™ç§é‡å¤å®šæ—¶å™¨ä¼šå­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š</p>\n<ul>\n<li>åœ¨æŸäº›é—´éš”ä¼šè¢«è·³è¿‡</li>\n<li>å¤šä¸ªå®šæ—¶å™¨çš„ä»£ç æ‰§è¡Œä¹‹é—´çš„é—´éš”å¯èƒ½ä¼šè¢«é¢„æœŸçš„å°</li>\n</ul>\n<p>å¯ä»¥é€šè¿‡å¦‚ä¸‹é“¾å¼setTimeout()è°ƒç”¨æ¨¡å¼æ¥é¿å…ç±»ä¼¼é—®é¢˜ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">  <span class=\"comment\">// do something. . . .</span></div><div class=\"line\">  setTimeout(<span class=\"built_in\">arguments</span>.callee, interval);</div><div class=\"line\">&#125;, interval);</div></pre></td></tr></table></figure>\n<p><strong>ä¸è¿‡setInterval()ä¼šä¸åœåœ°è°ƒç”¨å‡½æ•°ï¼Œç›´åˆ°çª—å£å…³é—­æˆ–è°ƒç”¨clearInterval()ã€‚å½“ç„¶å¦‚æœé“¾å¼setTimeout()è°ƒç”¨æ¨¡å¼æ²¡æœ‰ç»ˆæ­¢é€»è¾‘ï¼Œä¹Ÿä¼šä¸€ç›´è¿è¡Œä¸‹å»ã€‚å› æ­¤å†ä¸éœ€è¦é‡å¤å®šæ—¶å™¨æ—¶ï¼Œç¡®ä¿å¯¹å®šæ—¶å™¨è¿›è¡Œæ¸…é™¤ï¼Œé¿å…å ç”¨ç³»ç»Ÿèµ„æºã€‚</strong></p>\n<h2 id=\"requestAnimationFrame\"><a href=\"#requestAnimationFrame\" class=\"headerlink\" title=\"requestAnimationFrame\"></a>requestAnimationFrame</h2><blockquote>\n<p>åœ¨JavaScriptä¸­åˆ›å»ºåŠ¨ç”»çš„å…¸å‹æ–¹å¼å°±æ˜¯ä½¿ç”¨setInterval()æ–¹æ³•æ¥æ§åˆ¶æ‰€æœ‰åŠ¨ç”»ï¼ˆæˆ–é“¾å¼setTimeout()è°ƒç”¨æ¨¡å¼ï¼‰ã€‚ç¼–å†™è¿™ç§åŠ¨ç”»å¾ªç¯çš„å…³é”®æ˜¯è¦çŸ¥é“å»¶è¿Ÿæ—¶é—´å¤šé•¿é€‚åˆã€‚ä¸€æ–¹é¢ï¼Œå¾ªç¯é—´éš”å¿…é¡»è¶³å¤ŸçŸ­ï¼Œè¿™æ ·æ‰èƒ½è®©ä¸åŒçš„åŠ¨ç”»æ•ˆæœæ˜¾å¾—æ›´å¹³æ»‘æµç•…ï¼›å¦ä¸€æ–¹é¢ï¼Œå¾ªç¯é—´éš”è¿˜è¦è¶³å¤Ÿé•¿ï¼Œè¿™æ ·æ‰èƒ½ç¡®ä¿æµè§ˆå™¨æœ‰èƒ½åŠ›æ¸²æŸ“äº§ç”Ÿçš„å˜åŒ–ã€‚é€šå¸¸ç”µè„‘æ˜¾ç¤ºå™¨çš„åˆ·æ–°é¢‘ç‡æ˜¯60Hzï¼Œå¤§æ¦‚ç›¸å½“äºæ¯ç§’é‡ç»˜60æ¬¡ï¼Œå¹³å‡æ¯æ¬¡çº¦ç­‰äº17ms(1000ms/60)ï¼Œä»¥è¿™ä¸ªå¾ªç¯é—´éš”é‡ç»˜åŠ¨ç”»å¯åˆ°è¾¾æœ€å¹³æ»‘æ•ˆæœã€‚<br>è™½ç„¶ä¸ä½¿ç”¨å¤šç»„setTimeout()çš„å¾ªç¯æ–¹å¼ç›¸æ¯”ï¼Œä½¿ç”¨setInterval()çš„åŠ¨ç”»å¾ªç¯æ•ˆç‡æ›´é«˜ï¼Œä½†åè€…ä¹Ÿä¸æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚æ— è®ºæ˜¯setInterval()è¿˜æ˜¯setTimeout()éƒ½ä¸ååˆ†ç²¾ç¡®ã€‚<u>ä¼ é€’ç»™å®ƒä»¬çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®é™…ä¸Šåªæ˜¯æŒ‡å®šäº†æŠŠåŠ¨ç”»ä»£ç æ·»åŠ åˆ°æµè§ˆå™¨UIçº¿ç¨‹é˜Ÿåˆ—ä¸­ä»¥ç­‰å¾…æ‰§è¡Œçš„æ—¶é—´ç‚¹ã€‚å¦‚æœé˜Ÿåˆ—å‰é¢å·²ç»åŠ å…¥äº†å…¶ä»–çš„ä»»åŠ¡ï¼Œé‚£åŠ¨ç”»ä»£ç å°±è¦ç­‰å¾…å‰é¢çš„ä»»åŠ¡å®Œæˆåå†æ‰§è¡Œã€‚å¦å¤–ï¼Œè¦ä¿è¯åŠ¨ç”»å¹³æ»‘çš„å…³é”®æ˜¯è¦çŸ¥é“ä¸‹ä¸€å¸§çš„ç»˜åˆ¶æ—¶é—´ç‚¹ï¼Œè€Œå¼€å‘äººå‘˜æ²¡æœ‰åŠæ³•ç¡®ä¿æµè§ˆå™¨æŒ‰æ—¶ç»˜åˆ¶ä¸‹ä¸€å¸§ã€‚åŠ ä¸Šæµè§ˆå™¨ä½¿ç”¨çš„<a href=\"http://www.ituring.com.cn/article/1828\" target=\"_blank\" rel=\"external\">è®¡æ—¶å™¨å¹¶éç²¾ç¡®åˆ°æ¯«ç§’çº§åˆ«</a>ã€‚</u></p>\n</blockquote>\n<blockquote>\n<p>CSSçš„transitionå’Œanimationæ•ˆæœä¼˜äºJavaScriptå®ç°çš„åŠ¨ç”»æ•ˆæœï¼ŒåŸå› åœ¨äºCSSçŸ¥é“åŠ¨ç”»ä»€ä¹ˆæ—¶å€™å¼€å§‹ï¼Œä¼šè®¡ç®—å‡ºæ­£ç¡®çš„å¾ªç¯é—´éš”ï¼Œåœ¨é€‚åˆçš„æ—¶å€™åˆ·æ–°UIã€‚åŸºäºè¯¥é—®é¢˜ï¼Œæµè§ˆå™¨ä¸ºäº†JavaScriptåŠ¨ç”»æ·»åŠ äº†ä¸€ä¸ªæ–°APIï¼Œå³requestAnimationFrame()ã€‚</p>\n</blockquote>\n<p><strong>è¯­æ³•</strong>ï¼š<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame\" target=\"_blank\" rel=\"external\">requestAnimationFrame(callback)</a>;</p>\n<p><strong>å®šä¹‰</strong>ï¼šå‘Šè¯‰æµè§ˆå™¨å¸Œæœ›æ‰§è¡ŒåŠ¨ç”»ï¼Œå¹¶è¯·æ±‚æµè§ˆå™¨è°ƒç”¨æŒ‡å®šçš„å‡½æ•°åœ¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ›´æ–°åŠ¨ç”»ã€‚</p>\n<p>è¯¥æ–¹æ³•ä½¿ç”¨ä¸€ä¸ªå›è°ƒå‡½æ•°callbackä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°callbackä¼šåœ¨æµè§ˆå™¨é‡ç»˜ä¹‹å‰è°ƒç”¨ã€‚å›è°ƒé¢‘ç‡é€šå¸¸æ˜¯æ¯ç§’60æ¬¡ã€‚å›è°ƒå‡½æ•°callbackä¼šè¢«ä¼ å…¥ä¸€ä¸ªå‚æ•°<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/DOMHighResTimeStamp\" target=\"_blank\" rel=\"external\">DOMHighResTimeStamp</a>ï¼ŒæŒ‡ç¤ºä»è§¦å‘requestAnimationFrameå›è°ƒåˆ°ç°åœ¨çš„æ—¶é—´ã€‚<code>requestAnimationFrame(callback)</code>ä¼šè¿”å›ä¸€ä¸ªlongæ•´æ•°ï¼Œè¯·æ±‚IDï¼Œä¹Ÿæ˜¯å›è°ƒåˆ—è¡¨ä¸­å”¯ä¸€çš„æ ‡è¯†ï¼Œä¸€ä¸ªéé›¶å€¼ï¼Œå¯ä»¥ä¼ æ­¤å€¼åˆ° <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/cancelAnimationFrame\" target=\"_blank\" rel=\"external\">ancelAnimationFrame(requestID)</a>ä»¥å–æ¶ˆå›è°ƒå‡½æ•°ã€‚</p>\n<p>requestAnimationFrameåŸºæœ¬æ€æƒ³æ˜¯åˆ©ç”¨æ˜¾ç¤ºå™¨çš„åˆ·æ–°æœºåˆ¶ï¼Œä¸åˆ·æ–°é¢‘ç‡ä¿æŒåŒæ­¥ï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªåˆ·æ–°é¢‘ç‡è¿›è¡Œé¡µé¢é‡ç»˜æ›´æ–°ã€‚ä¸è¿‡éœ€è¦æ³¨æ„ï¼š<em>å› ä¸ºJavaScriptå•çº¿ç¨‹å·¥ä½œæœºåˆ¶ï¼Œå¦‚æœä¸»çº¿ç¨‹ä¸€ç›´å¤„äºç¹å¿™çŠ¶æ€ï¼Œé‚£ä¹ˆrequestAnimationFrameçš„åŠ¨ç”»æ•ˆæœä¹Ÿä¼šå—å½±å“çš„ã€‚</em></p>\n<h3 id=\"ä½¿ç”¨\"><a href=\"#ä½¿ç”¨\" class=\"headerlink\" title=\"ä½¿ç”¨\"></a>ä½¿ç”¨</h3><p>ä½¿ç”¨requestAnimationFrameçš„æ—¶å€™ï¼Œåªéœ€åå¤è°ƒç”¨å®ƒå³å¯ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">animation</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">  <span class=\"comment\">// do something ....</span></div><div class=\"line\">  requestAnimationFrame(animation);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">requestAnimationFrame(animation);</div></pre></td></tr></table></figure>\n<h3 id=\"ä¼˜åŠ¿\"><a href=\"#ä¼˜åŠ¿\" class=\"headerlink\" title=\"ä¼˜åŠ¿\"></a>ä¼˜åŠ¿</h3><p>ä¸setTimeoutå’ŒsetIntervalç›¸æ¯”ï¼ŒrequestAnimationFrameæœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p>\n<ul>\n<li>åœ¨åå°æ ‡ç­¾é¡µã€ä¸æ´»åŠ¨æ ‡ç­¾é¡µã€æœ€å°åŒ–çª—å£ä¸­ï¼ŒrequestAnimationFrameä¼šè‡ªåŠ¨æš‚åœï¼ŒèŠ‚çœç³»ç»Ÿèµ„æºä¸ºå…¶ä»–ä»»åŠ¡ã€‚</li>\n<li>åœ¨ä¸€ä¸ªå¸§ä¸­å¯¹DOMçš„æ‰€æœ‰æ“ä½œï¼Œåªè¿›è¡Œä¸€æ¬¡Layoutå’ŒPaintæ›´æ–°ã€‚</li>\n<li>åˆ©ç”¨æ˜¾ç¤ºå™¨çš„åˆ·æ–°æœºåˆ¶ï¼ŒçŸ¥é“åŠ¨ç”»ä½•æ—¶å¼€å§‹ï¼Œèƒ½ç¡®å®šåŠ¨ç”»æœ€ä½³å¾ªç¯é—´éš”æ—¶é—´åŠä»£ç ä½•æ—¶æ‰§è¡Œï¼Œå¹¶åœ¨é€‚åˆçš„æ—¶å€™åˆ·æ–°UIã€‚</li>\n</ul>\n<p>ä¸æ´»åŠ¨æ ‡ç­¾é¡µä¸­ï¼ŒsetIntervalä¸requestAnimationFrameçš„æ´»åŠ¨çŠ¶æ€ï¼š</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\"></th>\n<th style=\"text-align:center\">setInterval</th>\n<th style=\"text-align:center\">requestAnimationFrame</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">IE9-</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">no supported</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">IE10+</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">paused</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Chrome9-</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">no supported</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Chrome10</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">paused</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Chrome10+</td>\n<td style=\"text-align:center\">&gt;=1000ms</td>\n<td style=\"text-align:center\">paused</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Firefox3-</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">no supported</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Firefox4</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">1s</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Firefox5+</td>\n<td style=\"text-align:center\">&gt;=1000ms</td>\n<td style=\"text-align:center\">2ns (n = number of frames since inactivity)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Safari5-</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">no supported</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Safari6</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">paused</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Safari7+</td>\n<td style=\"text-align:center\">&gt;=1000ms</td>\n<td style=\"text-align:center\">paused</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Opera12-</td>\n<td style=\"text-align:center\">no</td>\n<td style=\"text-align:center\">no supported</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Opera15+</td>\n<td style=\"text-align:center\">&gt;=1000ms</td>\n<td style=\"text-align:center\">paused</td>\n</tr>\n</tbody>\n</table>\n<p>æ³¨ï¼š</p>\n<ul>\n<li><strong>-</strong>: &lt;= </li>\n<li><strong>+</strong>: &gt;=</li>\n<li><strong>no</strong>: æ²¡å½±å“</li>\n<li><strong>no supported</strong>: ä¸æ”¯æŒ</li>\n<li><strong>paused</strong>: æš‚åœ</li>\n<li><strong>&gt;=1000ms</strong>: æ—¶é—´é—´éš”å¤§äºç­‰äº1000msï¼Œå³å¦‚æœæ—¶é—´é—´éš”å°äº1000msä¼šè¢«è°ƒæ•´ä¸º1000msï¼Œå¦‚æœæ—¶é—´é—´éš”å¤§äºç­‰äº1000msä¼šç”¨æŒ‡å®šæ—¶é—´é—´éš”</li>\n<li><strong>1s | 2ns</strong>: æ—¶é—´é—´éš”ï¼ˆåœ¨Firefoxä¸æ´»åŠ¨æ ‡ç­¾é¡µä¸­ï¼ŒrequestAnimationFrameæ¯å¸§æ¶ˆè€—æ—¶é—´ä»¥2çš„æ¬¡æ–¹ä¾æ¬¡é€’å¢ï¼š1sã€2sã€4sã€8sâ€¦..ï¼‰</li>\n</ul>\n<h3 id=\"å…¼å®¹æ€§ï¼š\"><a href=\"#å…¼å®¹æ€§ï¼š\" class=\"headerlink\" title=\"å…¼å®¹æ€§ï¼š\"></a><a href=\"https://caniuse.com/#feat=requestanimationframe\" target=\"_blank\" rel=\"external\">å…¼å®¹æ€§ï¼š</a></h3><iframe height=\"540\" title=\"caniuse-requestAnimationFrame\" src=\"https://caniuse.com/#feat=requestanimationframe\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\"></iframe>\n\n<h3 id=\"polyfillï¼š\"><a href=\"#polyfillï¼š\" class=\"headerlink\" title=\"polyfillï¼š\"></a><a href=\"https://gist.github.com/paulirish/1579671\" target=\"_blank\" rel=\"external\">polyfillï¼š</a></h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// http://paulirish.com/2011/requestanimationframe-for-smart-animating/</span></div><div class=\"line\"><span class=\"comment\">// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// requestAnimationFrame polyfill by Erik MÃ¶ller. fixes from Paul Irish and Tino Zijdel</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// MIT license</span></div><div class=\"line\"></div><div class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> lastTime = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">var</span> vendors = [<span class=\"string\">'ms'</span>, <span class=\"string\">'moz'</span>, <span class=\"string\">'webkit'</span>, <span class=\"string\">'o'</span>];</div><div class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> x = <span class=\"number\">0</span>; x &lt; vendors.length &amp;&amp; !<span class=\"built_in\">window</span>.requestAnimationFrame; ++x) &#123;</div><div class=\"line\">        <span class=\"built_in\">window</span>.requestAnimationFrame = <span class=\"built_in\">window</span>[vendors[x]+<span class=\"string\">'RequestAnimationFrame'</span>];</div><div class=\"line\">        <span class=\"built_in\">window</span>.cancelAnimationFrame = <span class=\"built_in\">window</span>[vendors[x]+<span class=\"string\">'CancelAnimationFrame'</span>] </div><div class=\"line\">                                   || <span class=\"built_in\">window</span>[vendors[x]+<span class=\"string\">'CancelRequestAnimationFrame'</span>];</div><div class=\"line\">    &#125;</div><div class=\"line\"> </div><div class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">window</span>.requestAnimationFrame)</div><div class=\"line\">        <span class=\"built_in\">window</span>.requestAnimationFrame = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback, element</span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">var</span> currTime = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</div><div class=\"line\">            <span class=\"keyword\">var</span> timeToCall = <span class=\"built_in\">Math</span>.max(<span class=\"number\">0</span>, <span class=\"number\">16</span> - (currTime - lastTime));</div><div class=\"line\">            <span class=\"keyword\">var</span> id = <span class=\"built_in\">window</span>.setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; callback(currTime + timeToCall); &#125;, </div><div class=\"line\">              timeToCall);</div><div class=\"line\">            lastTime = currTime + timeToCall;</div><div class=\"line\">            <span class=\"keyword\">return</span> id;</div><div class=\"line\">        &#125;;</div><div class=\"line\"> </div><div class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">window</span>.cancelAnimationFrame)</div><div class=\"line\">        <span class=\"built_in\">window</span>.cancelAnimationFrame = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">id</span>) </span>&#123;</div><div class=\"line\">            clearTimeout(id);</div><div class=\"line\">        &#125;;</div><div class=\"line\">&#125;());</div></pre></td></tr></table></figure>\n<h2 id=\"å‚è€ƒæ–‡ç« \"><a href=\"#å‚è€ƒæ–‡ç« \" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« \"></a>å‚è€ƒæ–‡ç« </h2><ul>\n<li><a href=\"https://hacks.mozilla.org/2011/08/animating-with-javascript-from-setinterval-to-requestanimationframe/\" target=\"_blank\" rel=\"external\">Animating with javascript: from setInterval to requestAnimationFrame</a></li>\n<li><a href=\"http://satheeq.blogspot.com/2015/12/how-do-browsers-pausechange-javascript.html\" target=\"_blank\" rel=\"external\">How do browsers behave when tab or window is not active?</a></li>\n<li><a href=\"https://www.html5rocks.com/en/tutorials/speed/rendering/\" target=\"_blank\" rel=\"external\">Jank Busting for Better Rendering Performance</a></li>\n</ul>\n"},{"title":"å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹","date":"2017-09-19T11:02:53.000Z","author":"singsong","_content":"\nåœ¨è®²è§£ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸ªé—®é¢˜ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¤–éƒ¨æ ·å¼è¡¨æ˜¯å¦é˜»å¡HTMLè§£æï¼ˆå…ˆä¸è¦çœ‹ç­”æ¡ˆï¼Œå¯ä»¥è‡ªå·±æ€è€ƒå’Œå®éªŒä¸€ä¸‹ï¼‰ï¼š\n\n![default](./style-sheet-default.png)\n***\n\né€šè¿‡**DevTool->network**:\n\n![default](./default-network.png)\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ**indexcss.css**å¹¶æ²¡æœ‰é˜»å¡HTMLè§£æï¼Œå› ä¸ºDOMContentLoadedæ—¶é—´çº¿åœ¨**indexcss.css**ä¹‹åã€‚ä½†å¦‚æœåœ¨\n**indexcss.css**ä¹‹åæ·»åŠ **scriptæ ‡ç­¾ï¼ˆä¸èƒ½ä¸ºç©ºï¼‰**ï¼Œç»“æœä¼šä¸€æ ·ï¼Ÿ\n\n![script](./script.png)\né€šè¿‡**DevTool->network**:\n\n![script](./script-network.png)\n\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨**indexcss.css**ä¹‹åæ·»åŠ **scriptæ ‡ç­¾**(ä¸èƒ½ä¸ºç©º)åï¼Œæ­¤æ—¶DOMContentLoadedæ—¶é—´çº¿ä½äº**indexcss.css**ä¹‹åã€‚è¯´æ˜è¿™é‡Œ**indexcss.css**æ˜¯é˜»å¡HTMLè§£æçš„ã€‚\n\n#### å‚è€ƒç›¸å…³èµ„æ–™ï¼Œæ‰¾åˆ°å¦‚ä¸‹æè¿°ï¼š\n>Style sheets on the other hand have a different model. Conceptually it seems that since style sheets don't change the DOM tree, there is no reason to wait for them and stop the document parsing. There is an issue, though, of scripts asking for style information during the document parsing stage. If the style is not loaded and parsed yet, the script will get wrong answers and apparently this caused lots of problems. It seems to be an edge case but is quite common. Firefox blocks all scripts when there is a style sheet that is still being loaded and parsed. WebKit blocks scripts only when they try to access certain style properties that may be affected by unloaded style sheets.----[Tali Garsiel](https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/#The_order_of_processing_scripts_and_style_sheets) \n\nå¤§æ¦‚æ„æ€æ˜¯ï¼š<u>style-sheetsä¸ä¼šä¿®æ”¹DOMæ ‘ï¼Œæ²¡æœ‰ç†ç”±ä¸ºäº†è§£æstyle-sheetsè€Œé˜»å¡æ–‡æ¡£è§£æï¼ˆå³style-sheetsä¸ä¼šé˜»å¡æ–‡æ¡£è§£æï¼‰ã€‚ä½†å¦‚æœåœ¨è§£ææ–‡æ¡£è¿‡ç¨‹ä¸­æœ‰è„šæœ¬éœ€è¦è®¿é—®æ ·å¼ä¿¡æ¯æ—¶ï¼Œä¸ºäº†ä¿è¯è®¿é—®æ ·å¼ä¿¡æ¯çš„æ­£ç¡®æ€§ã€‚Firefoxä¼šé˜»å¡æ‰€æœ‰è„šæœ¬ç›´åˆ°style-sheetsä¸‹è½½è§£æå®Œä¸ºæ­¢ã€‚è€ŒWebKitåªåœ¨è„šæœ¬è®¿é—®çš„æ ·å¼å±æ€§æ²¡æœ‰è¢«åŠ è½½è§£ææ—¶ï¼Œæ‰ä¼šé˜»å¡è„šæœ¬</u>ã€‚\n\n![relationship](./style-sheet.png)\n\nä¹Ÿå³style-sheetä¸ä¼šç›´æ¥é˜»å¡æ–‡æ¡£è§£æï¼Œå®ƒåªé˜»å¡scriptçš„è§£ææ‰§è¡Œï¼Œæ‰å¯¼è‡´style-sheeté—´æ¥é˜»å¡æ–‡æ¡£è§£æã€‚å¦‚æœå°†scriptè®¾ç½®ä¸ºéé˜»å¡å¼çš„å‘¢ï¼Ÿå¯ä»¥é€šè¿‡ä¸ºscriptæ ‡ç­¾è®¾ç½®**aysnc**ç‰¹æ€§æ¥å®ç°ã€‚ä¸ºå•¥ä¸ç”¨**defer**?\n\n>Both async and defer scripts begin to download immediately without pausing the parser and both support an optional onload handler to address the common need to perform initialization which depends on the script. The difference between async and defer centers around when the script is executed. Each async script executes at the first opportunity after it is finished downloading and before the windowâ€™s load event. This means itâ€™s possible (and likely) that async scripts are not executed in the order in which they occur in the page. **The defer scripts, on the other hand, are guaranteed to be executed in the order they occur in the page. That execution starts after parsing is completely finished, but before the documentâ€™s DOMContentLoaded event.**\n\nå¤§æ¦‚æ„æ€ï¼š<u>**async**å’Œ**defer**ç‰¹æ€§åœ¨è„šæœ¬å¼€å§‹ä¸‹è½½æ—¶ï¼Œéƒ½ä¸ä¼šé˜»å¡æ–‡æ¡£è§£æã€‚å¹¶ä¸”éƒ½æ”¯æŒonloadäº‹ä»¶å›è°ƒå¤„ç†ï¼Œç”¨äºä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚å¦å¤–ï¼Œå¯¹å†…è”è„šæœ¬éƒ½æ— æ•ˆï¼Œè„šæœ¬ä¸­ä¸èƒ½è°ƒç”¨`document.write()`ã€‚ä¸åŒä¹‹å¤„ï¼šå¸¦æœ‰**async**ç‰¹æ€§çš„è„šæœ¬ä¼šåœ¨è„šæœ¬ä¸‹è½½å®Œåç«‹å³æ‰§è¡Œï¼Œä¸”åœ¨loadäº‹ä»¶ä¹‹å‰ï¼Œæ‰€ä»¥ä¸èƒ½ç¡®ä¿è„šæœ¬åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„é¡ºåºæ¥æ‰§è¡Œã€‚è€Œå¸¦æœ‰**defer**ç‰¹æ€§çš„è„šæœ¬ä¼šåœ¨æ–‡æ¡£è§£æå®ŒåæŒ‰ç…§åœ¨æ–‡æ¡£å‡ºç°çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œä¸”åœ¨DOMContentLoadedäº‹ä»¶ä¹‹å‰ã€‚</u>\n\nå› æ­¤ï¼Œè¿™é‡Œè®¾ç½®**async**ç‰¹æ€§ï¼Œè€Œä¸è®¾ç½®**defer**ç‰¹æ€§ã€‚ä¸ºäº†å°½æ—©åœ°è§¦å‘DOMContentLoadedäº‹ä»¶ï¼Œå› ä¸º**defer**ä¼šå»¶è¿ŸDOMContentLoadedäº‹ä»¶è§¦å‘ã€‚\n\nä¸ºscriptæ ‡ç­¾æ·»åŠ **async**ç‰¹æ€§:\n\n![async](./async.png)\n\né€šè¿‡**DevTool->network**:\n\n![async](./async-network1.png)\n\n***\nå½“ç„¶ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡[åª’ä½“æŸ¥è¯¢media](https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries)è®©style-sheetå¼‚æ­¥åŠ è½½ï¼š\n![media](./media.png)\n\né€šè¿‡**DevTool->network**:\n\n![media](./media-network.png)\n\n### æ€»ç»“ï¼š\n\n- style-sheeté»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸ä¼šé˜»å¡æ–‡æ¡£è§£æçš„ã€‚\n- style-sheetåªä¼šé˜»å¡scriptè„šæœ¬è§£ææ‰§è¡Œã€‚å› ä¸ºéœ€è¦scriptè„šæœ¬éœ€è¦è®¿é—®style-sheetæ ·å¼ä¿¡æ¯ï¼Œä¸ºäº†ç¡®ä¿æ ·å¼ä¿¡æ¯çš„æ­£ç¡®æ€§ï¼Œscriptè„šæœ¬éœ€è¦ç­‰å¾…style-sheetä¸‹è½½è§£æå®Œã€‚ä»è€Œå¯¼è‡´style-sheeté—´æ¥é˜»å¡æ–‡æ¡£è§£æã€‚\n- style-sheetå¯ä»¥é€šè¿‡**åª’ä½“æŸ¥è¯¢media**æ¥å®ç°å¼‚æ­¥åŠ è½½ã€‚\n- ä¸ºscriptè®¾ç½®**aysnc**ç‰¹æ€§æ¥å®ç°å¼‚æ­¥åŠ è½½ï¼Œæ¥åŠ å¿«æ–‡æ¡£è§£æã€‚\n\n\n\n\n\n### å‚è€ƒæ–‡ç« ï¼š\n- [åˆ†æå…³é”®æ¸²æŸ“è·¯å¾„æ€§èƒ½](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/analyzing-crp)\n- [Deciphering the Critical Rendering Path](https://calendar.perfplanet.com/2012/deciphering-the-critical-rendering-path/)\n- [How Browsers Work: Behind the scenes of modern web browsers](https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/#The_order_of_processing_scripts_and_style_sheets)\n\n---\n\n> å£°æ˜:æœ¬èµ„æ–™ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ä½¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”! å¦‚éœ€è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚\n\n---\n","source":"_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹.md","raw":"---\ntitle: å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹\ndate: 2017-09-19 19:02:53\ntags: [style-sheet, ä¼˜åŒ–]\nauthor: singsong\n---\n\nåœ¨è®²è§£ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸ªé—®é¢˜ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¤–éƒ¨æ ·å¼è¡¨æ˜¯å¦é˜»å¡HTMLè§£æï¼ˆå…ˆä¸è¦çœ‹ç­”æ¡ˆï¼Œå¯ä»¥è‡ªå·±æ€è€ƒå’Œå®éªŒä¸€ä¸‹ï¼‰ï¼š\n\n![default](./style-sheet-default.png)\n***\n\né€šè¿‡**DevTool->network**:\n\n![default](./default-network.png)\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ**indexcss.css**å¹¶æ²¡æœ‰é˜»å¡HTMLè§£æï¼Œå› ä¸ºDOMContentLoadedæ—¶é—´çº¿åœ¨**indexcss.css**ä¹‹åã€‚ä½†å¦‚æœåœ¨\n**indexcss.css**ä¹‹åæ·»åŠ **scriptæ ‡ç­¾ï¼ˆä¸èƒ½ä¸ºç©ºï¼‰**ï¼Œç»“æœä¼šä¸€æ ·ï¼Ÿ\n\n![script](./script.png)\né€šè¿‡**DevTool->network**:\n\n![script](./script-network.png)\n\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨**indexcss.css**ä¹‹åæ·»åŠ **scriptæ ‡ç­¾**(ä¸èƒ½ä¸ºç©º)åï¼Œæ­¤æ—¶DOMContentLoadedæ—¶é—´çº¿ä½äº**indexcss.css**ä¹‹åã€‚è¯´æ˜è¿™é‡Œ**indexcss.css**æ˜¯é˜»å¡HTMLè§£æçš„ã€‚\n\n#### å‚è€ƒç›¸å…³èµ„æ–™ï¼Œæ‰¾åˆ°å¦‚ä¸‹æè¿°ï¼š\n>Style sheets on the other hand have a different model. Conceptually it seems that since style sheets don't change the DOM tree, there is no reason to wait for them and stop the document parsing. There is an issue, though, of scripts asking for style information during the document parsing stage. If the style is not loaded and parsed yet, the script will get wrong answers and apparently this caused lots of problems. It seems to be an edge case but is quite common. Firefox blocks all scripts when there is a style sheet that is still being loaded and parsed. WebKit blocks scripts only when they try to access certain style properties that may be affected by unloaded style sheets.----[Tali Garsiel](https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/#The_order_of_processing_scripts_and_style_sheets) \n\nå¤§æ¦‚æ„æ€æ˜¯ï¼š<u>style-sheetsä¸ä¼šä¿®æ”¹DOMæ ‘ï¼Œæ²¡æœ‰ç†ç”±ä¸ºäº†è§£æstyle-sheetsè€Œé˜»å¡æ–‡æ¡£è§£æï¼ˆå³style-sheetsä¸ä¼šé˜»å¡æ–‡æ¡£è§£æï¼‰ã€‚ä½†å¦‚æœåœ¨è§£ææ–‡æ¡£è¿‡ç¨‹ä¸­æœ‰è„šæœ¬éœ€è¦è®¿é—®æ ·å¼ä¿¡æ¯æ—¶ï¼Œä¸ºäº†ä¿è¯è®¿é—®æ ·å¼ä¿¡æ¯çš„æ­£ç¡®æ€§ã€‚Firefoxä¼šé˜»å¡æ‰€æœ‰è„šæœ¬ç›´åˆ°style-sheetsä¸‹è½½è§£æå®Œä¸ºæ­¢ã€‚è€ŒWebKitåªåœ¨è„šæœ¬è®¿é—®çš„æ ·å¼å±æ€§æ²¡æœ‰è¢«åŠ è½½è§£ææ—¶ï¼Œæ‰ä¼šé˜»å¡è„šæœ¬</u>ã€‚\n\n![relationship](./style-sheet.png)\n\nä¹Ÿå³style-sheetä¸ä¼šç›´æ¥é˜»å¡æ–‡æ¡£è§£æï¼Œå®ƒåªé˜»å¡scriptçš„è§£ææ‰§è¡Œï¼Œæ‰å¯¼è‡´style-sheeté—´æ¥é˜»å¡æ–‡æ¡£è§£æã€‚å¦‚æœå°†scriptè®¾ç½®ä¸ºéé˜»å¡å¼çš„å‘¢ï¼Ÿå¯ä»¥é€šè¿‡ä¸ºscriptæ ‡ç­¾è®¾ç½®**aysnc**ç‰¹æ€§æ¥å®ç°ã€‚ä¸ºå•¥ä¸ç”¨**defer**?\n\n>Both async and defer scripts begin to download immediately without pausing the parser and both support an optional onload handler to address the common need to perform initialization which depends on the script. The difference between async and defer centers around when the script is executed. Each async script executes at the first opportunity after it is finished downloading and before the windowâ€™s load event. This means itâ€™s possible (and likely) that async scripts are not executed in the order in which they occur in the page. **The defer scripts, on the other hand, are guaranteed to be executed in the order they occur in the page. That execution starts after parsing is completely finished, but before the documentâ€™s DOMContentLoaded event.**\n\nå¤§æ¦‚æ„æ€ï¼š<u>**async**å’Œ**defer**ç‰¹æ€§åœ¨è„šæœ¬å¼€å§‹ä¸‹è½½æ—¶ï¼Œéƒ½ä¸ä¼šé˜»å¡æ–‡æ¡£è§£æã€‚å¹¶ä¸”éƒ½æ”¯æŒonloadäº‹ä»¶å›è°ƒå¤„ç†ï¼Œç”¨äºä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚å¦å¤–ï¼Œå¯¹å†…è”è„šæœ¬éƒ½æ— æ•ˆï¼Œè„šæœ¬ä¸­ä¸èƒ½è°ƒç”¨`document.write()`ã€‚ä¸åŒä¹‹å¤„ï¼šå¸¦æœ‰**async**ç‰¹æ€§çš„è„šæœ¬ä¼šåœ¨è„šæœ¬ä¸‹è½½å®Œåç«‹å³æ‰§è¡Œï¼Œä¸”åœ¨loadäº‹ä»¶ä¹‹å‰ï¼Œæ‰€ä»¥ä¸èƒ½ç¡®ä¿è„šæœ¬åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„é¡ºåºæ¥æ‰§è¡Œã€‚è€Œå¸¦æœ‰**defer**ç‰¹æ€§çš„è„šæœ¬ä¼šåœ¨æ–‡æ¡£è§£æå®ŒåæŒ‰ç…§åœ¨æ–‡æ¡£å‡ºç°çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œä¸”åœ¨DOMContentLoadedäº‹ä»¶ä¹‹å‰ã€‚</u>\n\nå› æ­¤ï¼Œè¿™é‡Œè®¾ç½®**async**ç‰¹æ€§ï¼Œè€Œä¸è®¾ç½®**defer**ç‰¹æ€§ã€‚ä¸ºäº†å°½æ—©åœ°è§¦å‘DOMContentLoadedäº‹ä»¶ï¼Œå› ä¸º**defer**ä¼šå»¶è¿ŸDOMContentLoadedäº‹ä»¶è§¦å‘ã€‚\n\nä¸ºscriptæ ‡ç­¾æ·»åŠ **async**ç‰¹æ€§:\n\n![async](./async.png)\n\né€šè¿‡**DevTool->network**:\n\n![async](./async-network1.png)\n\n***\nå½“ç„¶ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡[åª’ä½“æŸ¥è¯¢media](https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries)è®©style-sheetå¼‚æ­¥åŠ è½½ï¼š\n![media](./media.png)\n\né€šè¿‡**DevTool->network**:\n\n![media](./media-network.png)\n\n### æ€»ç»“ï¼š\n\n- style-sheeté»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸ä¼šé˜»å¡æ–‡æ¡£è§£æçš„ã€‚\n- style-sheetåªä¼šé˜»å¡scriptè„šæœ¬è§£ææ‰§è¡Œã€‚å› ä¸ºéœ€è¦scriptè„šæœ¬éœ€è¦è®¿é—®style-sheetæ ·å¼ä¿¡æ¯ï¼Œä¸ºäº†ç¡®ä¿æ ·å¼ä¿¡æ¯çš„æ­£ç¡®æ€§ï¼Œscriptè„šæœ¬éœ€è¦ç­‰å¾…style-sheetä¸‹è½½è§£æå®Œã€‚ä»è€Œå¯¼è‡´style-sheeté—´æ¥é˜»å¡æ–‡æ¡£è§£æã€‚\n- style-sheetå¯ä»¥é€šè¿‡**åª’ä½“æŸ¥è¯¢media**æ¥å®ç°å¼‚æ­¥åŠ è½½ã€‚\n- ä¸ºscriptè®¾ç½®**aysnc**ç‰¹æ€§æ¥å®ç°å¼‚æ­¥åŠ è½½ï¼Œæ¥åŠ å¿«æ–‡æ¡£è§£æã€‚\n\n\n\n\n\n### å‚è€ƒæ–‡ç« ï¼š\n- [åˆ†æå…³é”®æ¸²æŸ“è·¯å¾„æ€§èƒ½](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/analyzing-crp)\n- [Deciphering the Critical Rendering Path](https://calendar.perfplanet.com/2012/deciphering-the-critical-rendering-path/)\n- [How Browsers Work: Behind the scenes of modern web browsers](https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/#The_order_of_processing_scripts_and_style_sheets)\n\n---\n\n> å£°æ˜:æœ¬èµ„æ–™ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ä½¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”! å¦‚éœ€è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚\n\n---\n","slug":"å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹","published":1,"updated":"2018-08-22T08:06:45.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjl4vatah00091hn9zz0oy1h3","content":"<p>åœ¨è®²è§£ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸ªé—®é¢˜ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¤–éƒ¨æ ·å¼è¡¨æ˜¯å¦é˜»å¡HTMLè§£æï¼ˆå…ˆä¸è¦çœ‹ç­”æ¡ˆï¼Œå¯ä»¥è‡ªå·±æ€è€ƒå’Œå®éªŒä¸€ä¸‹ï¼‰ï¼š</p>\n<p><img src=\"./style-sheet-default.png\" alt=\"default\"></p>\n<hr>\n<p>é€šè¿‡<strong>DevTool-&gt;network</strong>:</p>\n<p><img src=\"./default-network.png\" alt=\"default\"><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ<strong>indexcss.css</strong>å¹¶æ²¡æœ‰é˜»å¡HTMLè§£æï¼Œå› ä¸ºDOMContentLoadedæ—¶é—´çº¿åœ¨<strong>indexcss.css</strong>ä¹‹åã€‚ä½†å¦‚æœåœ¨<br><strong>indexcss.css</strong>ä¹‹åæ·»åŠ <strong>scriptæ ‡ç­¾ï¼ˆä¸èƒ½ä¸ºç©ºï¼‰</strong>ï¼Œç»“æœä¼šä¸€æ ·ï¼Ÿ</p>\n<p><img src=\"./script.png\" alt=\"script\"><br>é€šè¿‡<strong>DevTool-&gt;network</strong>:</p>\n<p><img src=\"./script-network.png\" alt=\"script\"></p>\n<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨<strong>indexcss.css</strong>ä¹‹åæ·»åŠ <strong>scriptæ ‡ç­¾</strong>(ä¸èƒ½ä¸ºç©º)åï¼Œæ­¤æ—¶DOMContentLoadedæ—¶é—´çº¿ä½äº<strong>indexcss.css</strong>ä¹‹åã€‚è¯´æ˜è¿™é‡Œ<strong>indexcss.css</strong>æ˜¯é˜»å¡HTMLè§£æçš„ã€‚</p>\n<h4 id=\"å‚è€ƒç›¸å…³èµ„æ–™ï¼Œæ‰¾åˆ°å¦‚ä¸‹æè¿°ï¼š\"><a href=\"#å‚è€ƒç›¸å…³èµ„æ–™ï¼Œæ‰¾åˆ°å¦‚ä¸‹æè¿°ï¼š\" class=\"headerlink\" title=\"å‚è€ƒç›¸å…³èµ„æ–™ï¼Œæ‰¾åˆ°å¦‚ä¸‹æè¿°ï¼š\"></a>å‚è€ƒç›¸å…³èµ„æ–™ï¼Œæ‰¾åˆ°å¦‚ä¸‹æè¿°ï¼š</h4><blockquote>\n<p>Style sheets on the other hand have a different model. Conceptually it seems that since style sheets donâ€™t change the DOM tree, there is no reason to wait for them and stop the document parsing. There is an issue, though, of scripts asking for style information during the document parsing stage. If the style is not loaded and parsed yet, the script will get wrong answers and apparently this caused lots of problems. It seems to be an edge case but is quite common. Firefox blocks all scripts when there is a style sheet that is still being loaded and parsed. WebKit blocks scripts only when they try to access certain style properties that may be affected by unloaded style sheets.â€”-<a href=\"https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/#The_order_of_processing_scripts_and_style_sheets\" target=\"_blank\" rel=\"external\">Tali Garsiel</a> </p>\n</blockquote>\n<p>å¤§æ¦‚æ„æ€æ˜¯ï¼š<u>style-sheetsä¸ä¼šä¿®æ”¹DOMæ ‘ï¼Œæ²¡æœ‰ç†ç”±ä¸ºäº†è§£æstyle-sheetsè€Œé˜»å¡æ–‡æ¡£è§£æï¼ˆå³style-sheetsä¸ä¼šé˜»å¡æ–‡æ¡£è§£æï¼‰ã€‚ä½†å¦‚æœåœ¨è§£ææ–‡æ¡£è¿‡ç¨‹ä¸­æœ‰è„šæœ¬éœ€è¦è®¿é—®æ ·å¼ä¿¡æ¯æ—¶ï¼Œä¸ºäº†ä¿è¯è®¿é—®æ ·å¼ä¿¡æ¯çš„æ­£ç¡®æ€§ã€‚Firefoxä¼šé˜»å¡æ‰€æœ‰è„šæœ¬ç›´åˆ°style-sheetsä¸‹è½½è§£æå®Œä¸ºæ­¢ã€‚è€ŒWebKitåªåœ¨è„šæœ¬è®¿é—®çš„æ ·å¼å±æ€§æ²¡æœ‰è¢«åŠ è½½è§£ææ—¶ï¼Œæ‰ä¼šé˜»å¡è„šæœ¬</u>ã€‚</p>\n<p><img src=\"./style-sheet.png\" alt=\"relationship\"></p>\n<p>ä¹Ÿå³style-sheetä¸ä¼šç›´æ¥é˜»å¡æ–‡æ¡£è§£æï¼Œå®ƒåªé˜»å¡scriptçš„è§£ææ‰§è¡Œï¼Œæ‰å¯¼è‡´style-sheeté—´æ¥é˜»å¡æ–‡æ¡£è§£æã€‚å¦‚æœå°†scriptè®¾ç½®ä¸ºéé˜»å¡å¼çš„å‘¢ï¼Ÿå¯ä»¥é€šè¿‡ä¸ºscriptæ ‡ç­¾è®¾ç½®<strong>aysnc</strong>ç‰¹æ€§æ¥å®ç°ã€‚ä¸ºå•¥ä¸ç”¨<strong>defer</strong>?</p>\n<blockquote>\n<p>Both async and defer scripts begin to download immediately without pausing the parser and both support an optional onload handler to address the common need to perform initialization which depends on the script. The difference between async and defer centers around when the script is executed. Each async script executes at the first opportunity after it is finished downloading and before the windowâ€™s load event. This means itâ€™s possible (and likely) that async scripts are not executed in the order in which they occur in the page. <strong>The defer scripts, on the other hand, are guaranteed to be executed in the order they occur in the page. That execution starts after parsing is completely finished, but before the documentâ€™s DOMContentLoaded event.</strong></p>\n</blockquote>\n<p>å¤§æ¦‚æ„æ€ï¼š<u><strong>async</strong>å’Œ<strong>defer</strong>ç‰¹æ€§åœ¨è„šæœ¬å¼€å§‹ä¸‹è½½æ—¶ï¼Œéƒ½ä¸ä¼šé˜»å¡æ–‡æ¡£è§£æã€‚å¹¶ä¸”éƒ½æ”¯æŒonloadäº‹ä»¶å›è°ƒå¤„ç†ï¼Œç”¨äºä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚å¦å¤–ï¼Œå¯¹å†…è”è„šæœ¬éƒ½æ— æ•ˆï¼Œè„šæœ¬ä¸­ä¸èƒ½è°ƒç”¨<code>document.write()</code>ã€‚ä¸åŒä¹‹å¤„ï¼šå¸¦æœ‰<strong>async</strong>ç‰¹æ€§çš„è„šæœ¬ä¼šåœ¨è„šæœ¬ä¸‹è½½å®Œåç«‹å³æ‰§è¡Œï¼Œä¸”åœ¨loadäº‹ä»¶ä¹‹å‰ï¼Œæ‰€ä»¥ä¸èƒ½ç¡®ä¿è„šæœ¬åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„é¡ºåºæ¥æ‰§è¡Œã€‚è€Œå¸¦æœ‰<strong>defer</strong>ç‰¹æ€§çš„è„šæœ¬ä¼šåœ¨æ–‡æ¡£è§£æå®ŒåæŒ‰ç…§åœ¨æ–‡æ¡£å‡ºç°çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œä¸”åœ¨DOMContentLoadedäº‹ä»¶ä¹‹å‰ã€‚</u></p>\n<p>å› æ­¤ï¼Œè¿™é‡Œè®¾ç½®<strong>async</strong>ç‰¹æ€§ï¼Œè€Œä¸è®¾ç½®<strong>defer</strong>ç‰¹æ€§ã€‚ä¸ºäº†å°½æ—©åœ°è§¦å‘DOMContentLoadedäº‹ä»¶ï¼Œå› ä¸º<strong>defer</strong>ä¼šå»¶è¿ŸDOMContentLoadedäº‹ä»¶è§¦å‘ã€‚</p>\n<p>ä¸ºscriptæ ‡ç­¾æ·»åŠ <strong>async</strong>ç‰¹æ€§:</p>\n<p><img src=\"./async.png\" alt=\"async\"></p>\n<p>é€šè¿‡<strong>DevTool-&gt;network</strong>:</p>\n<p><img src=\"./async-network1.png\" alt=\"async\"></p>\n<hr>\n<p>å½“ç„¶ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡<a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries\" target=\"_blank\" rel=\"external\">åª’ä½“æŸ¥è¯¢media</a>è®©style-sheetå¼‚æ­¥åŠ è½½ï¼š<br><img src=\"./media.png\" alt=\"media\"></p>\n<p>é€šè¿‡<strong>DevTool-&gt;network</strong>:</p>\n<p><img src=\"./media-network.png\" alt=\"media\"></p>\n<h3 id=\"æ€»ç»“ï¼š\"><a href=\"#æ€»ç»“ï¼š\" class=\"headerlink\" title=\"æ€»ç»“ï¼š\"></a>æ€»ç»“ï¼š</h3><ul>\n<li>style-sheeté»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸ä¼šé˜»å¡æ–‡æ¡£è§£æçš„ã€‚</li>\n<li>style-sheetåªä¼šé˜»å¡scriptè„šæœ¬è§£ææ‰§è¡Œã€‚å› ä¸ºéœ€è¦scriptè„šæœ¬éœ€è¦è®¿é—®style-sheetæ ·å¼ä¿¡æ¯ï¼Œä¸ºäº†ç¡®ä¿æ ·å¼ä¿¡æ¯çš„æ­£ç¡®æ€§ï¼Œscriptè„šæœ¬éœ€è¦ç­‰å¾…style-sheetä¸‹è½½è§£æå®Œã€‚ä»è€Œå¯¼è‡´style-sheeté—´æ¥é˜»å¡æ–‡æ¡£è§£æã€‚</li>\n<li>style-sheetå¯ä»¥é€šè¿‡<strong>åª’ä½“æŸ¥è¯¢media</strong>æ¥å®ç°å¼‚æ­¥åŠ è½½ã€‚</li>\n<li>ä¸ºscriptè®¾ç½®<strong>aysnc</strong>ç‰¹æ€§æ¥å®ç°å¼‚æ­¥åŠ è½½ï¼Œæ¥åŠ å¿«æ–‡æ¡£è§£æã€‚</li>\n</ul>\n<h3 id=\"å‚è€ƒæ–‡ç« ï¼š\"><a href=\"#å‚è€ƒæ–‡ç« ï¼š\" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« ï¼š\"></a>å‚è€ƒæ–‡ç« ï¼š</h3><ul>\n<li><a href=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/analyzing-crp\" target=\"_blank\" rel=\"external\">åˆ†æå…³é”®æ¸²æŸ“è·¯å¾„æ€§èƒ½</a></li>\n<li><a href=\"https://calendar.perfplanet.com/2012/deciphering-the-critical-rendering-path/\" target=\"_blank\" rel=\"external\">Deciphering the Critical Rendering Path</a></li>\n<li><a href=\"https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/#The_order_of_processing_scripts_and_style_sheets\" target=\"_blank\" rel=\"external\">How Browsers Work: Behind the scenes of modern web browsers</a></li>\n</ul>\n<hr>\n<blockquote>\n<p>å£°æ˜:æœ¬èµ„æ–™ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ä½¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”! å¦‚éœ€è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>\n</blockquote>\n<hr>\n","site":{"data":{}},"excerpt":"","more":"<p>åœ¨è®²è§£ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸ªé—®é¢˜ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¤–éƒ¨æ ·å¼è¡¨æ˜¯å¦é˜»å¡HTMLè§£æï¼ˆå…ˆä¸è¦çœ‹ç­”æ¡ˆï¼Œå¯ä»¥è‡ªå·±æ€è€ƒå’Œå®éªŒä¸€ä¸‹ï¼‰ï¼š</p>\n<p><img src=\"./style-sheet-default.png\" alt=\"default\"></p>\n<hr>\n<p>é€šè¿‡<strong>DevTool-&gt;network</strong>:</p>\n<p><img src=\"./default-network.png\" alt=\"default\"><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ<strong>indexcss.css</strong>å¹¶æ²¡æœ‰é˜»å¡HTMLè§£æï¼Œå› ä¸ºDOMContentLoadedæ—¶é—´çº¿åœ¨<strong>indexcss.css</strong>ä¹‹åã€‚ä½†å¦‚æœåœ¨<br><strong>indexcss.css</strong>ä¹‹åæ·»åŠ <strong>scriptæ ‡ç­¾ï¼ˆä¸èƒ½ä¸ºç©ºï¼‰</strong>ï¼Œç»“æœä¼šä¸€æ ·ï¼Ÿ</p>\n<p><img src=\"./script.png\" alt=\"script\"><br>é€šè¿‡<strong>DevTool-&gt;network</strong>:</p>\n<p><img src=\"./script-network.png\" alt=\"script\"></p>\n<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨<strong>indexcss.css</strong>ä¹‹åæ·»åŠ <strong>scriptæ ‡ç­¾</strong>(ä¸èƒ½ä¸ºç©º)åï¼Œæ­¤æ—¶DOMContentLoadedæ—¶é—´çº¿ä½äº<strong>indexcss.css</strong>ä¹‹åã€‚è¯´æ˜è¿™é‡Œ<strong>indexcss.css</strong>æ˜¯é˜»å¡HTMLè§£æçš„ã€‚</p>\n<h4 id=\"å‚è€ƒç›¸å…³èµ„æ–™ï¼Œæ‰¾åˆ°å¦‚ä¸‹æè¿°ï¼š\"><a href=\"#å‚è€ƒç›¸å…³èµ„æ–™ï¼Œæ‰¾åˆ°å¦‚ä¸‹æè¿°ï¼š\" class=\"headerlink\" title=\"å‚è€ƒç›¸å…³èµ„æ–™ï¼Œæ‰¾åˆ°å¦‚ä¸‹æè¿°ï¼š\"></a>å‚è€ƒç›¸å…³èµ„æ–™ï¼Œæ‰¾åˆ°å¦‚ä¸‹æè¿°ï¼š</h4><blockquote>\n<p>Style sheets on the other hand have a different model. Conceptually it seems that since style sheets donâ€™t change the DOM tree, there is no reason to wait for them and stop the document parsing. There is an issue, though, of scripts asking for style information during the document parsing stage. If the style is not loaded and parsed yet, the script will get wrong answers and apparently this caused lots of problems. It seems to be an edge case but is quite common. Firefox blocks all scripts when there is a style sheet that is still being loaded and parsed. WebKit blocks scripts only when they try to access certain style properties that may be affected by unloaded style sheets.â€”-<a href=\"https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/#The_order_of_processing_scripts_and_style_sheets\" target=\"_blank\" rel=\"external\">Tali Garsiel</a> </p>\n</blockquote>\n<p>å¤§æ¦‚æ„æ€æ˜¯ï¼š<u>style-sheetsä¸ä¼šä¿®æ”¹DOMæ ‘ï¼Œæ²¡æœ‰ç†ç”±ä¸ºäº†è§£æstyle-sheetsè€Œé˜»å¡æ–‡æ¡£è§£æï¼ˆå³style-sheetsä¸ä¼šé˜»å¡æ–‡æ¡£è§£æï¼‰ã€‚ä½†å¦‚æœåœ¨è§£ææ–‡æ¡£è¿‡ç¨‹ä¸­æœ‰è„šæœ¬éœ€è¦è®¿é—®æ ·å¼ä¿¡æ¯æ—¶ï¼Œä¸ºäº†ä¿è¯è®¿é—®æ ·å¼ä¿¡æ¯çš„æ­£ç¡®æ€§ã€‚Firefoxä¼šé˜»å¡æ‰€æœ‰è„šæœ¬ç›´åˆ°style-sheetsä¸‹è½½è§£æå®Œä¸ºæ­¢ã€‚è€ŒWebKitåªåœ¨è„šæœ¬è®¿é—®çš„æ ·å¼å±æ€§æ²¡æœ‰è¢«åŠ è½½è§£ææ—¶ï¼Œæ‰ä¼šé˜»å¡è„šæœ¬</u>ã€‚</p>\n<p><img src=\"./style-sheet.png\" alt=\"relationship\"></p>\n<p>ä¹Ÿå³style-sheetä¸ä¼šç›´æ¥é˜»å¡æ–‡æ¡£è§£æï¼Œå®ƒåªé˜»å¡scriptçš„è§£ææ‰§è¡Œï¼Œæ‰å¯¼è‡´style-sheeté—´æ¥é˜»å¡æ–‡æ¡£è§£æã€‚å¦‚æœå°†scriptè®¾ç½®ä¸ºéé˜»å¡å¼çš„å‘¢ï¼Ÿå¯ä»¥é€šè¿‡ä¸ºscriptæ ‡ç­¾è®¾ç½®<strong>aysnc</strong>ç‰¹æ€§æ¥å®ç°ã€‚ä¸ºå•¥ä¸ç”¨<strong>defer</strong>?</p>\n<blockquote>\n<p>Both async and defer scripts begin to download immediately without pausing the parser and both support an optional onload handler to address the common need to perform initialization which depends on the script. The difference between async and defer centers around when the script is executed. Each async script executes at the first opportunity after it is finished downloading and before the windowâ€™s load event. This means itâ€™s possible (and likely) that async scripts are not executed in the order in which they occur in the page. <strong>The defer scripts, on the other hand, are guaranteed to be executed in the order they occur in the page. That execution starts after parsing is completely finished, but before the documentâ€™s DOMContentLoaded event.</strong></p>\n</blockquote>\n<p>å¤§æ¦‚æ„æ€ï¼š<u><strong>async</strong>å’Œ<strong>defer</strong>ç‰¹æ€§åœ¨è„šæœ¬å¼€å§‹ä¸‹è½½æ—¶ï¼Œéƒ½ä¸ä¼šé˜»å¡æ–‡æ¡£è§£æã€‚å¹¶ä¸”éƒ½æ”¯æŒonloadäº‹ä»¶å›è°ƒå¤„ç†ï¼Œç”¨äºä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚å¦å¤–ï¼Œå¯¹å†…è”è„šæœ¬éƒ½æ— æ•ˆï¼Œè„šæœ¬ä¸­ä¸èƒ½è°ƒç”¨<code>document.write()</code>ã€‚ä¸åŒä¹‹å¤„ï¼šå¸¦æœ‰<strong>async</strong>ç‰¹æ€§çš„è„šæœ¬ä¼šåœ¨è„šæœ¬ä¸‹è½½å®Œåç«‹å³æ‰§è¡Œï¼Œä¸”åœ¨loadäº‹ä»¶ä¹‹å‰ï¼Œæ‰€ä»¥ä¸èƒ½ç¡®ä¿è„šæœ¬åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„é¡ºåºæ¥æ‰§è¡Œã€‚è€Œå¸¦æœ‰<strong>defer</strong>ç‰¹æ€§çš„è„šæœ¬ä¼šåœ¨æ–‡æ¡£è§£æå®ŒåæŒ‰ç…§åœ¨æ–‡æ¡£å‡ºç°çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œä¸”åœ¨DOMContentLoadedäº‹ä»¶ä¹‹å‰ã€‚</u></p>\n<p>å› æ­¤ï¼Œè¿™é‡Œè®¾ç½®<strong>async</strong>ç‰¹æ€§ï¼Œè€Œä¸è®¾ç½®<strong>defer</strong>ç‰¹æ€§ã€‚ä¸ºäº†å°½æ—©åœ°è§¦å‘DOMContentLoadedäº‹ä»¶ï¼Œå› ä¸º<strong>defer</strong>ä¼šå»¶è¿ŸDOMContentLoadedäº‹ä»¶è§¦å‘ã€‚</p>\n<p>ä¸ºscriptæ ‡ç­¾æ·»åŠ <strong>async</strong>ç‰¹æ€§:</p>\n<p><img src=\"./async.png\" alt=\"async\"></p>\n<p>é€šè¿‡<strong>DevTool-&gt;network</strong>:</p>\n<p><img src=\"./async-network1.png\" alt=\"async\"></p>\n<hr>\n<p>å½“ç„¶ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡<a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries\" target=\"_blank\" rel=\"external\">åª’ä½“æŸ¥è¯¢media</a>è®©style-sheetå¼‚æ­¥åŠ è½½ï¼š<br><img src=\"./media.png\" alt=\"media\"></p>\n<p>é€šè¿‡<strong>DevTool-&gt;network</strong>:</p>\n<p><img src=\"./media-network.png\" alt=\"media\"></p>\n<h3 id=\"æ€»ç»“ï¼š\"><a href=\"#æ€»ç»“ï¼š\" class=\"headerlink\" title=\"æ€»ç»“ï¼š\"></a>æ€»ç»“ï¼š</h3><ul>\n<li>style-sheeté»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸ä¼šé˜»å¡æ–‡æ¡£è§£æçš„ã€‚</li>\n<li>style-sheetåªä¼šé˜»å¡scriptè„šæœ¬è§£ææ‰§è¡Œã€‚å› ä¸ºéœ€è¦scriptè„šæœ¬éœ€è¦è®¿é—®style-sheetæ ·å¼ä¿¡æ¯ï¼Œä¸ºäº†ç¡®ä¿æ ·å¼ä¿¡æ¯çš„æ­£ç¡®æ€§ï¼Œscriptè„šæœ¬éœ€è¦ç­‰å¾…style-sheetä¸‹è½½è§£æå®Œã€‚ä»è€Œå¯¼è‡´style-sheeté—´æ¥é˜»å¡æ–‡æ¡£è§£æã€‚</li>\n<li>style-sheetå¯ä»¥é€šè¿‡<strong>åª’ä½“æŸ¥è¯¢media</strong>æ¥å®ç°å¼‚æ­¥åŠ è½½ã€‚</li>\n<li>ä¸ºscriptè®¾ç½®<strong>aysnc</strong>ç‰¹æ€§æ¥å®ç°å¼‚æ­¥åŠ è½½ï¼Œæ¥åŠ å¿«æ–‡æ¡£è§£æã€‚</li>\n</ul>\n<h3 id=\"å‚è€ƒæ–‡ç« ï¼š\"><a href=\"#å‚è€ƒæ–‡ç« ï¼š\" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« ï¼š\"></a>å‚è€ƒæ–‡ç« ï¼š</h3><ul>\n<li><a href=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/analyzing-crp\" target=\"_blank\" rel=\"external\">åˆ†æå…³é”®æ¸²æŸ“è·¯å¾„æ€§èƒ½</a></li>\n<li><a href=\"https://calendar.perfplanet.com/2012/deciphering-the-critical-rendering-path/\" target=\"_blank\" rel=\"external\">Deciphering the Critical Rendering Path</a></li>\n<li><a href=\"https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/#The_order_of_processing_scripts_and_style_sheets\" target=\"_blank\" rel=\"external\">How Browsers Work: Behind the scenes of modern web browsers</a></li>\n</ul>\n<hr>\n<blockquote>\n<p>å£°æ˜:æœ¬èµ„æ–™ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ä½¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”! å¦‚éœ€è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>\n</blockquote>\n<hr>\n"},{"title":"å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹","date":"2017-11-23T13:48:36.000Z","author":"singsong","_content":"\n![closure](./closure.png)\n\nå½“ä¸€ä¸ªå‡½æ•°Aè¿”å›ä¸€ä¸ªå†…è”å‡½æ•°Bï¼Œå³ä½¿å‡½æ•°Aæ‰§è¡Œå®Œï¼Œå‡½æ•°Bä¹Ÿèƒ½è®¿é—®å‡½æ•°Aä½œç”¨åŸŸå†…çš„å˜é‡ã€‚è¿™å°±æ˜¯ä¸€ä¸ªé—­åŒ…â€”â€”â€”â€”â€”â€”æœ¬è´¨ä¸Šé—­åŒ…æ˜¯å°†å‡½æ•°å†…éƒ¨å’Œå¤–éƒ¨è¿æ¥èµ·æ¥çš„ä¸€åº§æ¡¥æ¢ã€‚\n\n```js\nfunction foo(message) {\n    function closure() {\n        console.log(message)\n    };\n    return closure;\n}\n\n// ä½¿ç”¨\nvar bar = foo(\"hello closure!\");\nbar()// è¿”å› 'hello closure!'\n```\nåœ¨å‡½æ•°fooå†…åˆ›å»ºçš„å‡½æ•°closureå¯¹è±¡æ˜¯ä¸èƒ½è¢«å›æ”¶æ‰çš„ï¼Œå› ä¸ºå®ƒè¢«å…¨å±€å˜é‡barå¼•ç”¨ï¼Œå¤„äºä¸€ç›´å¯è®¿é—®çŠ¶æ€ã€‚é€šè¿‡æ‰§è¡Œ`bar()`å¯ä»¥æ‰“å°å‡º`hello closure!`ã€‚å¦‚æœæƒ³é‡Šæ”¾æ‰å¯ä»¥å°†`bar = null`å³å¯ã€‚\n\n<u>**ç”±äºé—­åŒ…ä¼šæºå¸¦åŒ…å«å®ƒçš„å‡½æ•°çš„ä½œç”¨åŸŸï¼Œå› æ­¤ä¼šæ¯”å…¶ä»–å‡½æ•°å ç”¨æ›´å¤šçš„å†…å­˜ã€‚è¿‡åº¦ä½¿ç”¨é—­åŒ…å¯èƒ½ä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡å¤šã€‚**</u>\n\n### å®ä¾‹\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n  <title>Closure</title>\n</head>\n\n<body>\n  <p>ä¸æ–­å•å‡»ã€clickã€‘æŒ‰é’®</p>\n  <button id=\"click_button\">Click</button>\n  <script>\n    function f() {\n      var str = Array(10000).join('#');\n      var foo = {\n        name: 'foo'\n      }\n      function unused() {\n        var message = 'it is only a test message';\n        str = 'unused: ' + str;\n      }\n      function getData() {\n        return 'data';\n      }\n      return getData;\n    }\n\n    var list = [];\n    \n    document.querySelector('#click_button').addEventListener('click', function () {\n      list.push(f());\n    }, false);\n  </script>\n</body>\n\n</html>\n```\nè¿™é‡Œç»“åˆChromeçš„Devtools->Memoryå·¥å…·è¿›è¡Œåˆ†æï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š\n\n<u>**æ³¨ï¼šæœ€å¥½åœ¨éšèº«çª—å£ä¸­è¿›è¡Œåˆ†æå·¥ä½œï¼Œé¿å…æµè§ˆå™¨æ’ä»¶å½±å“åˆ†æç»“æœ**</u>\n\n1. é€‰ä¸­ã€Record allocation timelineã€‘é€‰é¡¹\n2. æ‰§è¡Œä¸€æ¬¡CG\n3. å•å‡»ã€startã€‘æŒ‰é’®å¼€å§‹è®°å½•å †åˆ†æ\n3. è¿ç»­å•å‡»ã€clickã€‘æŒ‰é’®åå¤šæ¬¡\n4. åœæ­¢è®°å½•å †åˆ†æ\n\n![closure](./closure1.png)\n\nä¸Šå›¾ä¸­è“è‰²æŸ±å½¢æ¡è¡¨ç¤ºéšç€æ—¶é—´æ–°åˆ†é…çš„å†…å­˜ã€‚é€‰ä¸­å…¶ä¸­æŸæ¡è“è‰²æŸ±å½¢æ¡ï¼Œè¿‡æ»¤å‡ºå¯¹åº”æ–°åˆ†é…çš„å¯¹è±¡ï¼š\n\n![closure](./closure2.png)\n\næŸ¥çœ‹å¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯ï¼š\n\n![closure](./closure3.png)\n\nä»å›¾å¯çŸ¥ï¼Œåœ¨è¿”å›çš„é—­åŒ…ä½œç”¨é“¾(Scopes)ä¸­æºå¸¦æœ‰å®ƒæ‰€åœ¨å‡½æ•°çš„ä½œç”¨åŸŸï¼Œä½œç”¨åŸŸä¸­è¿˜åŒ…å«ä¸€ä¸ªstrå­—æ®µã€‚è€Œstrå­—æ®µå¹¶æ²¡æœ‰åœ¨è¿”å›getData()ä¸­ä½¿ç”¨è¿‡ã€‚ä¸ºä»€ä¹ˆä¼šå­˜åœ¨åœ¨ä½œç”¨åŸŸä¸­ï¼ŒæŒ‰ç†åº”è¯¥è¢«GCå›æ”¶æ‰çš„ï¼Ÿ\n\nåŸå› æ˜¯åœ¨ç›¸åŒä½œç”¨åŸŸå†…åˆ›å»ºçš„å¤šä¸ªå†…éƒ¨å‡½æ•°å¯¹è±¡æ˜¯å…±äº«åŒä¸€ä¸ª[å˜é‡å¯¹è±¡ï¼ˆvariable objectï¼‰](http://dmitrysoshnikov.com/ecmascript/chapter-2-variable-object/)ã€‚å¦‚æœåˆ›å»ºçš„å†…éƒ¨å‡½æ•°æ²¡æœ‰è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œä¸ç®¡å†…éƒ¨å‡½æ•°æ˜¯å¦å¼•ç”¨å¤–éƒ¨å‡½æ•°çš„å˜é‡å’Œå‡½æ•°ï¼Œåœ¨å¤–éƒ¨å‡½æ•°æ‰§è¡Œå®Œï¼Œå¯¹åº”å˜é‡å¯¹è±¡ä¾¿ä¼šè¢«é”€æ¯ã€‚åä¹‹ï¼Œå¦‚æœå†…éƒ¨å‡½æ•°ä¸­å­˜åœ¨æœ‰å¯¹å¤–éƒ¨å‡½æ•°å˜é‡æˆ–å‡½æ•°çš„è®¿é—®ï¼ˆå¯ä»¥ä¸æ˜¯è¢«å¼•ç”¨çš„å†…éƒ¨å‡½æ•°ï¼‰ï¼Œå¹¶ä¸”å­˜åœ¨æŸä¸ªæˆ–å¤šä¸ªå†…éƒ¨å‡½æ•°è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šå½¢æˆé—­åŒ…ï¼Œå¤–éƒ¨å‡½æ•°çš„å˜é‡å¯¹è±¡å°±ä¼šå­˜åœ¨äºé—­åŒ…å‡½æ•°çš„ä½œç”¨åŸŸé“¾ä¸­ã€‚è¿™æ ·ç¡®ä¿äº†é—­åŒ…å‡½æ•°æœ‰æƒè®¿é—®å¤–éƒ¨å‡½æ•°çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°ã€‚äº†è§£äº†é—®é¢˜äº§ç”Ÿçš„åŸå› ï¼Œä¾¿å¯ä»¥å¯¹ç—‡ä¸‹è¯äº†ã€‚å¯¹ä»£ç åšå¦‚ä¸‹ä¿®æ”¹ï¼š\n\n```js\n    function f() {\n      var str = Array(10000).join('#');\n      var foo = {\n        name: 'foo'\n      }\n      function unused() {\n        var message = 'it is only a test message';\n        // str = 'unused: ' + str; //åˆ é™¤è¯¥æ¡è¯­å¥\n      }\n      function getData() {\n        return 'data';\n      }\n      return getData;\n    }\n\n    var list = [];\n    \n    document.querySelector('#click_button').addEventListener('click', function () {\n      list.push(f());\n    }, false);\n```\n\ngetData()å’Œunused()å†…éƒ¨å‡½æ•°å…±äº«få‡½æ•°å¯¹åº”çš„å˜é‡å¯¹è±¡ï¼Œå› ä¸ºunused()å†…éƒ¨å‡½æ•°è®¿é—®äº†fä½œç”¨åŸŸå†…strå˜é‡ï¼Œæ‰€ä»¥strå­—æ®µå­˜åœ¨äºfå˜é‡å¯¹è±¡ä¸­ã€‚åŠ ä¸ŠgetData()å†…éƒ¨å‡½æ•°è¢«è¿”å›ï¼Œè¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œå½¢æˆäº†é—­åŒ…ï¼Œå› æ­¤å¯¹åº”çš„få˜é‡å¯¹è±¡å­˜åœ¨äºé—­åŒ…å‡½æ•°çš„ä½œç”¨åŸŸé“¾ä¸­ã€‚è¿™é‡Œåªè¦å°†å‡½æ•°unusedä¸­`str = 'unused: ' + str;`è¯­å¥åˆ é™¤ä¾¿å¯è§£å†³é—®é¢˜ã€‚\n\n![closure](./closure4.png)\n\næŸ¥çœ‹ä¸€ä¸‹é—­åŒ…ä¿¡æ¯ï¼š\n\n![closure](./closure5.png)\n\n## æ€»ç»“\né—­åŒ…æ˜¯JavaScriptä¸­å¾ˆé‡è¦çš„æ¦‚å¿µï¼Œç†è§£å¥½å®ƒå¯¹æˆ‘ä»¬æŒæ¡JavaScriptå¾ˆå…³é”®ã€‚ä¹Ÿè®¸ä½ ä¸ªäººè®¤ä¸ºä½ å¯¹å®ƒå¾ˆäº†è§£ï¼Œä½†å½“å› å®ƒäº§ç”Ÿé—®é¢˜æ—¶ï¼Œæ‰æ„Ÿæ‚Ÿè‡ªå·±å¯¹å®ƒäº†è§£ç”šå°‘ã€‚å¦‚æœ¬æ–‡æåˆ°ï¼š<u>**åœ¨ç›¸åŒä½œç”¨åŸŸå†…åˆ›å»ºçš„å¤šä¸ªå†…éƒ¨å‡½æ•°å¯¹è±¡æ˜¯å…±äº«åŒä¸€ä¸ªå˜é‡å¯¹è±¡**</u>ã€‚ä¸ç®¡æ€ä¹ˆæ ·å¸Œæœ›ä½ èƒ½ä»æœ¬æ–‡ä¸­æœ‰æ‰€æ”¶è·~ã€‚~\n\n## å‚è€ƒæ–‡ç« \n- [An interesting kind of JavaScript memory leak](https://blog.meteor.com/an-interesting-kind-of-javascript-memory-leak-8b47d2e7f156)\n- [Grokking V8 closures for fun (and profit?)](http://mrale.ph/blog/2012/09/23/grokking-v8-closures-for-fun.html)\n","source":"_posts/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹.md","raw":"---\ntitle: å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹\ndate: 2017-11-23 21:48:36\ntags: [é—­åŒ…, closure]\nauthor: singsong\n---\n\n![closure](./closure.png)\n\nå½“ä¸€ä¸ªå‡½æ•°Aè¿”å›ä¸€ä¸ªå†…è”å‡½æ•°Bï¼Œå³ä½¿å‡½æ•°Aæ‰§è¡Œå®Œï¼Œå‡½æ•°Bä¹Ÿèƒ½è®¿é—®å‡½æ•°Aä½œç”¨åŸŸå†…çš„å˜é‡ã€‚è¿™å°±æ˜¯ä¸€ä¸ªé—­åŒ…â€”â€”â€”â€”â€”â€”æœ¬è´¨ä¸Šé—­åŒ…æ˜¯å°†å‡½æ•°å†…éƒ¨å’Œå¤–éƒ¨è¿æ¥èµ·æ¥çš„ä¸€åº§æ¡¥æ¢ã€‚\n\n```js\nfunction foo(message) {\n    function closure() {\n        console.log(message)\n    };\n    return closure;\n}\n\n// ä½¿ç”¨\nvar bar = foo(\"hello closure!\");\nbar()// è¿”å› 'hello closure!'\n```\nåœ¨å‡½æ•°fooå†…åˆ›å»ºçš„å‡½æ•°closureå¯¹è±¡æ˜¯ä¸èƒ½è¢«å›æ”¶æ‰çš„ï¼Œå› ä¸ºå®ƒè¢«å…¨å±€å˜é‡barå¼•ç”¨ï¼Œå¤„äºä¸€ç›´å¯è®¿é—®çŠ¶æ€ã€‚é€šè¿‡æ‰§è¡Œ`bar()`å¯ä»¥æ‰“å°å‡º`hello closure!`ã€‚å¦‚æœæƒ³é‡Šæ”¾æ‰å¯ä»¥å°†`bar = null`å³å¯ã€‚\n\n<u>**ç”±äºé—­åŒ…ä¼šæºå¸¦åŒ…å«å®ƒçš„å‡½æ•°çš„ä½œç”¨åŸŸï¼Œå› æ­¤ä¼šæ¯”å…¶ä»–å‡½æ•°å ç”¨æ›´å¤šçš„å†…å­˜ã€‚è¿‡åº¦ä½¿ç”¨é—­åŒ…å¯èƒ½ä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡å¤šã€‚**</u>\n\n### å®ä¾‹\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n  <title>Closure</title>\n</head>\n\n<body>\n  <p>ä¸æ–­å•å‡»ã€clickã€‘æŒ‰é’®</p>\n  <button id=\"click_button\">Click</button>\n  <script>\n    function f() {\n      var str = Array(10000).join('#');\n      var foo = {\n        name: 'foo'\n      }\n      function unused() {\n        var message = 'it is only a test message';\n        str = 'unused: ' + str;\n      }\n      function getData() {\n        return 'data';\n      }\n      return getData;\n    }\n\n    var list = [];\n    \n    document.querySelector('#click_button').addEventListener('click', function () {\n      list.push(f());\n    }, false);\n  </script>\n</body>\n\n</html>\n```\nè¿™é‡Œç»“åˆChromeçš„Devtools->Memoryå·¥å…·è¿›è¡Œåˆ†æï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š\n\n<u>**æ³¨ï¼šæœ€å¥½åœ¨éšèº«çª—å£ä¸­è¿›è¡Œåˆ†æå·¥ä½œï¼Œé¿å…æµè§ˆå™¨æ’ä»¶å½±å“åˆ†æç»“æœ**</u>\n\n1. é€‰ä¸­ã€Record allocation timelineã€‘é€‰é¡¹\n2. æ‰§è¡Œä¸€æ¬¡CG\n3. å•å‡»ã€startã€‘æŒ‰é’®å¼€å§‹è®°å½•å †åˆ†æ\n3. è¿ç»­å•å‡»ã€clickã€‘æŒ‰é’®åå¤šæ¬¡\n4. åœæ­¢è®°å½•å †åˆ†æ\n\n![closure](./closure1.png)\n\nä¸Šå›¾ä¸­è“è‰²æŸ±å½¢æ¡è¡¨ç¤ºéšç€æ—¶é—´æ–°åˆ†é…çš„å†…å­˜ã€‚é€‰ä¸­å…¶ä¸­æŸæ¡è“è‰²æŸ±å½¢æ¡ï¼Œè¿‡æ»¤å‡ºå¯¹åº”æ–°åˆ†é…çš„å¯¹è±¡ï¼š\n\n![closure](./closure2.png)\n\næŸ¥çœ‹å¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯ï¼š\n\n![closure](./closure3.png)\n\nä»å›¾å¯çŸ¥ï¼Œåœ¨è¿”å›çš„é—­åŒ…ä½œç”¨é“¾(Scopes)ä¸­æºå¸¦æœ‰å®ƒæ‰€åœ¨å‡½æ•°çš„ä½œç”¨åŸŸï¼Œä½œç”¨åŸŸä¸­è¿˜åŒ…å«ä¸€ä¸ªstrå­—æ®µã€‚è€Œstrå­—æ®µå¹¶æ²¡æœ‰åœ¨è¿”å›getData()ä¸­ä½¿ç”¨è¿‡ã€‚ä¸ºä»€ä¹ˆä¼šå­˜åœ¨åœ¨ä½œç”¨åŸŸä¸­ï¼ŒæŒ‰ç†åº”è¯¥è¢«GCå›æ”¶æ‰çš„ï¼Ÿ\n\nåŸå› æ˜¯åœ¨ç›¸åŒä½œç”¨åŸŸå†…åˆ›å»ºçš„å¤šä¸ªå†…éƒ¨å‡½æ•°å¯¹è±¡æ˜¯å…±äº«åŒä¸€ä¸ª[å˜é‡å¯¹è±¡ï¼ˆvariable objectï¼‰](http://dmitrysoshnikov.com/ecmascript/chapter-2-variable-object/)ã€‚å¦‚æœåˆ›å»ºçš„å†…éƒ¨å‡½æ•°æ²¡æœ‰è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œä¸ç®¡å†…éƒ¨å‡½æ•°æ˜¯å¦å¼•ç”¨å¤–éƒ¨å‡½æ•°çš„å˜é‡å’Œå‡½æ•°ï¼Œåœ¨å¤–éƒ¨å‡½æ•°æ‰§è¡Œå®Œï¼Œå¯¹åº”å˜é‡å¯¹è±¡ä¾¿ä¼šè¢«é”€æ¯ã€‚åä¹‹ï¼Œå¦‚æœå†…éƒ¨å‡½æ•°ä¸­å­˜åœ¨æœ‰å¯¹å¤–éƒ¨å‡½æ•°å˜é‡æˆ–å‡½æ•°çš„è®¿é—®ï¼ˆå¯ä»¥ä¸æ˜¯è¢«å¼•ç”¨çš„å†…éƒ¨å‡½æ•°ï¼‰ï¼Œå¹¶ä¸”å­˜åœ¨æŸä¸ªæˆ–å¤šä¸ªå†…éƒ¨å‡½æ•°è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šå½¢æˆé—­åŒ…ï¼Œå¤–éƒ¨å‡½æ•°çš„å˜é‡å¯¹è±¡å°±ä¼šå­˜åœ¨äºé—­åŒ…å‡½æ•°çš„ä½œç”¨åŸŸé“¾ä¸­ã€‚è¿™æ ·ç¡®ä¿äº†é—­åŒ…å‡½æ•°æœ‰æƒè®¿é—®å¤–éƒ¨å‡½æ•°çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°ã€‚äº†è§£äº†é—®é¢˜äº§ç”Ÿçš„åŸå› ï¼Œä¾¿å¯ä»¥å¯¹ç—‡ä¸‹è¯äº†ã€‚å¯¹ä»£ç åšå¦‚ä¸‹ä¿®æ”¹ï¼š\n\n```js\n    function f() {\n      var str = Array(10000).join('#');\n      var foo = {\n        name: 'foo'\n      }\n      function unused() {\n        var message = 'it is only a test message';\n        // str = 'unused: ' + str; //åˆ é™¤è¯¥æ¡è¯­å¥\n      }\n      function getData() {\n        return 'data';\n      }\n      return getData;\n    }\n\n    var list = [];\n    \n    document.querySelector('#click_button').addEventListener('click', function () {\n      list.push(f());\n    }, false);\n```\n\ngetData()å’Œunused()å†…éƒ¨å‡½æ•°å…±äº«få‡½æ•°å¯¹åº”çš„å˜é‡å¯¹è±¡ï¼Œå› ä¸ºunused()å†…éƒ¨å‡½æ•°è®¿é—®äº†fä½œç”¨åŸŸå†…strå˜é‡ï¼Œæ‰€ä»¥strå­—æ®µå­˜åœ¨äºfå˜é‡å¯¹è±¡ä¸­ã€‚åŠ ä¸ŠgetData()å†…éƒ¨å‡½æ•°è¢«è¿”å›ï¼Œè¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œå½¢æˆäº†é—­åŒ…ï¼Œå› æ­¤å¯¹åº”çš„få˜é‡å¯¹è±¡å­˜åœ¨äºé—­åŒ…å‡½æ•°çš„ä½œç”¨åŸŸé“¾ä¸­ã€‚è¿™é‡Œåªè¦å°†å‡½æ•°unusedä¸­`str = 'unused: ' + str;`è¯­å¥åˆ é™¤ä¾¿å¯è§£å†³é—®é¢˜ã€‚\n\n![closure](./closure4.png)\n\næŸ¥çœ‹ä¸€ä¸‹é—­åŒ…ä¿¡æ¯ï¼š\n\n![closure](./closure5.png)\n\n## æ€»ç»“\né—­åŒ…æ˜¯JavaScriptä¸­å¾ˆé‡è¦çš„æ¦‚å¿µï¼Œç†è§£å¥½å®ƒå¯¹æˆ‘ä»¬æŒæ¡JavaScriptå¾ˆå…³é”®ã€‚ä¹Ÿè®¸ä½ ä¸ªäººè®¤ä¸ºä½ å¯¹å®ƒå¾ˆäº†è§£ï¼Œä½†å½“å› å®ƒäº§ç”Ÿé—®é¢˜æ—¶ï¼Œæ‰æ„Ÿæ‚Ÿè‡ªå·±å¯¹å®ƒäº†è§£ç”šå°‘ã€‚å¦‚æœ¬æ–‡æåˆ°ï¼š<u>**åœ¨ç›¸åŒä½œç”¨åŸŸå†…åˆ›å»ºçš„å¤šä¸ªå†…éƒ¨å‡½æ•°å¯¹è±¡æ˜¯å…±äº«åŒä¸€ä¸ªå˜é‡å¯¹è±¡**</u>ã€‚ä¸ç®¡æ€ä¹ˆæ ·å¸Œæœ›ä½ èƒ½ä»æœ¬æ–‡ä¸­æœ‰æ‰€æ”¶è·~ã€‚~\n\n## å‚è€ƒæ–‡ç« \n- [An interesting kind of JavaScript memory leak](https://blog.meteor.com/an-interesting-kind-of-javascript-memory-leak-8b47d2e7f156)\n- [Grokking V8 closures for fun (and profit?)](http://mrale.ph/blog/2012/09/23/grokking-v8-closures-for-fun.html)\n","slug":"å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹","published":1,"updated":"2018-08-22T08:06:45.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjl4vatak000c1hn9x1b4gpqr","content":"<p><img src=\"./closure.png\" alt=\"closure\"></p>\n<p>å½“ä¸€ä¸ªå‡½æ•°Aè¿”å›ä¸€ä¸ªå†…è”å‡½æ•°Bï¼Œå³ä½¿å‡½æ•°Aæ‰§è¡Œå®Œï¼Œå‡½æ•°Bä¹Ÿèƒ½è®¿é—®å‡½æ•°Aä½œç”¨åŸŸå†…çš„å˜é‡ã€‚è¿™å°±æ˜¯ä¸€ä¸ªé—­åŒ…â€”â€”â€”â€”â€”â€”æœ¬è´¨ä¸Šé—­åŒ…æ˜¯å°†å‡½æ•°å†…éƒ¨å’Œå¤–éƒ¨è¿æ¥èµ·æ¥çš„ä¸€åº§æ¡¥æ¢ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">message</span>) </span>&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">closure</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(message)</div><div class=\"line\">    &#125;;</div><div class=\"line\">    <span class=\"keyword\">return</span> closure;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// ä½¿ç”¨</span></div><div class=\"line\"><span class=\"keyword\">var</span> bar = foo(<span class=\"string\">\"hello closure!\"</span>);</div><div class=\"line\">bar()<span class=\"comment\">// è¿”å› 'hello closure!'</span></div></pre></td></tr></table></figure>\n<p>åœ¨å‡½æ•°fooå†…åˆ›å»ºçš„å‡½æ•°closureå¯¹è±¡æ˜¯ä¸èƒ½è¢«å›æ”¶æ‰çš„ï¼Œå› ä¸ºå®ƒè¢«å…¨å±€å˜é‡barå¼•ç”¨ï¼Œå¤„äºä¸€ç›´å¯è®¿é—®çŠ¶æ€ã€‚é€šè¿‡æ‰§è¡Œ<code>bar()</code>å¯ä»¥æ‰“å°å‡º<code>hello closure!</code>ã€‚å¦‚æœæƒ³é‡Šæ”¾æ‰å¯ä»¥å°†<code>bar = null</code>å³å¯ã€‚</p>\n<p><u><strong>ç”±äºé—­åŒ…ä¼šæºå¸¦åŒ…å«å®ƒçš„å‡½æ•°çš„ä½œç”¨åŸŸï¼Œå› æ­¤ä¼šæ¯”å…¶ä»–å‡½æ•°å ç”¨æ›´å¤šçš„å†…å­˜ã€‚è¿‡åº¦ä½¿ç”¨é—­åŒ…å¯èƒ½ä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡å¤šã€‚</strong></u></p>\n<h3 id=\"å®ä¾‹\"><a href=\"#å®ä¾‹\" class=\"headerlink\" title=\"å®ä¾‹\"></a>å®ä¾‹</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, initial-scale=1.0\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"ie=edge\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Closure<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>ä¸æ–­å•å‡»ã€clickã€‘æŒ‰é’®<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"click_button\"</span>&gt;</span>Click<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"undefined\"></span></div><div class=\"line\"><span class=\"javascript\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\"></span>) </span>&#123;</span></div><div class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">var</span> str = <span class=\"built_in\">Array</span>(<span class=\"number\">10000</span>).join(<span class=\"string\">'#'</span>);</span></div><div class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">var</span> foo = &#123;</span></div><div class=\"line\"><span class=\"javascript\">        name: <span class=\"string\">'foo'</span></span></div><div class=\"line\"><span class=\"undefined\">      &#125;</span></div><div class=\"line\"><span class=\"javascript\">      <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">unused</span>(<span class=\"params\"></span>) </span>&#123;</span></div><div class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> message = <span class=\"string\">'it is only a test message'</span>;</span></div><div class=\"line\"><span class=\"javascript\">        str = <span class=\"string\">'unused: '</span> + str;</span></div><div class=\"line\"><span class=\"undefined\">      &#125;</span></div><div class=\"line\"><span class=\"javascript\">      <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getData</span>(<span class=\"params\"></span>) </span>&#123;</span></div><div class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">return</span> <span class=\"string\">'data'</span>;</span></div><div class=\"line\"><span class=\"undefined\">      &#125;</span></div><div class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">return</span> getData;</span></div><div class=\"line\"><span class=\"undefined\">    &#125;</span></div><div class=\"line\"><span class=\"undefined\"></span></div><div class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> list = [];</span></div><div class=\"line\"><span class=\"undefined\">    </span></div><div class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'#click_button'</span>).addEventListener(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></div><div class=\"line\"><span class=\"undefined\">      list.push(f());</span></div><div class=\"line\"><span class=\"javascript\">    &#125;, <span class=\"literal\">false</span>);</span></div><div class=\"line\"><span class=\"undefined\">  </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>è¿™é‡Œç»“åˆChromeçš„Devtools-&gt;Memoryå·¥å…·è¿›è¡Œåˆ†æï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<p><u><strong>æ³¨ï¼šæœ€å¥½åœ¨éšèº«çª—å£ä¸­è¿›è¡Œåˆ†æå·¥ä½œï¼Œé¿å…æµè§ˆå™¨æ’ä»¶å½±å“åˆ†æç»“æœ</strong></u></p>\n<ol>\n<li>é€‰ä¸­ã€Record allocation timelineã€‘é€‰é¡¹</li>\n<li>æ‰§è¡Œä¸€æ¬¡CG</li>\n<li>å•å‡»ã€startã€‘æŒ‰é’®å¼€å§‹è®°å½•å †åˆ†æ</li>\n<li>è¿ç»­å•å‡»ã€clickã€‘æŒ‰é’®åå¤šæ¬¡</li>\n<li>åœæ­¢è®°å½•å †åˆ†æ</li>\n</ol>\n<p><img src=\"./closure1.png\" alt=\"closure\"></p>\n<p>ä¸Šå›¾ä¸­è“è‰²æŸ±å½¢æ¡è¡¨ç¤ºéšç€æ—¶é—´æ–°åˆ†é…çš„å†…å­˜ã€‚é€‰ä¸­å…¶ä¸­æŸæ¡è“è‰²æŸ±å½¢æ¡ï¼Œè¿‡æ»¤å‡ºå¯¹åº”æ–°åˆ†é…çš„å¯¹è±¡ï¼š</p>\n<p><img src=\"./closure2.png\" alt=\"closure\"></p>\n<p>æŸ¥çœ‹å¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯ï¼š</p>\n<p><img src=\"./closure3.png\" alt=\"closure\"></p>\n<p>ä»å›¾å¯çŸ¥ï¼Œåœ¨è¿”å›çš„é—­åŒ…ä½œç”¨é“¾(Scopes)ä¸­æºå¸¦æœ‰å®ƒæ‰€åœ¨å‡½æ•°çš„ä½œç”¨åŸŸï¼Œä½œç”¨åŸŸä¸­è¿˜åŒ…å«ä¸€ä¸ªstrå­—æ®µã€‚è€Œstrå­—æ®µå¹¶æ²¡æœ‰åœ¨è¿”å›getData()ä¸­ä½¿ç”¨è¿‡ã€‚ä¸ºä»€ä¹ˆä¼šå­˜åœ¨åœ¨ä½œç”¨åŸŸä¸­ï¼ŒæŒ‰ç†åº”è¯¥è¢«GCå›æ”¶æ‰çš„ï¼Ÿ</p>\n<p>åŸå› æ˜¯åœ¨ç›¸åŒä½œç”¨åŸŸå†…åˆ›å»ºçš„å¤šä¸ªå†…éƒ¨å‡½æ•°å¯¹è±¡æ˜¯å…±äº«åŒä¸€ä¸ª<a href=\"http://dmitrysoshnikov.com/ecmascript/chapter-2-variable-object/\" target=\"_blank\" rel=\"external\">å˜é‡å¯¹è±¡ï¼ˆvariable objectï¼‰</a>ã€‚å¦‚æœåˆ›å»ºçš„å†…éƒ¨å‡½æ•°æ²¡æœ‰è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œä¸ç®¡å†…éƒ¨å‡½æ•°æ˜¯å¦å¼•ç”¨å¤–éƒ¨å‡½æ•°çš„å˜é‡å’Œå‡½æ•°ï¼Œåœ¨å¤–éƒ¨å‡½æ•°æ‰§è¡Œå®Œï¼Œå¯¹åº”å˜é‡å¯¹è±¡ä¾¿ä¼šè¢«é”€æ¯ã€‚åä¹‹ï¼Œå¦‚æœå†…éƒ¨å‡½æ•°ä¸­å­˜åœ¨æœ‰å¯¹å¤–éƒ¨å‡½æ•°å˜é‡æˆ–å‡½æ•°çš„è®¿é—®ï¼ˆå¯ä»¥ä¸æ˜¯è¢«å¼•ç”¨çš„å†…éƒ¨å‡½æ•°ï¼‰ï¼Œå¹¶ä¸”å­˜åœ¨æŸä¸ªæˆ–å¤šä¸ªå†…éƒ¨å‡½æ•°è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šå½¢æˆé—­åŒ…ï¼Œå¤–éƒ¨å‡½æ•°çš„å˜é‡å¯¹è±¡å°±ä¼šå­˜åœ¨äºé—­åŒ…å‡½æ•°çš„ä½œç”¨åŸŸé“¾ä¸­ã€‚è¿™æ ·ç¡®ä¿äº†é—­åŒ…å‡½æ•°æœ‰æƒè®¿é—®å¤–éƒ¨å‡½æ•°çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°ã€‚äº†è§£äº†é—®é¢˜äº§ç”Ÿçš„åŸå› ï¼Œä¾¿å¯ä»¥å¯¹ç—‡ä¸‹è¯äº†ã€‚å¯¹ä»£ç åšå¦‚ä¸‹ä¿®æ”¹ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">  <span class=\"keyword\">var</span> str = <span class=\"built_in\">Array</span>(<span class=\"number\">10000</span>).join(<span class=\"string\">'#'</span>);</div><div class=\"line\">  <span class=\"keyword\">var</span> foo = &#123;</div><div class=\"line\">    name: <span class=\"string\">'foo'</span></div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">unused</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> message = <span class=\"string\">'it is only a test message'</span>;</div><div class=\"line\">    <span class=\"comment\">// str = 'unused: ' + str; //åˆ é™¤è¯¥æ¡è¯­å¥</span></div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getData</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'data'</span>;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">return</span> getData;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> list = [];</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'#click_button'</span>).addEventListener(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">  list.push(f());</div><div class=\"line\">&#125;, <span class=\"literal\">false</span>);</div></pre></td></tr></table></figure>\n<p>getData()å’Œunused()å†…éƒ¨å‡½æ•°å…±äº«få‡½æ•°å¯¹åº”çš„å˜é‡å¯¹è±¡ï¼Œå› ä¸ºunused()å†…éƒ¨å‡½æ•°è®¿é—®äº†fä½œç”¨åŸŸå†…strå˜é‡ï¼Œæ‰€ä»¥strå­—æ®µå­˜åœ¨äºfå˜é‡å¯¹è±¡ä¸­ã€‚åŠ ä¸ŠgetData()å†…éƒ¨å‡½æ•°è¢«è¿”å›ï¼Œè¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œå½¢æˆäº†é—­åŒ…ï¼Œå› æ­¤å¯¹åº”çš„få˜é‡å¯¹è±¡å­˜åœ¨äºé—­åŒ…å‡½æ•°çš„ä½œç”¨åŸŸé“¾ä¸­ã€‚è¿™é‡Œåªè¦å°†å‡½æ•°unusedä¸­<code>str = &#39;unused: &#39; + str;</code>è¯­å¥åˆ é™¤ä¾¿å¯è§£å†³é—®é¢˜ã€‚</p>\n<p><img src=\"./closure4.png\" alt=\"closure\"></p>\n<p>æŸ¥çœ‹ä¸€ä¸‹é—­åŒ…ä¿¡æ¯ï¼š</p>\n<p><img src=\"./closure5.png\" alt=\"closure\"></p>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>é—­åŒ…æ˜¯JavaScriptä¸­å¾ˆé‡è¦çš„æ¦‚å¿µï¼Œç†è§£å¥½å®ƒå¯¹æˆ‘ä»¬æŒæ¡JavaScriptå¾ˆå…³é”®ã€‚ä¹Ÿè®¸ä½ ä¸ªäººè®¤ä¸ºä½ å¯¹å®ƒå¾ˆäº†è§£ï¼Œä½†å½“å› å®ƒäº§ç”Ÿé—®é¢˜æ—¶ï¼Œæ‰æ„Ÿæ‚Ÿè‡ªå·±å¯¹å®ƒäº†è§£ç”šå°‘ã€‚å¦‚æœ¬æ–‡æåˆ°ï¼š<u><strong>åœ¨ç›¸åŒä½œç”¨åŸŸå†…åˆ›å»ºçš„å¤šä¸ªå†…éƒ¨å‡½æ•°å¯¹è±¡æ˜¯å…±äº«åŒä¸€ä¸ªå˜é‡å¯¹è±¡</strong></u>ã€‚ä¸ç®¡æ€ä¹ˆæ ·å¸Œæœ›ä½ èƒ½ä»æœ¬æ–‡ä¸­æœ‰æ‰€æ”¶è·~ã€‚~</p>\n<h2 id=\"å‚è€ƒæ–‡ç« \"><a href=\"#å‚è€ƒæ–‡ç« \" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« \"></a>å‚è€ƒæ–‡ç« </h2><ul>\n<li><a href=\"https://blog.meteor.com/an-interesting-kind-of-javascript-memory-leak-8b47d2e7f156\" target=\"_blank\" rel=\"external\">An interesting kind of JavaScript memory leak</a></li>\n<li><a href=\"http://mrale.ph/blog/2012/09/23/grokking-v8-closures-for-fun.html\" target=\"_blank\" rel=\"external\">Grokking V8 closures for fun (and profit?)</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"./closure.png\" alt=\"closure\"></p>\n<p>å½“ä¸€ä¸ªå‡½æ•°Aè¿”å›ä¸€ä¸ªå†…è”å‡½æ•°Bï¼Œå³ä½¿å‡½æ•°Aæ‰§è¡Œå®Œï¼Œå‡½æ•°Bä¹Ÿèƒ½è®¿é—®å‡½æ•°Aä½œç”¨åŸŸå†…çš„å˜é‡ã€‚è¿™å°±æ˜¯ä¸€ä¸ªé—­åŒ…â€”â€”â€”â€”â€”â€”æœ¬è´¨ä¸Šé—­åŒ…æ˜¯å°†å‡½æ•°å†…éƒ¨å’Œå¤–éƒ¨è¿æ¥èµ·æ¥çš„ä¸€åº§æ¡¥æ¢ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">message</span>) </span>&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">closure</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(message)</div><div class=\"line\">    &#125;;</div><div class=\"line\">    <span class=\"keyword\">return</span> closure;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// ä½¿ç”¨</span></div><div class=\"line\"><span class=\"keyword\">var</span> bar = foo(<span class=\"string\">\"hello closure!\"</span>);</div><div class=\"line\">bar()<span class=\"comment\">// è¿”å› 'hello closure!'</span></div></pre></td></tr></table></figure>\n<p>åœ¨å‡½æ•°fooå†…åˆ›å»ºçš„å‡½æ•°closureå¯¹è±¡æ˜¯ä¸èƒ½è¢«å›æ”¶æ‰çš„ï¼Œå› ä¸ºå®ƒè¢«å…¨å±€å˜é‡barå¼•ç”¨ï¼Œå¤„äºä¸€ç›´å¯è®¿é—®çŠ¶æ€ã€‚é€šè¿‡æ‰§è¡Œ<code>bar()</code>å¯ä»¥æ‰“å°å‡º<code>hello closure!</code>ã€‚å¦‚æœæƒ³é‡Šæ”¾æ‰å¯ä»¥å°†<code>bar = null</code>å³å¯ã€‚</p>\n<p><u><strong>ç”±äºé—­åŒ…ä¼šæºå¸¦åŒ…å«å®ƒçš„å‡½æ•°çš„ä½œç”¨åŸŸï¼Œå› æ­¤ä¼šæ¯”å…¶ä»–å‡½æ•°å ç”¨æ›´å¤šçš„å†…å­˜ã€‚è¿‡åº¦ä½¿ç”¨é—­åŒ…å¯èƒ½ä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡å¤šã€‚</strong></u></p>\n<h3 id=\"å®ä¾‹\"><a href=\"#å®ä¾‹\" class=\"headerlink\" title=\"å®ä¾‹\"></a>å®ä¾‹</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, initial-scale=1.0\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"ie=edge\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Closure<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>ä¸æ–­å•å‡»ã€clickã€‘æŒ‰é’®<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"click_button\"</span>&gt;</span>Click<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"undefined\"></span></div><div class=\"line\"><span class=\"javascript\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\"></span>) </span>&#123;</span></div><div class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">var</span> str = <span class=\"built_in\">Array</span>(<span class=\"number\">10000</span>).join(<span class=\"string\">'#'</span>);</span></div><div class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">var</span> foo = &#123;</span></div><div class=\"line\"><span class=\"javascript\">        name: <span class=\"string\">'foo'</span></span></div><div class=\"line\"><span class=\"undefined\">      &#125;</span></div><div class=\"line\"><span class=\"javascript\">      <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">unused</span>(<span class=\"params\"></span>) </span>&#123;</span></div><div class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> message = <span class=\"string\">'it is only a test message'</span>;</span></div><div class=\"line\"><span class=\"javascript\">        str = <span class=\"string\">'unused: '</span> + str;</span></div><div class=\"line\"><span class=\"undefined\">      &#125;</span></div><div class=\"line\"><span class=\"javascript\">      <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getData</span>(<span class=\"params\"></span>) </span>&#123;</span></div><div class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">return</span> <span class=\"string\">'data'</span>;</span></div><div class=\"line\"><span class=\"undefined\">      &#125;</span></div><div class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">return</span> getData;</span></div><div class=\"line\"><span class=\"undefined\">    &#125;</span></div><div class=\"line\"><span class=\"undefined\"></span></div><div class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> list = [];</span></div><div class=\"line\"><span class=\"undefined\">    </span></div><div class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'#click_button'</span>).addEventListener(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></div><div class=\"line\"><span class=\"undefined\">      list.push(f());</span></div><div class=\"line\"><span class=\"javascript\">    &#125;, <span class=\"literal\">false</span>);</span></div><div class=\"line\"><span class=\"undefined\">  </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>è¿™é‡Œç»“åˆChromeçš„Devtools-&gt;Memoryå·¥å…·è¿›è¡Œåˆ†æï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<p><u><strong>æ³¨ï¼šæœ€å¥½åœ¨éšèº«çª—å£ä¸­è¿›è¡Œåˆ†æå·¥ä½œï¼Œé¿å…æµè§ˆå™¨æ’ä»¶å½±å“åˆ†æç»“æœ</strong></u></p>\n<ol>\n<li>é€‰ä¸­ã€Record allocation timelineã€‘é€‰é¡¹</li>\n<li>æ‰§è¡Œä¸€æ¬¡CG</li>\n<li>å•å‡»ã€startã€‘æŒ‰é’®å¼€å§‹è®°å½•å †åˆ†æ</li>\n<li>è¿ç»­å•å‡»ã€clickã€‘æŒ‰é’®åå¤šæ¬¡</li>\n<li>åœæ­¢è®°å½•å †åˆ†æ</li>\n</ol>\n<p><img src=\"./closure1.png\" alt=\"closure\"></p>\n<p>ä¸Šå›¾ä¸­è“è‰²æŸ±å½¢æ¡è¡¨ç¤ºéšç€æ—¶é—´æ–°åˆ†é…çš„å†…å­˜ã€‚é€‰ä¸­å…¶ä¸­æŸæ¡è“è‰²æŸ±å½¢æ¡ï¼Œè¿‡æ»¤å‡ºå¯¹åº”æ–°åˆ†é…çš„å¯¹è±¡ï¼š</p>\n<p><img src=\"./closure2.png\" alt=\"closure\"></p>\n<p>æŸ¥çœ‹å¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯ï¼š</p>\n<p><img src=\"./closure3.png\" alt=\"closure\"></p>\n<p>ä»å›¾å¯çŸ¥ï¼Œåœ¨è¿”å›çš„é—­åŒ…ä½œç”¨é“¾(Scopes)ä¸­æºå¸¦æœ‰å®ƒæ‰€åœ¨å‡½æ•°çš„ä½œç”¨åŸŸï¼Œä½œç”¨åŸŸä¸­è¿˜åŒ…å«ä¸€ä¸ªstrå­—æ®µã€‚è€Œstrå­—æ®µå¹¶æ²¡æœ‰åœ¨è¿”å›getData()ä¸­ä½¿ç”¨è¿‡ã€‚ä¸ºä»€ä¹ˆä¼šå­˜åœ¨åœ¨ä½œç”¨åŸŸä¸­ï¼ŒæŒ‰ç†åº”è¯¥è¢«GCå›æ”¶æ‰çš„ï¼Ÿ</p>\n<p>åŸå› æ˜¯åœ¨ç›¸åŒä½œç”¨åŸŸå†…åˆ›å»ºçš„å¤šä¸ªå†…éƒ¨å‡½æ•°å¯¹è±¡æ˜¯å…±äº«åŒä¸€ä¸ª<a href=\"http://dmitrysoshnikov.com/ecmascript/chapter-2-variable-object/\" target=\"_blank\" rel=\"external\">å˜é‡å¯¹è±¡ï¼ˆvariable objectï¼‰</a>ã€‚å¦‚æœåˆ›å»ºçš„å†…éƒ¨å‡½æ•°æ²¡æœ‰è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œä¸ç®¡å†…éƒ¨å‡½æ•°æ˜¯å¦å¼•ç”¨å¤–éƒ¨å‡½æ•°çš„å˜é‡å’Œå‡½æ•°ï¼Œåœ¨å¤–éƒ¨å‡½æ•°æ‰§è¡Œå®Œï¼Œå¯¹åº”å˜é‡å¯¹è±¡ä¾¿ä¼šè¢«é”€æ¯ã€‚åä¹‹ï¼Œå¦‚æœå†…éƒ¨å‡½æ•°ä¸­å­˜åœ¨æœ‰å¯¹å¤–éƒ¨å‡½æ•°å˜é‡æˆ–å‡½æ•°çš„è®¿é—®ï¼ˆå¯ä»¥ä¸æ˜¯è¢«å¼•ç”¨çš„å†…éƒ¨å‡½æ•°ï¼‰ï¼Œå¹¶ä¸”å­˜åœ¨æŸä¸ªæˆ–å¤šä¸ªå†…éƒ¨å‡½æ•°è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šå½¢æˆé—­åŒ…ï¼Œå¤–éƒ¨å‡½æ•°çš„å˜é‡å¯¹è±¡å°±ä¼šå­˜åœ¨äºé—­åŒ…å‡½æ•°çš„ä½œç”¨åŸŸé“¾ä¸­ã€‚è¿™æ ·ç¡®ä¿äº†é—­åŒ…å‡½æ•°æœ‰æƒè®¿é—®å¤–éƒ¨å‡½æ•°çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°ã€‚äº†è§£äº†é—®é¢˜äº§ç”Ÿçš„åŸå› ï¼Œä¾¿å¯ä»¥å¯¹ç—‡ä¸‹è¯äº†ã€‚å¯¹ä»£ç åšå¦‚ä¸‹ä¿®æ”¹ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">  <span class=\"keyword\">var</span> str = <span class=\"built_in\">Array</span>(<span class=\"number\">10000</span>).join(<span class=\"string\">'#'</span>);</div><div class=\"line\">  <span class=\"keyword\">var</span> foo = &#123;</div><div class=\"line\">    name: <span class=\"string\">'foo'</span></div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">unused</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> message = <span class=\"string\">'it is only a test message'</span>;</div><div class=\"line\">    <span class=\"comment\">// str = 'unused: ' + str; //åˆ é™¤è¯¥æ¡è¯­å¥</span></div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getData</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'data'</span>;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">return</span> getData;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> list = [];</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'#click_button'</span>).addEventListener(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">  list.push(f());</div><div class=\"line\">&#125;, <span class=\"literal\">false</span>);</div></pre></td></tr></table></figure>\n<p>getData()å’Œunused()å†…éƒ¨å‡½æ•°å…±äº«få‡½æ•°å¯¹åº”çš„å˜é‡å¯¹è±¡ï¼Œå› ä¸ºunused()å†…éƒ¨å‡½æ•°è®¿é—®äº†fä½œç”¨åŸŸå†…strå˜é‡ï¼Œæ‰€ä»¥strå­—æ®µå­˜åœ¨äºfå˜é‡å¯¹è±¡ä¸­ã€‚åŠ ä¸ŠgetData()å†…éƒ¨å‡½æ•°è¢«è¿”å›ï¼Œè¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œå½¢æˆäº†é—­åŒ…ï¼Œå› æ­¤å¯¹åº”çš„få˜é‡å¯¹è±¡å­˜åœ¨äºé—­åŒ…å‡½æ•°çš„ä½œç”¨åŸŸé“¾ä¸­ã€‚è¿™é‡Œåªè¦å°†å‡½æ•°unusedä¸­<code>str = &#39;unused: &#39; + str;</code>è¯­å¥åˆ é™¤ä¾¿å¯è§£å†³é—®é¢˜ã€‚</p>\n<p><img src=\"./closure4.png\" alt=\"closure\"></p>\n<p>æŸ¥çœ‹ä¸€ä¸‹é—­åŒ…ä¿¡æ¯ï¼š</p>\n<p><img src=\"./closure5.png\" alt=\"closure\"></p>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>é—­åŒ…æ˜¯JavaScriptä¸­å¾ˆé‡è¦çš„æ¦‚å¿µï¼Œç†è§£å¥½å®ƒå¯¹æˆ‘ä»¬æŒæ¡JavaScriptå¾ˆå…³é”®ã€‚ä¹Ÿè®¸ä½ ä¸ªäººè®¤ä¸ºä½ å¯¹å®ƒå¾ˆäº†è§£ï¼Œä½†å½“å› å®ƒäº§ç”Ÿé—®é¢˜æ—¶ï¼Œæ‰æ„Ÿæ‚Ÿè‡ªå·±å¯¹å®ƒäº†è§£ç”šå°‘ã€‚å¦‚æœ¬æ–‡æåˆ°ï¼š<u><strong>åœ¨ç›¸åŒä½œç”¨åŸŸå†…åˆ›å»ºçš„å¤šä¸ªå†…éƒ¨å‡½æ•°å¯¹è±¡æ˜¯å…±äº«åŒä¸€ä¸ªå˜é‡å¯¹è±¡</strong></u>ã€‚ä¸ç®¡æ€ä¹ˆæ ·å¸Œæœ›ä½ èƒ½ä»æœ¬æ–‡ä¸­æœ‰æ‰€æ”¶è·~ã€‚~</p>\n<h2 id=\"å‚è€ƒæ–‡ç« \"><a href=\"#å‚è€ƒæ–‡ç« \" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« \"></a>å‚è€ƒæ–‡ç« </h2><ul>\n<li><a href=\"https://blog.meteor.com/an-interesting-kind-of-javascript-memory-leak-8b47d2e7f156\" target=\"_blank\" rel=\"external\">An interesting kind of JavaScript memory leak</a></li>\n<li><a href=\"http://mrale.ph/blog/2012/09/23/grokking-v8-closures-for-fun.html\" target=\"_blank\" rel=\"external\">Grokking V8 closures for fun (and profit?)</a></li>\n</ul>\n"},{"title":"å†…å­˜æ³„éœ²ä¹‹Listeners","date":"2017-11-01T04:59:04.000Z","author":"singsong","_content":"\né¡µé¢ä¸­äº‹ä»¶ç»‘å®šæ•°é‡ä¼šç›´æ¥å½±å“é¡µé¢çš„æ•´ä½“è¿è¡Œæ€§èƒ½ï¼Œå› ä¸ºæ¯ä¸ªäº‹ä»¶çš„å›è°ƒå¤„ç†å‡½æ•°éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå ç”¨ä¸€å®šçš„å†…å­˜ã€‚å¦‚æœäº‹ä»¶çš„ç»‘å®šæ•°é‡è¶Šå¤šï¼Œå†…å­˜ä¹Ÿéšä¹‹å¢åŠ ã€‚å¦å¤–ï¼Œå›è°ƒå¤„ç†å‡½æ•°éœ€è¦ä¸DOMèŠ‚ç‚¹è¿›è¡Œäº¤äº’ï¼Œè€ŒJSå¼•æ“ç‹¬ç«‹äºæ¸²æŸ“å¼•æ“ï¼Œè€ŒDOMæ˜¯ä½äºæ¸²æŸ“å¼•æ“ï¼Œç›¸äº’è®¿é—®éœ€è¦æ¶ˆè€—ä¸€å®šçš„èµ„æºã€‚åŠ ä¸Šæ“ä½œDOMï¼Œä¼šå¼•èµ·æµè§ˆå™¨çš„é‡æ’æˆ–é‡ç»˜ï¼Œè€Œå½±å“é¡µé¢çš„æ•´ä½“æ€§èƒ½ã€‚\n\n> äº‹ä»¶ä»£ç† (äº‹ä»¶å§”æ‰˜) åˆ©ç”¨äº†äº‹ä»¶å†’æ³¡ï¼ŒåªæŒ‡å®šä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Œå°±å¯ä»¥ç®¡ç†æŸä¸€ç±»å‹çš„æ‰€æœ‰äº‹ä»¶ã€‚\n\nå› æ­¤å¦‚ä½•æ§åˆ¶äº‹ä»¶ç»‘å®šæ•°é‡å°±å¾ˆé‡è¦äº†ï¼Œé€šå¸¸éƒ½æ˜¯é€šè¿‡äº‹ä»¶ä»£ç†ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰æ¥è§£å†³ç±»ä¼¼çš„é—®é¢˜ã€‚ä¸è¿‡æœ‰æ—¶å€ŸåŠ©äº†äº‹ä»¶ä»£ç†ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰ï¼Œè€Œé¡µé¢çš„äº‹ä»¶ç»‘å®šæ•°é‡ä¹Ÿåœ¨ä¸æ–­åœ°å¢åŠ ï¼Ÿè¿™å¯èƒ½æ˜¯æŸäº›â€œä¸å¥½â€ä»£ç å¯¼è‡´çš„ï¼Œé‚£å¦‚ä½•å®šä½å¢åŠ çš„åŸå› å°±æ˜¾å¾—å¾ˆå…³é”®äº†ã€‚è¿™é‡Œå¯ä»¥é€šè¿‡chromeçš„**DevTools**æ¥è¾…åŠ©è¯Šæ–­ã€‚\n\n## DevTools\n\n### å¦‚ä½•åˆ¤æ–­é¡µé¢çš„äº‹ä»¶ç»‘å®šæ•°é‡åœ¨å¢åŠ ï¼š\n 1. æ‰“å¼€DevTools->Performanceï¼Œå•å‡»ã€è®°å½•æŒ‰é’®ã€‘å¼€å§‹è®°å½•é¡µé¢ç›¸å…³performanceæ•°æ®ã€‚æ¥ç€å•å‡»ã€åƒåœ¾å›æ”¶æŒ‰é’®ã€‘ï¼Œè¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œåˆ›å»ºåŸºå‡†å‚è€ƒçº¿ã€‚\n 2. è¿›è¡Œå¯èƒ½å¼•èµ·äº‹ä»¶ç»‘å®šæ•°é‡å¢åŠ çš„æ“ä½œã€‚\n 3. å•å‡»ã€stopã€‘æŒ‰é’®ï¼Œåœæ­¢è®°å½•ã€‚\n\n![performance](listeners_performance.png)\n\n### å¦‚ä½•å®šä½äº‹ä»¶ç»‘å®šæ•°é‡çš„å¢åŠ ï¼š\n1. æ‰“å¼€DevTools->Elementsï¼ŒæŸ¥çœ‹é¡µé¢ä¸­ç»‘å®šäº‹ä»¶çš„å…ƒç´ ã€‚\n\n![listeners](listeners_event.png)\n\n\n## å®æˆ˜\n\båŒåä¸€å¿«åˆ°äº†ï¼Œå„ç§tmallæ´»åŠ¨å°±å¤šèµ·æ¥äº†ã€‚åœ¨åšä¸€ä¸ªtmallåŠ¨æ€çš®è‚¤æ—¶ï¼Œéœ€è¦åœ¨windowå¤§å°å˜åŒ–æ—¶å°†ä¹‹å‰æ„å»ºçš„ç»“æ„é”€æ¯ï¼Œç„¶åå†é‡æ–°è®¡ç®—æ„å»ºã€‚å› ä¸ºåœ¨é”€æ¯æ—¶ï¼Œæœªè§£ç»‘å¯¹åº”çš„äº‹ä»¶ã€‚å¯¼è‡´åœ¨windowè§¦å‘resizeæ—¶ï¼ŒæŸä¸ªå…ƒç´ çš„äº‹ä»¶ç»‘å®šæ•°é‡ä¸æ–­å¢åŠ ã€‚å…³é”®ä»£ç å¦‚ä¸‹ï¼š\n\n```js\n  var tmallskin = {\n    init: function() {\n      //......\n      this.bindEvent();\n    },\n    destroy: function() {\n      if (this.element.length > 0) {\n        this.container.off(\"click.tmallskin\");//è¯¥è¯­å¥å¯ä»¥ä¸ç”¨ï¼Œå› ä¸ºåœ¨element.removeæ—¶ä¼šè§£é™¤elementä¸Šç»‘å®šçš„äº‹ä»¶\n        this.element.remove();\n      }\n    }\n   // ç»‘å®šé€»è¾‘\n   bindEvent: function() {\n      var context = this;\n      this.container.on(\"click.tmallskin\", \".tmallskin-close\",function() {\n        //.... \n      });\n\n      var timer = null;\n      $(window).on(\"resize.tmallskin\", function() {\n        if (timer) {\n          clearTimeout(timer);\n        }\n        timer = setTimeout(function() {\n          // çª—å£å¤§å°å˜åŒ–æ—¶ï¼Œä¼šä¸æ–­æ‰§è¡Œdestroyï¼Œinit\n          context.destroy();\n          context.init();\n          timer = null;\n        }, 400);\n      });\n      // å› ä¸ºæœªåœ¨destroyä¸­è§£é™¤è¯¥ç»‘å®šï¼Œåœ¨windowè§¦å‘resizeæ—¶ï¼Œä¼šä¸æ–­åœ°ç»‘å®š\n      $(\".m-skin\").on(\"click.tmallskin\", \".grey, .reset\", function() {\n        o._JS.SK[\"1\"].init();\n      });\n    }\n  };\n```\nä¸Šè¿°codeä¸­ï¼Œå› ä¸ºåœ¨destroyæ–¹æ³•ä¸­æœªå¯¹`$(\".m-skin\")`å…ƒç´ ä¸Šç»‘å®šçš„äº‹ä»¶è¿›è¡Œè§£é™¤ï¼Œå¯¼è‡´åœ¨windowè§¦å‘resizeæ—¶ï¼Œä¸æ–­è¿›è¡Œç»‘å®šã€‚\n\n- DevToolsè¯Šæ–­æˆªå›¾å¦‚ä¸‹ï¼š\n\n![resize](listeners_resize.png)\n\n- resizeä¹‹åï¼š\n\n![resize](listeners_resize_after.png)\n\n- å•å‡»å³ä¾§å®šä½é“¾æ¥`(index):42`ï¼š\n\n![location](listener_location.png)\n\n\n### çŸ¥é“é—®é¢˜çš„åŸå› ï¼Œä¿®å¤ä»£ç å¦‚ä¸‹ï¼š\n\n```js\n    //.....\n    destroy: function() {\n      if (this.element.length > 0) {\n        this.container.off(\"click.tmallskin\");\n        $(\".m-skin\").off(\"click.tmallskin\");//é”€æ¯æ—¶è§£é™¤ç»‘å®š\n        $(window).off(\"resize.tmallskin\");\n        this.element.remove();\n      }\n    },\n    //.....\n```\næ•ˆæœæˆªå›¾ï¼š\n\n![fixed](listeners_fixed.png)\n\n\n## æ€»ç»“\nå¯èƒ½åœ¨å®è·µç¼–ç ä¸­ï¼Œå¾ˆå°‘å…³æ³¨ä¸»åŠ¨è§£é™¤äº‹ä»¶ç»‘å®šã€‚å¦‚å¸¸ç”¨çš„Jqueryåº“ï¼Œä¼šåœ¨å…ƒç´ åˆ é™¤æ—¶ï¼Œè‡ªåŠ¨è§£é™¤å…ƒç´ ä¸Šç»‘å®šçš„äº‹ä»¶ã€‚ä¸è¿‡éš¾å…å­˜åœ¨æŸäº›æƒ…å†µï¼ŒJqueryä¹Ÿæ— èƒ½æ— åŠ›ï¼Œè¿™æ—¶éœ€è¦æˆ‘ä»¬ä¸»åŠ¨è¿›è¡Œè§£ç»‘ï¼Œå› ä¸ºè¿‡å¤šçš„äº‹ä»¶ç»‘å®šä¼šç›´æ¥å½±å“é¡µé¢çš„æ•´ä½“æ€§èƒ½ã€‚å› æ­¤äº†è§£å¦‚ä½•è¯Šæ–­äº‹ä»¶ç»‘å®šçš„å¢åŠ æ˜¯å¾ˆé‡è¦çš„ï¼Œä¹Ÿå¸Œæœ›æœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚","source":"_posts/å†…å­˜æ³„éœ²ä¹‹Listeners.md","raw":"---\ntitle: å†…å­˜æ³„éœ²ä¹‹Listeners\ndate: 2017-11-01 12:59:04\ntags: [listeners, ä¼˜åŒ–, å†…å­˜æ³„éœ²]\nauthor: singsong\n---\n\né¡µé¢ä¸­äº‹ä»¶ç»‘å®šæ•°é‡ä¼šç›´æ¥å½±å“é¡µé¢çš„æ•´ä½“è¿è¡Œæ€§èƒ½ï¼Œå› ä¸ºæ¯ä¸ªäº‹ä»¶çš„å›è°ƒå¤„ç†å‡½æ•°éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå ç”¨ä¸€å®šçš„å†…å­˜ã€‚å¦‚æœäº‹ä»¶çš„ç»‘å®šæ•°é‡è¶Šå¤šï¼Œå†…å­˜ä¹Ÿéšä¹‹å¢åŠ ã€‚å¦å¤–ï¼Œå›è°ƒå¤„ç†å‡½æ•°éœ€è¦ä¸DOMèŠ‚ç‚¹è¿›è¡Œäº¤äº’ï¼Œè€ŒJSå¼•æ“ç‹¬ç«‹äºæ¸²æŸ“å¼•æ“ï¼Œè€ŒDOMæ˜¯ä½äºæ¸²æŸ“å¼•æ“ï¼Œç›¸äº’è®¿é—®éœ€è¦æ¶ˆè€—ä¸€å®šçš„èµ„æºã€‚åŠ ä¸Šæ“ä½œDOMï¼Œä¼šå¼•èµ·æµè§ˆå™¨çš„é‡æ’æˆ–é‡ç»˜ï¼Œè€Œå½±å“é¡µé¢çš„æ•´ä½“æ€§èƒ½ã€‚\n\n> äº‹ä»¶ä»£ç† (äº‹ä»¶å§”æ‰˜) åˆ©ç”¨äº†äº‹ä»¶å†’æ³¡ï¼ŒåªæŒ‡å®šä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Œå°±å¯ä»¥ç®¡ç†æŸä¸€ç±»å‹çš„æ‰€æœ‰äº‹ä»¶ã€‚\n\nå› æ­¤å¦‚ä½•æ§åˆ¶äº‹ä»¶ç»‘å®šæ•°é‡å°±å¾ˆé‡è¦äº†ï¼Œé€šå¸¸éƒ½æ˜¯é€šè¿‡äº‹ä»¶ä»£ç†ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰æ¥è§£å†³ç±»ä¼¼çš„é—®é¢˜ã€‚ä¸è¿‡æœ‰æ—¶å€ŸåŠ©äº†äº‹ä»¶ä»£ç†ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰ï¼Œè€Œé¡µé¢çš„äº‹ä»¶ç»‘å®šæ•°é‡ä¹Ÿåœ¨ä¸æ–­åœ°å¢åŠ ï¼Ÿè¿™å¯èƒ½æ˜¯æŸäº›â€œä¸å¥½â€ä»£ç å¯¼è‡´çš„ï¼Œé‚£å¦‚ä½•å®šä½å¢åŠ çš„åŸå› å°±æ˜¾å¾—å¾ˆå…³é”®äº†ã€‚è¿™é‡Œå¯ä»¥é€šè¿‡chromeçš„**DevTools**æ¥è¾…åŠ©è¯Šæ–­ã€‚\n\n## DevTools\n\n### å¦‚ä½•åˆ¤æ–­é¡µé¢çš„äº‹ä»¶ç»‘å®šæ•°é‡åœ¨å¢åŠ ï¼š\n 1. æ‰“å¼€DevTools->Performanceï¼Œå•å‡»ã€è®°å½•æŒ‰é’®ã€‘å¼€å§‹è®°å½•é¡µé¢ç›¸å…³performanceæ•°æ®ã€‚æ¥ç€å•å‡»ã€åƒåœ¾å›æ”¶æŒ‰é’®ã€‘ï¼Œè¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œåˆ›å»ºåŸºå‡†å‚è€ƒçº¿ã€‚\n 2. è¿›è¡Œå¯èƒ½å¼•èµ·äº‹ä»¶ç»‘å®šæ•°é‡å¢åŠ çš„æ“ä½œã€‚\n 3. å•å‡»ã€stopã€‘æŒ‰é’®ï¼Œåœæ­¢è®°å½•ã€‚\n\n![performance](listeners_performance.png)\n\n### å¦‚ä½•å®šä½äº‹ä»¶ç»‘å®šæ•°é‡çš„å¢åŠ ï¼š\n1. æ‰“å¼€DevTools->Elementsï¼ŒæŸ¥çœ‹é¡µé¢ä¸­ç»‘å®šäº‹ä»¶çš„å…ƒç´ ã€‚\n\n![listeners](listeners_event.png)\n\n\n## å®æˆ˜\n\båŒåä¸€å¿«åˆ°äº†ï¼Œå„ç§tmallæ´»åŠ¨å°±å¤šèµ·æ¥äº†ã€‚åœ¨åšä¸€ä¸ªtmallåŠ¨æ€çš®è‚¤æ—¶ï¼Œéœ€è¦åœ¨windowå¤§å°å˜åŒ–æ—¶å°†ä¹‹å‰æ„å»ºçš„ç»“æ„é”€æ¯ï¼Œç„¶åå†é‡æ–°è®¡ç®—æ„å»ºã€‚å› ä¸ºåœ¨é”€æ¯æ—¶ï¼Œæœªè§£ç»‘å¯¹åº”çš„äº‹ä»¶ã€‚å¯¼è‡´åœ¨windowè§¦å‘resizeæ—¶ï¼ŒæŸä¸ªå…ƒç´ çš„äº‹ä»¶ç»‘å®šæ•°é‡ä¸æ–­å¢åŠ ã€‚å…³é”®ä»£ç å¦‚ä¸‹ï¼š\n\n```js\n  var tmallskin = {\n    init: function() {\n      //......\n      this.bindEvent();\n    },\n    destroy: function() {\n      if (this.element.length > 0) {\n        this.container.off(\"click.tmallskin\");//è¯¥è¯­å¥å¯ä»¥ä¸ç”¨ï¼Œå› ä¸ºåœ¨element.removeæ—¶ä¼šè§£é™¤elementä¸Šç»‘å®šçš„äº‹ä»¶\n        this.element.remove();\n      }\n    }\n   // ç»‘å®šé€»è¾‘\n   bindEvent: function() {\n      var context = this;\n      this.container.on(\"click.tmallskin\", \".tmallskin-close\",function() {\n        //.... \n      });\n\n      var timer = null;\n      $(window).on(\"resize.tmallskin\", function() {\n        if (timer) {\n          clearTimeout(timer);\n        }\n        timer = setTimeout(function() {\n          // çª—å£å¤§å°å˜åŒ–æ—¶ï¼Œä¼šä¸æ–­æ‰§è¡Œdestroyï¼Œinit\n          context.destroy();\n          context.init();\n          timer = null;\n        }, 400);\n      });\n      // å› ä¸ºæœªåœ¨destroyä¸­è§£é™¤è¯¥ç»‘å®šï¼Œåœ¨windowè§¦å‘resizeæ—¶ï¼Œä¼šä¸æ–­åœ°ç»‘å®š\n      $(\".m-skin\").on(\"click.tmallskin\", \".grey, .reset\", function() {\n        o._JS.SK[\"1\"].init();\n      });\n    }\n  };\n```\nä¸Šè¿°codeä¸­ï¼Œå› ä¸ºåœ¨destroyæ–¹æ³•ä¸­æœªå¯¹`$(\".m-skin\")`å…ƒç´ ä¸Šç»‘å®šçš„äº‹ä»¶è¿›è¡Œè§£é™¤ï¼Œå¯¼è‡´åœ¨windowè§¦å‘resizeæ—¶ï¼Œä¸æ–­è¿›è¡Œç»‘å®šã€‚\n\n- DevToolsè¯Šæ–­æˆªå›¾å¦‚ä¸‹ï¼š\n\n![resize](listeners_resize.png)\n\n- resizeä¹‹åï¼š\n\n![resize](listeners_resize_after.png)\n\n- å•å‡»å³ä¾§å®šä½é“¾æ¥`(index):42`ï¼š\n\n![location](listener_location.png)\n\n\n### çŸ¥é“é—®é¢˜çš„åŸå› ï¼Œä¿®å¤ä»£ç å¦‚ä¸‹ï¼š\n\n```js\n    //.....\n    destroy: function() {\n      if (this.element.length > 0) {\n        this.container.off(\"click.tmallskin\");\n        $(\".m-skin\").off(\"click.tmallskin\");//é”€æ¯æ—¶è§£é™¤ç»‘å®š\n        $(window).off(\"resize.tmallskin\");\n        this.element.remove();\n      }\n    },\n    //.....\n```\næ•ˆæœæˆªå›¾ï¼š\n\n![fixed](listeners_fixed.png)\n\n\n## æ€»ç»“\nå¯èƒ½åœ¨å®è·µç¼–ç ä¸­ï¼Œå¾ˆå°‘å…³æ³¨ä¸»åŠ¨è§£é™¤äº‹ä»¶ç»‘å®šã€‚å¦‚å¸¸ç”¨çš„Jqueryåº“ï¼Œä¼šåœ¨å…ƒç´ åˆ é™¤æ—¶ï¼Œè‡ªåŠ¨è§£é™¤å…ƒç´ ä¸Šç»‘å®šçš„äº‹ä»¶ã€‚ä¸è¿‡éš¾å…å­˜åœ¨æŸäº›æƒ…å†µï¼ŒJqueryä¹Ÿæ— èƒ½æ— åŠ›ï¼Œè¿™æ—¶éœ€è¦æˆ‘ä»¬ä¸»åŠ¨è¿›è¡Œè§£ç»‘ï¼Œå› ä¸ºè¿‡å¤šçš„äº‹ä»¶ç»‘å®šä¼šç›´æ¥å½±å“é¡µé¢çš„æ•´ä½“æ€§èƒ½ã€‚å› æ­¤äº†è§£å¦‚ä½•è¯Šæ–­äº‹ä»¶ç»‘å®šçš„å¢åŠ æ˜¯å¾ˆé‡è¦çš„ï¼Œä¹Ÿå¸Œæœ›æœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚","slug":"å†…å­˜æ³„éœ²ä¹‹Listeners","published":1,"updated":"2018-08-22T08:06:45.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjl4vatal000d1hn9kh575zzi","content":"<p>é¡µé¢ä¸­äº‹ä»¶ç»‘å®šæ•°é‡ä¼šç›´æ¥å½±å“é¡µé¢çš„æ•´ä½“è¿è¡Œæ€§èƒ½ï¼Œå› ä¸ºæ¯ä¸ªäº‹ä»¶çš„å›è°ƒå¤„ç†å‡½æ•°éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå ç”¨ä¸€å®šçš„å†…å­˜ã€‚å¦‚æœäº‹ä»¶çš„ç»‘å®šæ•°é‡è¶Šå¤šï¼Œå†…å­˜ä¹Ÿéšä¹‹å¢åŠ ã€‚å¦å¤–ï¼Œå›è°ƒå¤„ç†å‡½æ•°éœ€è¦ä¸DOMèŠ‚ç‚¹è¿›è¡Œäº¤äº’ï¼Œè€ŒJSå¼•æ“ç‹¬ç«‹äºæ¸²æŸ“å¼•æ“ï¼Œè€ŒDOMæ˜¯ä½äºæ¸²æŸ“å¼•æ“ï¼Œç›¸äº’è®¿é—®éœ€è¦æ¶ˆè€—ä¸€å®šçš„èµ„æºã€‚åŠ ä¸Šæ“ä½œDOMï¼Œä¼šå¼•èµ·æµè§ˆå™¨çš„é‡æ’æˆ–é‡ç»˜ï¼Œè€Œå½±å“é¡µé¢çš„æ•´ä½“æ€§èƒ½ã€‚</p>\n<blockquote>\n<p>äº‹ä»¶ä»£ç† (äº‹ä»¶å§”æ‰˜) åˆ©ç”¨äº†äº‹ä»¶å†’æ³¡ï¼ŒåªæŒ‡å®šä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Œå°±å¯ä»¥ç®¡ç†æŸä¸€ç±»å‹çš„æ‰€æœ‰äº‹ä»¶ã€‚</p>\n</blockquote>\n<p>å› æ­¤å¦‚ä½•æ§åˆ¶äº‹ä»¶ç»‘å®šæ•°é‡å°±å¾ˆé‡è¦äº†ï¼Œé€šå¸¸éƒ½æ˜¯é€šè¿‡äº‹ä»¶ä»£ç†ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰æ¥è§£å†³ç±»ä¼¼çš„é—®é¢˜ã€‚ä¸è¿‡æœ‰æ—¶å€ŸåŠ©äº†äº‹ä»¶ä»£ç†ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰ï¼Œè€Œé¡µé¢çš„äº‹ä»¶ç»‘å®šæ•°é‡ä¹Ÿåœ¨ä¸æ–­åœ°å¢åŠ ï¼Ÿè¿™å¯èƒ½æ˜¯æŸäº›â€œä¸å¥½â€ä»£ç å¯¼è‡´çš„ï¼Œé‚£å¦‚ä½•å®šä½å¢åŠ çš„åŸå› å°±æ˜¾å¾—å¾ˆå…³é”®äº†ã€‚è¿™é‡Œå¯ä»¥é€šè¿‡chromeçš„<strong>DevTools</strong>æ¥è¾…åŠ©è¯Šæ–­ã€‚</p>\n<h2 id=\"DevTools\"><a href=\"#DevTools\" class=\"headerlink\" title=\"DevTools\"></a>DevTools</h2><h3 id=\"å¦‚ä½•åˆ¤æ–­é¡µé¢çš„äº‹ä»¶ç»‘å®šæ•°é‡åœ¨å¢åŠ ï¼š\"><a href=\"#å¦‚ä½•åˆ¤æ–­é¡µé¢çš„äº‹ä»¶ç»‘å®šæ•°é‡åœ¨å¢åŠ ï¼š\" class=\"headerlink\" title=\"å¦‚ä½•åˆ¤æ–­é¡µé¢çš„äº‹ä»¶ç»‘å®šæ•°é‡åœ¨å¢åŠ ï¼š\"></a>å¦‚ä½•åˆ¤æ–­é¡µé¢çš„äº‹ä»¶ç»‘å®šæ•°é‡åœ¨å¢åŠ ï¼š</h3><ol>\n<li>æ‰“å¼€DevTools-&gt;Performanceï¼Œå•å‡»ã€è®°å½•æŒ‰é’®ã€‘å¼€å§‹è®°å½•é¡µé¢ç›¸å…³performanceæ•°æ®ã€‚æ¥ç€å•å‡»ã€åƒåœ¾å›æ”¶æŒ‰é’®ã€‘ï¼Œè¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œåˆ›å»ºåŸºå‡†å‚è€ƒçº¿ã€‚</li>\n<li>è¿›è¡Œå¯èƒ½å¼•èµ·äº‹ä»¶ç»‘å®šæ•°é‡å¢åŠ çš„æ“ä½œã€‚</li>\n<li>å•å‡»ã€stopã€‘æŒ‰é’®ï¼Œåœæ­¢è®°å½•ã€‚</li>\n</ol>\n<p><img src=\"listeners_performance.png\" alt=\"performance\"></p>\n<h3 id=\"å¦‚ä½•å®šä½äº‹ä»¶ç»‘å®šæ•°é‡çš„å¢åŠ ï¼š\"><a href=\"#å¦‚ä½•å®šä½äº‹ä»¶ç»‘å®šæ•°é‡çš„å¢åŠ ï¼š\" class=\"headerlink\" title=\"å¦‚ä½•å®šä½äº‹ä»¶ç»‘å®šæ•°é‡çš„å¢åŠ ï¼š\"></a>å¦‚ä½•å®šä½äº‹ä»¶ç»‘å®šæ•°é‡çš„å¢åŠ ï¼š</h3><ol>\n<li>æ‰“å¼€DevTools-&gt;Elementsï¼ŒæŸ¥çœ‹é¡µé¢ä¸­ç»‘å®šäº‹ä»¶çš„å…ƒç´ ã€‚</li>\n</ol>\n<p><img src=\"listeners_event.png\" alt=\"listeners\"></p>\n<h2 id=\"å®æˆ˜\"><a href=\"#å®æˆ˜\" class=\"headerlink\" title=\"å®æˆ˜\"></a>å®æˆ˜</h2><p>\båŒåä¸€å¿«åˆ°äº†ï¼Œå„ç§tmallæ´»åŠ¨å°±å¤šèµ·æ¥äº†ã€‚åœ¨åšä¸€ä¸ªtmallåŠ¨æ€çš®è‚¤æ—¶ï¼Œéœ€è¦åœ¨windowå¤§å°å˜åŒ–æ—¶å°†ä¹‹å‰æ„å»ºçš„ç»“æ„é”€æ¯ï¼Œç„¶åå†é‡æ–°è®¡ç®—æ„å»ºã€‚å› ä¸ºåœ¨é”€æ¯æ—¶ï¼Œæœªè§£ç»‘å¯¹åº”çš„äº‹ä»¶ã€‚å¯¼è‡´åœ¨windowè§¦å‘resizeæ—¶ï¼ŒæŸä¸ªå…ƒç´ çš„äº‹ä»¶ç»‘å®šæ•°é‡ä¸æ–­å¢åŠ ã€‚å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> tmallskin = &#123;</div><div class=\"line\">  init: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//......</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.bindEvent();</div><div class=\"line\">  &#125;,</div><div class=\"line\">  destroy: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.element.length &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">      <span class=\"keyword\">this</span>.container.off(<span class=\"string\">\"click.tmallskin\"</span>);<span class=\"comment\">//è¯¥è¯­å¥å¯ä»¥ä¸ç”¨ï¼Œå› ä¸ºåœ¨element.removeæ—¶ä¼šè§£é™¤elementä¸Šç»‘å®šçš„äº‹ä»¶</span></div><div class=\"line\">      <span class=\"keyword\">this</span>.element.remove();</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"> <span class=\"comment\">// ç»‘å®šé€»è¾‘</span></div><div class=\"line\"> bindEvent: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> context = <span class=\"keyword\">this</span>;</div><div class=\"line\">    <span class=\"keyword\">this</span>.container.on(<span class=\"string\">\"click.tmallskin\"</span>, <span class=\"string\">\".tmallskin-close\"</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">      <span class=\"comment\">//.... </span></div><div class=\"line\">    &#125;);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">var</span> timer = <span class=\"literal\">null</span>;</div><div class=\"line\">    $(<span class=\"built_in\">window</span>).on(<span class=\"string\">\"resize.tmallskin\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">      <span class=\"keyword\">if</span> (timer) &#123;</div><div class=\"line\">        clearTimeout(timer);</div><div class=\"line\">      &#125;</div><div class=\"line\">      timer = setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// çª—å£å¤§å°å˜åŒ–æ—¶ï¼Œä¼šä¸æ–­æ‰§è¡Œdestroyï¼Œinit</span></div><div class=\"line\">        context.destroy();</div><div class=\"line\">        context.init();</div><div class=\"line\">        timer = <span class=\"literal\">null</span>;</div><div class=\"line\">      &#125;, <span class=\"number\">400</span>);</div><div class=\"line\">    &#125;);</div><div class=\"line\">    <span class=\"comment\">// å› ä¸ºæœªåœ¨destroyä¸­è§£é™¤è¯¥ç»‘å®šï¼Œåœ¨windowè§¦å‘resizeæ—¶ï¼Œä¼šä¸æ–­åœ°ç»‘å®š</span></div><div class=\"line\">    $(<span class=\"string\">\".m-skin\"</span>).on(<span class=\"string\">\"click.tmallskin\"</span>, <span class=\"string\">\".grey, .reset\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">      o._JS.SK[<span class=\"string\">\"1\"</span>].init();</div><div class=\"line\">    &#125;);</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure>\n<p>ä¸Šè¿°codeä¸­ï¼Œå› ä¸ºåœ¨destroyæ–¹æ³•ä¸­æœªå¯¹<code>$(&quot;.m-skin&quot;)</code>å…ƒç´ ä¸Šç»‘å®šçš„äº‹ä»¶è¿›è¡Œè§£é™¤ï¼Œå¯¼è‡´åœ¨windowè§¦å‘resizeæ—¶ï¼Œä¸æ–­è¿›è¡Œç»‘å®šã€‚</p>\n<ul>\n<li>DevToolsè¯Šæ–­æˆªå›¾å¦‚ä¸‹ï¼š</li>\n</ul>\n<p><img src=\"listeners_resize.png\" alt=\"resize\"></p>\n<ul>\n<li>resizeä¹‹åï¼š</li>\n</ul>\n<p><img src=\"listeners_resize_after.png\" alt=\"resize\"></p>\n<ul>\n<li>å•å‡»å³ä¾§å®šä½é“¾æ¥<code>(index):42</code>ï¼š</li>\n</ul>\n<p><img src=\"listener_location.png\" alt=\"location\"></p>\n<h3 id=\"çŸ¥é“é—®é¢˜çš„åŸå› ï¼Œä¿®å¤ä»£ç å¦‚ä¸‹ï¼š\"><a href=\"#çŸ¥é“é—®é¢˜çš„åŸå› ï¼Œä¿®å¤ä»£ç å¦‚ä¸‹ï¼š\" class=\"headerlink\" title=\"çŸ¥é“é—®é¢˜çš„åŸå› ï¼Œä¿®å¤ä»£ç å¦‚ä¸‹ï¼š\"></a>çŸ¥é“é—®é¢˜çš„åŸå› ï¼Œä¿®å¤ä»£ç å¦‚ä¸‹ï¼š</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//.....</span></div><div class=\"line\">destroy: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.element.length &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.container.off(<span class=\"string\">\"click.tmallskin\"</span>);</div><div class=\"line\">    $(<span class=\"string\">\".m-skin\"</span>).off(<span class=\"string\">\"click.tmallskin\"</span>);<span class=\"comment\">//é”€æ¯æ—¶è§£é™¤ç»‘å®š</span></div><div class=\"line\">    $(<span class=\"built_in\">window</span>).off(<span class=\"string\">\"resize.tmallskin\"</span>);</div><div class=\"line\">    <span class=\"keyword\">this</span>.element.remove();</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;,</div><div class=\"line\"><span class=\"comment\">//.....</span></div></pre></td></tr></table></figure>\n<p>æ•ˆæœæˆªå›¾ï¼š</p>\n<p><img src=\"listeners_fixed.png\" alt=\"fixed\"></p>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>å¯èƒ½åœ¨å®è·µç¼–ç ä¸­ï¼Œå¾ˆå°‘å…³æ³¨ä¸»åŠ¨è§£é™¤äº‹ä»¶ç»‘å®šã€‚å¦‚å¸¸ç”¨çš„Jqueryåº“ï¼Œä¼šåœ¨å…ƒç´ åˆ é™¤æ—¶ï¼Œè‡ªåŠ¨è§£é™¤å…ƒç´ ä¸Šç»‘å®šçš„äº‹ä»¶ã€‚ä¸è¿‡éš¾å…å­˜åœ¨æŸäº›æƒ…å†µï¼ŒJqueryä¹Ÿæ— èƒ½æ— åŠ›ï¼Œè¿™æ—¶éœ€è¦æˆ‘ä»¬ä¸»åŠ¨è¿›è¡Œè§£ç»‘ï¼Œå› ä¸ºè¿‡å¤šçš„äº‹ä»¶ç»‘å®šä¼šç›´æ¥å½±å“é¡µé¢çš„æ•´ä½“æ€§èƒ½ã€‚å› æ­¤äº†è§£å¦‚ä½•è¯Šæ–­äº‹ä»¶ç»‘å®šçš„å¢åŠ æ˜¯å¾ˆé‡è¦çš„ï¼Œä¹Ÿå¸Œæœ›æœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p>\n","site":{"data":{}},"excerpt":"","more":"<p>é¡µé¢ä¸­äº‹ä»¶ç»‘å®šæ•°é‡ä¼šç›´æ¥å½±å“é¡µé¢çš„æ•´ä½“è¿è¡Œæ€§èƒ½ï¼Œå› ä¸ºæ¯ä¸ªäº‹ä»¶çš„å›è°ƒå¤„ç†å‡½æ•°éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå ç”¨ä¸€å®šçš„å†…å­˜ã€‚å¦‚æœäº‹ä»¶çš„ç»‘å®šæ•°é‡è¶Šå¤šï¼Œå†…å­˜ä¹Ÿéšä¹‹å¢åŠ ã€‚å¦å¤–ï¼Œå›è°ƒå¤„ç†å‡½æ•°éœ€è¦ä¸DOMèŠ‚ç‚¹è¿›è¡Œäº¤äº’ï¼Œè€ŒJSå¼•æ“ç‹¬ç«‹äºæ¸²æŸ“å¼•æ“ï¼Œè€ŒDOMæ˜¯ä½äºæ¸²æŸ“å¼•æ“ï¼Œç›¸äº’è®¿é—®éœ€è¦æ¶ˆè€—ä¸€å®šçš„èµ„æºã€‚åŠ ä¸Šæ“ä½œDOMï¼Œä¼šå¼•èµ·æµè§ˆå™¨çš„é‡æ’æˆ–é‡ç»˜ï¼Œè€Œå½±å“é¡µé¢çš„æ•´ä½“æ€§èƒ½ã€‚</p>\n<blockquote>\n<p>äº‹ä»¶ä»£ç† (äº‹ä»¶å§”æ‰˜) åˆ©ç”¨äº†äº‹ä»¶å†’æ³¡ï¼ŒåªæŒ‡å®šä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Œå°±å¯ä»¥ç®¡ç†æŸä¸€ç±»å‹çš„æ‰€æœ‰äº‹ä»¶ã€‚</p>\n</blockquote>\n<p>å› æ­¤å¦‚ä½•æ§åˆ¶äº‹ä»¶ç»‘å®šæ•°é‡å°±å¾ˆé‡è¦äº†ï¼Œé€šå¸¸éƒ½æ˜¯é€šè¿‡äº‹ä»¶ä»£ç†ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰æ¥è§£å†³ç±»ä¼¼çš„é—®é¢˜ã€‚ä¸è¿‡æœ‰æ—¶å€ŸåŠ©äº†äº‹ä»¶ä»£ç†ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰ï¼Œè€Œé¡µé¢çš„äº‹ä»¶ç»‘å®šæ•°é‡ä¹Ÿåœ¨ä¸æ–­åœ°å¢åŠ ï¼Ÿè¿™å¯èƒ½æ˜¯æŸäº›â€œä¸å¥½â€ä»£ç å¯¼è‡´çš„ï¼Œé‚£å¦‚ä½•å®šä½å¢åŠ çš„åŸå› å°±æ˜¾å¾—å¾ˆå…³é”®äº†ã€‚è¿™é‡Œå¯ä»¥é€šè¿‡chromeçš„<strong>DevTools</strong>æ¥è¾…åŠ©è¯Šæ–­ã€‚</p>\n<h2 id=\"DevTools\"><a href=\"#DevTools\" class=\"headerlink\" title=\"DevTools\"></a>DevTools</h2><h3 id=\"å¦‚ä½•åˆ¤æ–­é¡µé¢çš„äº‹ä»¶ç»‘å®šæ•°é‡åœ¨å¢åŠ ï¼š\"><a href=\"#å¦‚ä½•åˆ¤æ–­é¡µé¢çš„äº‹ä»¶ç»‘å®šæ•°é‡åœ¨å¢åŠ ï¼š\" class=\"headerlink\" title=\"å¦‚ä½•åˆ¤æ–­é¡µé¢çš„äº‹ä»¶ç»‘å®šæ•°é‡åœ¨å¢åŠ ï¼š\"></a>å¦‚ä½•åˆ¤æ–­é¡µé¢çš„äº‹ä»¶ç»‘å®šæ•°é‡åœ¨å¢åŠ ï¼š</h3><ol>\n<li>æ‰“å¼€DevTools-&gt;Performanceï¼Œå•å‡»ã€è®°å½•æŒ‰é’®ã€‘å¼€å§‹è®°å½•é¡µé¢ç›¸å…³performanceæ•°æ®ã€‚æ¥ç€å•å‡»ã€åƒåœ¾å›æ”¶æŒ‰é’®ã€‘ï¼Œè¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œåˆ›å»ºåŸºå‡†å‚è€ƒçº¿ã€‚</li>\n<li>è¿›è¡Œå¯èƒ½å¼•èµ·äº‹ä»¶ç»‘å®šæ•°é‡å¢åŠ çš„æ“ä½œã€‚</li>\n<li>å•å‡»ã€stopã€‘æŒ‰é’®ï¼Œåœæ­¢è®°å½•ã€‚</li>\n</ol>\n<p><img src=\"listeners_performance.png\" alt=\"performance\"></p>\n<h3 id=\"å¦‚ä½•å®šä½äº‹ä»¶ç»‘å®šæ•°é‡çš„å¢åŠ ï¼š\"><a href=\"#å¦‚ä½•å®šä½äº‹ä»¶ç»‘å®šæ•°é‡çš„å¢åŠ ï¼š\" class=\"headerlink\" title=\"å¦‚ä½•å®šä½äº‹ä»¶ç»‘å®šæ•°é‡çš„å¢åŠ ï¼š\"></a>å¦‚ä½•å®šä½äº‹ä»¶ç»‘å®šæ•°é‡çš„å¢åŠ ï¼š</h3><ol>\n<li>æ‰“å¼€DevTools-&gt;Elementsï¼ŒæŸ¥çœ‹é¡µé¢ä¸­ç»‘å®šäº‹ä»¶çš„å…ƒç´ ã€‚</li>\n</ol>\n<p><img src=\"listeners_event.png\" alt=\"listeners\"></p>\n<h2 id=\"å®æˆ˜\"><a href=\"#å®æˆ˜\" class=\"headerlink\" title=\"å®æˆ˜\"></a>å®æˆ˜</h2><p>\båŒåä¸€å¿«åˆ°äº†ï¼Œå„ç§tmallæ´»åŠ¨å°±å¤šèµ·æ¥äº†ã€‚åœ¨åšä¸€ä¸ªtmallåŠ¨æ€çš®è‚¤æ—¶ï¼Œéœ€è¦åœ¨windowå¤§å°å˜åŒ–æ—¶å°†ä¹‹å‰æ„å»ºçš„ç»“æ„é”€æ¯ï¼Œç„¶åå†é‡æ–°è®¡ç®—æ„å»ºã€‚å› ä¸ºåœ¨é”€æ¯æ—¶ï¼Œæœªè§£ç»‘å¯¹åº”çš„äº‹ä»¶ã€‚å¯¼è‡´åœ¨windowè§¦å‘resizeæ—¶ï¼ŒæŸä¸ªå…ƒç´ çš„äº‹ä»¶ç»‘å®šæ•°é‡ä¸æ–­å¢åŠ ã€‚å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> tmallskin = &#123;</div><div class=\"line\">  init: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//......</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.bindEvent();</div><div class=\"line\">  &#125;,</div><div class=\"line\">  destroy: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.element.length &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">      <span class=\"keyword\">this</span>.container.off(<span class=\"string\">\"click.tmallskin\"</span>);<span class=\"comment\">//è¯¥è¯­å¥å¯ä»¥ä¸ç”¨ï¼Œå› ä¸ºåœ¨element.removeæ—¶ä¼šè§£é™¤elementä¸Šç»‘å®šçš„äº‹ä»¶</span></div><div class=\"line\">      <span class=\"keyword\">this</span>.element.remove();</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"> <span class=\"comment\">// ç»‘å®šé€»è¾‘</span></div><div class=\"line\"> bindEvent: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> context = <span class=\"keyword\">this</span>;</div><div class=\"line\">    <span class=\"keyword\">this</span>.container.on(<span class=\"string\">\"click.tmallskin\"</span>, <span class=\"string\">\".tmallskin-close\"</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">      <span class=\"comment\">//.... </span></div><div class=\"line\">    &#125;);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">var</span> timer = <span class=\"literal\">null</span>;</div><div class=\"line\">    $(<span class=\"built_in\">window</span>).on(<span class=\"string\">\"resize.tmallskin\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">      <span class=\"keyword\">if</span> (timer) &#123;</div><div class=\"line\">        clearTimeout(timer);</div><div class=\"line\">      &#125;</div><div class=\"line\">      timer = setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// çª—å£å¤§å°å˜åŒ–æ—¶ï¼Œä¼šä¸æ–­æ‰§è¡Œdestroyï¼Œinit</span></div><div class=\"line\">        context.destroy();</div><div class=\"line\">        context.init();</div><div class=\"line\">        timer = <span class=\"literal\">null</span>;</div><div class=\"line\">      &#125;, <span class=\"number\">400</span>);</div><div class=\"line\">    &#125;);</div><div class=\"line\">    <span class=\"comment\">// å› ä¸ºæœªåœ¨destroyä¸­è§£é™¤è¯¥ç»‘å®šï¼Œåœ¨windowè§¦å‘resizeæ—¶ï¼Œä¼šä¸æ–­åœ°ç»‘å®š</span></div><div class=\"line\">    $(<span class=\"string\">\".m-skin\"</span>).on(<span class=\"string\">\"click.tmallskin\"</span>, <span class=\"string\">\".grey, .reset\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">      o._JS.SK[<span class=\"string\">\"1\"</span>].init();</div><div class=\"line\">    &#125;);</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure>\n<p>ä¸Šè¿°codeä¸­ï¼Œå› ä¸ºåœ¨destroyæ–¹æ³•ä¸­æœªå¯¹<code>$(&quot;.m-skin&quot;)</code>å…ƒç´ ä¸Šç»‘å®šçš„äº‹ä»¶è¿›è¡Œè§£é™¤ï¼Œå¯¼è‡´åœ¨windowè§¦å‘resizeæ—¶ï¼Œä¸æ–­è¿›è¡Œç»‘å®šã€‚</p>\n<ul>\n<li>DevToolsè¯Šæ–­æˆªå›¾å¦‚ä¸‹ï¼š</li>\n</ul>\n<p><img src=\"listeners_resize.png\" alt=\"resize\"></p>\n<ul>\n<li>resizeä¹‹åï¼š</li>\n</ul>\n<p><img src=\"listeners_resize_after.png\" alt=\"resize\"></p>\n<ul>\n<li>å•å‡»å³ä¾§å®šä½é“¾æ¥<code>(index):42</code>ï¼š</li>\n</ul>\n<p><img src=\"listener_location.png\" alt=\"location\"></p>\n<h3 id=\"çŸ¥é“é—®é¢˜çš„åŸå› ï¼Œä¿®å¤ä»£ç å¦‚ä¸‹ï¼š\"><a href=\"#çŸ¥é“é—®é¢˜çš„åŸå› ï¼Œä¿®å¤ä»£ç å¦‚ä¸‹ï¼š\" class=\"headerlink\" title=\"çŸ¥é“é—®é¢˜çš„åŸå› ï¼Œä¿®å¤ä»£ç å¦‚ä¸‹ï¼š\"></a>çŸ¥é“é—®é¢˜çš„åŸå› ï¼Œä¿®å¤ä»£ç å¦‚ä¸‹ï¼š</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//.....</span></div><div class=\"line\">destroy: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.element.length &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.container.off(<span class=\"string\">\"click.tmallskin\"</span>);</div><div class=\"line\">    $(<span class=\"string\">\".m-skin\"</span>).off(<span class=\"string\">\"click.tmallskin\"</span>);<span class=\"comment\">//é”€æ¯æ—¶è§£é™¤ç»‘å®š</span></div><div class=\"line\">    $(<span class=\"built_in\">window</span>).off(<span class=\"string\">\"resize.tmallskin\"</span>);</div><div class=\"line\">    <span class=\"keyword\">this</span>.element.remove();</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;,</div><div class=\"line\"><span class=\"comment\">//.....</span></div></pre></td></tr></table></figure>\n<p>æ•ˆæœæˆªå›¾ï¼š</p>\n<p><img src=\"listeners_fixed.png\" alt=\"fixed\"></p>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>å¯èƒ½åœ¨å®è·µç¼–ç ä¸­ï¼Œå¾ˆå°‘å…³æ³¨ä¸»åŠ¨è§£é™¤äº‹ä»¶ç»‘å®šã€‚å¦‚å¸¸ç”¨çš„Jqueryåº“ï¼Œä¼šåœ¨å…ƒç´ åˆ é™¤æ—¶ï¼Œè‡ªåŠ¨è§£é™¤å…ƒç´ ä¸Šç»‘å®šçš„äº‹ä»¶ã€‚ä¸è¿‡éš¾å…å­˜åœ¨æŸäº›æƒ…å†µï¼ŒJqueryä¹Ÿæ— èƒ½æ— åŠ›ï¼Œè¿™æ—¶éœ€è¦æˆ‘ä»¬ä¸»åŠ¨è¿›è¡Œè§£ç»‘ï¼Œå› ä¸ºè¿‡å¤šçš„äº‹ä»¶ç»‘å®šä¼šç›´æ¥å½±å“é¡µé¢çš„æ•´ä½“æ€§èƒ½ã€‚å› æ­¤äº†è§£å¦‚ä½•è¯Šæ–­äº‹ä»¶ç»‘å®šçš„å¢åŠ æ˜¯å¾ˆé‡è¦çš„ï¼Œä¹Ÿå¸Œæœ›æœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p>\n"},{"title":"å†…å­˜æ³„éœ²ä¹‹jQuery.cache","date":"2017-11-13T08:51:49.000Z","author":"singsong","_content":"\n![jquery.jpg](./jquery.jpg)\n\njQueryæ²¡æœ‰å°†äº‹ä»¶å’Œæ•°æ®ç»‘å®šåœ¨DOMèŠ‚ç‚¹ä¸Šï¼Œè€Œæ˜¯å°†è¿™äº›ä¿¡æ¯å‚¨å­˜åœ¨`$.cache`å¯¹è±¡ä¸Šã€‚jQueryå¯¹è±¡æ¯æ¬¡æ–°å¢äº‹ä»¶æˆ–æ•°æ®æ—¶ï¼Œéƒ½åœ¨`$.cache`æ–°å¢ä¸€æ¡æ•°æ®ã€‚è€Œ`$.cache`ä¼šæŒæœ‰å¯¹åº”DOMèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰æ­£ç¡®åˆ é™¤DOMèŠ‚ç‚¹ï¼Œä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸èƒ½è¢«å›æ”¶ã€‚å³DOMèŠ‚ç‚¹å·²ä»DOMä¸­åˆ é™¤ï¼Œä½†ä¾ç„¶è¿˜å­˜åœ¨å†…å­˜ä¸­ï¼Œæ²¡æœ‰è¢«CGå›æ”¶ã€‚æ­£ç¡®çš„åˆ é™¤æ–¹å¼æ˜¯é€šè¿‡jQueryçš„åˆ é™¤æ–¹æ³•æ¥ç§»é™¤ï¼š`remove()`,`empty()`,`html()`;\n\n#### ä¸Šè¿°æåˆ°ä¸æ­£ç¡®çš„åˆ é™¤æ–¹å¼ï¼Œä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸èƒ½è¢«å›æ”¶ï¼Œè€Œå¯¼è‡´å†…å­˜æ³„éœ²é—®é¢˜ã€‚å¦‚ä½¿ç”¨JavaScriptå†…ç½®æ–¹æ³•ï¼ˆå¦‚removeChildï¼ŒinnerHTMLï¼‰æ¥åˆ é™¤jQueryç»‘å®šäº†äº‹ä»¶æˆ–æ•°æ®çš„èŠ‚ç‚¹ã€‚\n\n```js\nvar $element = $('<div></div>');\n$element.on('click', function() { ... });\n$element.appendTo(document.body); \nvar nativeElement = $element.get(0);\ndocument.body.removeChild(nativeElement); // â† é€šè¿‡removeChildæ–¹æ³•ç§»é™¤nativeElement\n```\n\nä¸Šè¿°ä»£ç ä¸­ä½¿ç”¨å†…ç½®çš„removeChildæ–¹æ³•ç§»é™¤nativeElementï¼Œæ­¤æ—¶ä»…ä»…åªæ˜¯å°†nativeElementä¸DOMè„±ç¦»è€Œå·²ï¼Œå¹¶æ²¡æœ‰çœŸæ­£åœ°åˆ é™¤nativeElementã€‚åŸå› æ˜¯$elementç»‘å®šäº†äº‹ä»¶ï¼Œ`$.cache`ä¸­æŒæœ‰å¯¹$elementå¼•ç”¨ï¼Œå¯¼è‡´nativeElementä¸èƒ½è¢«å›æ”¶æ‰ã€‚\n\n```js\nvar $element = $('<div></div>');\n$element.on('click', function() { ... });// â† ç»‘å®šäº‹ä»¶\n$element.appendTo(document.body);\ndocument.body.innerHTML = '';// â† é€šè¿‡innerHTMLæ–¹æ³•ç§»é™¤bodyå†…çš„èŠ‚ç‚¹\n```\ninnerHTMLæ–¹æ³•ä¹Ÿå­˜åœ¨åŒæ ·çš„é—®é¢˜ã€‚\n\n\n#### ä¸Šè¿°å®ä¾‹éƒ½æ˜¯ç»‘å®šäº‹ä»¶çš„ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ç»‘å®šæ•°æ®çš„ä¾‹å­ï¼šå‡å¦‚é€šè¿‡jQueryåˆ›å»ºä¸€ä¸ªDOMå…ƒç´ ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªdataï¼Œä½†æ²¡æœ‰å°†å…¶æ·»åŠ åˆ°DOMä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n```js\n$element = $('<div></div>');\n$element.data('foo', 'bar');\n```\n\nå³ä½¿ä»£ç æ‰§è¡Œå®Œï¼Œ$elementä¹Ÿä¸èƒ½è¢«å›æ”¶ã€‚è¿™æ˜¯å› ä¸º$.cahceé˜»æ­¢CGçš„å›æ”¶ã€‚éœ€è¦é€šè¿‡`$element.remove()`,`$element.parent.empty()`æˆ–`$elememnt.removeData()`;\n\n\n## ä¸ºä»€ä¹ˆ`remove()`,`empty()`,`html()`èƒ½æ­£ç¡®ç§»é™¤DOMèŠ‚ç‚¹\nå› ä¸ºå®ƒä»¬éƒ½ä¼šè°ƒç”¨`jQuery.cleanData()`æ–¹æ³•æ¥åˆ é™¤`$.cache`ç¼“å­˜çš„å¯¹åº”æ•°æ®ï¼Œç„¶ååœ¨è°ƒç”¨JavaScriptå†…ç½®åˆ é™¤æ–¹æ³•æ¥ç§»é™¤DOMèŠ‚ç‚¹ã€‚\n\n[empty()æ–¹æ³•æºç ](https://github.com/jquery/jquery/blob/1.12-stable/src/manipulation.js#L461)ï¼š\n\n```js\n\tempty: function() {\n\t\tvar elem,\n\t\t\ti = 0;\n\n\t\tfor ( ; ( elem = this[ i ] ) != null; i++ ) {\n\n\t\t\t// Remove element nodes and prevent memory leaks \n      // åˆ é™¤å…ƒç´ èŠ‚ç‚¹å¹¶é˜»æ­¢å†…å­˜æ³„éœ²\n\t\t\tif ( elem.nodeType === 1 ) {\n\t\t\t\tjQuery.cleanData( getAll( elem, false ) );// â† æ¸…é™¤elemåœ¨$.cacheä¸­çš„æ•°æ®ï¼Œé‡Šæ”¾æ‰$.cacheå¯¹elemçš„å¼•ç”¨\n\t\t\t}\n\n\t\t\t// Remove any remaining nodes\n\t\t\twhile ( elem.firstChild ) {\n\t\t\t\telem.removeChild( elem.firstChild );\n\t\t\t}\n\n\t\t\t// If this is a select, ensure that it displays empty (#12336)\n\t\t\t// Support: IE<9\n\t\t\tif ( elem.options && jQuery.nodeName( elem, \"select\" ) ) {\n\t\t\t\telem.options.length = 0;\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t},\n\n```\n\n[remove()æ–¹æ³•æºç ](https://github.com/jquery/jquery/blob/1.12-stable/src/manipulation.js#L265)\n\n```js\nfunction remove( elem, selector, keepData ) {\n\tvar node,\n\t\telems = selector ? jQuery.filter( selector, elem ) : elem,\n\t\ti = 0;\n\n\tfor ( ; ( node = elems[ i ] ) != null; i++ ) {\n\n\t\tif ( !keepData && node.nodeType === 1 ) {\n\t\t\tjQuery.cleanData( getAll( node ) );// â† æ¸…é™¤elemåœ¨$.cacheä¸­çš„æ•°æ®ï¼Œé‡Šæ”¾æ‰$.cacheå¯¹elemçš„å¼•ç”¨\n\t\t}\n\n\t\tif ( node.parentNode ) {\n\t\t\tif ( keepData && jQuery.contains( node.ownerDocument, node ) ) {\n\t\t\t\tsetGlobalEval( getAll( node, \"script\" ) );\n\t\t\t}\n\t\t\tnode.parentNode.removeChild( node );\n\t\t}\n\t}\n\n\treturn elem;\n}\n```\n\n[html()æ–¹æ³•æºç ](https://github.com/jquery/jquery/blob/1.12-stable/src/manipulation.js#L496)\n```js\n\thtml: function( value ) {\n\t\treturn access( this, function( value ) {\n\t\t\tvar elem = this[ 0 ] || {},\n\t\t\t\ti = 0,\n\t\t\t\tl = this.length;\n\n\t\t\tif ( value === undefined ) {\n\t\t\t\treturn elem.nodeType === 1 ?\n\t\t\t\t\telem.innerHTML.replace( rinlinejQuery, \"\" ) :\n\t\t\t\t\tundefined;\n\t\t\t}\n\n\t\t\t// See if we can take a shortcut and just use innerHTML\n\t\t\tif ( typeof value === \"string\" && !rnoInnerhtml.test( value ) &&\n\t\t\t\t( support.htmlSerialize || !rnoshimcache.test( value )  ) &&\n\t\t\t\t( support.leadingWhitespace || !rleadingWhitespace.test( value ) ) &&\n\t\t\t\t!wrapMap[ ( rtagName.exec( value ) || [ \"\", \"\" ] )[ 1 ].toLowerCase() ] ) {\n\n\t\t\t\tvalue = jQuery.htmlPrefilter( value );\n\n\t\t\t\ttry {\n\t\t\t\t\tfor ( ; i < l; i++ ) {\n\n\t\t\t\t\t\t// Remove element nodes and prevent memory leaks\n            // åˆ é™¤å…ƒç´ èŠ‚ç‚¹å¹¶é˜»æ­¢å†…å­˜æ³„éœ²\n\t\t\t\t\t\telem = this[ i ] || {};\n\t\t\t\t\t\tif ( elem.nodeType === 1 ) {\n\t\t\t\t\t\t\tjQuery.cleanData( getAll( elem, false ) );// â† æ¸…é™¤elemåœ¨$.cacheä¸­çš„æ•°æ®ï¼Œé‡Šæ”¾æ‰$.cacheå¯¹elemçš„å¼•ç”¨\n\t\t\t\t\t\t\telem.innerHTML = value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telem = 0;\n\n\t\t\t\t// If using innerHTML throws an exception, use the fallback method\n\t\t\t\t} catch ( e ) {}\n\t\t\t}\n\n\t\t\tif ( elem ) {\n\t\t\t\tthis.empty().append( value );\n\t\t\t}\n\t\t}, null, value, arguments.length );\n\t}\n```\n\n## ä¸ºä»€ä¹ˆjQueryæ²¡æœ‰å°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨åœ¨DOMå…ƒç´ ä¸Šï¼Œè€Œæ˜¯å°†å…¶ä¿å­˜åœ¨$.cacheä¸­ï¼Ÿ\n\nå› ä¸ºåœ¨IE<8ç‰ˆæœ¬ä¸­ï¼ŒJScriptåƒåœ¾å›æ”¶å™¨ä»…ç®¡ç†JScriptå¯¹è±¡ç”Ÿå‘½å‘¨æœŸè€Œä¸ä¼šç®¡ç†DOMå¯¹è±¡çš„(å³DOMå¯¹è±¡æœ‰è‡ªå·±çš„åƒåœ¾å›æ”¶å™¨)ã€‚å³JScriptå›æ”¶å™¨ä¸ä¼šè§£é™¤æ‰DOMå¯¹è±¡ä¸Jscriptå¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨ï¼ˆå¾ªç¯å¼•ç”¨ï¼‰ï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚ä¸ºäº†é¿å…åœ¨ä½ç‰ˆæœ¬IEå’ŒFirefoxä¸­å†…å­˜æ³„éœ²ï¼ŒjQueryåˆ›å»ºäº†`$.cache`æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ›´å¤šä¿¡æ¯å‚è€ƒ[IE<8å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„éœ²](http://123fe.cn/2017/11/10/IE-8%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E5%AF%BC%E8%87%B4%E7%9A%84%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2/)ã€‚\n\n\n>  jQuery 2.0 leaves behind the older Internet Explorer 6, 7, and 8 browsers. In return it is smaller, faster, and can be used in JavaScript environments where the code needed for old-IE compatibility often causes problems of its own. But donâ€™t worry, the jQuery team still supports the 1.x branch which does run on IE 6/7/8. You can (and should) continue to use jQuery 1.9 (and the upcoming 1.10) on web sites that need to accommodate older browsers. The final 2.0.0 file is 12 percent smaller than the 1.9.1 file, thanks to the elimination of patches that were only needed for IE 6, 7, and 8. ----[jQuery 2.0 Released](http://blog.jquery.com/2013/04/18/jquery-2-0-released/)\n\n**å¤§æ¦‚æ„æ€**ï¼š<u>jQuery2.0ç‰ˆæœ¬ä¹‹åï¼ŒjQueryå›¢é˜ŸåŒæ—¶ç»´æŠ¤ä¸¤ä¸ªåˆ†æ”¯ï¼š2.xç‰ˆæœ¬å’Œ1.xç‰ˆæœ¬ã€‚jQuery2.0å¼€å§‹æ”¾å¼ƒIE6/7/8æ”¯æŒ(æ³¨ï¼šä¹ŸåŒ…å«3.xç‰ˆæœ¬)ã€‚è€ŒjQuery1.xç‰ˆæœ¬ä¼šç»§ç»­æ”¯æŒIE6/7/8ã€‚å› ä¸º2.xç‰ˆæœ¬åˆ é™¤äº†IE6/7/8è¡¥ä¸ä»£ç ï¼Œæ•´ä½“å¤§å°æ¯”1.xç‰ˆæœ¬å°12%ï¼Œæ€§èƒ½æ›´å¥½ã€‚</u>\n\nå³ä»jQuery2.0å¼€å§‹ä¸æ”¯æŒIE6/7/8ï¼Œå°±ä¸å­˜åœ¨å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œå› æ­¤$.cacheä¹Ÿä»jQuery2.xç‰ˆæœ¬ä¸­ç§»é™¤ã€‚jQuery2.0å¼€å§‹å°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨å­˜å‚¨åœ¨å…ƒç´ èŠ‚ç‚¹ä¸Šï¼Œè¿™æ ·å°±ä¸å­˜åœ¨ä¸Šè¿°çš„å†…å­˜æ³„éœ²é—®é¢˜äº†ã€‚\n\n## å¯¹æ¯”æµ‹è¯•\nåˆ†åˆ«ä½¿ç”¨jquery1.xå’Œjquery2.xç‰ˆæœ¬åˆ›å»ºä¸€ä¸ª1000ä¸ªå…ƒç´ å¹¶ç»‘å®šclickäº‹ä»¶ï¼Œåˆ›å»ºå®Œåå†é€šè¿‡JavaScriptåˆ é™¤æ–¹æ³•ç§»é™¤ï¼Œå¹¶é€šè¿‡**Devtools**-->**Performance**åšåˆ†æï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š\n  1. å¼€å¯**Performance**é¡¹çš„è®°å½•\n  2. æ‰§è¡Œä¸€æ¬¡CGï¼Œåˆ›å»ºåŸºæœ¬å‚è€ƒçº¿\n  3. å•å‡»ã€runã€‘æŒ‰é’®ï¼Œåˆ›å»º1000ä¸ªå…ƒç´ \n  4. å†æ¬¡å•å‡»ã€runã€‘æŒ‰é’®ï¼Œåˆ›å»º1000ä¸ªå…ƒç´ \n  5. å•å‡»ã€clearã€‘æŒ‰é’®ï¼Œé€šè¿‡JavaScriptåˆ é™¤æ–¹æ³•ç§»é™¤åˆšåˆ›å»º2000ä¸ªå…ƒç´ \n  6. æ‰§è¡Œä¸€æ¬¡CG\n\nç»“æœå›¾å¦‚ä¸‹ï¼š\n\n![](./jquery1_x.png)\n\n----\n\n![](./jquery2_x.png)\n\n\n\n\n\n\n**ä»å¯¹æ¯”ç»“æœå›¾è¯å®äº†jquery2.xå°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨åœ¨å…ƒç´ å¯¹è±¡ä¸Šã€‚è¿™é‡Œä¹Ÿå¯ä»¥åˆ†åˆ«æ‰“å°`$.cache`ï¼Œå¯¹æ¯”ä¸€ä¸‹è¾“å‡ºç»“æœï¼š**\n\n![](./jquery_cache_1_x.png)\n\n----\n\n![](./jquery_cache_2_x.png)\n\n\nè¿™é‡Œæ²¡æœ‰è®¨è®ºjquery3.xç‰ˆæœ¬ï¼Œå› ä¸ºå®ƒä¸jquery2.xç‰ˆæœ¬ä¸€æ ·ä¸æ”¯æŒä½ç‰ˆæœ¬IEï¼Œä¹Ÿä¸å­˜åœ¨`$.cache`é—®é¢˜ï¼Œæ‰€ä»¥ä¸å†èµ˜è¿°ã€‚\n\n## æ€»ç»“\n\næœ¬æ–‡ä¸»è¦è®¨è®ºäº†jqueryçš„`$.cache`å¼•èµ·çš„å†…å­˜æ³„éœ²é—®é¢˜ã€‚åœ¨ä½¿ç”¨jquery1.xç‰ˆæœ¬æ—¶ï¼Œéœ€è¦å…³æ³¨ä¸€ä¸‹è¿™ä¸€é—®é¢˜ã€‚å¦‚jquery.lazyload.jså’Œå•é¡µåº”ç”¨éƒ½å¾ˆå®¹æ˜“å¼•èµ·è¿™æ–¹é¢çš„é—®é¢˜ã€‚å¦‚ä½•é¿å…å‘¢ï¼Ÿæœ¬æ–‡ä¹Ÿæåˆ°äº†ï¼Œé€šè¿‡jqueryçš„åˆ é™¤æ–¹æ³•æ¥ç§»é™¤:`remove()`,`empty()`,`html()`ã€‚**åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ—¶ä¸€å®šè¦è®°ä½ï¼šé€šè¿‡ä»»ä½•ç¬¬ä¸‰æ–¹åº“åˆ›å»ºçš„å¯¹è±¡ï¼Œæœ€å¥½é€šè¿‡è¯¥åº“æä¾›çš„åˆ é™¤æ–¹æ³•æ¥åˆ é™¤ã€‚**\n\n\n## å‚è€ƒæ–‡ç« ï¼š\n\n- [How to create memory leaks in jQuery](https://makandracards.com/makandra/31325-how-to-create-memory-leaks-in-jquery)\n- [What is the purpose of $.cache in jQuery?](https://stackoverflow.com/questions/9304768/what-is-the-purpose-of-cache-in-jquery)\n- [JScript Memory Leaks](http://www.crockford.com/javascript/memory/leak.html)\n- [Memory Leaks in Microsoft Internet Explorer](http://isaacschlueter.com/2006/10/msie-memory-leaks/)\n","source":"_posts/å†…å­˜æ³„éœ²ä¹‹jQuery-cache.md","raw":"---\ntitle: å†…å­˜æ³„éœ²ä¹‹jQuery.cache\ndate: 2017-11-13 16:51:49\ntags: [$.cache,'jquery', ä¼˜åŒ–, å†…å­˜æ³„éœ²]\nauthor: singsong\n---\n\n![jquery.jpg](./jquery.jpg)\n\njQueryæ²¡æœ‰å°†äº‹ä»¶å’Œæ•°æ®ç»‘å®šåœ¨DOMèŠ‚ç‚¹ä¸Šï¼Œè€Œæ˜¯å°†è¿™äº›ä¿¡æ¯å‚¨å­˜åœ¨`$.cache`å¯¹è±¡ä¸Šã€‚jQueryå¯¹è±¡æ¯æ¬¡æ–°å¢äº‹ä»¶æˆ–æ•°æ®æ—¶ï¼Œéƒ½åœ¨`$.cache`æ–°å¢ä¸€æ¡æ•°æ®ã€‚è€Œ`$.cache`ä¼šæŒæœ‰å¯¹åº”DOMèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰æ­£ç¡®åˆ é™¤DOMèŠ‚ç‚¹ï¼Œä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸èƒ½è¢«å›æ”¶ã€‚å³DOMèŠ‚ç‚¹å·²ä»DOMä¸­åˆ é™¤ï¼Œä½†ä¾ç„¶è¿˜å­˜åœ¨å†…å­˜ä¸­ï¼Œæ²¡æœ‰è¢«CGå›æ”¶ã€‚æ­£ç¡®çš„åˆ é™¤æ–¹å¼æ˜¯é€šè¿‡jQueryçš„åˆ é™¤æ–¹æ³•æ¥ç§»é™¤ï¼š`remove()`,`empty()`,`html()`;\n\n#### ä¸Šè¿°æåˆ°ä¸æ­£ç¡®çš„åˆ é™¤æ–¹å¼ï¼Œä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸èƒ½è¢«å›æ”¶ï¼Œè€Œå¯¼è‡´å†…å­˜æ³„éœ²é—®é¢˜ã€‚å¦‚ä½¿ç”¨JavaScriptå†…ç½®æ–¹æ³•ï¼ˆå¦‚removeChildï¼ŒinnerHTMLï¼‰æ¥åˆ é™¤jQueryç»‘å®šäº†äº‹ä»¶æˆ–æ•°æ®çš„èŠ‚ç‚¹ã€‚\n\n```js\nvar $element = $('<div></div>');\n$element.on('click', function() { ... });\n$element.appendTo(document.body); \nvar nativeElement = $element.get(0);\ndocument.body.removeChild(nativeElement); // â† é€šè¿‡removeChildæ–¹æ³•ç§»é™¤nativeElement\n```\n\nä¸Šè¿°ä»£ç ä¸­ä½¿ç”¨å†…ç½®çš„removeChildæ–¹æ³•ç§»é™¤nativeElementï¼Œæ­¤æ—¶ä»…ä»…åªæ˜¯å°†nativeElementä¸DOMè„±ç¦»è€Œå·²ï¼Œå¹¶æ²¡æœ‰çœŸæ­£åœ°åˆ é™¤nativeElementã€‚åŸå› æ˜¯$elementç»‘å®šäº†äº‹ä»¶ï¼Œ`$.cache`ä¸­æŒæœ‰å¯¹$elementå¼•ç”¨ï¼Œå¯¼è‡´nativeElementä¸èƒ½è¢«å›æ”¶æ‰ã€‚\n\n```js\nvar $element = $('<div></div>');\n$element.on('click', function() { ... });// â† ç»‘å®šäº‹ä»¶\n$element.appendTo(document.body);\ndocument.body.innerHTML = '';// â† é€šè¿‡innerHTMLæ–¹æ³•ç§»é™¤bodyå†…çš„èŠ‚ç‚¹\n```\ninnerHTMLæ–¹æ³•ä¹Ÿå­˜åœ¨åŒæ ·çš„é—®é¢˜ã€‚\n\n\n#### ä¸Šè¿°å®ä¾‹éƒ½æ˜¯ç»‘å®šäº‹ä»¶çš„ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ç»‘å®šæ•°æ®çš„ä¾‹å­ï¼šå‡å¦‚é€šè¿‡jQueryåˆ›å»ºä¸€ä¸ªDOMå…ƒç´ ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªdataï¼Œä½†æ²¡æœ‰å°†å…¶æ·»åŠ åˆ°DOMä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n```js\n$element = $('<div></div>');\n$element.data('foo', 'bar');\n```\n\nå³ä½¿ä»£ç æ‰§è¡Œå®Œï¼Œ$elementä¹Ÿä¸èƒ½è¢«å›æ”¶ã€‚è¿™æ˜¯å› ä¸º$.cahceé˜»æ­¢CGçš„å›æ”¶ã€‚éœ€è¦é€šè¿‡`$element.remove()`,`$element.parent.empty()`æˆ–`$elememnt.removeData()`;\n\n\n## ä¸ºä»€ä¹ˆ`remove()`,`empty()`,`html()`èƒ½æ­£ç¡®ç§»é™¤DOMèŠ‚ç‚¹\nå› ä¸ºå®ƒä»¬éƒ½ä¼šè°ƒç”¨`jQuery.cleanData()`æ–¹æ³•æ¥åˆ é™¤`$.cache`ç¼“å­˜çš„å¯¹åº”æ•°æ®ï¼Œç„¶ååœ¨è°ƒç”¨JavaScriptå†…ç½®åˆ é™¤æ–¹æ³•æ¥ç§»é™¤DOMèŠ‚ç‚¹ã€‚\n\n[empty()æ–¹æ³•æºç ](https://github.com/jquery/jquery/blob/1.12-stable/src/manipulation.js#L461)ï¼š\n\n```js\n\tempty: function() {\n\t\tvar elem,\n\t\t\ti = 0;\n\n\t\tfor ( ; ( elem = this[ i ] ) != null; i++ ) {\n\n\t\t\t// Remove element nodes and prevent memory leaks \n      // åˆ é™¤å…ƒç´ èŠ‚ç‚¹å¹¶é˜»æ­¢å†…å­˜æ³„éœ²\n\t\t\tif ( elem.nodeType === 1 ) {\n\t\t\t\tjQuery.cleanData( getAll( elem, false ) );// â† æ¸…é™¤elemåœ¨$.cacheä¸­çš„æ•°æ®ï¼Œé‡Šæ”¾æ‰$.cacheå¯¹elemçš„å¼•ç”¨\n\t\t\t}\n\n\t\t\t// Remove any remaining nodes\n\t\t\twhile ( elem.firstChild ) {\n\t\t\t\telem.removeChild( elem.firstChild );\n\t\t\t}\n\n\t\t\t// If this is a select, ensure that it displays empty (#12336)\n\t\t\t// Support: IE<9\n\t\t\tif ( elem.options && jQuery.nodeName( elem, \"select\" ) ) {\n\t\t\t\telem.options.length = 0;\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t},\n\n```\n\n[remove()æ–¹æ³•æºç ](https://github.com/jquery/jquery/blob/1.12-stable/src/manipulation.js#L265)\n\n```js\nfunction remove( elem, selector, keepData ) {\n\tvar node,\n\t\telems = selector ? jQuery.filter( selector, elem ) : elem,\n\t\ti = 0;\n\n\tfor ( ; ( node = elems[ i ] ) != null; i++ ) {\n\n\t\tif ( !keepData && node.nodeType === 1 ) {\n\t\t\tjQuery.cleanData( getAll( node ) );// â† æ¸…é™¤elemåœ¨$.cacheä¸­çš„æ•°æ®ï¼Œé‡Šæ”¾æ‰$.cacheå¯¹elemçš„å¼•ç”¨\n\t\t}\n\n\t\tif ( node.parentNode ) {\n\t\t\tif ( keepData && jQuery.contains( node.ownerDocument, node ) ) {\n\t\t\t\tsetGlobalEval( getAll( node, \"script\" ) );\n\t\t\t}\n\t\t\tnode.parentNode.removeChild( node );\n\t\t}\n\t}\n\n\treturn elem;\n}\n```\n\n[html()æ–¹æ³•æºç ](https://github.com/jquery/jquery/blob/1.12-stable/src/manipulation.js#L496)\n```js\n\thtml: function( value ) {\n\t\treturn access( this, function( value ) {\n\t\t\tvar elem = this[ 0 ] || {},\n\t\t\t\ti = 0,\n\t\t\t\tl = this.length;\n\n\t\t\tif ( value === undefined ) {\n\t\t\t\treturn elem.nodeType === 1 ?\n\t\t\t\t\telem.innerHTML.replace( rinlinejQuery, \"\" ) :\n\t\t\t\t\tundefined;\n\t\t\t}\n\n\t\t\t// See if we can take a shortcut and just use innerHTML\n\t\t\tif ( typeof value === \"string\" && !rnoInnerhtml.test( value ) &&\n\t\t\t\t( support.htmlSerialize || !rnoshimcache.test( value )  ) &&\n\t\t\t\t( support.leadingWhitespace || !rleadingWhitespace.test( value ) ) &&\n\t\t\t\t!wrapMap[ ( rtagName.exec( value ) || [ \"\", \"\" ] )[ 1 ].toLowerCase() ] ) {\n\n\t\t\t\tvalue = jQuery.htmlPrefilter( value );\n\n\t\t\t\ttry {\n\t\t\t\t\tfor ( ; i < l; i++ ) {\n\n\t\t\t\t\t\t// Remove element nodes and prevent memory leaks\n            // åˆ é™¤å…ƒç´ èŠ‚ç‚¹å¹¶é˜»æ­¢å†…å­˜æ³„éœ²\n\t\t\t\t\t\telem = this[ i ] || {};\n\t\t\t\t\t\tif ( elem.nodeType === 1 ) {\n\t\t\t\t\t\t\tjQuery.cleanData( getAll( elem, false ) );// â† æ¸…é™¤elemåœ¨$.cacheä¸­çš„æ•°æ®ï¼Œé‡Šæ”¾æ‰$.cacheå¯¹elemçš„å¼•ç”¨\n\t\t\t\t\t\t\telem.innerHTML = value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telem = 0;\n\n\t\t\t\t// If using innerHTML throws an exception, use the fallback method\n\t\t\t\t} catch ( e ) {}\n\t\t\t}\n\n\t\t\tif ( elem ) {\n\t\t\t\tthis.empty().append( value );\n\t\t\t}\n\t\t}, null, value, arguments.length );\n\t}\n```\n\n## ä¸ºä»€ä¹ˆjQueryæ²¡æœ‰å°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨åœ¨DOMå…ƒç´ ä¸Šï¼Œè€Œæ˜¯å°†å…¶ä¿å­˜åœ¨$.cacheä¸­ï¼Ÿ\n\nå› ä¸ºåœ¨IE<8ç‰ˆæœ¬ä¸­ï¼ŒJScriptåƒåœ¾å›æ”¶å™¨ä»…ç®¡ç†JScriptå¯¹è±¡ç”Ÿå‘½å‘¨æœŸè€Œä¸ä¼šç®¡ç†DOMå¯¹è±¡çš„(å³DOMå¯¹è±¡æœ‰è‡ªå·±çš„åƒåœ¾å›æ”¶å™¨)ã€‚å³JScriptå›æ”¶å™¨ä¸ä¼šè§£é™¤æ‰DOMå¯¹è±¡ä¸Jscriptå¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨ï¼ˆå¾ªç¯å¼•ç”¨ï¼‰ï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚ä¸ºäº†é¿å…åœ¨ä½ç‰ˆæœ¬IEå’ŒFirefoxä¸­å†…å­˜æ³„éœ²ï¼ŒjQueryåˆ›å»ºäº†`$.cache`æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ›´å¤šä¿¡æ¯å‚è€ƒ[IE<8å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„éœ²](http://123fe.cn/2017/11/10/IE-8%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E5%AF%BC%E8%87%B4%E7%9A%84%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2/)ã€‚\n\n\n>  jQuery 2.0 leaves behind the older Internet Explorer 6, 7, and 8 browsers. In return it is smaller, faster, and can be used in JavaScript environments where the code needed for old-IE compatibility often causes problems of its own. But donâ€™t worry, the jQuery team still supports the 1.x branch which does run on IE 6/7/8. You can (and should) continue to use jQuery 1.9 (and the upcoming 1.10) on web sites that need to accommodate older browsers. The final 2.0.0 file is 12 percent smaller than the 1.9.1 file, thanks to the elimination of patches that were only needed for IE 6, 7, and 8. ----[jQuery 2.0 Released](http://blog.jquery.com/2013/04/18/jquery-2-0-released/)\n\n**å¤§æ¦‚æ„æ€**ï¼š<u>jQuery2.0ç‰ˆæœ¬ä¹‹åï¼ŒjQueryå›¢é˜ŸåŒæ—¶ç»´æŠ¤ä¸¤ä¸ªåˆ†æ”¯ï¼š2.xç‰ˆæœ¬å’Œ1.xç‰ˆæœ¬ã€‚jQuery2.0å¼€å§‹æ”¾å¼ƒIE6/7/8æ”¯æŒ(æ³¨ï¼šä¹ŸåŒ…å«3.xç‰ˆæœ¬)ã€‚è€ŒjQuery1.xç‰ˆæœ¬ä¼šç»§ç»­æ”¯æŒIE6/7/8ã€‚å› ä¸º2.xç‰ˆæœ¬åˆ é™¤äº†IE6/7/8è¡¥ä¸ä»£ç ï¼Œæ•´ä½“å¤§å°æ¯”1.xç‰ˆæœ¬å°12%ï¼Œæ€§èƒ½æ›´å¥½ã€‚</u>\n\nå³ä»jQuery2.0å¼€å§‹ä¸æ”¯æŒIE6/7/8ï¼Œå°±ä¸å­˜åœ¨å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œå› æ­¤$.cacheä¹Ÿä»jQuery2.xç‰ˆæœ¬ä¸­ç§»é™¤ã€‚jQuery2.0å¼€å§‹å°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨å­˜å‚¨åœ¨å…ƒç´ èŠ‚ç‚¹ä¸Šï¼Œè¿™æ ·å°±ä¸å­˜åœ¨ä¸Šè¿°çš„å†…å­˜æ³„éœ²é—®é¢˜äº†ã€‚\n\n## å¯¹æ¯”æµ‹è¯•\nåˆ†åˆ«ä½¿ç”¨jquery1.xå’Œjquery2.xç‰ˆæœ¬åˆ›å»ºä¸€ä¸ª1000ä¸ªå…ƒç´ å¹¶ç»‘å®šclickäº‹ä»¶ï¼Œåˆ›å»ºå®Œåå†é€šè¿‡JavaScriptåˆ é™¤æ–¹æ³•ç§»é™¤ï¼Œå¹¶é€šè¿‡**Devtools**-->**Performance**åšåˆ†æï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š\n  1. å¼€å¯**Performance**é¡¹çš„è®°å½•\n  2. æ‰§è¡Œä¸€æ¬¡CGï¼Œåˆ›å»ºåŸºæœ¬å‚è€ƒçº¿\n  3. å•å‡»ã€runã€‘æŒ‰é’®ï¼Œåˆ›å»º1000ä¸ªå…ƒç´ \n  4. å†æ¬¡å•å‡»ã€runã€‘æŒ‰é’®ï¼Œåˆ›å»º1000ä¸ªå…ƒç´ \n  5. å•å‡»ã€clearã€‘æŒ‰é’®ï¼Œé€šè¿‡JavaScriptåˆ é™¤æ–¹æ³•ç§»é™¤åˆšåˆ›å»º2000ä¸ªå…ƒç´ \n  6. æ‰§è¡Œä¸€æ¬¡CG\n\nç»“æœå›¾å¦‚ä¸‹ï¼š\n\n![](./jquery1_x.png)\n\n----\n\n![](./jquery2_x.png)\n\n\n\n\n\n\n**ä»å¯¹æ¯”ç»“æœå›¾è¯å®äº†jquery2.xå°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨åœ¨å…ƒç´ å¯¹è±¡ä¸Šã€‚è¿™é‡Œä¹Ÿå¯ä»¥åˆ†åˆ«æ‰“å°`$.cache`ï¼Œå¯¹æ¯”ä¸€ä¸‹è¾“å‡ºç»“æœï¼š**\n\n![](./jquery_cache_1_x.png)\n\n----\n\n![](./jquery_cache_2_x.png)\n\n\nè¿™é‡Œæ²¡æœ‰è®¨è®ºjquery3.xç‰ˆæœ¬ï¼Œå› ä¸ºå®ƒä¸jquery2.xç‰ˆæœ¬ä¸€æ ·ä¸æ”¯æŒä½ç‰ˆæœ¬IEï¼Œä¹Ÿä¸å­˜åœ¨`$.cache`é—®é¢˜ï¼Œæ‰€ä»¥ä¸å†èµ˜è¿°ã€‚\n\n## æ€»ç»“\n\næœ¬æ–‡ä¸»è¦è®¨è®ºäº†jqueryçš„`$.cache`å¼•èµ·çš„å†…å­˜æ³„éœ²é—®é¢˜ã€‚åœ¨ä½¿ç”¨jquery1.xç‰ˆæœ¬æ—¶ï¼Œéœ€è¦å…³æ³¨ä¸€ä¸‹è¿™ä¸€é—®é¢˜ã€‚å¦‚jquery.lazyload.jså’Œå•é¡µåº”ç”¨éƒ½å¾ˆå®¹æ˜“å¼•èµ·è¿™æ–¹é¢çš„é—®é¢˜ã€‚å¦‚ä½•é¿å…å‘¢ï¼Ÿæœ¬æ–‡ä¹Ÿæåˆ°äº†ï¼Œé€šè¿‡jqueryçš„åˆ é™¤æ–¹æ³•æ¥ç§»é™¤:`remove()`,`empty()`,`html()`ã€‚**åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ—¶ä¸€å®šè¦è®°ä½ï¼šé€šè¿‡ä»»ä½•ç¬¬ä¸‰æ–¹åº“åˆ›å»ºçš„å¯¹è±¡ï¼Œæœ€å¥½é€šè¿‡è¯¥åº“æä¾›çš„åˆ é™¤æ–¹æ³•æ¥åˆ é™¤ã€‚**\n\n\n## å‚è€ƒæ–‡ç« ï¼š\n\n- [How to create memory leaks in jQuery](https://makandracards.com/makandra/31325-how-to-create-memory-leaks-in-jquery)\n- [What is the purpose of $.cache in jQuery?](https://stackoverflow.com/questions/9304768/what-is-the-purpose-of-cache-in-jquery)\n- [JScript Memory Leaks](http://www.crockford.com/javascript/memory/leak.html)\n- [Memory Leaks in Microsoft Internet Explorer](http://isaacschlueter.com/2006/10/msie-memory-leaks/)\n","slug":"å†…å­˜æ³„éœ²ä¹‹jQuery-cache","published":1,"updated":"2018-08-22T08:06:45.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjl4vatam000f1hn9rven9ng7","content":"<p><img src=\"./jquery.jpg\" alt=\"jquery.jpg\"></p>\n<p>jQueryæ²¡æœ‰å°†äº‹ä»¶å’Œæ•°æ®ç»‘å®šåœ¨DOMèŠ‚ç‚¹ä¸Šï¼Œè€Œæ˜¯å°†è¿™äº›ä¿¡æ¯å‚¨å­˜åœ¨<code>$.cache</code>å¯¹è±¡ä¸Šã€‚jQueryå¯¹è±¡æ¯æ¬¡æ–°å¢äº‹ä»¶æˆ–æ•°æ®æ—¶ï¼Œéƒ½åœ¨<code>$.cache</code>æ–°å¢ä¸€æ¡æ•°æ®ã€‚è€Œ<code>$.cache</code>ä¼šæŒæœ‰å¯¹åº”DOMèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰æ­£ç¡®åˆ é™¤DOMèŠ‚ç‚¹ï¼Œä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸èƒ½è¢«å›æ”¶ã€‚å³DOMèŠ‚ç‚¹å·²ä»DOMä¸­åˆ é™¤ï¼Œä½†ä¾ç„¶è¿˜å­˜åœ¨å†…å­˜ä¸­ï¼Œæ²¡æœ‰è¢«CGå›æ”¶ã€‚æ­£ç¡®çš„åˆ é™¤æ–¹å¼æ˜¯é€šè¿‡jQueryçš„åˆ é™¤æ–¹æ³•æ¥ç§»é™¤ï¼š<code>remove()</code>,<code>empty()</code>,<code>html()</code>;</p>\n<h4 id=\"ä¸Šè¿°æåˆ°ä¸æ­£ç¡®çš„åˆ é™¤æ–¹å¼ï¼Œä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸èƒ½è¢«å›æ”¶ï¼Œè€Œå¯¼è‡´å†…å­˜æ³„éœ²é—®é¢˜ã€‚å¦‚ä½¿ç”¨JavaScriptå†…ç½®æ–¹æ³•ï¼ˆå¦‚removeChildï¼ŒinnerHTMLï¼‰æ¥åˆ é™¤jQueryç»‘å®šäº†äº‹ä»¶æˆ–æ•°æ®çš„èŠ‚ç‚¹ã€‚\"><a href=\"#ä¸Šè¿°æåˆ°ä¸æ­£ç¡®çš„åˆ é™¤æ–¹å¼ï¼Œä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸èƒ½è¢«å›æ”¶ï¼Œè€Œå¯¼è‡´å†…å­˜æ³„éœ²é—®é¢˜ã€‚å¦‚ä½¿ç”¨JavaScriptå†…ç½®æ–¹æ³•ï¼ˆå¦‚removeChildï¼ŒinnerHTMLï¼‰æ¥åˆ é™¤jQueryç»‘å®šäº†äº‹ä»¶æˆ–æ•°æ®çš„èŠ‚ç‚¹ã€‚\" class=\"headerlink\" title=\"ä¸Šè¿°æåˆ°ä¸æ­£ç¡®çš„åˆ é™¤æ–¹å¼ï¼Œä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸èƒ½è¢«å›æ”¶ï¼Œè€Œå¯¼è‡´å†…å­˜æ³„éœ²é—®é¢˜ã€‚å¦‚ä½¿ç”¨JavaScriptå†…ç½®æ–¹æ³•ï¼ˆå¦‚removeChildï¼ŒinnerHTMLï¼‰æ¥åˆ é™¤jQueryç»‘å®šäº†äº‹ä»¶æˆ–æ•°æ®çš„èŠ‚ç‚¹ã€‚\"></a>ä¸Šè¿°æåˆ°ä¸æ­£ç¡®çš„åˆ é™¤æ–¹å¼ï¼Œä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸èƒ½è¢«å›æ”¶ï¼Œè€Œå¯¼è‡´å†…å­˜æ³„éœ²é—®é¢˜ã€‚å¦‚ä½¿ç”¨JavaScriptå†…ç½®æ–¹æ³•ï¼ˆå¦‚removeChildï¼ŒinnerHTMLï¼‰æ¥åˆ é™¤jQueryç»‘å®šäº†äº‹ä»¶æˆ–æ•°æ®çš„èŠ‚ç‚¹ã€‚</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> $element = $(<span class=\"string\">'&lt;div&gt;&lt;/div&gt;'</span>);</div><div class=\"line\">$element.on(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; ... &#125;);</div><div class=\"line\">$element.appendTo(<span class=\"built_in\">document</span>.body); </div><div class=\"line\"><span class=\"keyword\">var</span> nativeElement = $element.get(<span class=\"number\">0</span>);</div><div class=\"line\"><span class=\"built_in\">document</span>.body.removeChild(nativeElement); <span class=\"comment\">// â† é€šè¿‡removeChildæ–¹æ³•ç§»é™¤nativeElement</span></div></pre></td></tr></table></figure>\n<p>ä¸Šè¿°ä»£ç ä¸­ä½¿ç”¨å†…ç½®çš„removeChildæ–¹æ³•ç§»é™¤nativeElementï¼Œæ­¤æ—¶ä»…ä»…åªæ˜¯å°†nativeElementä¸DOMè„±ç¦»è€Œå·²ï¼Œå¹¶æ²¡æœ‰çœŸæ­£åœ°åˆ é™¤nativeElementã€‚åŸå› æ˜¯$elementç»‘å®šäº†äº‹ä»¶ï¼Œ<code>$.cache</code>ä¸­æŒæœ‰å¯¹$elementå¼•ç”¨ï¼Œå¯¼è‡´nativeElementä¸èƒ½è¢«å›æ”¶æ‰ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> $element = $(<span class=\"string\">'&lt;div&gt;&lt;/div&gt;'</span>);</div><div class=\"line\">$element.on(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; ... &#125;);<span class=\"comment\">// â† ç»‘å®šäº‹ä»¶</span></div><div class=\"line\">$element.appendTo(<span class=\"built_in\">document</span>.body);</div><div class=\"line\"><span class=\"built_in\">document</span>.body.innerHTML = <span class=\"string\">''</span>;<span class=\"comment\">// â† é€šè¿‡innerHTMLæ–¹æ³•ç§»é™¤bodyå†…çš„èŠ‚ç‚¹</span></div></pre></td></tr></table></figure>\n<p>innerHTMLæ–¹æ³•ä¹Ÿå­˜åœ¨åŒæ ·çš„é—®é¢˜ã€‚</p>\n<h4 id=\"ä¸Šè¿°å®ä¾‹éƒ½æ˜¯ç»‘å®šäº‹ä»¶çš„ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ç»‘å®šæ•°æ®çš„ä¾‹å­ï¼šå‡å¦‚é€šè¿‡jQueryåˆ›å»ºä¸€ä¸ªDOMå…ƒç´ ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªdataï¼Œä½†æ²¡æœ‰å°†å…¶æ·»åŠ åˆ°DOMä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š\"><a href=\"#ä¸Šè¿°å®ä¾‹éƒ½æ˜¯ç»‘å®šäº‹ä»¶çš„ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ç»‘å®šæ•°æ®çš„ä¾‹å­ï¼šå‡å¦‚é€šè¿‡jQueryåˆ›å»ºä¸€ä¸ªDOMå…ƒç´ ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªdataï¼Œä½†æ²¡æœ‰å°†å…¶æ·»åŠ åˆ°DOMä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š\" class=\"headerlink\" title=\"ä¸Šè¿°å®ä¾‹éƒ½æ˜¯ç»‘å®šäº‹ä»¶çš„ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ç»‘å®šæ•°æ®çš„ä¾‹å­ï¼šå‡å¦‚é€šè¿‡jQueryåˆ›å»ºä¸€ä¸ªDOMå…ƒç´ ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªdataï¼Œä½†æ²¡æœ‰å°†å…¶æ·»åŠ åˆ°DOMä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š\"></a>ä¸Šè¿°å®ä¾‹éƒ½æ˜¯ç»‘å®šäº‹ä»¶çš„ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ç»‘å®šæ•°æ®çš„ä¾‹å­ï¼šå‡å¦‚é€šè¿‡jQueryåˆ›å»ºä¸€ä¸ªDOMå…ƒç´ ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªdataï¼Œä½†æ²¡æœ‰å°†å…¶æ·»åŠ åˆ°DOMä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">$element = $(<span class=\"string\">'&lt;div&gt;&lt;/div&gt;'</span>);</div><div class=\"line\">$element.data(<span class=\"string\">'foo'</span>, <span class=\"string\">'bar'</span>);</div></pre></td></tr></table></figure>\n<p>å³ä½¿ä»£ç æ‰§è¡Œå®Œï¼Œ$elementä¹Ÿä¸èƒ½è¢«å›æ”¶ã€‚è¿™æ˜¯å› ä¸º$.cahceé˜»æ­¢CGçš„å›æ”¶ã€‚éœ€è¦é€šè¿‡<code>$element.remove()</code>,<code>$element.parent.empty()</code>æˆ–<code>$elememnt.removeData()</code>;</p>\n<h2 id=\"ä¸ºä»€ä¹ˆremove-empty-html-èƒ½æ­£ç¡®ç§»é™¤DOMèŠ‚ç‚¹\"><a href=\"#ä¸ºä»€ä¹ˆremove-empty-html-èƒ½æ­£ç¡®ç§»é™¤DOMèŠ‚ç‚¹\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆremove(),empty(),html()èƒ½æ­£ç¡®ç§»é™¤DOMèŠ‚ç‚¹\"></a>ä¸ºä»€ä¹ˆ<code>remove()</code>,<code>empty()</code>,<code>html()</code>èƒ½æ­£ç¡®ç§»é™¤DOMèŠ‚ç‚¹</h2><p>å› ä¸ºå®ƒä»¬éƒ½ä¼šè°ƒç”¨<code>jQuery.cleanData()</code>æ–¹æ³•æ¥åˆ é™¤<code>$.cache</code>ç¼“å­˜çš„å¯¹åº”æ•°æ®ï¼Œç„¶ååœ¨è°ƒç”¨JavaScriptå†…ç½®åˆ é™¤æ–¹æ³•æ¥ç§»é™¤DOMèŠ‚ç‚¹ã€‚</p>\n<p><a href=\"https://github.com/jquery/jquery/blob/1.12-stable/src/manipulation.js#L461\" target=\"_blank\" rel=\"external\">empty()æ–¹æ³•æºç </a>ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\">empty: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">var</span> elem,</div><div class=\"line\">\t\ti = <span class=\"number\">0</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">for</span> ( ; ( elem = <span class=\"keyword\">this</span>[ i ] ) != <span class=\"literal\">null</span>; i++ ) &#123;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// Remove element nodes and prevent memory leaks </span></div><div class=\"line\">     <span class=\"comment\">// åˆ é™¤å…ƒç´ èŠ‚ç‚¹å¹¶é˜»æ­¢å†…å­˜æ³„éœ²</span></div><div class=\"line\">\t\t<span class=\"keyword\">if</span> ( elem.nodeType === <span class=\"number\">1</span> ) &#123;</div><div class=\"line\">\t\t\tjQuery.cleanData( getAll( elem, <span class=\"literal\">false</span> ) );<span class=\"comment\">// â† æ¸…é™¤elemåœ¨$.cacheä¸­çš„æ•°æ®ï¼Œé‡Šæ”¾æ‰$.cacheå¯¹elemçš„å¼•ç”¨</span></div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// Remove any remaining nodes</span></div><div class=\"line\">\t\t<span class=\"keyword\">while</span> ( elem.firstChild ) &#123;</div><div class=\"line\">\t\t\telem.removeChild( elem.firstChild );</div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// If this is a select, ensure that it displays empty (#12336)</span></div><div class=\"line\">\t\t<span class=\"comment\">// Support: IE&lt;9</span></div><div class=\"line\">\t\t<span class=\"keyword\">if</span> ( elem.options &amp;&amp; jQuery.nodeName( elem, <span class=\"string\">\"select\"</span> ) ) &#123;</div><div class=\"line\">\t\t\telem.options.length = <span class=\"number\">0</span>;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</div><div class=\"line\">&#125;,</div></pre></td></tr></table></figure>\n<p><a href=\"https://github.com/jquery/jquery/blob/1.12-stable/src/manipulation.js#L265\" target=\"_blank\" rel=\"external\">remove()æ–¹æ³•æºç </a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">remove</span>(<span class=\"params\"> elem, selector, keepData </span>) </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">var</span> node,</div><div class=\"line\">\t\telems = selector ? jQuery.filter( selector, elem ) : elem,</div><div class=\"line\">\t\ti = <span class=\"number\">0</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">for</span> ( ; ( node = elems[ i ] ) != <span class=\"literal\">null</span>; i++ ) &#123;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">if</span> ( !keepData &amp;&amp; node.nodeType === <span class=\"number\">1</span> ) &#123;</div><div class=\"line\">\t\t\tjQuery.cleanData( getAll( node ) );<span class=\"comment\">// â† æ¸…é™¤elemåœ¨$.cacheä¸­çš„æ•°æ®ï¼Œé‡Šæ”¾æ‰$.cacheå¯¹elemçš„å¼•ç”¨</span></div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">if</span> ( node.parentNode ) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> ( keepData &amp;&amp; jQuery.contains( node.ownerDocument, node ) ) &#123;</div><div class=\"line\">\t\t\t\tsetGlobalEval( getAll( node, <span class=\"string\">\"script\"</span> ) );</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tnode.parentNode.removeChild( node );</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">return</span> elem;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p><a href=\"https://github.com/jquery/jquery/blob/1.12-stable/src/manipulation.js#L496\" target=\"_blank\" rel=\"external\">html()æ–¹æ³•æºç </a><br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div></pre></td><td class=\"code\"><pre><div class=\"line\">html: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> value </span>) </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">return</span> access( <span class=\"keyword\">this</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> value </span>) </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">var</span> elem = <span class=\"keyword\">this</span>[ <span class=\"number\">0</span> ] || &#123;&#125;,</div><div class=\"line\">\t\t\ti = <span class=\"number\">0</span>,</div><div class=\"line\">\t\t\tl = <span class=\"keyword\">this</span>.length;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">if</span> ( value === <span class=\"literal\">undefined</span> ) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">return</span> elem.nodeType === <span class=\"number\">1</span> ?</div><div class=\"line\">\t\t\t\telem.innerHTML.replace( rinlinejQuery, <span class=\"string\">\"\"</span> ) :</div><div class=\"line\">\t\t\t\t<span class=\"literal\">undefined</span>;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// See if we can take a shortcut and just use innerHTML</span></div><div class=\"line\">\t\t<span class=\"keyword\">if</span> ( <span class=\"keyword\">typeof</span> value === <span class=\"string\">\"string\"</span> &amp;&amp; !rnoInnerhtml.test( value ) &amp;&amp;</div><div class=\"line\">\t\t\t( support.htmlSerialize || !rnoshimcache.test( value )  ) &amp;&amp;</div><div class=\"line\">\t\t\t( support.leadingWhitespace || !rleadingWhitespace.test( value ) ) &amp;&amp;</div><div class=\"line\">\t\t\t!wrapMap[ ( rtagName.exec( value ) || [ <span class=\"string\">\"\"</span>, <span class=\"string\">\"\"</span> ] )[ <span class=\"number\">1</span> ].toLowerCase() ] ) &#123;</div><div class=\"line\"></div><div class=\"line\">\t\t\tvalue = jQuery.htmlPrefilter( value );</div><div class=\"line\"></div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> ( ; i &lt; l; i++ ) &#123;</div><div class=\"line\"></div><div class=\"line\">\t\t\t\t\t<span class=\"comment\">// Remove element nodes and prevent memory leaks</span></div><div class=\"line\">           <span class=\"comment\">// åˆ é™¤å…ƒç´ èŠ‚ç‚¹å¹¶é˜»æ­¢å†…å­˜æ³„éœ²</span></div><div class=\"line\">\t\t\t\t\telem = <span class=\"keyword\">this</span>[ i ] || &#123;&#125;;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> ( elem.nodeType === <span class=\"number\">1</span> ) &#123;</div><div class=\"line\">\t\t\t\t\t\tjQuery.cleanData( getAll( elem, <span class=\"literal\">false</span> ) );<span class=\"comment\">// â† æ¸…é™¤elemåœ¨$.cacheä¸­çš„æ•°æ®ï¼Œé‡Šæ”¾æ‰$.cacheå¯¹elemçš„å¼•ç”¨</span></div><div class=\"line\">\t\t\t\t\t\telem.innerHTML = value;</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t\t\telem = <span class=\"number\">0</span>;</div><div class=\"line\"></div><div class=\"line\">\t\t\t<span class=\"comment\">// If using innerHTML throws an exception, use the fallback method</span></div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> ( e ) &#123;&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">if</span> ( elem ) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">this</span>.empty().append( value );</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;, <span class=\"literal\">null</span>, value, <span class=\"built_in\">arguments</span>.length );</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<h2 id=\"ä¸ºä»€ä¹ˆjQueryæ²¡æœ‰å°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨åœ¨DOMå…ƒç´ ä¸Šï¼Œè€Œæ˜¯å°†å…¶ä¿å­˜åœ¨-cacheä¸­ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆjQueryæ²¡æœ‰å°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨åœ¨DOMå…ƒç´ ä¸Šï¼Œè€Œæ˜¯å°†å…¶ä¿å­˜åœ¨-cacheä¸­ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆjQueryæ²¡æœ‰å°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨åœ¨DOMå…ƒç´ ä¸Šï¼Œè€Œæ˜¯å°†å…¶ä¿å­˜åœ¨$.cacheä¸­ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆjQueryæ²¡æœ‰å°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨åœ¨DOMå…ƒç´ ä¸Šï¼Œè€Œæ˜¯å°†å…¶ä¿å­˜åœ¨$.cacheä¸­ï¼Ÿ</h2><p>å› ä¸ºåœ¨IE&lt;8ç‰ˆæœ¬ä¸­ï¼ŒJScriptåƒåœ¾å›æ”¶å™¨ä»…ç®¡ç†JScriptå¯¹è±¡ç”Ÿå‘½å‘¨æœŸè€Œä¸ä¼šç®¡ç†DOMå¯¹è±¡çš„(å³DOMå¯¹è±¡æœ‰è‡ªå·±çš„åƒåœ¾å›æ”¶å™¨)ã€‚å³JScriptå›æ”¶å™¨ä¸ä¼šè§£é™¤æ‰DOMå¯¹è±¡ä¸Jscriptå¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨ï¼ˆå¾ªç¯å¼•ç”¨ï¼‰ï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚ä¸ºäº†é¿å…åœ¨ä½ç‰ˆæœ¬IEå’ŒFirefoxä¸­å†…å­˜æ³„éœ²ï¼ŒjQueryåˆ›å»ºäº†<code>$.cache</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ›´å¤šä¿¡æ¯å‚è€ƒ<a href=\"http://123fe.cn/2017/11/10/IE-8%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E5%AF%BC%E8%87%B4%E7%9A%84%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2/\" target=\"_blank\" rel=\"external\">IE&lt;8å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„éœ²</a>ã€‚</p>\n<blockquote>\n<p> jQuery 2.0 leaves behind the older Internet Explorer 6, 7, and 8 browsers. In return it is smaller, faster, and can be used in JavaScript environments where the code needed for old-IE compatibility often causes problems of its own. But donâ€™t worry, the jQuery team still supports the 1.x branch which does run on IE 6/7/8. You can (and should) continue to use jQuery 1.9 (and the upcoming 1.10) on web sites that need to accommodate older browsers. The final 2.0.0 file is 12 percent smaller than the 1.9.1 file, thanks to the elimination of patches that were only needed for IE 6, 7, and 8. â€”-<a href=\"http://blog.jquery.com/2013/04/18/jquery-2-0-released/\" target=\"_blank\" rel=\"external\">jQuery 2.0 Released</a></p>\n</blockquote>\n<p><strong>å¤§æ¦‚æ„æ€</strong>ï¼š<u>jQuery2.0ç‰ˆæœ¬ä¹‹åï¼ŒjQueryå›¢é˜ŸåŒæ—¶ç»´æŠ¤ä¸¤ä¸ªåˆ†æ”¯ï¼š2.xç‰ˆæœ¬å’Œ1.xç‰ˆæœ¬ã€‚jQuery2.0å¼€å§‹æ”¾å¼ƒIE6/7/8æ”¯æŒ(æ³¨ï¼šä¹ŸåŒ…å«3.xç‰ˆæœ¬)ã€‚è€ŒjQuery1.xç‰ˆæœ¬ä¼šç»§ç»­æ”¯æŒIE6/7/8ã€‚å› ä¸º2.xç‰ˆæœ¬åˆ é™¤äº†IE6/7/8è¡¥ä¸ä»£ç ï¼Œæ•´ä½“å¤§å°æ¯”1.xç‰ˆæœ¬å°12%ï¼Œæ€§èƒ½æ›´å¥½ã€‚</u></p>\n<p>å³ä»jQuery2.0å¼€å§‹ä¸æ”¯æŒIE6/7/8ï¼Œå°±ä¸å­˜åœ¨å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œå› æ­¤$.cacheä¹Ÿä»jQuery2.xç‰ˆæœ¬ä¸­ç§»é™¤ã€‚jQuery2.0å¼€å§‹å°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨å­˜å‚¨åœ¨å…ƒç´ èŠ‚ç‚¹ä¸Šï¼Œè¿™æ ·å°±ä¸å­˜åœ¨ä¸Šè¿°çš„å†…å­˜æ³„éœ²é—®é¢˜äº†ã€‚</p>\n<h2 id=\"å¯¹æ¯”æµ‹è¯•\"><a href=\"#å¯¹æ¯”æµ‹è¯•\" class=\"headerlink\" title=\"å¯¹æ¯”æµ‹è¯•\"></a>å¯¹æ¯”æµ‹è¯•</h2><p>åˆ†åˆ«ä½¿ç”¨jquery1.xå’Œjquery2.xç‰ˆæœ¬åˆ›å»ºä¸€ä¸ª1000ä¸ªå…ƒç´ å¹¶ç»‘å®šclickäº‹ä»¶ï¼Œåˆ›å»ºå®Œåå†é€šè¿‡JavaScriptåˆ é™¤æ–¹æ³•ç§»é™¤ï¼Œå¹¶é€šè¿‡<strong>Devtools</strong>â€“&gt;<strong>Performance</strong>åšåˆ†æï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<ol>\n<li>å¼€å¯<strong>Performance</strong>é¡¹çš„è®°å½•</li>\n<li>æ‰§è¡Œä¸€æ¬¡CGï¼Œåˆ›å»ºåŸºæœ¬å‚è€ƒçº¿</li>\n<li>å•å‡»ã€runã€‘æŒ‰é’®ï¼Œåˆ›å»º1000ä¸ªå…ƒç´ </li>\n<li>å†æ¬¡å•å‡»ã€runã€‘æŒ‰é’®ï¼Œåˆ›å»º1000ä¸ªå…ƒç´ </li>\n<li>å•å‡»ã€clearã€‘æŒ‰é’®ï¼Œé€šè¿‡JavaScriptåˆ é™¤æ–¹æ³•ç§»é™¤åˆšåˆ›å»º2000ä¸ªå…ƒç´ </li>\n<li>æ‰§è¡Œä¸€æ¬¡CG</li>\n</ol>\n<p>ç»“æœå›¾å¦‚ä¸‹ï¼š</p>\n<p><img src=\"./jquery1_x.png\" alt=\"\"></p>\n<hr>\n<p><img src=\"./jquery2_x.png\" alt=\"\"></p>\n<p><strong>ä»å¯¹æ¯”ç»“æœå›¾è¯å®äº†jquery2.xå°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨åœ¨å…ƒç´ å¯¹è±¡ä¸Šã€‚è¿™é‡Œä¹Ÿå¯ä»¥åˆ†åˆ«æ‰“å°<code>$.cache</code>ï¼Œå¯¹æ¯”ä¸€ä¸‹è¾“å‡ºç»“æœï¼š</strong></p>\n<p><img src=\"./jquery_cache_1_x.png\" alt=\"\"></p>\n<hr>\n<p><img src=\"./jquery_cache_2_x.png\" alt=\"\"></p>\n<p>è¿™é‡Œæ²¡æœ‰è®¨è®ºjquery3.xç‰ˆæœ¬ï¼Œå› ä¸ºå®ƒä¸jquery2.xç‰ˆæœ¬ä¸€æ ·ä¸æ”¯æŒä½ç‰ˆæœ¬IEï¼Œä¹Ÿä¸å­˜åœ¨<code>$.cache</code>é—®é¢˜ï¼Œæ‰€ä»¥ä¸å†èµ˜è¿°ã€‚</p>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä¸»è¦è®¨è®ºäº†jqueryçš„<code>$.cache</code>å¼•èµ·çš„å†…å­˜æ³„éœ²é—®é¢˜ã€‚åœ¨ä½¿ç”¨jquery1.xç‰ˆæœ¬æ—¶ï¼Œéœ€è¦å…³æ³¨ä¸€ä¸‹è¿™ä¸€é—®é¢˜ã€‚å¦‚jquery.lazyload.jså’Œå•é¡µåº”ç”¨éƒ½å¾ˆå®¹æ˜“å¼•èµ·è¿™æ–¹é¢çš„é—®é¢˜ã€‚å¦‚ä½•é¿å…å‘¢ï¼Ÿæœ¬æ–‡ä¹Ÿæåˆ°äº†ï¼Œé€šè¿‡jqueryçš„åˆ é™¤æ–¹æ³•æ¥ç§»é™¤:<code>remove()</code>,<code>empty()</code>,<code>html()</code>ã€‚<strong>åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ—¶ä¸€å®šè¦è®°ä½ï¼šé€šè¿‡ä»»ä½•ç¬¬ä¸‰æ–¹åº“åˆ›å»ºçš„å¯¹è±¡ï¼Œæœ€å¥½é€šè¿‡è¯¥åº“æä¾›çš„åˆ é™¤æ–¹æ³•æ¥åˆ é™¤ã€‚</strong></p>\n<h2 id=\"å‚è€ƒæ–‡ç« ï¼š\"><a href=\"#å‚è€ƒæ–‡ç« ï¼š\" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« ï¼š\"></a>å‚è€ƒæ–‡ç« ï¼š</h2><ul>\n<li><a href=\"https://makandracards.com/makandra/31325-how-to-create-memory-leaks-in-jquery\" target=\"_blank\" rel=\"external\">How to create memory leaks in jQuery</a></li>\n<li><a href=\"https://stackoverflow.com/questions/9304768/what-is-the-purpose-of-cache-in-jquery\" target=\"_blank\" rel=\"external\">What is the purpose of $.cache in jQuery?</a></li>\n<li><a href=\"http://www.crockford.com/javascript/memory/leak.html\" target=\"_blank\" rel=\"external\">JScript Memory Leaks</a></li>\n<li><a href=\"http://isaacschlueter.com/2006/10/msie-memory-leaks/\" target=\"_blank\" rel=\"external\">Memory Leaks in Microsoft Internet Explorer</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"./jquery.jpg\" alt=\"jquery.jpg\"></p>\n<p>jQueryæ²¡æœ‰å°†äº‹ä»¶å’Œæ•°æ®ç»‘å®šåœ¨DOMèŠ‚ç‚¹ä¸Šï¼Œè€Œæ˜¯å°†è¿™äº›ä¿¡æ¯å‚¨å­˜åœ¨<code>$.cache</code>å¯¹è±¡ä¸Šã€‚jQueryå¯¹è±¡æ¯æ¬¡æ–°å¢äº‹ä»¶æˆ–æ•°æ®æ—¶ï¼Œéƒ½åœ¨<code>$.cache</code>æ–°å¢ä¸€æ¡æ•°æ®ã€‚è€Œ<code>$.cache</code>ä¼šæŒæœ‰å¯¹åº”DOMèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰æ­£ç¡®åˆ é™¤DOMèŠ‚ç‚¹ï¼Œä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸èƒ½è¢«å›æ”¶ã€‚å³DOMèŠ‚ç‚¹å·²ä»DOMä¸­åˆ é™¤ï¼Œä½†ä¾ç„¶è¿˜å­˜åœ¨å†…å­˜ä¸­ï¼Œæ²¡æœ‰è¢«CGå›æ”¶ã€‚æ­£ç¡®çš„åˆ é™¤æ–¹å¼æ˜¯é€šè¿‡jQueryçš„åˆ é™¤æ–¹æ³•æ¥ç§»é™¤ï¼š<code>remove()</code>,<code>empty()</code>,<code>html()</code>;</p>\n<h4 id=\"ä¸Šè¿°æåˆ°ä¸æ­£ç¡®çš„åˆ é™¤æ–¹å¼ï¼Œä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸èƒ½è¢«å›æ”¶ï¼Œè€Œå¯¼è‡´å†…å­˜æ³„éœ²é—®é¢˜ã€‚å¦‚ä½¿ç”¨JavaScriptå†…ç½®æ–¹æ³•ï¼ˆå¦‚removeChildï¼ŒinnerHTMLï¼‰æ¥åˆ é™¤jQueryç»‘å®šäº†äº‹ä»¶æˆ–æ•°æ®çš„èŠ‚ç‚¹ã€‚\"><a href=\"#ä¸Šè¿°æåˆ°ä¸æ­£ç¡®çš„åˆ é™¤æ–¹å¼ï¼Œä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸èƒ½è¢«å›æ”¶ï¼Œè€Œå¯¼è‡´å†…å­˜æ³„éœ²é—®é¢˜ã€‚å¦‚ä½¿ç”¨JavaScriptå†…ç½®æ–¹æ³•ï¼ˆå¦‚removeChildï¼ŒinnerHTMLï¼‰æ¥åˆ é™¤jQueryç»‘å®šäº†äº‹ä»¶æˆ–æ•°æ®çš„èŠ‚ç‚¹ã€‚\" class=\"headerlink\" title=\"ä¸Šè¿°æåˆ°ä¸æ­£ç¡®çš„åˆ é™¤æ–¹å¼ï¼Œä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸èƒ½è¢«å›æ”¶ï¼Œè€Œå¯¼è‡´å†…å­˜æ³„éœ²é—®é¢˜ã€‚å¦‚ä½¿ç”¨JavaScriptå†…ç½®æ–¹æ³•ï¼ˆå¦‚removeChildï¼ŒinnerHTMLï¼‰æ¥åˆ é™¤jQueryç»‘å®šäº†äº‹ä»¶æˆ–æ•°æ®çš„èŠ‚ç‚¹ã€‚\"></a>ä¸Šè¿°æåˆ°ä¸æ­£ç¡®çš„åˆ é™¤æ–¹å¼ï¼Œä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸èƒ½è¢«å›æ”¶ï¼Œè€Œå¯¼è‡´å†…å­˜æ³„éœ²é—®é¢˜ã€‚å¦‚ä½¿ç”¨JavaScriptå†…ç½®æ–¹æ³•ï¼ˆå¦‚removeChildï¼ŒinnerHTMLï¼‰æ¥åˆ é™¤jQueryç»‘å®šäº†äº‹ä»¶æˆ–æ•°æ®çš„èŠ‚ç‚¹ã€‚</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> $element = $(<span class=\"string\">'&lt;div&gt;&lt;/div&gt;'</span>);</div><div class=\"line\">$element.on(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; ... &#125;);</div><div class=\"line\">$element.appendTo(<span class=\"built_in\">document</span>.body); </div><div class=\"line\"><span class=\"keyword\">var</span> nativeElement = $element.get(<span class=\"number\">0</span>);</div><div class=\"line\"><span class=\"built_in\">document</span>.body.removeChild(nativeElement); <span class=\"comment\">// â† é€šè¿‡removeChildæ–¹æ³•ç§»é™¤nativeElement</span></div></pre></td></tr></table></figure>\n<p>ä¸Šè¿°ä»£ç ä¸­ä½¿ç”¨å†…ç½®çš„removeChildæ–¹æ³•ç§»é™¤nativeElementï¼Œæ­¤æ—¶ä»…ä»…åªæ˜¯å°†nativeElementä¸DOMè„±ç¦»è€Œå·²ï¼Œå¹¶æ²¡æœ‰çœŸæ­£åœ°åˆ é™¤nativeElementã€‚åŸå› æ˜¯$elementç»‘å®šäº†äº‹ä»¶ï¼Œ<code>$.cache</code>ä¸­æŒæœ‰å¯¹$elementå¼•ç”¨ï¼Œå¯¼è‡´nativeElementä¸èƒ½è¢«å›æ”¶æ‰ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> $element = $(<span class=\"string\">'&lt;div&gt;&lt;/div&gt;'</span>);</div><div class=\"line\">$element.on(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; ... &#125;);<span class=\"comment\">// â† ç»‘å®šäº‹ä»¶</span></div><div class=\"line\">$element.appendTo(<span class=\"built_in\">document</span>.body);</div><div class=\"line\"><span class=\"built_in\">document</span>.body.innerHTML = <span class=\"string\">''</span>;<span class=\"comment\">// â† é€šè¿‡innerHTMLæ–¹æ³•ç§»é™¤bodyå†…çš„èŠ‚ç‚¹</span></div></pre></td></tr></table></figure>\n<p>innerHTMLæ–¹æ³•ä¹Ÿå­˜åœ¨åŒæ ·çš„é—®é¢˜ã€‚</p>\n<h4 id=\"ä¸Šè¿°å®ä¾‹éƒ½æ˜¯ç»‘å®šäº‹ä»¶çš„ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ç»‘å®šæ•°æ®çš„ä¾‹å­ï¼šå‡å¦‚é€šè¿‡jQueryåˆ›å»ºä¸€ä¸ªDOMå…ƒç´ ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªdataï¼Œä½†æ²¡æœ‰å°†å…¶æ·»åŠ åˆ°DOMä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š\"><a href=\"#ä¸Šè¿°å®ä¾‹éƒ½æ˜¯ç»‘å®šäº‹ä»¶çš„ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ç»‘å®šæ•°æ®çš„ä¾‹å­ï¼šå‡å¦‚é€šè¿‡jQueryåˆ›å»ºä¸€ä¸ªDOMå…ƒç´ ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªdataï¼Œä½†æ²¡æœ‰å°†å…¶æ·»åŠ åˆ°DOMä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š\" class=\"headerlink\" title=\"ä¸Šè¿°å®ä¾‹éƒ½æ˜¯ç»‘å®šäº‹ä»¶çš„ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ç»‘å®šæ•°æ®çš„ä¾‹å­ï¼šå‡å¦‚é€šè¿‡jQueryåˆ›å»ºä¸€ä¸ªDOMå…ƒç´ ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªdataï¼Œä½†æ²¡æœ‰å°†å…¶æ·»åŠ åˆ°DOMä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š\"></a>ä¸Šè¿°å®ä¾‹éƒ½æ˜¯ç»‘å®šäº‹ä»¶çš„ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ç»‘å®šæ•°æ®çš„ä¾‹å­ï¼šå‡å¦‚é€šè¿‡jQueryåˆ›å»ºä¸€ä¸ªDOMå…ƒç´ ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªdataï¼Œä½†æ²¡æœ‰å°†å…¶æ·»åŠ åˆ°DOMä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">$element = $(<span class=\"string\">'&lt;div&gt;&lt;/div&gt;'</span>);</div><div class=\"line\">$element.data(<span class=\"string\">'foo'</span>, <span class=\"string\">'bar'</span>);</div></pre></td></tr></table></figure>\n<p>å³ä½¿ä»£ç æ‰§è¡Œå®Œï¼Œ$elementä¹Ÿä¸èƒ½è¢«å›æ”¶ã€‚è¿™æ˜¯å› ä¸º$.cahceé˜»æ­¢CGçš„å›æ”¶ã€‚éœ€è¦é€šè¿‡<code>$element.remove()</code>,<code>$element.parent.empty()</code>æˆ–<code>$elememnt.removeData()</code>;</p>\n<h2 id=\"ä¸ºä»€ä¹ˆremove-empty-html-èƒ½æ­£ç¡®ç§»é™¤DOMèŠ‚ç‚¹\"><a href=\"#ä¸ºä»€ä¹ˆremove-empty-html-èƒ½æ­£ç¡®ç§»é™¤DOMèŠ‚ç‚¹\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆremove(),empty(),html()èƒ½æ­£ç¡®ç§»é™¤DOMèŠ‚ç‚¹\"></a>ä¸ºä»€ä¹ˆ<code>remove()</code>,<code>empty()</code>,<code>html()</code>èƒ½æ­£ç¡®ç§»é™¤DOMèŠ‚ç‚¹</h2><p>å› ä¸ºå®ƒä»¬éƒ½ä¼šè°ƒç”¨<code>jQuery.cleanData()</code>æ–¹æ³•æ¥åˆ é™¤<code>$.cache</code>ç¼“å­˜çš„å¯¹åº”æ•°æ®ï¼Œç„¶ååœ¨è°ƒç”¨JavaScriptå†…ç½®åˆ é™¤æ–¹æ³•æ¥ç§»é™¤DOMèŠ‚ç‚¹ã€‚</p>\n<p><a href=\"https://github.com/jquery/jquery/blob/1.12-stable/src/manipulation.js#L461\" target=\"_blank\" rel=\"external\">empty()æ–¹æ³•æºç </a>ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\">empty: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">var</span> elem,</div><div class=\"line\">\t\ti = <span class=\"number\">0</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">for</span> ( ; ( elem = <span class=\"keyword\">this</span>[ i ] ) != <span class=\"literal\">null</span>; i++ ) &#123;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// Remove element nodes and prevent memory leaks </span></div><div class=\"line\">     <span class=\"comment\">// åˆ é™¤å…ƒç´ èŠ‚ç‚¹å¹¶é˜»æ­¢å†…å­˜æ³„éœ²</span></div><div class=\"line\">\t\t<span class=\"keyword\">if</span> ( elem.nodeType === <span class=\"number\">1</span> ) &#123;</div><div class=\"line\">\t\t\tjQuery.cleanData( getAll( elem, <span class=\"literal\">false</span> ) );<span class=\"comment\">// â† æ¸…é™¤elemåœ¨$.cacheä¸­çš„æ•°æ®ï¼Œé‡Šæ”¾æ‰$.cacheå¯¹elemçš„å¼•ç”¨</span></div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// Remove any remaining nodes</span></div><div class=\"line\">\t\t<span class=\"keyword\">while</span> ( elem.firstChild ) &#123;</div><div class=\"line\">\t\t\telem.removeChild( elem.firstChild );</div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// If this is a select, ensure that it displays empty (#12336)</span></div><div class=\"line\">\t\t<span class=\"comment\">// Support: IE&lt;9</span></div><div class=\"line\">\t\t<span class=\"keyword\">if</span> ( elem.options &amp;&amp; jQuery.nodeName( elem, <span class=\"string\">\"select\"</span> ) ) &#123;</div><div class=\"line\">\t\t\telem.options.length = <span class=\"number\">0</span>;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</div><div class=\"line\">&#125;,</div></pre></td></tr></table></figure>\n<p><a href=\"https://github.com/jquery/jquery/blob/1.12-stable/src/manipulation.js#L265\" target=\"_blank\" rel=\"external\">remove()æ–¹æ³•æºç </a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">remove</span>(<span class=\"params\"> elem, selector, keepData </span>) </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">var</span> node,</div><div class=\"line\">\t\telems = selector ? jQuery.filter( selector, elem ) : elem,</div><div class=\"line\">\t\ti = <span class=\"number\">0</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">for</span> ( ; ( node = elems[ i ] ) != <span class=\"literal\">null</span>; i++ ) &#123;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">if</span> ( !keepData &amp;&amp; node.nodeType === <span class=\"number\">1</span> ) &#123;</div><div class=\"line\">\t\t\tjQuery.cleanData( getAll( node ) );<span class=\"comment\">// â† æ¸…é™¤elemåœ¨$.cacheä¸­çš„æ•°æ®ï¼Œé‡Šæ”¾æ‰$.cacheå¯¹elemçš„å¼•ç”¨</span></div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">if</span> ( node.parentNode ) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> ( keepData &amp;&amp; jQuery.contains( node.ownerDocument, node ) ) &#123;</div><div class=\"line\">\t\t\t\tsetGlobalEval( getAll( node, <span class=\"string\">\"script\"</span> ) );</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tnode.parentNode.removeChild( node );</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">return</span> elem;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p><a href=\"https://github.com/jquery/jquery/blob/1.12-stable/src/manipulation.js#L496\" target=\"_blank\" rel=\"external\">html()æ–¹æ³•æºç </a><br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div></pre></td><td class=\"code\"><pre><div class=\"line\">html: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> value </span>) </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">return</span> access( <span class=\"keyword\">this</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> value </span>) </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">var</span> elem = <span class=\"keyword\">this</span>[ <span class=\"number\">0</span> ] || &#123;&#125;,</div><div class=\"line\">\t\t\ti = <span class=\"number\">0</span>,</div><div class=\"line\">\t\t\tl = <span class=\"keyword\">this</span>.length;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">if</span> ( value === <span class=\"literal\">undefined</span> ) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">return</span> elem.nodeType === <span class=\"number\">1</span> ?</div><div class=\"line\">\t\t\t\telem.innerHTML.replace( rinlinejQuery, <span class=\"string\">\"\"</span> ) :</div><div class=\"line\">\t\t\t\t<span class=\"literal\">undefined</span>;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">// See if we can take a shortcut and just use innerHTML</span></div><div class=\"line\">\t\t<span class=\"keyword\">if</span> ( <span class=\"keyword\">typeof</span> value === <span class=\"string\">\"string\"</span> &amp;&amp; !rnoInnerhtml.test( value ) &amp;&amp;</div><div class=\"line\">\t\t\t( support.htmlSerialize || !rnoshimcache.test( value )  ) &amp;&amp;</div><div class=\"line\">\t\t\t( support.leadingWhitespace || !rleadingWhitespace.test( value ) ) &amp;&amp;</div><div class=\"line\">\t\t\t!wrapMap[ ( rtagName.exec( value ) || [ <span class=\"string\">\"\"</span>, <span class=\"string\">\"\"</span> ] )[ <span class=\"number\">1</span> ].toLowerCase() ] ) &#123;</div><div class=\"line\"></div><div class=\"line\">\t\t\tvalue = jQuery.htmlPrefilter( value );</div><div class=\"line\"></div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> ( ; i &lt; l; i++ ) &#123;</div><div class=\"line\"></div><div class=\"line\">\t\t\t\t\t<span class=\"comment\">// Remove element nodes and prevent memory leaks</span></div><div class=\"line\">           <span class=\"comment\">// åˆ é™¤å…ƒç´ èŠ‚ç‚¹å¹¶é˜»æ­¢å†…å­˜æ³„éœ²</span></div><div class=\"line\">\t\t\t\t\telem = <span class=\"keyword\">this</span>[ i ] || &#123;&#125;;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> ( elem.nodeType === <span class=\"number\">1</span> ) &#123;</div><div class=\"line\">\t\t\t\t\t\tjQuery.cleanData( getAll( elem, <span class=\"literal\">false</span> ) );<span class=\"comment\">// â† æ¸…é™¤elemåœ¨$.cacheä¸­çš„æ•°æ®ï¼Œé‡Šæ”¾æ‰$.cacheå¯¹elemçš„å¼•ç”¨</span></div><div class=\"line\">\t\t\t\t\t\telem.innerHTML = value;</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t\t\telem = <span class=\"number\">0</span>;</div><div class=\"line\"></div><div class=\"line\">\t\t\t<span class=\"comment\">// If using innerHTML throws an exception, use the fallback method</span></div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> ( e ) &#123;&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">if</span> ( elem ) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">this</span>.empty().append( value );</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;, <span class=\"literal\">null</span>, value, <span class=\"built_in\">arguments</span>.length );</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<h2 id=\"ä¸ºä»€ä¹ˆjQueryæ²¡æœ‰å°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨åœ¨DOMå…ƒç´ ä¸Šï¼Œè€Œæ˜¯å°†å…¶ä¿å­˜åœ¨-cacheä¸­ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆjQueryæ²¡æœ‰å°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨åœ¨DOMå…ƒç´ ä¸Šï¼Œè€Œæ˜¯å°†å…¶ä¿å­˜åœ¨-cacheä¸­ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆjQueryæ²¡æœ‰å°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨åœ¨DOMå…ƒç´ ä¸Šï¼Œè€Œæ˜¯å°†å…¶ä¿å­˜åœ¨$.cacheä¸­ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆjQueryæ²¡æœ‰å°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨åœ¨DOMå…ƒç´ ä¸Šï¼Œè€Œæ˜¯å°†å…¶ä¿å­˜åœ¨$.cacheä¸­ï¼Ÿ</h2><p>å› ä¸ºåœ¨IE&lt;8ç‰ˆæœ¬ä¸­ï¼ŒJScriptåƒåœ¾å›æ”¶å™¨ä»…ç®¡ç†JScriptå¯¹è±¡ç”Ÿå‘½å‘¨æœŸè€Œä¸ä¼šç®¡ç†DOMå¯¹è±¡çš„(å³DOMå¯¹è±¡æœ‰è‡ªå·±çš„åƒåœ¾å›æ”¶å™¨)ã€‚å³JScriptå›æ”¶å™¨ä¸ä¼šè§£é™¤æ‰DOMå¯¹è±¡ä¸Jscriptå¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨ï¼ˆå¾ªç¯å¼•ç”¨ï¼‰ï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚ä¸ºäº†é¿å…åœ¨ä½ç‰ˆæœ¬IEå’ŒFirefoxä¸­å†…å­˜æ³„éœ²ï¼ŒjQueryåˆ›å»ºäº†<code>$.cache</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ›´å¤šä¿¡æ¯å‚è€ƒ<a href=\"http://123fe.cn/2017/11/10/IE-8%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E5%AF%BC%E8%87%B4%E7%9A%84%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2/\" target=\"_blank\" rel=\"external\">IE&lt;8å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„éœ²</a>ã€‚</p>\n<blockquote>\n<p> jQuery 2.0 leaves behind the older Internet Explorer 6, 7, and 8 browsers. In return it is smaller, faster, and can be used in JavaScript environments where the code needed for old-IE compatibility often causes problems of its own. But donâ€™t worry, the jQuery team still supports the 1.x branch which does run on IE 6/7/8. You can (and should) continue to use jQuery 1.9 (and the upcoming 1.10) on web sites that need to accommodate older browsers. The final 2.0.0 file is 12 percent smaller than the 1.9.1 file, thanks to the elimination of patches that were only needed for IE 6, 7, and 8. â€”-<a href=\"http://blog.jquery.com/2013/04/18/jquery-2-0-released/\" target=\"_blank\" rel=\"external\">jQuery 2.0 Released</a></p>\n</blockquote>\n<p><strong>å¤§æ¦‚æ„æ€</strong>ï¼š<u>jQuery2.0ç‰ˆæœ¬ä¹‹åï¼ŒjQueryå›¢é˜ŸåŒæ—¶ç»´æŠ¤ä¸¤ä¸ªåˆ†æ”¯ï¼š2.xç‰ˆæœ¬å’Œ1.xç‰ˆæœ¬ã€‚jQuery2.0å¼€å§‹æ”¾å¼ƒIE6/7/8æ”¯æŒ(æ³¨ï¼šä¹ŸåŒ…å«3.xç‰ˆæœ¬)ã€‚è€ŒjQuery1.xç‰ˆæœ¬ä¼šç»§ç»­æ”¯æŒIE6/7/8ã€‚å› ä¸º2.xç‰ˆæœ¬åˆ é™¤äº†IE6/7/8è¡¥ä¸ä»£ç ï¼Œæ•´ä½“å¤§å°æ¯”1.xç‰ˆæœ¬å°12%ï¼Œæ€§èƒ½æ›´å¥½ã€‚</u></p>\n<p>å³ä»jQuery2.0å¼€å§‹ä¸æ”¯æŒIE6/7/8ï¼Œå°±ä¸å­˜åœ¨å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œå› æ­¤$.cacheä¹Ÿä»jQuery2.xç‰ˆæœ¬ä¸­ç§»é™¤ã€‚jQuery2.0å¼€å§‹å°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨å­˜å‚¨åœ¨å…ƒç´ èŠ‚ç‚¹ä¸Šï¼Œè¿™æ ·å°±ä¸å­˜åœ¨ä¸Šè¿°çš„å†…å­˜æ³„éœ²é—®é¢˜äº†ã€‚</p>\n<h2 id=\"å¯¹æ¯”æµ‹è¯•\"><a href=\"#å¯¹æ¯”æµ‹è¯•\" class=\"headerlink\" title=\"å¯¹æ¯”æµ‹è¯•\"></a>å¯¹æ¯”æµ‹è¯•</h2><p>åˆ†åˆ«ä½¿ç”¨jquery1.xå’Œjquery2.xç‰ˆæœ¬åˆ›å»ºä¸€ä¸ª1000ä¸ªå…ƒç´ å¹¶ç»‘å®šclickäº‹ä»¶ï¼Œåˆ›å»ºå®Œåå†é€šè¿‡JavaScriptåˆ é™¤æ–¹æ³•ç§»é™¤ï¼Œå¹¶é€šè¿‡<strong>Devtools</strong>â€“&gt;<strong>Performance</strong>åšåˆ†æï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<ol>\n<li>å¼€å¯<strong>Performance</strong>é¡¹çš„è®°å½•</li>\n<li>æ‰§è¡Œä¸€æ¬¡CGï¼Œåˆ›å»ºåŸºæœ¬å‚è€ƒçº¿</li>\n<li>å•å‡»ã€runã€‘æŒ‰é’®ï¼Œåˆ›å»º1000ä¸ªå…ƒç´ </li>\n<li>å†æ¬¡å•å‡»ã€runã€‘æŒ‰é’®ï¼Œåˆ›å»º1000ä¸ªå…ƒç´ </li>\n<li>å•å‡»ã€clearã€‘æŒ‰é’®ï¼Œé€šè¿‡JavaScriptåˆ é™¤æ–¹æ³•ç§»é™¤åˆšåˆ›å»º2000ä¸ªå…ƒç´ </li>\n<li>æ‰§è¡Œä¸€æ¬¡CG</li>\n</ol>\n<p>ç»“æœå›¾å¦‚ä¸‹ï¼š</p>\n<p><img src=\"./jquery1_x.png\" alt=\"\"></p>\n<hr>\n<p><img src=\"./jquery2_x.png\" alt=\"\"></p>\n<p><strong>ä»å¯¹æ¯”ç»“æœå›¾è¯å®äº†jquery2.xå°†äº‹ä»¶ä¿¡æ¯å­˜å‚¨åœ¨å…ƒç´ å¯¹è±¡ä¸Šã€‚è¿™é‡Œä¹Ÿå¯ä»¥åˆ†åˆ«æ‰“å°<code>$.cache</code>ï¼Œå¯¹æ¯”ä¸€ä¸‹è¾“å‡ºç»“æœï¼š</strong></p>\n<p><img src=\"./jquery_cache_1_x.png\" alt=\"\"></p>\n<hr>\n<p><img src=\"./jquery_cache_2_x.png\" alt=\"\"></p>\n<p>è¿™é‡Œæ²¡æœ‰è®¨è®ºjquery3.xç‰ˆæœ¬ï¼Œå› ä¸ºå®ƒä¸jquery2.xç‰ˆæœ¬ä¸€æ ·ä¸æ”¯æŒä½ç‰ˆæœ¬IEï¼Œä¹Ÿä¸å­˜åœ¨<code>$.cache</code>é—®é¢˜ï¼Œæ‰€ä»¥ä¸å†èµ˜è¿°ã€‚</p>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä¸»è¦è®¨è®ºäº†jqueryçš„<code>$.cache</code>å¼•èµ·çš„å†…å­˜æ³„éœ²é—®é¢˜ã€‚åœ¨ä½¿ç”¨jquery1.xç‰ˆæœ¬æ—¶ï¼Œéœ€è¦å…³æ³¨ä¸€ä¸‹è¿™ä¸€é—®é¢˜ã€‚å¦‚jquery.lazyload.jså’Œå•é¡µåº”ç”¨éƒ½å¾ˆå®¹æ˜“å¼•èµ·è¿™æ–¹é¢çš„é—®é¢˜ã€‚å¦‚ä½•é¿å…å‘¢ï¼Ÿæœ¬æ–‡ä¹Ÿæåˆ°äº†ï¼Œé€šè¿‡jqueryçš„åˆ é™¤æ–¹æ³•æ¥ç§»é™¤:<code>remove()</code>,<code>empty()</code>,<code>html()</code>ã€‚<strong>åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ—¶ä¸€å®šè¦è®°ä½ï¼šé€šè¿‡ä»»ä½•ç¬¬ä¸‰æ–¹åº“åˆ›å»ºçš„å¯¹è±¡ï¼Œæœ€å¥½é€šè¿‡è¯¥åº“æä¾›çš„åˆ é™¤æ–¹æ³•æ¥åˆ é™¤ã€‚</strong></p>\n<h2 id=\"å‚è€ƒæ–‡ç« ï¼š\"><a href=\"#å‚è€ƒæ–‡ç« ï¼š\" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« ï¼š\"></a>å‚è€ƒæ–‡ç« ï¼š</h2><ul>\n<li><a href=\"https://makandracards.com/makandra/31325-how-to-create-memory-leaks-in-jquery\" target=\"_blank\" rel=\"external\">How to create memory leaks in jQuery</a></li>\n<li><a href=\"https://stackoverflow.com/questions/9304768/what-is-the-purpose-of-cache-in-jquery\" target=\"_blank\" rel=\"external\">What is the purpose of $.cache in jQuery?</a></li>\n<li><a href=\"http://www.crockford.com/javascript/memory/leak.html\" target=\"_blank\" rel=\"external\">JScript Memory Leaks</a></li>\n<li><a href=\"http://isaacschlueter.com/2006/10/msie-memory-leaks/\" target=\"_blank\" rel=\"external\">Memory Leaks in Microsoft Internet Explorer</a></li>\n</ul>\n"},{"title":"æµè§ˆå™¨æ¸²æŸ“ç®€è¿°","date":"2017-11-21T08:05:04.000Z","author":"singsong","_content":"\nè¦ç¼–å†™é«˜æ€§èƒ½çš„ç½‘ç«™å’Œåº”ç”¨ï¼Œé™¤äº†ç¡®ä¿ç¼–å†™çš„ä»£ç èƒ½é«˜æ•ˆåœ°è¿è¡Œå¤–ï¼Œè¿˜éœ€è¦äº†è§£æµè§ˆå™¨æ˜¯å¦‚ä½•è¿›è¡Œæ¸²æŸ“å·¥ä½œçš„ã€‚\n\n## æµè§ˆå™¨ä¸»è¦ç»„æˆç»“æ„\n\n![](https://skmukhiya.files.wordpress.com/2013/06/fb76d-layers-pagespeed-ce-mfe5f8ctav.png)\n\n1. ç”¨æˆ·ç•Œé¢(User Interface)ï¼šåŒ…æ‹¬åœ°å€æ ã€å‰è¿›/åé€€æŒ‰é’®ã€ä¹¦ç­¾èœå•ç­‰ã€‚é™¤äº†æµè§ˆå™¨ä¸»çª—å£æ˜¾ç¤ºçš„æ‚¨è¯·æ±‚çš„é¡µé¢å¤–ï¼Œå…¶ä»–æ˜¾ç¤ºçš„å„ä¸ªéƒ¨åˆ†éƒ½å±äºç”¨æˆ·ç•Œé¢ã€‚\n2. æµè§ˆå™¨å¼•æ“(Browser engine)ï¼šåœ¨ç”¨æˆ·ç•Œé¢(User Interface)å’Œæ¸²æŸ“å¼•æ“(Rendering engine)ä¹‹é—´ä¼ é€æŒ‡ä»¤ã€‚\n3. æ¸²æŸ“å¼•æ“(Rendering engine)ï¼šè´Ÿè´£æ˜¾ç¤ºè¯·æ±‚çš„å†…å®¹ã€‚å¦‚æœè¯·æ±‚çš„å†…å®¹æ˜¯HTMLï¼Œå®ƒå°±è´Ÿè´£è§£æHTMLå’ŒCSSå†…å®¹ï¼Œå¹¶å°†è§£æåçš„å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚\n4. ç½‘ç»œ(Networking)ï¼šç”¨äºç½‘ç»œè°ƒç”¨ï¼Œæ¯”å¦‚HTTPè¯·æ±‚ã€‚å…¶æ¥å£ä¸å¹³å°æ— å…³ï¼Œå¹¶ä¸ºæ‰€æœ‰å¹³å°æä¾›åº•å±‚å®ç°ã€‚\n5. JavaScriptè§£é‡Šå™¨(JavaScript Interperter)ï¼šç”¨äºè§£æå’Œæ‰§è¡ŒJavaScriptä»£ç ã€‚\n6. ç”¨æˆ·ç•Œé¢åç«¯(UI Backend)ï¼šç”¨äºç»˜åˆ¶åŸºæœ¬çš„çª—å£å°éƒ¨ä»¶ï¼Œæ¯”å¦‚ç»„åˆæ¡†å’Œçª—å£ã€‚å…¶å…¬å¼€äº†ä¸å¹³å°æ— å…³çš„é€šç”¨æ¥å£ï¼Œè€Œåœ¨åº•å±‚ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ç”¨æˆ·ç•Œé¢æ–¹æ³•ã€‚\n7. æ•°æ®å­˜å‚¨(Data storage)ï¼šè¿™æ˜¯æŒä¹…å±‚ã€‚æµè§ˆå™¨éœ€è¦åœ¨ç¡¬ç›˜ä¸Šä¿å­˜å„ç§æ•°æ®ï¼Œä¾‹å¦‚Cookiesã€‚æµè§ˆå™¨è¿˜æ”¯æŒè¯¸å¦‚localStorageï¼ŒIndexedDBï¼ŒWebSQLå’ŒFileSystemä¹‹ç±»çš„å­˜å‚¨æœºåˆ¶ã€‚\n\n\n ## æ–‡æ¡£å¯¹è±¡æ¨¡å‹(DOMï¼šDocument Object Modelï¼‰\næœ¬æ–‡ä¸»è¦ä»‹ç»æµè§ˆå™¨çš„æ¸²æŸ“ï¼Œå³æ¸²æŸ“å¼•æ“(Rendering engine)è´Ÿè´£çš„å·¥ä½œ: å°†è¯·æ±‚çš„HTMLå†…å®¹è§£æå¹¶æ¸²æŸ“åœ¨å±å¹•ä¸Šã€‚\nå¦‚ä¸‹HTMLç»“æ„ï¼Œä¸€ä¸ªåŒ…å«ä¸€äº›æ–‡æœ¬å’Œä¸€å¼ å›¾ç‰‡ï¼š\n```html\n<html>\n  <head>\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n    <link href=\"style.css\" rel=\"stylesheet\">\n    <title>Critical Path</title>\n  </head>\n  <body>\n    <p>Hello <span>web performance</span> students!</p>\n    <div><img src=\"awesome-photo.jpg\"></div>\n  </body>\n</html>\n```\næµè§ˆå™¨æ˜¯å¦‚ä½•å¤„ç†è¿™ä¸ªHTMLé¡µé¢ï¼š\n\n\b![](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/full-process.png)\n\n1. è½¬æ¢(Conversion)ï¼šæµè§ˆå™¨ä»ç£ç›˜æˆ–ç½‘ç»œè¯»å–HTMLçš„åŸå§‹å­—èŠ‚ç ï¼Œå¹¶æ ¹æ®æ–‡ä»¶çš„æŒ‡å®šç¼–ç ï¼ˆä¾‹å¦‚ UTF-8ï¼‰å°†å®ƒä»¬è½¬æ¢æˆå¯¹åº”çš„å­—ç¬¦ã€‚\n2. ä»¤ç‰ŒåŒ–(Tokenizing)ï¼šæµè§ˆå™¨å°†å­—ç¬¦ä¸²è½¬æ¢æˆ[W3C HTML5æ ‡å‡†](http://www.w3.org/TR/html5/)è§„å®šçš„å„ç§ä»¤ç‰Œï¼Œä¾‹å¦‚`<html>`ã€`<body>`ï¼Œä»¥åŠå…¶ä»–å°–æ‹¬å·å†…çš„å­—ç¬¦ä¸²ã€‚æ¯ä¸ªä»¤ç‰Œéƒ½å…·æœ‰ç‰¹æ®Šå«ä¹‰å’Œä¸€ç»„è§„åˆ™ã€‚\n3. è¯æ³•åˆ†æ(Lexing)ï¼šå‘å‡ºçš„ä»¤ç‰Œè½¬æ¢æˆå®šä¹‰å…¶å±æ€§å’Œè§„åˆ™çš„â€œå¯¹è±¡â€ã€‚\n4. DOMæ„å»º(DOM construction)ï¼šHTMLæ ‡è®°å®šä¹‰ä¸åŒæ ‡è®°ä¹‹é—´çš„å…³ç³»ï¼ˆä¸€äº›æ ‡è®°åŒ…å«åœ¨å…¶ä»–æ ‡è®°å†…ï¼‰ï¼Œåˆ›å»ºçš„å¯¹è±¡é“¾æ¥åœ¨ä¸€ä¸ªæ ‘æ•°æ®ç»“æ„å†…ï¼Œæ­¤ç»“æ„ä¹Ÿä¼šæ•è·åŸå§‹æ ‡è®°ä¸­å®šä¹‰çš„çˆ¶é¡¹-å­é¡¹å…³ç³»ï¼šHTMLå¯¹è±¡æ˜¯bodyå¯¹è±¡çš„çˆ¶é¡¹ï¼Œbodyæ˜¯paragraphå¯¹è±¡çš„çˆ¶é¡¹ï¼Œä¾æ­¤ç±»æ¨ã€‚\n\næ•´ä¸ªè¿‡ç¨‹çš„æœ€ç»ˆè¾“å‡ºæ˜¯HTMLé¡µé¢çš„æ–‡æ¡£å¯¹è±¡æ¨¡å‹ (DOM)ï¼Œæµè§ˆå™¨å¯¹é¡µé¢è¿›è¡Œçš„æ‰€æœ‰è¿›ä¸€æ­¥å¤„ç†éƒ½ä¼šç”¨åˆ°å®ƒã€‚æµè§ˆå™¨æ¯æ¬¡å¤„ç†HTMLæ ‡è®°æ—¶ï¼Œéƒ½ä¼šå®Œæˆä»¥ä¸Šæ‰€æœ‰æ­¥éª¤ï¼šå°†å­—èŠ‚è½¬æ¢æˆå­—ç¬¦ï¼Œç¡®å®šä»¤ç‰Œï¼Œå°†ä»¤ç‰Œè½¬æ¢æˆèŠ‚ç‚¹ï¼Œç„¶åæ„å»ºDOMæ ‘ã€‚DOMæ ‘æ•è·æ–‡æ¡£æ ‡è®°çš„å±æ€§å’Œå…³ç³»ï¼Œä½†å¹¶æœªå¤„ç†å…ƒç´ åœ¨æ¸²æŸ“åå‘ˆç°çš„å¤–è§‚ã€‚é‚£æ˜¯CSSOMçš„è´£ä»»ã€‚\n\n\n## CSSå¯¹è±¡æ¨¡å‹(CSSOMï¼šCSS Object Model)\n\nåœ¨æµè§ˆå™¨æ„å»ºDOMé‡åˆ°linkæ ‡è®°æ—¶ï¼Œè¯¥æ ‡è®°å¼•ç”¨ä¸€ä¸ªå¤–éƒ¨CSSæ ·å¼è¡¨ï¼šstyle.cssã€‚ç”±äºé¢„è§åˆ°éœ€è¦åˆ©ç”¨è¯¥èµ„æºæ¥æ¸²æŸ“é¡µé¢ï¼Œå®ƒä¼šç«‹å³å‘å‡ºå¯¹è¯¥èµ„æºçš„è¯·æ±‚ï¼Œå¹¶è¿”å›ä»¥ä¸‹å†…å®¹ï¼š\n\n```CSS\nbody { font-size: 16px }\np { font-weight: bold }\nspan { color: red }\np span { display: none }\nimg { float: right }\n```\n\nä¸å¤„ç†HTMLæ—¶ç±»ä¼¼ï¼Œéœ€è¦å°†æ”¶åˆ°çš„CSSè§„åˆ™è½¬æ¢æˆæŸç§æµè§ˆå™¨èƒ½å¤Ÿç†è§£å’Œå¤„ç†çš„ä¸œè¥¿ã€‚å› æ­¤ä¼šé‡å¤HTMLè¿‡ç¨‹ï¼Œä¸è¿‡æ˜¯ä¸ºCSSè€Œä¸æ˜¯HTMLï¼š\n\n![](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/cssom-construction.png?hl=zh-cn)\n\nCSSå­—èŠ‚è½¬æ¢æˆå­—ç¬¦ï¼Œæ¥ç€è½¬æ¢æˆä»¤ç‰Œå’ŒèŠ‚ç‚¹ï¼Œæœ€åé“¾æ¥åˆ°CSSOMæ ‘ç»“æ„å†…ï¼š\n\n\n![https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/cssom-tree.png](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/cssom-tree.png)\n\nCSSOMä¸ºä½•å…·æœ‰æ ‘ç»“æ„ï¼Ÿç”¨äºç¡®å®šèŠ‚ç‚¹å¯¹è±¡çš„è®¡ç®—æ ·å¼ã€‚å¦‚spanæ ‡è®°åŒ…å«äº†`color:red`æ ·å¼å’Œç»§æ‰¿äºbodyæ ‡è®°çš„`font-size:16px`æ ·å¼;\n\n<u>æ³¨æ„ï¼šä»¥ä¸Šæ ‘å¹¶éå®Œæ•´çš„CSSOMæ ‘ï¼Œå®ƒåªæ˜¯æ›¿ä»£é»˜è®¤æ ·å¼çš„è‡ªå®šä¹‰æ ·å¼ã€‚æ¯ä¸ªæµè§ˆå™¨éƒ½æä¾›ä¸€ç»„é»˜è®¤æ ·å¼ï¼ˆä¹Ÿç§°ä¸ºâ€œUser Agent æ ·å¼â€ï¼‰ï¼Œå³ä¸æä¾›ä»»ä½•è‡ªå®šä¹‰æ ·å¼æ—¶æ‰€çœ‹åˆ°çš„æ ·å¼ï¼Œè‡ªå®šä¹‰æ ·å¼åªæ˜¯æ›¿æ¢è¿™äº›é»˜è®¤æ ·å¼</u>\n\n\nCSSOMæ˜¯åœ¨DOMä¸­çš„ä¸€äº›æ¥å£ä¸­ï¼ŒåŠ å…¥è·å–å’Œæ“ä½œCSSå±æ€§æˆ–æ¥å£çš„JavaScriptæ¥å£ï¼Œå› è€ŒJavaScriptå¯ä»¥åŠ¨æ€æ“ä½œCSSæ ·å¼ã€‚DOMæä¾›äº†æ¥å£è®©JavaScriptä¿®æ”¹HTMLæ–‡æ¡£ï¼ŒCSSOMæä¾›äº†æ¥å£è®©JavaScriptè·å¾—å’Œä¿®æ”¹CSSä»£ç è®¾ç½®çš„æ ·å¼ä¿¡æ¯ã€‚\n\n\n\n## æ¸²æŸ“æ ‘(RenderObject treeï¼Œä¹Ÿç§°ä¸ºRender tree)\nåœ¨DOMæ ‘ä¸­ï¼Œå­˜åœ¨ä¸å¯è§ä¸å¯è§èŠ‚ç‚¹ä¹‹åˆ†ã€‚é¡¾åæ€ä¹‰ï¼Œä¸å¯è§èŠ‚ç‚¹æ˜¯ä¸éœ€è¦ç»˜åˆ¶æœ€ç»ˆé¡µé¢ä¸­çš„èŠ‚ç‚¹ï¼Œå¦‚`meta`ã€`head`ã€`script`ç­‰ï¼Œä»¥åŠé€šè¿‡CSSæ ·å¼`display:none`éšè—çš„èŠ‚ç‚¹ã€‚ç›¸åå¯è§èŠ‚ç‚¹æ˜¯ç”¨æˆ·å¯è§çš„ï¼Œå¦‚`body`ã€`div`ã€`span`ã€`canvas`ã€`img`ç­‰ã€‚\nå¯¹äºè¿™äº›å¯è§èŠ‚ç‚¹ï¼Œæµè§ˆå™¨éœ€è¦å°†å®ƒä»¬çš„å†…å®¹ç»˜åˆ¶åˆ°æœ€ç»ˆçš„é¡µé¢ä¸­ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¼šä¸ºå®ƒä»¬å»ºç«‹å¯¹åº”çš„RenderObjectå¯¹è±¡ã€‚ä¸€ä¸ªRenderObjectå¯¹è±¡ä¿å­˜äº†ä¸ºç»˜åˆ¶DOMèŠ‚ç‚¹çš„å„ç§ä¿¡æ¯ã€‚è¿™äº›RenderObjectå¯¹è±¡ä¸DOMå¯¹è±¡ç±»ä¼¼ï¼Œä¹Ÿæ„æˆä¸€æ£µæ ‘ï¼Œç§°ä¸º**RenderObject tree**ã€‚RenderObjectæ ‘æ˜¯åŸºäºDOMæ ‘å»ºç«‹èµ·æ¥çš„ä¸€æ£µæ–°æ ‘ï¼Œæ˜¯ä¸ºäº†å¸ƒå±€è®¡ç®—å’Œæ¸²æŸ“ç­‰æœºåˆ¶è€Œæ„å»ºçš„ä¸€ç§æ–°çš„å†…éƒ¨è¡¨ç¤ºã€‚RenderObjectæ ‘èŠ‚ç‚¹ä¸DOMæ ‘èŠ‚ç‚¹ä¸æ˜¯ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚å› ä¸ºåˆ›å»ºä¸€ä¸ªRenderObjectå¯¹è±¡éœ€è¦æ»¡è¶³å¦‚ä¸‹è§„åˆ™ï¼š\n- DOMæ ‘çš„documentèŠ‚ç‚¹\n- DOMæ ‘ä¸­çš„å¯è§èŠ‚ç‚¹ï¼Œå¦‚`html`ã€`body`ã€`div`ç­‰ã€‚è€Œæµè§ˆå™¨ä¸ä¼šä¸ºä¸å¯è§èŠ‚ç‚¹åˆ›å»ºRenderObjectèŠ‚ç‚¹ã€‚\n- æŸäº›æƒ…å†µä¸‹æµè§ˆå™¨éœ€è¦åˆ›å»ºåŒ¿åçš„RenderObjectèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¸å¯¹åº”DOMæ ‘ä¸­çš„ä»»ä½•èŠ‚ç‚¹ã€‚\n\nRenderObjectå¯¹è±¡æ„æˆäº†RenderObjectæ ‘ï¼Œæ¯ä¸ªRenderObjectå¯¹è±¡ä¿å­˜äº†ä¸ºç»˜åˆ¶DOMèŠ‚ç‚¹çš„è®¡ç®—æ ·å¼ã€‚RenderObjectæ ‘ä¹Ÿå¯ä»¥ç†è§£æˆç”±CSSOMæ ‘å’ŒDOMæ ‘åˆå¹¶æˆï¼š\n\n![](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/render-tree-construction.png?hl=zh-cn)\n\n## å¸ƒå±€(loayout)\n\nå½“æµè§ˆå™¨åˆ›å»ºRenderObjectå¯¹è±¡ä¹‹åï¼Œæ¯ä¸ªå¯¹è±¡å¹¶ä¸çŸ¥é“è‡ªå·±åœ¨è®¾å¤‡è§†å£å†…çš„ä½ç½®ã€å¤§å°ç­‰ä¿¡æ¯ã€‚æµè§ˆå™¨æ ¹æ®[ç›’æ¨¡å‹(Box-model)](https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Box_Model)æ¥è®¡ç®—å®ƒä»¬çš„ä½ç½®ã€å¤§å°ç­‰ä¿¡æ¯çš„è¿‡ç¨‹ç§°ä¸ºå¸ƒå±€è®¡ç®—ï¼ˆé‡æ’ï¼‰ã€‚\nå¸ƒå±€è®¡ç®—æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œè¿™æ˜¯å› ä¸ºä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°é€šå¸¸éœ€è¦å…ˆè®¡ç®—å®ƒçš„å­©å­èŠ‚ç‚¹çš„ä½ç½®ã€å¤§å°ç­‰ä¿¡æ¯ã€‚ä¸ºäº†è®¡ç®—èŠ‚ç‚¹åœ¨é¡µé¢ä¸­çš„ç¡®åˆ‡å¤§å°å’Œä½ç½®ï¼Œæµè§ˆå™¨ä¼šä»RenderObjectæ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹è¿›è¡Œéå†ã€‚\n\nå®ä¾‹ï¼š\n```html\n<html>\n  <head>\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n    <title>Critial Path: Hello world!</title>\n  </head>\n  <body>\n    <div style=\"width: 50%\">\n      <div style=\"width: 50%\">Hello world!</div>\n    </div>\n  </body>\n</html>\n```\né¡µé¢åŒ…å«äº†ä¸¤ä¸ªåµŒå¥—divï¼šçˆ¶divå°†å…¶çš„æ˜¾ç¤ºå°ºå¯¸è®¾ç½®ä¸ºè§†å£å®½åº¦çš„50%ï¼Œå­divå°†å…¶å®½åº¦è®¾ç½®ä¸ºå…¶çˆ¶é¡¹çš„50%ï¼Œå³è§†å£å®½åº¦çš„25%ã€‚\n\n![](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/layout-viewport.png?hl=zh-cn)\n\n## RenderLayeræ ‘(RenderLayer tree)\n\næµè§ˆå™¨æ¸²æŸ“å¼•æ“å¹¶ä¸æ˜¯ç›´æ¥ä½¿ç”¨RenderObjectæ ‘è¿›è¡Œç»˜åˆ¶ï¼Œä¸ºäº†æ–¹ä¾¿å¤„ç†Positioning(å®šä½)ï¼ŒClipping(è£å‰ª)ï¼ŒOverflow-scroll(é¡µå…§æ»šåŠ¨)ï¼ŒCSS Transform/Opacity/Animation/Filterï¼ŒMask or Reflectionï¼ŒZ-indexing(Zæ’åº)ç­‰ï¼Œæµè§ˆå™¨éœ€è¦ä¼šä¸ºä¸€äº›ç‰¹å®šçš„RenderObjectç”Ÿæˆå¯¹åº”çš„RenderLayerï¼Œå¹¶ç”Ÿæˆä¸€æ£µå¯¹åº”çš„RenderLayeræ ‘ã€‚è€Œè¿™äº›ç‰¹å®šçš„RenderObjectè·Ÿå¯¹åº”çš„RenderLayerå°±æ˜¯ç›´å±çš„å…³ç³»ï¼Œå¦‚æœå®ƒä»¬çš„å­èŠ‚ç‚¹å¦‚æœæ²¡æœ‰å¯¹åº”çš„RenderLayerï¼Œå°±ä»å±äºçˆ¶èŠ‚ç‚¹çš„RenderLayerã€‚æœ€ç»ˆï¼Œæ¯ä¸€ä¸ªRenderObjectéƒ½ä¼šç›´æ¥æˆ–è€…é—´æ¥åœ°ä»å±äºä¸€ä¸ªRenderLayerã€‚å› æ­¤RenderObjectèŠ‚ç‚¹ä¸RenderLayerèŠ‚ç‚¹ä¸æ˜¯ä¸€ä¸€å¯¹åº”å…³ç³»ï¼Œè€Œæ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚é‚£éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Œæ¸²æŸ“å¼•æ“æ‰ä¸ºRenderObjectå»ºç«‹å¯¹åº”çš„RenderLayerï¼š\n\n* It's the root object for the page\n* It has explicit CSS position properties (relative, absolute or a transform)\n* It is transparent\n* Has overflow, an alpha mask or reflection\n* Has a CSS filter\n* Corresponds to `<canvas>` element that has a 3D (WebGL) context or an accelerated 2D context\n* Corresponds to a `<video>` element\n\nç¿»è¯‘ï¼š\n* DOMæ ‘çš„DocumentèŠ‚ç‚¹å¯¹åº”çš„RenderObjectèŠ‚ç‚¹å’ŒHTMLèŠ‚ç‚¹å¯¹åº”çš„RenderObjectèŠ‚ç‚¹\n* æ˜¾å¼æŒ‡å®šCSS positionå±æ€§çš„RenderObjectèŠ‚ç‚¹\n* æœ‰é€æ˜åº¦çš„RenderObjectèŠ‚ç‚¹\n* æœ‰overflowï¼Œalphaå’Œreflectionçš„æ ·å¼RenderObjectèŠ‚ç‚¹\n* æœ‰filteræ ·å¼çš„RenderObjectèŠ‚ç‚¹\n* ä½¿ç”¨Canvas 2Då’Œ3D(WebGL)æŠ€æœ¯çš„RenderObjectèŠ‚ç‚¹\n* videoå…ƒç´ å¯¹åº”çš„RenderObjectèŠ‚ç‚¹\n\næ¯ä¸ªRenderLayerå¯¹è±¡å¯ä»¥æƒ³è±¡æˆå›¾åƒä¸­ä¸€ä¸ªå›¾å±‚ï¼Œå„ä¸ªå›¾å±‚å åŠ æ„æˆäº†ä¸€ä¸ªå›¾åƒã€‚æµè§ˆå™¨ä¼šéå†RenderLayeræ ‘ï¼Œå†éå†ä»å±è¿™ä¸ªRenderLayerçš„RenderObjectï¼ŒRenderObjectå¯¹è±¡å­˜å‚¨æœ‰ç»˜åˆ¶ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œç»˜åˆ¶ã€‚RenderLayerå’ŒRenderObjectå…±åŒå†³å®šäº†æœ€ç»ˆå‘ˆç°çš„ç½‘é¡µå†…å®¹ï¼ŒRenderLayeræ ‘å†³å®šäº†ç½‘é¡µçš„ç»˜åˆ¶çš„å±‚æ¬¡é¡ºåºï¼Œè€Œä»å±äºRenderLayerçš„RenderObjectå†³å®šäº†è¯¥RenderLayerçš„å†…å®¹ã€‚\n\n## æ¸²æŸ“æ–¹å¼\nåœ¨å®Œæˆæ„å»ºRenderLayeræ ‘ä¹‹åï¼Œæµè§ˆå™¨ä¼šä½¿ç”¨å›¾å½¢åº“å°†å…¶æ„å»ºçš„æ¸²æŸ“æ¨¡å‹ç»˜åˆ¶å‡ºæ¥ï¼Œè¯¥è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š\n- ç»˜åˆ¶ï¼šå°†ä»å±æ¯ä¸ªRenderLayerå›¾å±‚ä¸Šçš„RenderObjectç»˜åˆ¶åœ¨å…¶RenderLayerä¸Šã€‚å³ç»˜åˆ¶ï¼ˆPaintï¼‰æˆ–è€…å…‰æ …åŒ–ï¼ˆRasterizationï¼‰ï¼Œå°†ä¸€äº›ç»˜å›¾æŒ‡ä»¤è½¬æ¢æˆçœŸæ­£çš„åƒç´ é¢œè‰²å€¼ã€‚\n  - è½¯ä»¶ç»˜å›¾ï¼šCPUæ¥å®Œæˆç»˜å›¾æ“ä½œ\n  - ç¡¬ä»¶åŠ é€Ÿç»˜å›¾ï¼šGPUæ¥å®Œæˆç»˜å›¾æ“ä½œ\n- åˆæˆ(compositing)ï¼šå°†å„ä¸ªRenderLayerå›¾å±‚åˆå¹¶æˆåˆ°ä¸€ä¸ªä½å›¾(Bitmap)ä¸­ã€‚åŒæ—¶è¿˜å¯èƒ½åŒ…æ‹¬ä½ç§»ï¼ˆTranslationï¼‰ï¼Œç¼©æ”¾ï¼ˆScaleï¼‰ï¼Œæ—‹è½¬ï¼ˆRotationï¼‰ï¼ŒAlpha åˆæˆç­‰æ“ä½œã€‚\n\n\næ¸²æŸ“å¼•æ“çš„æ¸²æŸ“ï¼Œç›®å‰æœ‰ä¸‰ç§ç½‘é¡µçš„æ¸²æŸ“æ–¹å¼ï¼š\n\n> - ç¡¬ä»¶åŠ é€Ÿåˆæˆ(Accelerated Compositing)ï¼šä½¿ç”¨GPUæ¥å®Œæˆåˆæˆå·¥ä½œã€‚\n> - åˆæˆåŒ–æ¸²æŸ“ï¼šä½¿ç”¨åˆæˆ(compositing)æŠ€æœ¯çš„æ¸²æŸ“ç§°ã€‚\n\n- è½¯ä»¶æ¸²æŸ“æ–¹å¼ï¼šä½¿ç”¨CPUæ¥ç»˜åˆ¶æ¯ä¸ªRenderLayerå›¾å±‚çš„å†…å®¹(RenderObject)åˆ°ä¸€ä¸ªä½å›¾ï¼Œå³ä¸€å—CPUä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚ç»˜åˆ¶æ¯ä¸€å±‚çš„æ—¶å€™éƒ½ä¼šä½¿ç”¨è¯¥ä½å›¾ï¼ŒåŒºåˆ«åœ¨äºç»˜åˆ¶çš„ä½ç½®å¯èƒ½ä¸ä¸€æ ·ï¼Œç»˜åˆ¶é¡ºåºæŒ‰ç…§ä»ååˆ°å‰ã€‚å› æ­¤è½¯ä»¶æ¸²æŸ“æœºåˆ¶æ˜¯æ²¡æœ‰åˆæˆé˜¶æ®µçš„ã€‚\n- ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“çš„åˆæˆåŒ–æ¸²æŸ“æ–¹å¼ï¼šä½¿ç”¨GPUæ¥ç»˜åˆ¶æ‰€æœ‰åˆæˆå±‚ï¼Œå¹¶ä½¿ç”¨GPUç¡¬ä»¶æ¥åŠ é€Ÿåˆæˆã€‚\n- è½¯ä»¶ç»˜å›¾çš„åˆæˆåŒ–æ¸²æŸ“æ–¹å¼ï¼š æŸäº›åˆæˆå±‚ä½¿ç”¨CPUæ¥ç»˜å›¾ï¼Œå¦å¤–ä¸€äº›ä½¿ç”¨GPUæ¥ç»˜åˆ¶ã€‚å¯¹äºä½¿ç”¨CPUæ¥ç»˜åˆ¶çš„å›¾å±‚ï¼Œè¯¥å±‚çš„ç»˜åˆ¶ç»“æœä¼šå…ˆä¿å­˜åœ¨CPUå†…å­˜ä¸­ï¼Œä¹‹åä¼šè¢«ä¼ è¾“åˆ°GPUå†…å­˜ä¸­ï¼Œç„¶åå†ä½¿ç”¨GPUæ¥å®Œæˆåˆæˆå·¥ä½œã€‚\n\n\n![](./render.png)\n\nç¬¬äºŒç§å’Œç¬¬ä¸‰ç§æ¸²æŸ“æ–¹å¼ï¼Œéƒ½æ˜¯ä½¿ç”¨äº†åˆæˆåŒ–æ¸²æŸ“æŠ€æœ¯ï¼Œåˆæˆå·¥ä½œä¹Ÿéƒ½æ˜¯ç”±GPUæ¥åšã€‚å¯¹äºå¸¸è§çš„2Dç»˜å›¾æ“ä½œï¼Œä½¿ç”¨GPUæ¥ç»˜å›¾ä¸ä¸€å®šæ¯”ä½¿ç”¨CPUç»˜å›¾åœ¨æ€§èƒ½ä¸Šæœ‰ä¼˜åŠ¿ï¼Œä¾‹å¦‚ç»˜åˆ¶æ–‡å­—ã€ç‚¹ã€çº¿ç­‰ï¼ŒåŸå› æ˜¯CPUçš„ä½¿ç”¨ç¼“å†²æœºåˆ¶æœ‰æ•ˆå‡å°‘äº†é‡å¤ç»˜åˆ¶çš„å¼€é”€è€Œä¸”ä¸éœ€è¦è€ƒè™‘ä¸GPUå¹¶è¡Œã€‚å¦å¤–ï¼ŒGPUçš„å†…å­˜èµ„æºç›¸å¯¹CPUçš„å†…å­˜èµ„æºæ¥è¯´æ¯”è¾ƒç´§å¼ ï¼Œè€Œä¸”ç½‘é¡µçš„åˆ†å±‚ä½¿å¾—GPUçš„å†…å­˜ä½¿ç”¨ç›¸å¯¹æ¯”è¾ƒå¤šã€‚é‰´äºæ­¤ï¼Œå°±ç›®å‰çš„æƒ…å†µæ¥çœ‹ï¼Œä¸‰è€…éƒ½å­˜åœ¨æ˜¯æœ‰å…¶åˆç†æ€§çš„ï¼Œä¸‹é¢åˆ†æä¸€ä¸‹å®ƒä»¬çš„ç‰¹ç‚¹ï¼š\n\n\n- è½¯ä»¶æ¸²æŸ“æ˜¯ç›®å‰å¾ˆå¸¸è§çš„æŠ€æœ¯ï¼Œä¹Ÿæ˜¯æµè§ˆå™¨æœ€æ—©ä½¿ç”¨çš„æ¸²æŸ“æ–¹å¼ã€‚è¿™ä¸€æŠ€æœ¯æ¯”è¾ƒèŠ‚çœå†…å­˜ï¼Œç‰¹åˆ«æ˜¯å®è´µçš„GPUå†…å­˜ï¼Œä½†æ˜¯è½¯ä»¶æ¸²æŸ“åªèƒ½å¤„ç†2Dæ–¹é¢çš„æ“ä½œã€‚ç®€å•çš„ç½‘é¡µæ²¡æœ‰å¤æ‚ç»˜å›¾æˆ–è€…å¤šåª’ä½“æ–¹é¢çš„éœ€æ±‚ï¼Œè½¯ä»¶æ¸²æŸ“æ–¹å¼å°±æ¯”è¾ƒåˆé€‚æ¥æ¸²æŸ“è¯¥ç±»å‹çš„ç½‘é¡µã€‚é—®é¢˜æ˜¯ï¼Œä¸€æ—¦é‡ä¸Šäº†HTML5çš„å¾ˆå¤šæ–°æŠ€æœ¯ï¼Œè½¯ä»¶æ¸²æŸ“æ˜¾å¾—æ— èƒ½ä¸ºåŠ›ï¼Œä¸€æ˜¯å› ä¸ºèƒ½åŠ›ä¸è¶³ï¼›äºŒæ˜¯å› ä¸ºæ€§èƒ½ä¸å¥½ï¼Œä¾‹å¦‚è§†é¢‘ã€Canvas 2Dç­‰ã€‚æ‰€ä»¥ï¼Œè½¯ä»¶æ¸²æŸ“æŠ€æœ¯è¢«ç”¨çš„è¶Šæ¥è¶Šå°‘ï¼Œç‰¹åˆ«æ˜¯åœ¨ç§»åŠ¨é¢†åŸŸã€‚è½¯ä»¶æ¸²æŸ“åŒç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“å¦å¤–ä¸€ä¸ªå¾ˆä¸åŒçš„åœ°æ–¹å°±æ˜¯å¯¹æ›´æ–°åŒºåŸŸçš„å¤„ç†ã€‚å½“ç½‘é¡µä¸­æœ‰ä¸€ä¸ªæ›´æ–°å°å‹åŒºåŸŸçš„è¯·æ±‚ï¼ˆå¦‚åŠ¨ç”»ï¼‰æ—¶ï¼Œè½¯ä»¶æ¸²æŸ“å¯èƒ½åªéœ€è¦è®¡ç®—ä¸€ä¸ªæå°çš„åŒºåŸŸï¼Œè€Œç¡¬ä»¶æ¸²æŸ“å¯èƒ½éœ€è¦é‡æ–°ç»˜åˆ¶å…¶ä¸­çš„ä¸€å±‚æˆ–è€…å¤šå±‚ï¼Œç„¶åå†åˆæˆè¿™äº›å±‚ã€‚ç¡¬ä»¶æ¸²æŸ“çš„ä»£ä»·å¯èƒ½ä¼šå¤§å¾—å¤šã€‚\n- å¯¹äºç¡¬ä»¶åŠ é€Ÿçš„åˆæˆåŒ–æ¸²æŸ“æ–¹å¼æ¥è¯´ï¼Œæ¯ä¸ªå±‚çš„ç»˜åˆ¶å’Œæ‰€æœ‰å±‚çš„åˆæˆå‡ä½¿ç”¨GPUç¡¬ä»¶æ¥å®Œæˆï¼Œè¿™å¯¹éœ€è¦ä½¿ç”¨3Dç»˜å›¾çš„æ“ä½œæ¥è¯´ç‰¹åˆ«åˆé€‚ã€‚è¿™ç§æ–¹å¼ä¸‹ï¼Œåœ¨RenderLayeræ ‘ä¹‹åï¼Œæµè§ˆå™¨è¿˜éœ€è¦å»ºç«‹æ›´å¤šçš„å†…éƒ¨è¡¨ç¤ºï¼Œç›®çš„æ˜¯æ”¯æŒç¡¬ä»¶åŠ é€Ÿæœºåˆ¶ï¼Œè¿™æ˜¾ç„¶ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜èµ„æºã€‚ä½†æ˜¯ï¼Œä¸€æ–¹é¢ï¼Œç¡¬ä»¶åŠ é€Ÿæœºåˆ¶èƒ½å¤Ÿæ”¯æŒç°åœ¨æ‰€æœ‰çš„HTML5å®šä¹‰çš„2Dæˆ–è€…3Dç»˜å›¾æ ‡å‡†ï¼›å¦ä¸€æ–¹é¢ï¼Œå…³äºæ›´æ–°åŒºåŸŸçš„è®¨è®ºï¼Œå¦‚æœéœ€è¦æ›´æ–°æŸä¸ªå±‚çš„ä¸€ä¸ªåŒºåŸŸï¼Œå› ä¸ºè½¯ä»¶æ¸²æŸ“æ²¡æœ‰ä¸ºæ¯ä¸€å±‚æä¾›åç«¯å­˜å‚¨ï¼Œå› è€Œå®ƒéœ€è¦å°†å’Œè¿™ä¸ªåŒºåŸŸæœ‰é‡å éƒ¨åˆ†çš„æ‰€æœ‰å±‚æ¬¡çš„ç›¸å…³åŒºåŸŸä¸€æ¬¡ä»åå¾€å‰é‡æ–°ç»˜åˆ¶ä¸€éï¼Œè€Œç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“åªéœ€è¦é‡æ–°ç»˜åˆ¶æ›´æ–°å‘ç”Ÿçš„å±‚æ¬¡ï¼Œå› è€Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè½¯ä»¶æ¸²æŸ“çš„ä»£ä»·åˆå˜å¾—æ›´å¤§ã€‚å½“ç„¶ï¼Œè¿™å–å†³äºç½‘é¡µçš„ç»“æ„å’Œæ¸²æŸ“ç­–ç•¥ã€‚\n- è½¯ä»¶ç»˜å›¾çš„åˆæˆåŒ–æ¸²æŸ“æ–¹å¼ç»“åˆäº†å‰é¢ä¸¤ç§æ–¹å¼çš„ä¼˜ç‚¹ï¼Œè¿™æ—¶å› ä¸ºå¾ˆå¤šç½‘é¡µå¯èƒ½æ—¢åŒ…å«åŸºæœ¬çš„HTMLå…ƒç´ ï¼Œä¹ŸåŒ…å«ä¸€äº›HTML5æ–°åŠŸèƒ½ï¼Œä½¿ç”¨CPUç»˜å›¾æ–¹å¼æ¥ç»˜åˆ¶æŸäº›å±‚ï¼Œä½¿ç”¨GPUæ¥ç»˜åˆ¶å…¶ä»–ä¸€äº›å±‚ã€‚åŸå› å½“ç„¶æ˜¯å‰é¢æ‰€è¿°çš„åŸºäºæ€§èƒ½å’Œå†…å­˜æ–¹é¢ç»¼åˆè€ƒè™‘çš„ç»“æœã€‚\n\n\n> æµè§ˆå™¨è¿˜å¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹çš„æ¸²æŸ“æ¶æ„ï¼Œå°†ç½‘é¡µå†…å®¹ç»˜åˆ¶åˆ°åç«¯å­˜å‚¨çš„æ“ä½œæ”¾åˆ°å¦å¤–ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼ˆç»˜åˆ¶çº¿ç¨‹ï¼‰ï¼Œè€ŒåŸæ¥çº¿ç¨‹è½¬ä¸ºåˆæˆçº¿ç¨‹ï¼Œç»˜åˆ¶çº¿ç¨‹è·Ÿåˆæˆçº¿ç¨‹ä¹‹é—´å¯ä»¥ä½¿ç”¨åŒæ­¥ï¼Œéƒ¨åˆ†åŒæ­¥ï¼Œå®Œå…¨å¼‚æ­¥ç­‰ä½œä¸šæ¨¡å¼ï¼Œè®©æµè§ˆå™¨å¯ä»¥åœ¨æ€§èƒ½ä¸æ•ˆæœä¹‹é—´æ ¹æ®éœ€è¦è¿›è¡Œé€‰æ‹©ã€‚\n\n## GrphicsLayer tree(GrphicsLayeræ ‘)\n\nå¯¹äºè½¯ä»¶æ¸²æŸ“è€Œè¨€ï¼Œåˆ°RenderLayeræ ‘å°±ç»“æŸäº†ï¼Œåé¢ä¸ä¼šå»ºç«‹å…¶å®ƒé¢å¤–çš„æ ‘æ¥å¯¹åº”äºRenderLayeræ ‘ã€‚ä½†æ˜¯ï¼Œå¯¹äºç¡¬ä»¶æ¸²æŸ“æ¥è¯´ï¼Œåœ¨RenderLayeræ ‘ä¹‹åï¼Œæµè§ˆå™¨æ¸²æŸ“å¼•æ“ä¸ºç¡¬ä»¶æ¸²æŸ“æä¾›äº†æ›´å¤šçš„å†…éƒ¨ç»“æ„æ¥æ”¯æŒè¿™ä¸ªæœºåˆ¶ã€‚\n\nåœ¨ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“çš„åˆæˆåŒ–æ¸²æŸ“å’Œè½¯ä»¶ç»˜å›¾çš„åˆæˆåŒ–æ¸²æŸ“æ¶æ„ä¸‹ï¼Œä¸€ä¸ªRenderLayerå¯¹è±¡å¦‚æœéœ€è¦åç«¯å­˜å‚¨ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªRenderLayerBackingå¯¹è±¡ï¼Œè¯¥å¯¹è±¡è´Ÿè´£Renderlayerå¯¹è±¡æ‰€éœ€è¦çš„å„ç§å­˜å‚¨ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œæ¯ä¸ªRenderLayeréƒ½å¯ä»¥åˆ›å»ºè‡ªå·±çš„åç«¯å­˜å‚¨ï¼Œäº‹å®ä¸Šä¸æ˜¯æ‰€æœ‰RenderLayeréƒ½æœ‰è‡ªå·±çš„RenderLayerBackingå¯¹è±¡ã€‚å¦‚æœä¸€ä¸ªRenderLayerå¯¹è±¡è¢«åƒæ ·çš„åˆ›å»ºåç«¯å­˜å‚¨ï¼Œé‚£ä¹ˆå°†è¯¥RenderLayerç§°ä¸ºåˆæˆå±‚ï¼ˆCompositing Layerï¼‰ã€‚\n\nå“ªäº›RenderLayerå¯¹è±¡å¯ä»¥æ˜¯åˆæˆå±‚ï¼Ÿå¦‚æœä¸€ä¸ªRenderLayerå¯¹è±¡å…·æœ‰ä»¥ä¸‹çš„ç‰¹å¾ä¹‹ä¸€ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯åˆæˆå±‚ï¼š\n\n* Layer has 3D or perspective transform CSS properties\n* Layer is used by < video> element using accelerated video decoding\n* Layer is used by a < canvas> element with a 3D context or accelerated 2D context\n* Layer is used for a composited plugin\n* Layer uses a CSS animation for its opacity or uses an animated webkit transform\n* Layer uses accelerated CSS filters\n* Layer with a composited descendant has information that needs to be in the composited layer tree, such as a clip or reflection\n* Layer has a sibling with a lower z-index which has a compositing layer (in other words the layer is rendered on top of a composited layer)\n\nç¿»è¯‘:\n\n* RenderLayerå…·æœ‰3Dæˆ–é€è§†è½¬æ¢çš„CSSå±æ€§\n* RenderLayeråŒ…å«ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„è§†é¢‘è§£ç æŠ€æœ¯çš„`<video>`å…ƒç´ \n* RenderLayeråŒ…å«ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„2Dæˆ–WebGL-3DæŠ€æœ¯çš„`<canvas>`å…ƒç´ \n* RenderLayerä½¿ç”¨äº†åˆæˆæ’ä»¶ã€‚\n* RenderLayerä½¿ç”¨äº†`opacity`æˆ–`transform`åŠ¨ç”»\n* RenderLayerä½¿ç”¨äº†ç¡¬ä»¶åŠ é€Ÿçš„CSS FiltersæŠ€æœ¯\n* RenderLayeråä»£ä¸­åŒ…å«äº†ä¸€ä¸ªåˆæˆå±‚ï¼ˆå¦‚æœ‰clipæˆ–reflectionå±æ€§ï¼‰\n* RenderLayeræœ‰ä¸ªä¸€ä¸ªz-indexæ¯”è‡ªå·±å°çš„åˆæˆå±‚ï¼ˆå³åœ¨ä¸€ä¸ªåˆæˆå±‚ä¹‹ä¸Šï¼‰\n\næ¯ä¸ªåˆæˆå±‚éƒ½æœ‰ä¸€ä¸ªRenderLayerBackingï¼ŒRenderLayerBackingè´Ÿè´£ç®¡ç†RenderLayeræ‰€éœ€è¦çš„æ‰€æœ‰åç«¯å­˜å‚¨ï¼Œå› ä¸ºåç«¯å­˜å‚¨å¯èƒ½éœ€è¦å¤šä¸ªå­˜å‚¨ç©ºé—´ã€‚åœ¨æµè§ˆå™¨(WebKit)ä¸­ï¼Œå­˜å‚¨ç©ºé—´ä½¿ç”¨ç±»GraphicsLayeræ¥è¡¨ç¤ºã€‚æµè§ˆå™¨ä¼šä¸ºè¿™äº›RenderLayeråˆ›å»ºå¯¹åº”çš„GraphicsLayerï¼Œä¸åŒçš„æµè§ˆå™¨éœ€è¦æä¾›è‡ªå·±çš„GrphicsLayerå®ç°ç”¨äºç®¡ç†å­˜å‚¨ç©ºé—´çš„åˆ†é…ï¼Œé‡Šæ”¾ï¼Œæ›´æ–°ç­‰ç­‰ã€‚æ‹¥æœ‰GrphicsLayerçš„RenderLayerä¼šè¢«ç»˜åˆ¶åˆ°è‡ªå·±çš„åç«¯å­˜å‚¨ï¼Œè€Œæ²¡æœ‰GrphicsLayerçš„RenderLayerå®ƒä»¬ä¼šå‘ä¸Šè¿½æº¯æœ‰GrphicsLayerçš„çˆ¶/ç¥–å…ˆRenderLayerï¼Œç›´åˆ°Root RenderLayerä¸ºæ­¢ï¼Œç„¶åç»˜åˆ¶åœ¨æœ‰GrphicsLayerçš„çˆ¶/ç¥–å…ˆRenderLayerçš„å­˜å‚¨ç©ºé—´ï¼Œè€ŒRoot RenderLayeræ€»æ˜¯ä¼šåˆ›å»ºä¸€ä¸ªGrphicsLayerå¹¶æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å­˜å‚¨ç©ºé—´ã€‚åœ¨å°†æ¯ä¸ªåˆæˆå›¾å±‚åŒ…å«çš„RenderLayerå†…å®¹ç»˜åˆ¶åœ¨åˆæˆå±‚çš„åç«¯å­˜å‚¨ä¸­ï¼Œè¿™é‡Œç»˜åˆ¶å¯ä»¥æ˜¯è½¯ä»¶ç»˜åˆ¶æˆ–ç¡¬ä»¶ç»˜åˆ¶ã€‚æ¥ç€ç”±åˆæˆå™¨(Compositor)å°†å¤šä¸ªåˆæˆå±‚åˆæˆèµ·æ¥ï¼Œå½¢æˆæœ€ç»ˆç”¨æˆ·å¯è§çš„ç½‘é¡µï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€å¼ å›¾ç‰‡ã€‚\n\nGraphicsLayeråˆæ„æˆäº†ä¸€æ£µä¸RenderLayerå¹¶è¡Œçš„æ ‘ï¼Œè€ŒRenderLayerä¸GraphicsLayerçš„å…³ç³»æœ‰äº›ç±»ä¼¼äºRenderObjectä¸RenderLayerä¹‹é—´çš„å…³ç³»ã€‚å¦‚ä¸‹æ˜¯DOMæ ‘ã€RenderObjectæ ‘ã€RenderLayeræ ‘ã€GraphicsLayeræ ‘å…³ç³»å›¾ï¼š\n\n![](http://www.chromium.org/_/rsrc/1479245083354/developers/design-documents/gpu-accelerated-compositing-in-chrome/the_compositing_forest.png)\n\n\nè¿™æ ·å¯ä»¥åˆå¹¶ä¸€äº›RenderLayerå±‚ï¼Œä»è€Œå‡å°‘å†…å­˜çš„æ¶ˆè€—ã€‚å…¶æ¬¡ï¼Œåˆå¹¶ä¹‹åï¼Œå‡å°‘äº†åˆå¹¶å¸¦æ¥çš„é‡ç»˜æ€§èƒ½å’Œå¤„ç†ä¸Šçš„å›°éš¾ã€‚\nåœ¨ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“çš„åˆæˆåŒ–æ¸²æŸ“å’Œè½¯ä»¶ç»˜å›¾çš„åˆæˆåŒ–æ¸²æŸ“æ¶æ„ä¸‹ï¼ŒRenderLayerçš„å†…å®¹å˜åŒ–ï¼Œåªéœ€è¦æ›´æ–°æ‰€å±çš„GraphicsLayerçš„ç¼“å­˜å³å¯ï¼Œè€Œç¼“å­˜çš„æ›´æ–°ï¼Œä¹Ÿåªéœ€è¦ç»˜åˆ¶ç›´æ¥æˆ–è€…é—´æ¥å±äºè¿™ä¸ªGraphicsLayerçš„RenderLayerï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„RenderLayerã€‚ç‰¹åˆ«æ˜¯ä¸€äº›ç‰¹å®šçš„CSSæ ·å¼å±æ€§çš„å˜åŒ–ï¼Œå®é™…ä¸Šå¹¶ä¸å¼•èµ·å†…å®¹çš„å˜åŒ–ï¼Œåªéœ€è¦æ”¹å˜ä¸€äº›GraphicsLayerçš„æ··åˆå‚æ•°ï¼Œç„¶åé‡æ–°æ··åˆå³å¯ï¼Œè€Œæ··åˆç›¸å¯¹ç»˜åˆ¶è€Œè¨€æ˜¯å¾ˆå¿«çš„ï¼Œè¿™äº›ç‰¹å®šçš„CSSæ ·å¼å±æ€§æˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºæ˜¯è¢«åŠ é€Ÿçš„ï¼Œä¸åŒçš„æµè§ˆå™¨æ”¯æŒçš„çŠ¶å†µä¸å¤ªä¸€æ ·ï¼Œä½†åŸºæœ¬ä¸ŠCSS Transform & Opacityåœ¨æ‰€æœ‰æ”¯æŒæ··åˆåŠ é€Ÿçš„æµè§ˆå™¨ä¸Šéƒ½æ˜¯è¢«åŠ é€Ÿçš„ã€‚è¢«åŠ é€Ÿçš„CSSæ ·å¼å±æ€§çš„åŠ¨ç”»ï¼Œå°±æ¯”è¾ƒå®¹æ˜“è¾¾åˆ°60å¸§/æ¯ç§’çš„æµç•…æ•ˆæœäº†ã€‚\n\n![](http://img.blog.csdn.net/20140416142656281)\n\nä¸è¿‡å¹¶ä¸æ˜¯æ‹¥æœ‰ç‹¬ç«‹ç¼“å­˜çš„RenderLayerè¶Šå¤šè¶Šå¥½ï¼Œå¤ªå¤šæ‹¥æœ‰ç‹¬ç«‹ç¼“å­˜çš„RenderLayerä¼šå¸¦æ¥ä¸€äº›ä¸¥é‡çš„å‰¯ä½œç”¨:\n - å®ƒå¤§å¤§å¢åŠ äº†å†…å­˜çš„å¼€é”€ï¼Œè¿™ç‚¹åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šçš„å½±å“æ›´å¤§ï¼Œç”šè‡³å¯¼è‡´æµè§ˆå™¨åœ¨ä¸€äº›å†…å­˜è¾ƒå°‘çš„ç§»åŠ¨è®¾å¤‡ä¸Šæ— æ³•å¾ˆå¥½åœ°æ”¯æŒå›¾å±‚åˆæˆåŠ é€Ÿï¼›\n - å®ƒåŠ å¤§äº†åˆæˆçš„æ—¶é—´å¼€é”€ï¼Œå¯¼è‡´åˆæˆæ€§èƒ½çš„ä¸‹é™ï¼Œè€Œåˆæˆæ€§èƒ½è·Ÿç½‘é¡µæ»šåŠ¨/ç¼©æ”¾æ“ä½œçš„æµç•…åº¦åˆæ¯æ¯ç›¸å…³ï¼Œæœ€ç»ˆå¯¼è‡´ç½‘é¡µæ»šåŠ¨/ç¼©æ”¾çš„æµç•…åº¦ä¸‹é™ï¼Œè®©ç”¨æˆ·è§‰å¾—æ“ä½œä¸å¤Ÿæµç•…ã€‚\n\n## Tile Rendering(ç“¦ç‰‡æ¸²æŸ“)\n\né€šå¸¸ä¸€ä¸ªåˆæˆå±‚çš„åç«¯å­˜å‚¨è¢«åˆ†å‰²æˆå¤šä¸ªå¤§å°ç›¸åŒçš„ç“¦ç‰‡çŠ¶çš„å°å­˜å‚¨ç©ºé—´ï¼Œæ¯ä¸ªç“¦ç‰‡å¯ä»¥ç†è§£ä¸ºOpenGLä¸­çš„ä¸€ä¸ªçº¹ç†ï¼Œåˆæˆå±‚çš„ç»“æœè¢«åˆ†å¼€å­˜å‚¨åœ¨è¿™äº›ç“¦ç‰‡ä¸­ã€‚ä¸ºä»€ä¹ˆä½¿ç”¨ç“¦ç‰‡åŒ–çš„åç«¯å­˜å‚¨ï¼Ÿ\n - DOMæ ‘ç§çš„htmlå…ƒç´ æ‰€åœ¨çš„å±‚å¯èƒ½ä¼šæ¯”è¾ƒå¤§ï¼Œå› ä¸ºç½‘é¡µçš„é«˜åº¦å¾ˆå¤§ï¼Œå¦‚æœåªæ˜¯ä½¿ç”¨ä¸€ä¸ªåç«¯å­˜å‚¨çš„è¯ï¼Œé‚£ä¹ˆéœ€è¦ä¸€ä¸ªå¾ˆå¤§çš„çº¹ç†å¯¹è±¡ï¼Œä½†æ˜¯å®é™…çš„GPUç¡¬ä»¶å¯èƒ½åªæ”¯æŒéå¸¸æœ‰é™çš„çº¹ç†å¤§å°ã€‚\n - åœ¨ä¸€ä¸ªæ¯”è¾ƒå¤§çš„åˆæˆå±‚ä¸­ï¼Œå¯èƒ½åªæ˜¯å…¶ä¸­ä¸€éƒ¨åˆ†å‘ç”Ÿå˜åŒ–ï¼Œæ ¹æ®ä¹‹å‰çš„ä»‹ç»ï¼Œéœ€è¦é‡æ–°ç»˜åˆ¶æ•´ä¸ªå±‚ï¼Œè¿™æ ·å¿…ç„¶äº§ç”Ÿé¢å¤–çš„å¼€é”€ï¼Œä½¿ç”¨ç“¦ç‰‡è¯çš„åç«¯å­˜å‚¨ï¼Œå°±åªéœ€è¦é‡ç»˜ä¸€äº›å­˜åœ¨æ›´æ–°çš„ç“¦ç‰‡ã€‚\n - å½“å±‚å‘ç”Ÿæ»šåŠ¨çš„æ—¶å€™ï¼Œä¸€äº›ç“¦ç‰‡å¯èƒ½ä¸å†éœ€è¦ï¼Œç„¶åæ¸²æŸ“å¼•æ“éœ€è¦ä¸€äº›æ–°çš„ç“¦ç‰‡æ¥ç»˜åˆ¶æ–°çš„åŒºåŸŸï¼Œè¿™äº›å¤§å°ç›¸åŒçš„åç«¯å­˜å‚¨å¾ˆå®¹æ˜“é‡å¤åˆ©ç”¨ã€‚\n\n![](./tiles.png)\n\n\n## æµç•…åŠ¨ç”»\n\nç½‘é¡µåŠ è½½åï¼Œç»˜åˆ¶æ–°çš„æ¯ä¸€å¸§ï¼Œä¸€èˆ¬éƒ½éœ€è¦ç»è¿‡è®¡ç®—å¸ƒå±€(layout)ã€ç»˜å›¾(paint)ã€åˆæˆï¼ˆcompositeï¼‰ä¸‰é˜¶æ®µã€‚å› æ­¤è¦æƒ³æé«˜é¡µé¢æ€§èƒ½ï¼ˆæˆ–FPSï¼‰ï¼Œéœ€è¦å‡å°‘æ¯ä¸€å¸§çš„æ—¶é—´ã€‚è€Œåœ¨è¿™ä¸‰ä¸ªé˜¶æ®µä¸­ï¼Œlayoutå’Œpaintæ¯”è¾ƒè€—æ—¶é—´ï¼Œè€Œåˆæˆéœ€è¦çš„æ—¶é—´ç›¸å¯¹è¾ƒå°‘ä¸€äº›ã€‚\n\n#### layout\nå¦‚æœä¿®æ”¹ä¸€ä¸ªDOMå…ƒç´ çš„â€layoutâ€å±æ€§ï¼Œä¹Ÿå°±æ˜¯æ”¹å˜äº†å…ƒç´ çš„æ ·å¼ï¼ˆæ¯”å¦‚å®½åº¦ã€é«˜åº¦æˆ–è€…ä½ç½®ç­‰ï¼‰ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šæ£€æŸ¥å“ªäº›å…ƒç´ éœ€è¦é‡æ–°å¸ƒå±€ï¼Œç„¶åå¯¹é¡µé¢æ¿€å‘ä¸€ä¸ªreflowè¿‡ç¨‹å®Œæˆé‡æ–°å¸ƒå±€ã€‚è¢«reflowçš„å…ƒç´ ï¼Œæ¥ä¸‹æ¥ä¹Ÿä¼šæ¿€å‘ç»˜åˆ¶è¿‡ç¨‹ï¼Œæœ€åæ¿€å‘æ¸²æŸ“å±‚åˆå¹¶è¿‡ç¨‹ï¼Œç”Ÿæˆæœ€åçš„ç”»é¢ã€‚\n![](https://developers.google.com/web/fundamentals/performance/rendering/images/intro/frame-full.jpg)\n#### paint\nå¦‚æœä¿®æ”¹äº†â€œpaint onlyâ€å±æ€§ï¼ˆä¾‹å¦‚èƒŒæ™¯å›¾ç‰‡ã€æ–‡å­—é¢œè‰²æˆ–é˜´å½±ç­‰ï¼‰ï¼Œå³ä¸ä¼šå½±å“é¡µé¢å¸ƒå±€çš„å±æ€§ï¼Œåˆ™æµè§ˆå™¨ä¼šè·³è¿‡å¸ƒå±€ï¼Œä½†ä»å°†æ‰§è¡Œç»˜åˆ¶ã€‚\n![](https://developers.google.com/web/fundamentals/performance/rendering/images/intro/frame-no-layout.jpg)\n#### composite\nå¦‚æœæ›´æ”¹äº†ä¸€ä¸ªæ—¢ä¸è¦å¸ƒå±€ä¹Ÿä¸è¦ç»˜åˆ¶çš„å±æ€§ï¼Œåˆ™æµè§ˆå™¨å°†è·³åˆ°åªæ‰§è¡Œåˆæˆã€‚è¿™ä¸ªæœ€åçš„ç‰ˆæœ¬å¼€é”€æœ€å°ï¼Œæœ€é€‚åˆäºåº”ç”¨ç”Ÿå‘½å‘¨æœŸä¸­çš„é«˜å‹åŠ›ç‚¹ï¼Œä¾‹å¦‚åŠ¨ç”»æˆ–æ»šåŠ¨ã€‚\n\n![](https://developers.google.com/web/fundamentals/performance/rendering/images/intro/frame-no-layout-paint.jpg)\n\n**å¦‚æœæƒ³çŸ¥é“æ›´æ”¹ä»»ä½•æŒ‡å®šCSSå±æ€§å°†è§¦å‘layoutã€paintã€compositeä¸­çš„å“ªä¸€ä¸ªï¼Œè¯·æŸ¥çœ‹[CSSè§¦å‘å™¨](https://csstriggers.com/)ã€‚**\n\n#### ä¼˜åŒ–\nå¯ä»¥é€šè¿‡ä»€ä¹ˆé€”å¾„è¿›è¡Œä¼˜åŒ–ï¼Œå‡å°‘æ¯ä¸€å¸§çš„æ—¶é—´ï¼ˆé¿å…è¿‡å¤šlayoutæˆ–paintï¼‰ï¼š\n\n - ä½¿ç”¨é€‚åˆçš„ç½‘é¡µåˆ†å±‚æŠ€æœ¯å‡å°‘layoutå’Œpaintã€‚ä¸€æ—¦æœ‰è¯·æ±‚æ›´æ–°ï¼Œå¦‚æœæ²¡æœ‰åˆ†å±‚ï¼Œæ¸²æŸ“å¼•æ“å¯èƒ½éœ€è¦é‡æ–°ç»˜åˆ¶æ‰€æœ‰åŒºåŸŸï¼Œå› ä¸ºè®¡ç®—æ›´æ–°éƒ¨åˆ†å¯¹GPUæ¥è¯´å¯èƒ½æ¶ˆè€—æ›´å¤šçš„æ—¶é—´ã€‚è€Œç½‘é¡µåˆ†å±‚ä¹‹åï¼Œéƒ¨åˆ†åŒºåŸŸçš„æ›´æ–°å¯èƒ½åªåœ¨ç½‘é¡µçš„ä¸€å±‚æˆ–å‡ å±‚ï¼Œè€Œä¸éœ€è¦å°†æ•´ä¸ªç½‘é¡µé‡æ–°ç»˜åˆ¶ã€‚é€šè¿‡é‡æ–°ç»˜åˆ¶ç½‘é¡µçš„ä¸€å±‚æˆ–å‡ å±‚ï¼Œå¹¶å°†å®ƒä»¬å’Œå…¶ä»–ä¹‹å‰ç»˜åˆ¶å®Œçš„å±‚åˆå¹¶èµ·æ¥ï¼Œæ—¢èƒ½ä½¿ç”¨GPUçš„èƒ½åŠ›ï¼Œåˆèƒ½å¤Ÿå‡å°‘é‡ç»˜çš„å¼€é”€ã€‚\n - ä½¿ç”¨åˆæˆå±æ€§æ ·å¼ï¼ˆopcityã€tansformï¼‰æ¥å®Œæˆtansitionæˆ–animationã€‚å½“åˆæˆå™¨åˆæˆæ—¶å€™ï¼Œæ¯ä¸ªåˆæˆå±‚éƒ½å¯ä»¥è®¾ç½®å˜å½¢å±æ€§ï¼šä½ç§»ï¼ˆTranslateï¼‰ã€ç¼©æ”¾ï¼ˆScaleï¼‰ã€æ—‹è½¬ï¼ˆRotationï¼‰ã€opacityï¼Œè¿™äº›å±æ€§ä»…ä»…æ”¹å˜åˆæˆå±‚çš„å˜æ¢å‚æ•°ï¼Œè€Œä¸éœ€è¦layoutå’Œpaintæ“ä½œï¼Œæå¤§åœ°å‡å°‘æ¯ä¸€å¸§çš„æ¸²æŸ“æ—¶é—´ã€‚\n\n å³ä½¿ç”¨GPUç¡¬ä»¶åŠ é€Ÿï¼Œä¸ºæŸäº›RenderLayeråˆ›å»ºå¯¹åº”GraphicsLayerã€‚é€šè¿‡ä¸ºæ¯ä¸€ä¸ªåˆæˆå±‚è®¾ç½®å˜å½¢å±æ€§æ¥å®Œæˆtansitionæˆ–animationï¼Œæœ‰æ•ˆåœ°é¿å…relayoutå’Œrepaintçš„å¼€é”€ã€‚\n\n ![](https://www.html5rocks.com/zh/tutorials/speed/high-performance-animations/cheap-operations.jpg)\n\n\n\n\n\n\n\n## æ€»ç»“\næœ¬æ–‡æ˜¯ç”±å‡ ç¯‡å…³äºæµè§ˆå™¨æ¸²æŸ“çš„æ–‡ç« ç»„åˆè€Œæˆï¼Œå¯èƒ½æœ‰äº›æ¦‚å¿µæ¯”è¾ƒæŠ½è±¡ï¼Œä¸å¥½ç†è§£ï¼Œå¯ä»¥æŸ¥çœ‹**å‚è€ƒæ–‡ç« **å°èŠ‚ï¼Œè·å–æ›´å¤šä¿¡æ¯ã€‚æœ¬æ–‡é‡ç‚¹ä»‹ç»äº†æµè§ˆå™¨æ¸²æŸ“å¼•æ“çš„æ¸²æŸ“è¿‡ç¨‹ï¼Œæ¶‰åŠäº†DOMæ ‘ã€CSSOMæ ‘ã€RenderObjectæ ‘ã€RenderLayeræ ‘ã€GraphicsLayeræ ‘ã€‚å¹¶å¯¹å„ç§æ¸²æŸ“æ¨¡å¼è¿›è¡Œäº†ç®€å•ä»‹ç»ï¼Œå…¶ä¸­å¼•å…¥äº†ç¡¬ä»¶åŠ é€Ÿæœºåˆ¶ï¼Œè¿˜ç»™å‡ºä¸€äº›ä¼˜åŒ–å»ºè®®ã€‚äº†è§£è¿™äº›çŸ¥è¯†ç‚¹å¯¹æˆ‘ä»¬å¼€å‘é«˜æ€§èƒ½çš„webåº”ç”¨ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚\n\n## å‚è€ƒæ–‡ç« ï¼š\n- [GPU Accelerated Compositing in Chrome](http://www.chromium.org/developers/design-documents/gpu-accelerated-compositing-in-chrome)\n- [æµè§ˆå™¨çš„å·¥ä½œåŸç†ï¼šæ–°å¼ç½‘ç»œæµè§ˆå™¨å¹•åæ­ç§˜](https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/)\n- [æ„å»ºå¯¹è±¡æ¨¡å‹](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/constructing-the-object-model?hl=zh-cn)\n- [How Rendering Work (in WebKit and Blink)](https://rogeryi.wordpress.com/2014/04/16/how-rendering-work-in-webkit-and-blink/)\n- [WebKitæŠ€æœ¯å†…å¹•](http://blog.csdn.net/milado_nju)\n- [æ¸²æŸ“æ€§èƒ½](https://developers.google.com/web/fundamentals/performance/rendering/)\n- [High Performance Animations](https://www.html5rocks.com/zh/tutorials/speed/high-performance-animations/)","source":"_posts/æµè§ˆå™¨æ¸²æŸ“ç®€è¿°.md","raw":"---\ntitle: æµè§ˆå™¨æ¸²æŸ“ç®€è¿°\ndate: 2017-11-21 16:05:04\ntags: [æ¸²æŸ“, ä¼˜åŒ–, render, ç¡¬ä»¶åŠ é€Ÿ]\nauthor: singsong\n---\n\nè¦ç¼–å†™é«˜æ€§èƒ½çš„ç½‘ç«™å’Œåº”ç”¨ï¼Œé™¤äº†ç¡®ä¿ç¼–å†™çš„ä»£ç èƒ½é«˜æ•ˆåœ°è¿è¡Œå¤–ï¼Œè¿˜éœ€è¦äº†è§£æµè§ˆå™¨æ˜¯å¦‚ä½•è¿›è¡Œæ¸²æŸ“å·¥ä½œçš„ã€‚\n\n## æµè§ˆå™¨ä¸»è¦ç»„æˆç»“æ„\n\n![](https://skmukhiya.files.wordpress.com/2013/06/fb76d-layers-pagespeed-ce-mfe5f8ctav.png)\n\n1. ç”¨æˆ·ç•Œé¢(User Interface)ï¼šåŒ…æ‹¬åœ°å€æ ã€å‰è¿›/åé€€æŒ‰é’®ã€ä¹¦ç­¾èœå•ç­‰ã€‚é™¤äº†æµè§ˆå™¨ä¸»çª—å£æ˜¾ç¤ºçš„æ‚¨è¯·æ±‚çš„é¡µé¢å¤–ï¼Œå…¶ä»–æ˜¾ç¤ºçš„å„ä¸ªéƒ¨åˆ†éƒ½å±äºç”¨æˆ·ç•Œé¢ã€‚\n2. æµè§ˆå™¨å¼•æ“(Browser engine)ï¼šåœ¨ç”¨æˆ·ç•Œé¢(User Interface)å’Œæ¸²æŸ“å¼•æ“(Rendering engine)ä¹‹é—´ä¼ é€æŒ‡ä»¤ã€‚\n3. æ¸²æŸ“å¼•æ“(Rendering engine)ï¼šè´Ÿè´£æ˜¾ç¤ºè¯·æ±‚çš„å†…å®¹ã€‚å¦‚æœè¯·æ±‚çš„å†…å®¹æ˜¯HTMLï¼Œå®ƒå°±è´Ÿè´£è§£æHTMLå’ŒCSSå†…å®¹ï¼Œå¹¶å°†è§£æåçš„å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚\n4. ç½‘ç»œ(Networking)ï¼šç”¨äºç½‘ç»œè°ƒç”¨ï¼Œæ¯”å¦‚HTTPè¯·æ±‚ã€‚å…¶æ¥å£ä¸å¹³å°æ— å…³ï¼Œå¹¶ä¸ºæ‰€æœ‰å¹³å°æä¾›åº•å±‚å®ç°ã€‚\n5. JavaScriptè§£é‡Šå™¨(JavaScript Interperter)ï¼šç”¨äºè§£æå’Œæ‰§è¡ŒJavaScriptä»£ç ã€‚\n6. ç”¨æˆ·ç•Œé¢åç«¯(UI Backend)ï¼šç”¨äºç»˜åˆ¶åŸºæœ¬çš„çª—å£å°éƒ¨ä»¶ï¼Œæ¯”å¦‚ç»„åˆæ¡†å’Œçª—å£ã€‚å…¶å…¬å¼€äº†ä¸å¹³å°æ— å…³çš„é€šç”¨æ¥å£ï¼Œè€Œåœ¨åº•å±‚ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ç”¨æˆ·ç•Œé¢æ–¹æ³•ã€‚\n7. æ•°æ®å­˜å‚¨(Data storage)ï¼šè¿™æ˜¯æŒä¹…å±‚ã€‚æµè§ˆå™¨éœ€è¦åœ¨ç¡¬ç›˜ä¸Šä¿å­˜å„ç§æ•°æ®ï¼Œä¾‹å¦‚Cookiesã€‚æµè§ˆå™¨è¿˜æ”¯æŒè¯¸å¦‚localStorageï¼ŒIndexedDBï¼ŒWebSQLå’ŒFileSystemä¹‹ç±»çš„å­˜å‚¨æœºåˆ¶ã€‚\n\n\n ## æ–‡æ¡£å¯¹è±¡æ¨¡å‹(DOMï¼šDocument Object Modelï¼‰\næœ¬æ–‡ä¸»è¦ä»‹ç»æµè§ˆå™¨çš„æ¸²æŸ“ï¼Œå³æ¸²æŸ“å¼•æ“(Rendering engine)è´Ÿè´£çš„å·¥ä½œ: å°†è¯·æ±‚çš„HTMLå†…å®¹è§£æå¹¶æ¸²æŸ“åœ¨å±å¹•ä¸Šã€‚\nå¦‚ä¸‹HTMLç»“æ„ï¼Œä¸€ä¸ªåŒ…å«ä¸€äº›æ–‡æœ¬å’Œä¸€å¼ å›¾ç‰‡ï¼š\n```html\n<html>\n  <head>\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n    <link href=\"style.css\" rel=\"stylesheet\">\n    <title>Critical Path</title>\n  </head>\n  <body>\n    <p>Hello <span>web performance</span> students!</p>\n    <div><img src=\"awesome-photo.jpg\"></div>\n  </body>\n</html>\n```\næµè§ˆå™¨æ˜¯å¦‚ä½•å¤„ç†è¿™ä¸ªHTMLé¡µé¢ï¼š\n\n\b![](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/full-process.png)\n\n1. è½¬æ¢(Conversion)ï¼šæµè§ˆå™¨ä»ç£ç›˜æˆ–ç½‘ç»œè¯»å–HTMLçš„åŸå§‹å­—èŠ‚ç ï¼Œå¹¶æ ¹æ®æ–‡ä»¶çš„æŒ‡å®šç¼–ç ï¼ˆä¾‹å¦‚ UTF-8ï¼‰å°†å®ƒä»¬è½¬æ¢æˆå¯¹åº”çš„å­—ç¬¦ã€‚\n2. ä»¤ç‰ŒåŒ–(Tokenizing)ï¼šæµè§ˆå™¨å°†å­—ç¬¦ä¸²è½¬æ¢æˆ[W3C HTML5æ ‡å‡†](http://www.w3.org/TR/html5/)è§„å®šçš„å„ç§ä»¤ç‰Œï¼Œä¾‹å¦‚`<html>`ã€`<body>`ï¼Œä»¥åŠå…¶ä»–å°–æ‹¬å·å†…çš„å­—ç¬¦ä¸²ã€‚æ¯ä¸ªä»¤ç‰Œéƒ½å…·æœ‰ç‰¹æ®Šå«ä¹‰å’Œä¸€ç»„è§„åˆ™ã€‚\n3. è¯æ³•åˆ†æ(Lexing)ï¼šå‘å‡ºçš„ä»¤ç‰Œè½¬æ¢æˆå®šä¹‰å…¶å±æ€§å’Œè§„åˆ™çš„â€œå¯¹è±¡â€ã€‚\n4. DOMæ„å»º(DOM construction)ï¼šHTMLæ ‡è®°å®šä¹‰ä¸åŒæ ‡è®°ä¹‹é—´çš„å…³ç³»ï¼ˆä¸€äº›æ ‡è®°åŒ…å«åœ¨å…¶ä»–æ ‡è®°å†…ï¼‰ï¼Œåˆ›å»ºçš„å¯¹è±¡é“¾æ¥åœ¨ä¸€ä¸ªæ ‘æ•°æ®ç»“æ„å†…ï¼Œæ­¤ç»“æ„ä¹Ÿä¼šæ•è·åŸå§‹æ ‡è®°ä¸­å®šä¹‰çš„çˆ¶é¡¹-å­é¡¹å…³ç³»ï¼šHTMLå¯¹è±¡æ˜¯bodyå¯¹è±¡çš„çˆ¶é¡¹ï¼Œbodyæ˜¯paragraphå¯¹è±¡çš„çˆ¶é¡¹ï¼Œä¾æ­¤ç±»æ¨ã€‚\n\næ•´ä¸ªè¿‡ç¨‹çš„æœ€ç»ˆè¾“å‡ºæ˜¯HTMLé¡µé¢çš„æ–‡æ¡£å¯¹è±¡æ¨¡å‹ (DOM)ï¼Œæµè§ˆå™¨å¯¹é¡µé¢è¿›è¡Œçš„æ‰€æœ‰è¿›ä¸€æ­¥å¤„ç†éƒ½ä¼šç”¨åˆ°å®ƒã€‚æµè§ˆå™¨æ¯æ¬¡å¤„ç†HTMLæ ‡è®°æ—¶ï¼Œéƒ½ä¼šå®Œæˆä»¥ä¸Šæ‰€æœ‰æ­¥éª¤ï¼šå°†å­—èŠ‚è½¬æ¢æˆå­—ç¬¦ï¼Œç¡®å®šä»¤ç‰Œï¼Œå°†ä»¤ç‰Œè½¬æ¢æˆèŠ‚ç‚¹ï¼Œç„¶åæ„å»ºDOMæ ‘ã€‚DOMæ ‘æ•è·æ–‡æ¡£æ ‡è®°çš„å±æ€§å’Œå…³ç³»ï¼Œä½†å¹¶æœªå¤„ç†å…ƒç´ åœ¨æ¸²æŸ“åå‘ˆç°çš„å¤–è§‚ã€‚é‚£æ˜¯CSSOMçš„è´£ä»»ã€‚\n\n\n## CSSå¯¹è±¡æ¨¡å‹(CSSOMï¼šCSS Object Model)\n\nåœ¨æµè§ˆå™¨æ„å»ºDOMé‡åˆ°linkæ ‡è®°æ—¶ï¼Œè¯¥æ ‡è®°å¼•ç”¨ä¸€ä¸ªå¤–éƒ¨CSSæ ·å¼è¡¨ï¼šstyle.cssã€‚ç”±äºé¢„è§åˆ°éœ€è¦åˆ©ç”¨è¯¥èµ„æºæ¥æ¸²æŸ“é¡µé¢ï¼Œå®ƒä¼šç«‹å³å‘å‡ºå¯¹è¯¥èµ„æºçš„è¯·æ±‚ï¼Œå¹¶è¿”å›ä»¥ä¸‹å†…å®¹ï¼š\n\n```CSS\nbody { font-size: 16px }\np { font-weight: bold }\nspan { color: red }\np span { display: none }\nimg { float: right }\n```\n\nä¸å¤„ç†HTMLæ—¶ç±»ä¼¼ï¼Œéœ€è¦å°†æ”¶åˆ°çš„CSSè§„åˆ™è½¬æ¢æˆæŸç§æµè§ˆå™¨èƒ½å¤Ÿç†è§£å’Œå¤„ç†çš„ä¸œè¥¿ã€‚å› æ­¤ä¼šé‡å¤HTMLè¿‡ç¨‹ï¼Œä¸è¿‡æ˜¯ä¸ºCSSè€Œä¸æ˜¯HTMLï¼š\n\n![](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/cssom-construction.png?hl=zh-cn)\n\nCSSå­—èŠ‚è½¬æ¢æˆå­—ç¬¦ï¼Œæ¥ç€è½¬æ¢æˆä»¤ç‰Œå’ŒèŠ‚ç‚¹ï¼Œæœ€åé“¾æ¥åˆ°CSSOMæ ‘ç»“æ„å†…ï¼š\n\n\n![https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/cssom-tree.png](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/cssom-tree.png)\n\nCSSOMä¸ºä½•å…·æœ‰æ ‘ç»“æ„ï¼Ÿç”¨äºç¡®å®šèŠ‚ç‚¹å¯¹è±¡çš„è®¡ç®—æ ·å¼ã€‚å¦‚spanæ ‡è®°åŒ…å«äº†`color:red`æ ·å¼å’Œç»§æ‰¿äºbodyæ ‡è®°çš„`font-size:16px`æ ·å¼;\n\n<u>æ³¨æ„ï¼šä»¥ä¸Šæ ‘å¹¶éå®Œæ•´çš„CSSOMæ ‘ï¼Œå®ƒåªæ˜¯æ›¿ä»£é»˜è®¤æ ·å¼çš„è‡ªå®šä¹‰æ ·å¼ã€‚æ¯ä¸ªæµè§ˆå™¨éƒ½æä¾›ä¸€ç»„é»˜è®¤æ ·å¼ï¼ˆä¹Ÿç§°ä¸ºâ€œUser Agent æ ·å¼â€ï¼‰ï¼Œå³ä¸æä¾›ä»»ä½•è‡ªå®šä¹‰æ ·å¼æ—¶æ‰€çœ‹åˆ°çš„æ ·å¼ï¼Œè‡ªå®šä¹‰æ ·å¼åªæ˜¯æ›¿æ¢è¿™äº›é»˜è®¤æ ·å¼</u>\n\n\nCSSOMæ˜¯åœ¨DOMä¸­çš„ä¸€äº›æ¥å£ä¸­ï¼ŒåŠ å…¥è·å–å’Œæ“ä½œCSSå±æ€§æˆ–æ¥å£çš„JavaScriptæ¥å£ï¼Œå› è€ŒJavaScriptå¯ä»¥åŠ¨æ€æ“ä½œCSSæ ·å¼ã€‚DOMæä¾›äº†æ¥å£è®©JavaScriptä¿®æ”¹HTMLæ–‡æ¡£ï¼ŒCSSOMæä¾›äº†æ¥å£è®©JavaScriptè·å¾—å’Œä¿®æ”¹CSSä»£ç è®¾ç½®çš„æ ·å¼ä¿¡æ¯ã€‚\n\n\n\n## æ¸²æŸ“æ ‘(RenderObject treeï¼Œä¹Ÿç§°ä¸ºRender tree)\nåœ¨DOMæ ‘ä¸­ï¼Œå­˜åœ¨ä¸å¯è§ä¸å¯è§èŠ‚ç‚¹ä¹‹åˆ†ã€‚é¡¾åæ€ä¹‰ï¼Œä¸å¯è§èŠ‚ç‚¹æ˜¯ä¸éœ€è¦ç»˜åˆ¶æœ€ç»ˆé¡µé¢ä¸­çš„èŠ‚ç‚¹ï¼Œå¦‚`meta`ã€`head`ã€`script`ç­‰ï¼Œä»¥åŠé€šè¿‡CSSæ ·å¼`display:none`éšè—çš„èŠ‚ç‚¹ã€‚ç›¸åå¯è§èŠ‚ç‚¹æ˜¯ç”¨æˆ·å¯è§çš„ï¼Œå¦‚`body`ã€`div`ã€`span`ã€`canvas`ã€`img`ç­‰ã€‚\nå¯¹äºè¿™äº›å¯è§èŠ‚ç‚¹ï¼Œæµè§ˆå™¨éœ€è¦å°†å®ƒä»¬çš„å†…å®¹ç»˜åˆ¶åˆ°æœ€ç»ˆçš„é¡µé¢ä¸­ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¼šä¸ºå®ƒä»¬å»ºç«‹å¯¹åº”çš„RenderObjectå¯¹è±¡ã€‚ä¸€ä¸ªRenderObjectå¯¹è±¡ä¿å­˜äº†ä¸ºç»˜åˆ¶DOMèŠ‚ç‚¹çš„å„ç§ä¿¡æ¯ã€‚è¿™äº›RenderObjectå¯¹è±¡ä¸DOMå¯¹è±¡ç±»ä¼¼ï¼Œä¹Ÿæ„æˆä¸€æ£µæ ‘ï¼Œç§°ä¸º**RenderObject tree**ã€‚RenderObjectæ ‘æ˜¯åŸºäºDOMæ ‘å»ºç«‹èµ·æ¥çš„ä¸€æ£µæ–°æ ‘ï¼Œæ˜¯ä¸ºäº†å¸ƒå±€è®¡ç®—å’Œæ¸²æŸ“ç­‰æœºåˆ¶è€Œæ„å»ºçš„ä¸€ç§æ–°çš„å†…éƒ¨è¡¨ç¤ºã€‚RenderObjectæ ‘èŠ‚ç‚¹ä¸DOMæ ‘èŠ‚ç‚¹ä¸æ˜¯ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚å› ä¸ºåˆ›å»ºä¸€ä¸ªRenderObjectå¯¹è±¡éœ€è¦æ»¡è¶³å¦‚ä¸‹è§„åˆ™ï¼š\n- DOMæ ‘çš„documentèŠ‚ç‚¹\n- DOMæ ‘ä¸­çš„å¯è§èŠ‚ç‚¹ï¼Œå¦‚`html`ã€`body`ã€`div`ç­‰ã€‚è€Œæµè§ˆå™¨ä¸ä¼šä¸ºä¸å¯è§èŠ‚ç‚¹åˆ›å»ºRenderObjectèŠ‚ç‚¹ã€‚\n- æŸäº›æƒ…å†µä¸‹æµè§ˆå™¨éœ€è¦åˆ›å»ºåŒ¿åçš„RenderObjectèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¸å¯¹åº”DOMæ ‘ä¸­çš„ä»»ä½•èŠ‚ç‚¹ã€‚\n\nRenderObjectå¯¹è±¡æ„æˆäº†RenderObjectæ ‘ï¼Œæ¯ä¸ªRenderObjectå¯¹è±¡ä¿å­˜äº†ä¸ºç»˜åˆ¶DOMèŠ‚ç‚¹çš„è®¡ç®—æ ·å¼ã€‚RenderObjectæ ‘ä¹Ÿå¯ä»¥ç†è§£æˆç”±CSSOMæ ‘å’ŒDOMæ ‘åˆå¹¶æˆï¼š\n\n![](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/render-tree-construction.png?hl=zh-cn)\n\n## å¸ƒå±€(loayout)\n\nå½“æµè§ˆå™¨åˆ›å»ºRenderObjectå¯¹è±¡ä¹‹åï¼Œæ¯ä¸ªå¯¹è±¡å¹¶ä¸çŸ¥é“è‡ªå·±åœ¨è®¾å¤‡è§†å£å†…çš„ä½ç½®ã€å¤§å°ç­‰ä¿¡æ¯ã€‚æµè§ˆå™¨æ ¹æ®[ç›’æ¨¡å‹(Box-model)](https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Box_Model)æ¥è®¡ç®—å®ƒä»¬çš„ä½ç½®ã€å¤§å°ç­‰ä¿¡æ¯çš„è¿‡ç¨‹ç§°ä¸ºå¸ƒå±€è®¡ç®—ï¼ˆé‡æ’ï¼‰ã€‚\nå¸ƒå±€è®¡ç®—æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œè¿™æ˜¯å› ä¸ºä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°é€šå¸¸éœ€è¦å…ˆè®¡ç®—å®ƒçš„å­©å­èŠ‚ç‚¹çš„ä½ç½®ã€å¤§å°ç­‰ä¿¡æ¯ã€‚ä¸ºäº†è®¡ç®—èŠ‚ç‚¹åœ¨é¡µé¢ä¸­çš„ç¡®åˆ‡å¤§å°å’Œä½ç½®ï¼Œæµè§ˆå™¨ä¼šä»RenderObjectæ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹è¿›è¡Œéå†ã€‚\n\nå®ä¾‹ï¼š\n```html\n<html>\n  <head>\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n    <title>Critial Path: Hello world!</title>\n  </head>\n  <body>\n    <div style=\"width: 50%\">\n      <div style=\"width: 50%\">Hello world!</div>\n    </div>\n  </body>\n</html>\n```\né¡µé¢åŒ…å«äº†ä¸¤ä¸ªåµŒå¥—divï¼šçˆ¶divå°†å…¶çš„æ˜¾ç¤ºå°ºå¯¸è®¾ç½®ä¸ºè§†å£å®½åº¦çš„50%ï¼Œå­divå°†å…¶å®½åº¦è®¾ç½®ä¸ºå…¶çˆ¶é¡¹çš„50%ï¼Œå³è§†å£å®½åº¦çš„25%ã€‚\n\n![](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/layout-viewport.png?hl=zh-cn)\n\n## RenderLayeræ ‘(RenderLayer tree)\n\næµè§ˆå™¨æ¸²æŸ“å¼•æ“å¹¶ä¸æ˜¯ç›´æ¥ä½¿ç”¨RenderObjectæ ‘è¿›è¡Œç»˜åˆ¶ï¼Œä¸ºäº†æ–¹ä¾¿å¤„ç†Positioning(å®šä½)ï¼ŒClipping(è£å‰ª)ï¼ŒOverflow-scroll(é¡µå…§æ»šåŠ¨)ï¼ŒCSS Transform/Opacity/Animation/Filterï¼ŒMask or Reflectionï¼ŒZ-indexing(Zæ’åº)ç­‰ï¼Œæµè§ˆå™¨éœ€è¦ä¼šä¸ºä¸€äº›ç‰¹å®šçš„RenderObjectç”Ÿæˆå¯¹åº”çš„RenderLayerï¼Œå¹¶ç”Ÿæˆä¸€æ£µå¯¹åº”çš„RenderLayeræ ‘ã€‚è€Œè¿™äº›ç‰¹å®šçš„RenderObjectè·Ÿå¯¹åº”çš„RenderLayerå°±æ˜¯ç›´å±çš„å…³ç³»ï¼Œå¦‚æœå®ƒä»¬çš„å­èŠ‚ç‚¹å¦‚æœæ²¡æœ‰å¯¹åº”çš„RenderLayerï¼Œå°±ä»å±äºçˆ¶èŠ‚ç‚¹çš„RenderLayerã€‚æœ€ç»ˆï¼Œæ¯ä¸€ä¸ªRenderObjectéƒ½ä¼šç›´æ¥æˆ–è€…é—´æ¥åœ°ä»å±äºä¸€ä¸ªRenderLayerã€‚å› æ­¤RenderObjectèŠ‚ç‚¹ä¸RenderLayerèŠ‚ç‚¹ä¸æ˜¯ä¸€ä¸€å¯¹åº”å…³ç³»ï¼Œè€Œæ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚é‚£éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Œæ¸²æŸ“å¼•æ“æ‰ä¸ºRenderObjectå»ºç«‹å¯¹åº”çš„RenderLayerï¼š\n\n* It's the root object for the page\n* It has explicit CSS position properties (relative, absolute or a transform)\n* It is transparent\n* Has overflow, an alpha mask or reflection\n* Has a CSS filter\n* Corresponds to `<canvas>` element that has a 3D (WebGL) context or an accelerated 2D context\n* Corresponds to a `<video>` element\n\nç¿»è¯‘ï¼š\n* DOMæ ‘çš„DocumentèŠ‚ç‚¹å¯¹åº”çš„RenderObjectèŠ‚ç‚¹å’ŒHTMLèŠ‚ç‚¹å¯¹åº”çš„RenderObjectèŠ‚ç‚¹\n* æ˜¾å¼æŒ‡å®šCSS positionå±æ€§çš„RenderObjectèŠ‚ç‚¹\n* æœ‰é€æ˜åº¦çš„RenderObjectèŠ‚ç‚¹\n* æœ‰overflowï¼Œalphaå’Œreflectionçš„æ ·å¼RenderObjectèŠ‚ç‚¹\n* æœ‰filteræ ·å¼çš„RenderObjectèŠ‚ç‚¹\n* ä½¿ç”¨Canvas 2Då’Œ3D(WebGL)æŠ€æœ¯çš„RenderObjectèŠ‚ç‚¹\n* videoå…ƒç´ å¯¹åº”çš„RenderObjectèŠ‚ç‚¹\n\næ¯ä¸ªRenderLayerå¯¹è±¡å¯ä»¥æƒ³è±¡æˆå›¾åƒä¸­ä¸€ä¸ªå›¾å±‚ï¼Œå„ä¸ªå›¾å±‚å åŠ æ„æˆäº†ä¸€ä¸ªå›¾åƒã€‚æµè§ˆå™¨ä¼šéå†RenderLayeræ ‘ï¼Œå†éå†ä»å±è¿™ä¸ªRenderLayerçš„RenderObjectï¼ŒRenderObjectå¯¹è±¡å­˜å‚¨æœ‰ç»˜åˆ¶ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œç»˜åˆ¶ã€‚RenderLayerå’ŒRenderObjectå…±åŒå†³å®šäº†æœ€ç»ˆå‘ˆç°çš„ç½‘é¡µå†…å®¹ï¼ŒRenderLayeræ ‘å†³å®šäº†ç½‘é¡µçš„ç»˜åˆ¶çš„å±‚æ¬¡é¡ºåºï¼Œè€Œä»å±äºRenderLayerçš„RenderObjectå†³å®šäº†è¯¥RenderLayerçš„å†…å®¹ã€‚\n\n## æ¸²æŸ“æ–¹å¼\nåœ¨å®Œæˆæ„å»ºRenderLayeræ ‘ä¹‹åï¼Œæµè§ˆå™¨ä¼šä½¿ç”¨å›¾å½¢åº“å°†å…¶æ„å»ºçš„æ¸²æŸ“æ¨¡å‹ç»˜åˆ¶å‡ºæ¥ï¼Œè¯¥è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š\n- ç»˜åˆ¶ï¼šå°†ä»å±æ¯ä¸ªRenderLayerå›¾å±‚ä¸Šçš„RenderObjectç»˜åˆ¶åœ¨å…¶RenderLayerä¸Šã€‚å³ç»˜åˆ¶ï¼ˆPaintï¼‰æˆ–è€…å…‰æ …åŒ–ï¼ˆRasterizationï¼‰ï¼Œå°†ä¸€äº›ç»˜å›¾æŒ‡ä»¤è½¬æ¢æˆçœŸæ­£çš„åƒç´ é¢œè‰²å€¼ã€‚\n  - è½¯ä»¶ç»˜å›¾ï¼šCPUæ¥å®Œæˆç»˜å›¾æ“ä½œ\n  - ç¡¬ä»¶åŠ é€Ÿç»˜å›¾ï¼šGPUæ¥å®Œæˆç»˜å›¾æ“ä½œ\n- åˆæˆ(compositing)ï¼šå°†å„ä¸ªRenderLayerå›¾å±‚åˆå¹¶æˆåˆ°ä¸€ä¸ªä½å›¾(Bitmap)ä¸­ã€‚åŒæ—¶è¿˜å¯èƒ½åŒ…æ‹¬ä½ç§»ï¼ˆTranslationï¼‰ï¼Œç¼©æ”¾ï¼ˆScaleï¼‰ï¼Œæ—‹è½¬ï¼ˆRotationï¼‰ï¼ŒAlpha åˆæˆç­‰æ“ä½œã€‚\n\n\næ¸²æŸ“å¼•æ“çš„æ¸²æŸ“ï¼Œç›®å‰æœ‰ä¸‰ç§ç½‘é¡µçš„æ¸²æŸ“æ–¹å¼ï¼š\n\n> - ç¡¬ä»¶åŠ é€Ÿåˆæˆ(Accelerated Compositing)ï¼šä½¿ç”¨GPUæ¥å®Œæˆåˆæˆå·¥ä½œã€‚\n> - åˆæˆåŒ–æ¸²æŸ“ï¼šä½¿ç”¨åˆæˆ(compositing)æŠ€æœ¯çš„æ¸²æŸ“ç§°ã€‚\n\n- è½¯ä»¶æ¸²æŸ“æ–¹å¼ï¼šä½¿ç”¨CPUæ¥ç»˜åˆ¶æ¯ä¸ªRenderLayerå›¾å±‚çš„å†…å®¹(RenderObject)åˆ°ä¸€ä¸ªä½å›¾ï¼Œå³ä¸€å—CPUä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚ç»˜åˆ¶æ¯ä¸€å±‚çš„æ—¶å€™éƒ½ä¼šä½¿ç”¨è¯¥ä½å›¾ï¼ŒåŒºåˆ«åœ¨äºç»˜åˆ¶çš„ä½ç½®å¯èƒ½ä¸ä¸€æ ·ï¼Œç»˜åˆ¶é¡ºåºæŒ‰ç…§ä»ååˆ°å‰ã€‚å› æ­¤è½¯ä»¶æ¸²æŸ“æœºåˆ¶æ˜¯æ²¡æœ‰åˆæˆé˜¶æ®µçš„ã€‚\n- ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“çš„åˆæˆåŒ–æ¸²æŸ“æ–¹å¼ï¼šä½¿ç”¨GPUæ¥ç»˜åˆ¶æ‰€æœ‰åˆæˆå±‚ï¼Œå¹¶ä½¿ç”¨GPUç¡¬ä»¶æ¥åŠ é€Ÿåˆæˆã€‚\n- è½¯ä»¶ç»˜å›¾çš„åˆæˆåŒ–æ¸²æŸ“æ–¹å¼ï¼š æŸäº›åˆæˆå±‚ä½¿ç”¨CPUæ¥ç»˜å›¾ï¼Œå¦å¤–ä¸€äº›ä½¿ç”¨GPUæ¥ç»˜åˆ¶ã€‚å¯¹äºä½¿ç”¨CPUæ¥ç»˜åˆ¶çš„å›¾å±‚ï¼Œè¯¥å±‚çš„ç»˜åˆ¶ç»“æœä¼šå…ˆä¿å­˜åœ¨CPUå†…å­˜ä¸­ï¼Œä¹‹åä¼šè¢«ä¼ è¾“åˆ°GPUå†…å­˜ä¸­ï¼Œç„¶åå†ä½¿ç”¨GPUæ¥å®Œæˆåˆæˆå·¥ä½œã€‚\n\n\n![](./render.png)\n\nç¬¬äºŒç§å’Œç¬¬ä¸‰ç§æ¸²æŸ“æ–¹å¼ï¼Œéƒ½æ˜¯ä½¿ç”¨äº†åˆæˆåŒ–æ¸²æŸ“æŠ€æœ¯ï¼Œåˆæˆå·¥ä½œä¹Ÿéƒ½æ˜¯ç”±GPUæ¥åšã€‚å¯¹äºå¸¸è§çš„2Dç»˜å›¾æ“ä½œï¼Œä½¿ç”¨GPUæ¥ç»˜å›¾ä¸ä¸€å®šæ¯”ä½¿ç”¨CPUç»˜å›¾åœ¨æ€§èƒ½ä¸Šæœ‰ä¼˜åŠ¿ï¼Œä¾‹å¦‚ç»˜åˆ¶æ–‡å­—ã€ç‚¹ã€çº¿ç­‰ï¼ŒåŸå› æ˜¯CPUçš„ä½¿ç”¨ç¼“å†²æœºåˆ¶æœ‰æ•ˆå‡å°‘äº†é‡å¤ç»˜åˆ¶çš„å¼€é”€è€Œä¸”ä¸éœ€è¦è€ƒè™‘ä¸GPUå¹¶è¡Œã€‚å¦å¤–ï¼ŒGPUçš„å†…å­˜èµ„æºç›¸å¯¹CPUçš„å†…å­˜èµ„æºæ¥è¯´æ¯”è¾ƒç´§å¼ ï¼Œè€Œä¸”ç½‘é¡µçš„åˆ†å±‚ä½¿å¾—GPUçš„å†…å­˜ä½¿ç”¨ç›¸å¯¹æ¯”è¾ƒå¤šã€‚é‰´äºæ­¤ï¼Œå°±ç›®å‰çš„æƒ…å†µæ¥çœ‹ï¼Œä¸‰è€…éƒ½å­˜åœ¨æ˜¯æœ‰å…¶åˆç†æ€§çš„ï¼Œä¸‹é¢åˆ†æä¸€ä¸‹å®ƒä»¬çš„ç‰¹ç‚¹ï¼š\n\n\n- è½¯ä»¶æ¸²æŸ“æ˜¯ç›®å‰å¾ˆå¸¸è§çš„æŠ€æœ¯ï¼Œä¹Ÿæ˜¯æµè§ˆå™¨æœ€æ—©ä½¿ç”¨çš„æ¸²æŸ“æ–¹å¼ã€‚è¿™ä¸€æŠ€æœ¯æ¯”è¾ƒèŠ‚çœå†…å­˜ï¼Œç‰¹åˆ«æ˜¯å®è´µçš„GPUå†…å­˜ï¼Œä½†æ˜¯è½¯ä»¶æ¸²æŸ“åªèƒ½å¤„ç†2Dæ–¹é¢çš„æ“ä½œã€‚ç®€å•çš„ç½‘é¡µæ²¡æœ‰å¤æ‚ç»˜å›¾æˆ–è€…å¤šåª’ä½“æ–¹é¢çš„éœ€æ±‚ï¼Œè½¯ä»¶æ¸²æŸ“æ–¹å¼å°±æ¯”è¾ƒåˆé€‚æ¥æ¸²æŸ“è¯¥ç±»å‹çš„ç½‘é¡µã€‚é—®é¢˜æ˜¯ï¼Œä¸€æ—¦é‡ä¸Šäº†HTML5çš„å¾ˆå¤šæ–°æŠ€æœ¯ï¼Œè½¯ä»¶æ¸²æŸ“æ˜¾å¾—æ— èƒ½ä¸ºåŠ›ï¼Œä¸€æ˜¯å› ä¸ºèƒ½åŠ›ä¸è¶³ï¼›äºŒæ˜¯å› ä¸ºæ€§èƒ½ä¸å¥½ï¼Œä¾‹å¦‚è§†é¢‘ã€Canvas 2Dç­‰ã€‚æ‰€ä»¥ï¼Œè½¯ä»¶æ¸²æŸ“æŠ€æœ¯è¢«ç”¨çš„è¶Šæ¥è¶Šå°‘ï¼Œç‰¹åˆ«æ˜¯åœ¨ç§»åŠ¨é¢†åŸŸã€‚è½¯ä»¶æ¸²æŸ“åŒç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“å¦å¤–ä¸€ä¸ªå¾ˆä¸åŒçš„åœ°æ–¹å°±æ˜¯å¯¹æ›´æ–°åŒºåŸŸçš„å¤„ç†ã€‚å½“ç½‘é¡µä¸­æœ‰ä¸€ä¸ªæ›´æ–°å°å‹åŒºåŸŸçš„è¯·æ±‚ï¼ˆå¦‚åŠ¨ç”»ï¼‰æ—¶ï¼Œè½¯ä»¶æ¸²æŸ“å¯èƒ½åªéœ€è¦è®¡ç®—ä¸€ä¸ªæå°çš„åŒºåŸŸï¼Œè€Œç¡¬ä»¶æ¸²æŸ“å¯èƒ½éœ€è¦é‡æ–°ç»˜åˆ¶å…¶ä¸­çš„ä¸€å±‚æˆ–è€…å¤šå±‚ï¼Œç„¶åå†åˆæˆè¿™äº›å±‚ã€‚ç¡¬ä»¶æ¸²æŸ“çš„ä»£ä»·å¯èƒ½ä¼šå¤§å¾—å¤šã€‚\n- å¯¹äºç¡¬ä»¶åŠ é€Ÿçš„åˆæˆåŒ–æ¸²æŸ“æ–¹å¼æ¥è¯´ï¼Œæ¯ä¸ªå±‚çš„ç»˜åˆ¶å’Œæ‰€æœ‰å±‚çš„åˆæˆå‡ä½¿ç”¨GPUç¡¬ä»¶æ¥å®Œæˆï¼Œè¿™å¯¹éœ€è¦ä½¿ç”¨3Dç»˜å›¾çš„æ“ä½œæ¥è¯´ç‰¹åˆ«åˆé€‚ã€‚è¿™ç§æ–¹å¼ä¸‹ï¼Œåœ¨RenderLayeræ ‘ä¹‹åï¼Œæµè§ˆå™¨è¿˜éœ€è¦å»ºç«‹æ›´å¤šçš„å†…éƒ¨è¡¨ç¤ºï¼Œç›®çš„æ˜¯æ”¯æŒç¡¬ä»¶åŠ é€Ÿæœºåˆ¶ï¼Œè¿™æ˜¾ç„¶ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜èµ„æºã€‚ä½†æ˜¯ï¼Œä¸€æ–¹é¢ï¼Œç¡¬ä»¶åŠ é€Ÿæœºåˆ¶èƒ½å¤Ÿæ”¯æŒç°åœ¨æ‰€æœ‰çš„HTML5å®šä¹‰çš„2Dæˆ–è€…3Dç»˜å›¾æ ‡å‡†ï¼›å¦ä¸€æ–¹é¢ï¼Œå…³äºæ›´æ–°åŒºåŸŸçš„è®¨è®ºï¼Œå¦‚æœéœ€è¦æ›´æ–°æŸä¸ªå±‚çš„ä¸€ä¸ªåŒºåŸŸï¼Œå› ä¸ºè½¯ä»¶æ¸²æŸ“æ²¡æœ‰ä¸ºæ¯ä¸€å±‚æä¾›åç«¯å­˜å‚¨ï¼Œå› è€Œå®ƒéœ€è¦å°†å’Œè¿™ä¸ªåŒºåŸŸæœ‰é‡å éƒ¨åˆ†çš„æ‰€æœ‰å±‚æ¬¡çš„ç›¸å…³åŒºåŸŸä¸€æ¬¡ä»åå¾€å‰é‡æ–°ç»˜åˆ¶ä¸€éï¼Œè€Œç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“åªéœ€è¦é‡æ–°ç»˜åˆ¶æ›´æ–°å‘ç”Ÿçš„å±‚æ¬¡ï¼Œå› è€Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè½¯ä»¶æ¸²æŸ“çš„ä»£ä»·åˆå˜å¾—æ›´å¤§ã€‚å½“ç„¶ï¼Œè¿™å–å†³äºç½‘é¡µçš„ç»“æ„å’Œæ¸²æŸ“ç­–ç•¥ã€‚\n- è½¯ä»¶ç»˜å›¾çš„åˆæˆåŒ–æ¸²æŸ“æ–¹å¼ç»“åˆäº†å‰é¢ä¸¤ç§æ–¹å¼çš„ä¼˜ç‚¹ï¼Œè¿™æ—¶å› ä¸ºå¾ˆå¤šç½‘é¡µå¯èƒ½æ—¢åŒ…å«åŸºæœ¬çš„HTMLå…ƒç´ ï¼Œä¹ŸåŒ…å«ä¸€äº›HTML5æ–°åŠŸèƒ½ï¼Œä½¿ç”¨CPUç»˜å›¾æ–¹å¼æ¥ç»˜åˆ¶æŸäº›å±‚ï¼Œä½¿ç”¨GPUæ¥ç»˜åˆ¶å…¶ä»–ä¸€äº›å±‚ã€‚åŸå› å½“ç„¶æ˜¯å‰é¢æ‰€è¿°çš„åŸºäºæ€§èƒ½å’Œå†…å­˜æ–¹é¢ç»¼åˆè€ƒè™‘çš„ç»“æœã€‚\n\n\n> æµè§ˆå™¨è¿˜å¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹çš„æ¸²æŸ“æ¶æ„ï¼Œå°†ç½‘é¡µå†…å®¹ç»˜åˆ¶åˆ°åç«¯å­˜å‚¨çš„æ“ä½œæ”¾åˆ°å¦å¤–ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼ˆç»˜åˆ¶çº¿ç¨‹ï¼‰ï¼Œè€ŒåŸæ¥çº¿ç¨‹è½¬ä¸ºåˆæˆçº¿ç¨‹ï¼Œç»˜åˆ¶çº¿ç¨‹è·Ÿåˆæˆçº¿ç¨‹ä¹‹é—´å¯ä»¥ä½¿ç”¨åŒæ­¥ï¼Œéƒ¨åˆ†åŒæ­¥ï¼Œå®Œå…¨å¼‚æ­¥ç­‰ä½œä¸šæ¨¡å¼ï¼Œè®©æµè§ˆå™¨å¯ä»¥åœ¨æ€§èƒ½ä¸æ•ˆæœä¹‹é—´æ ¹æ®éœ€è¦è¿›è¡Œé€‰æ‹©ã€‚\n\n## GrphicsLayer tree(GrphicsLayeræ ‘)\n\nå¯¹äºè½¯ä»¶æ¸²æŸ“è€Œè¨€ï¼Œåˆ°RenderLayeræ ‘å°±ç»“æŸäº†ï¼Œåé¢ä¸ä¼šå»ºç«‹å…¶å®ƒé¢å¤–çš„æ ‘æ¥å¯¹åº”äºRenderLayeræ ‘ã€‚ä½†æ˜¯ï¼Œå¯¹äºç¡¬ä»¶æ¸²æŸ“æ¥è¯´ï¼Œåœ¨RenderLayeræ ‘ä¹‹åï¼Œæµè§ˆå™¨æ¸²æŸ“å¼•æ“ä¸ºç¡¬ä»¶æ¸²æŸ“æä¾›äº†æ›´å¤šçš„å†…éƒ¨ç»“æ„æ¥æ”¯æŒè¿™ä¸ªæœºåˆ¶ã€‚\n\nåœ¨ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“çš„åˆæˆåŒ–æ¸²æŸ“å’Œè½¯ä»¶ç»˜å›¾çš„åˆæˆåŒ–æ¸²æŸ“æ¶æ„ä¸‹ï¼Œä¸€ä¸ªRenderLayerå¯¹è±¡å¦‚æœéœ€è¦åç«¯å­˜å‚¨ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªRenderLayerBackingå¯¹è±¡ï¼Œè¯¥å¯¹è±¡è´Ÿè´£Renderlayerå¯¹è±¡æ‰€éœ€è¦çš„å„ç§å­˜å‚¨ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œæ¯ä¸ªRenderLayeréƒ½å¯ä»¥åˆ›å»ºè‡ªå·±çš„åç«¯å­˜å‚¨ï¼Œäº‹å®ä¸Šä¸æ˜¯æ‰€æœ‰RenderLayeréƒ½æœ‰è‡ªå·±çš„RenderLayerBackingå¯¹è±¡ã€‚å¦‚æœä¸€ä¸ªRenderLayerå¯¹è±¡è¢«åƒæ ·çš„åˆ›å»ºåç«¯å­˜å‚¨ï¼Œé‚£ä¹ˆå°†è¯¥RenderLayerç§°ä¸ºåˆæˆå±‚ï¼ˆCompositing Layerï¼‰ã€‚\n\nå“ªäº›RenderLayerå¯¹è±¡å¯ä»¥æ˜¯åˆæˆå±‚ï¼Ÿå¦‚æœä¸€ä¸ªRenderLayerå¯¹è±¡å…·æœ‰ä»¥ä¸‹çš„ç‰¹å¾ä¹‹ä¸€ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯åˆæˆå±‚ï¼š\n\n* Layer has 3D or perspective transform CSS properties\n* Layer is used by < video> element using accelerated video decoding\n* Layer is used by a < canvas> element with a 3D context or accelerated 2D context\n* Layer is used for a composited plugin\n* Layer uses a CSS animation for its opacity or uses an animated webkit transform\n* Layer uses accelerated CSS filters\n* Layer with a composited descendant has information that needs to be in the composited layer tree, such as a clip or reflection\n* Layer has a sibling with a lower z-index which has a compositing layer (in other words the layer is rendered on top of a composited layer)\n\nç¿»è¯‘:\n\n* RenderLayerå…·æœ‰3Dæˆ–é€è§†è½¬æ¢çš„CSSå±æ€§\n* RenderLayeråŒ…å«ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„è§†é¢‘è§£ç æŠ€æœ¯çš„`<video>`å…ƒç´ \n* RenderLayeråŒ…å«ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„2Dæˆ–WebGL-3DæŠ€æœ¯çš„`<canvas>`å…ƒç´ \n* RenderLayerä½¿ç”¨äº†åˆæˆæ’ä»¶ã€‚\n* RenderLayerä½¿ç”¨äº†`opacity`æˆ–`transform`åŠ¨ç”»\n* RenderLayerä½¿ç”¨äº†ç¡¬ä»¶åŠ é€Ÿçš„CSS FiltersæŠ€æœ¯\n* RenderLayeråä»£ä¸­åŒ…å«äº†ä¸€ä¸ªåˆæˆå±‚ï¼ˆå¦‚æœ‰clipæˆ–reflectionå±æ€§ï¼‰\n* RenderLayeræœ‰ä¸ªä¸€ä¸ªz-indexæ¯”è‡ªå·±å°çš„åˆæˆå±‚ï¼ˆå³åœ¨ä¸€ä¸ªåˆæˆå±‚ä¹‹ä¸Šï¼‰\n\næ¯ä¸ªåˆæˆå±‚éƒ½æœ‰ä¸€ä¸ªRenderLayerBackingï¼ŒRenderLayerBackingè´Ÿè´£ç®¡ç†RenderLayeræ‰€éœ€è¦çš„æ‰€æœ‰åç«¯å­˜å‚¨ï¼Œå› ä¸ºåç«¯å­˜å‚¨å¯èƒ½éœ€è¦å¤šä¸ªå­˜å‚¨ç©ºé—´ã€‚åœ¨æµè§ˆå™¨(WebKit)ä¸­ï¼Œå­˜å‚¨ç©ºé—´ä½¿ç”¨ç±»GraphicsLayeræ¥è¡¨ç¤ºã€‚æµè§ˆå™¨ä¼šä¸ºè¿™äº›RenderLayeråˆ›å»ºå¯¹åº”çš„GraphicsLayerï¼Œä¸åŒçš„æµè§ˆå™¨éœ€è¦æä¾›è‡ªå·±çš„GrphicsLayerå®ç°ç”¨äºç®¡ç†å­˜å‚¨ç©ºé—´çš„åˆ†é…ï¼Œé‡Šæ”¾ï¼Œæ›´æ–°ç­‰ç­‰ã€‚æ‹¥æœ‰GrphicsLayerçš„RenderLayerä¼šè¢«ç»˜åˆ¶åˆ°è‡ªå·±çš„åç«¯å­˜å‚¨ï¼Œè€Œæ²¡æœ‰GrphicsLayerçš„RenderLayerå®ƒä»¬ä¼šå‘ä¸Šè¿½æº¯æœ‰GrphicsLayerçš„çˆ¶/ç¥–å…ˆRenderLayerï¼Œç›´åˆ°Root RenderLayerä¸ºæ­¢ï¼Œç„¶åç»˜åˆ¶åœ¨æœ‰GrphicsLayerçš„çˆ¶/ç¥–å…ˆRenderLayerçš„å­˜å‚¨ç©ºé—´ï¼Œè€ŒRoot RenderLayeræ€»æ˜¯ä¼šåˆ›å»ºä¸€ä¸ªGrphicsLayerå¹¶æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å­˜å‚¨ç©ºé—´ã€‚åœ¨å°†æ¯ä¸ªåˆæˆå›¾å±‚åŒ…å«çš„RenderLayerå†…å®¹ç»˜åˆ¶åœ¨åˆæˆå±‚çš„åç«¯å­˜å‚¨ä¸­ï¼Œè¿™é‡Œç»˜åˆ¶å¯ä»¥æ˜¯è½¯ä»¶ç»˜åˆ¶æˆ–ç¡¬ä»¶ç»˜åˆ¶ã€‚æ¥ç€ç”±åˆæˆå™¨(Compositor)å°†å¤šä¸ªåˆæˆå±‚åˆæˆèµ·æ¥ï¼Œå½¢æˆæœ€ç»ˆç”¨æˆ·å¯è§çš„ç½‘é¡µï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€å¼ å›¾ç‰‡ã€‚\n\nGraphicsLayeråˆæ„æˆäº†ä¸€æ£µä¸RenderLayerå¹¶è¡Œçš„æ ‘ï¼Œè€ŒRenderLayerä¸GraphicsLayerçš„å…³ç³»æœ‰äº›ç±»ä¼¼äºRenderObjectä¸RenderLayerä¹‹é—´çš„å…³ç³»ã€‚å¦‚ä¸‹æ˜¯DOMæ ‘ã€RenderObjectæ ‘ã€RenderLayeræ ‘ã€GraphicsLayeræ ‘å…³ç³»å›¾ï¼š\n\n![](http://www.chromium.org/_/rsrc/1479245083354/developers/design-documents/gpu-accelerated-compositing-in-chrome/the_compositing_forest.png)\n\n\nè¿™æ ·å¯ä»¥åˆå¹¶ä¸€äº›RenderLayerå±‚ï¼Œä»è€Œå‡å°‘å†…å­˜çš„æ¶ˆè€—ã€‚å…¶æ¬¡ï¼Œåˆå¹¶ä¹‹åï¼Œå‡å°‘äº†åˆå¹¶å¸¦æ¥çš„é‡ç»˜æ€§èƒ½å’Œå¤„ç†ä¸Šçš„å›°éš¾ã€‚\nåœ¨ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“çš„åˆæˆåŒ–æ¸²æŸ“å’Œè½¯ä»¶ç»˜å›¾çš„åˆæˆåŒ–æ¸²æŸ“æ¶æ„ä¸‹ï¼ŒRenderLayerçš„å†…å®¹å˜åŒ–ï¼Œåªéœ€è¦æ›´æ–°æ‰€å±çš„GraphicsLayerçš„ç¼“å­˜å³å¯ï¼Œè€Œç¼“å­˜çš„æ›´æ–°ï¼Œä¹Ÿåªéœ€è¦ç»˜åˆ¶ç›´æ¥æˆ–è€…é—´æ¥å±äºè¿™ä¸ªGraphicsLayerçš„RenderLayerï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„RenderLayerã€‚ç‰¹åˆ«æ˜¯ä¸€äº›ç‰¹å®šçš„CSSæ ·å¼å±æ€§çš„å˜åŒ–ï¼Œå®é™…ä¸Šå¹¶ä¸å¼•èµ·å†…å®¹çš„å˜åŒ–ï¼Œåªéœ€è¦æ”¹å˜ä¸€äº›GraphicsLayerçš„æ··åˆå‚æ•°ï¼Œç„¶åé‡æ–°æ··åˆå³å¯ï¼Œè€Œæ··åˆç›¸å¯¹ç»˜åˆ¶è€Œè¨€æ˜¯å¾ˆå¿«çš„ï¼Œè¿™äº›ç‰¹å®šçš„CSSæ ·å¼å±æ€§æˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºæ˜¯è¢«åŠ é€Ÿçš„ï¼Œä¸åŒçš„æµè§ˆå™¨æ”¯æŒçš„çŠ¶å†µä¸å¤ªä¸€æ ·ï¼Œä½†åŸºæœ¬ä¸ŠCSS Transform & Opacityåœ¨æ‰€æœ‰æ”¯æŒæ··åˆåŠ é€Ÿçš„æµè§ˆå™¨ä¸Šéƒ½æ˜¯è¢«åŠ é€Ÿçš„ã€‚è¢«åŠ é€Ÿçš„CSSæ ·å¼å±æ€§çš„åŠ¨ç”»ï¼Œå°±æ¯”è¾ƒå®¹æ˜“è¾¾åˆ°60å¸§/æ¯ç§’çš„æµç•…æ•ˆæœäº†ã€‚\n\n![](http://img.blog.csdn.net/20140416142656281)\n\nä¸è¿‡å¹¶ä¸æ˜¯æ‹¥æœ‰ç‹¬ç«‹ç¼“å­˜çš„RenderLayerè¶Šå¤šè¶Šå¥½ï¼Œå¤ªå¤šæ‹¥æœ‰ç‹¬ç«‹ç¼“å­˜çš„RenderLayerä¼šå¸¦æ¥ä¸€äº›ä¸¥é‡çš„å‰¯ä½œç”¨:\n - å®ƒå¤§å¤§å¢åŠ äº†å†…å­˜çš„å¼€é”€ï¼Œè¿™ç‚¹åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šçš„å½±å“æ›´å¤§ï¼Œç”šè‡³å¯¼è‡´æµè§ˆå™¨åœ¨ä¸€äº›å†…å­˜è¾ƒå°‘çš„ç§»åŠ¨è®¾å¤‡ä¸Šæ— æ³•å¾ˆå¥½åœ°æ”¯æŒå›¾å±‚åˆæˆåŠ é€Ÿï¼›\n - å®ƒåŠ å¤§äº†åˆæˆçš„æ—¶é—´å¼€é”€ï¼Œå¯¼è‡´åˆæˆæ€§èƒ½çš„ä¸‹é™ï¼Œè€Œåˆæˆæ€§èƒ½è·Ÿç½‘é¡µæ»šåŠ¨/ç¼©æ”¾æ“ä½œçš„æµç•…åº¦åˆæ¯æ¯ç›¸å…³ï¼Œæœ€ç»ˆå¯¼è‡´ç½‘é¡µæ»šåŠ¨/ç¼©æ”¾çš„æµç•…åº¦ä¸‹é™ï¼Œè®©ç”¨æˆ·è§‰å¾—æ“ä½œä¸å¤Ÿæµç•…ã€‚\n\n## Tile Rendering(ç“¦ç‰‡æ¸²æŸ“)\n\né€šå¸¸ä¸€ä¸ªåˆæˆå±‚çš„åç«¯å­˜å‚¨è¢«åˆ†å‰²æˆå¤šä¸ªå¤§å°ç›¸åŒçš„ç“¦ç‰‡çŠ¶çš„å°å­˜å‚¨ç©ºé—´ï¼Œæ¯ä¸ªç“¦ç‰‡å¯ä»¥ç†è§£ä¸ºOpenGLä¸­çš„ä¸€ä¸ªçº¹ç†ï¼Œåˆæˆå±‚çš„ç»“æœè¢«åˆ†å¼€å­˜å‚¨åœ¨è¿™äº›ç“¦ç‰‡ä¸­ã€‚ä¸ºä»€ä¹ˆä½¿ç”¨ç“¦ç‰‡åŒ–çš„åç«¯å­˜å‚¨ï¼Ÿ\n - DOMæ ‘ç§çš„htmlå…ƒç´ æ‰€åœ¨çš„å±‚å¯èƒ½ä¼šæ¯”è¾ƒå¤§ï¼Œå› ä¸ºç½‘é¡µçš„é«˜åº¦å¾ˆå¤§ï¼Œå¦‚æœåªæ˜¯ä½¿ç”¨ä¸€ä¸ªåç«¯å­˜å‚¨çš„è¯ï¼Œé‚£ä¹ˆéœ€è¦ä¸€ä¸ªå¾ˆå¤§çš„çº¹ç†å¯¹è±¡ï¼Œä½†æ˜¯å®é™…çš„GPUç¡¬ä»¶å¯èƒ½åªæ”¯æŒéå¸¸æœ‰é™çš„çº¹ç†å¤§å°ã€‚\n - åœ¨ä¸€ä¸ªæ¯”è¾ƒå¤§çš„åˆæˆå±‚ä¸­ï¼Œå¯èƒ½åªæ˜¯å…¶ä¸­ä¸€éƒ¨åˆ†å‘ç”Ÿå˜åŒ–ï¼Œæ ¹æ®ä¹‹å‰çš„ä»‹ç»ï¼Œéœ€è¦é‡æ–°ç»˜åˆ¶æ•´ä¸ªå±‚ï¼Œè¿™æ ·å¿…ç„¶äº§ç”Ÿé¢å¤–çš„å¼€é”€ï¼Œä½¿ç”¨ç“¦ç‰‡è¯çš„åç«¯å­˜å‚¨ï¼Œå°±åªéœ€è¦é‡ç»˜ä¸€äº›å­˜åœ¨æ›´æ–°çš„ç“¦ç‰‡ã€‚\n - å½“å±‚å‘ç”Ÿæ»šåŠ¨çš„æ—¶å€™ï¼Œä¸€äº›ç“¦ç‰‡å¯èƒ½ä¸å†éœ€è¦ï¼Œç„¶åæ¸²æŸ“å¼•æ“éœ€è¦ä¸€äº›æ–°çš„ç“¦ç‰‡æ¥ç»˜åˆ¶æ–°çš„åŒºåŸŸï¼Œè¿™äº›å¤§å°ç›¸åŒçš„åç«¯å­˜å‚¨å¾ˆå®¹æ˜“é‡å¤åˆ©ç”¨ã€‚\n\n![](./tiles.png)\n\n\n## æµç•…åŠ¨ç”»\n\nç½‘é¡µåŠ è½½åï¼Œç»˜åˆ¶æ–°çš„æ¯ä¸€å¸§ï¼Œä¸€èˆ¬éƒ½éœ€è¦ç»è¿‡è®¡ç®—å¸ƒå±€(layout)ã€ç»˜å›¾(paint)ã€åˆæˆï¼ˆcompositeï¼‰ä¸‰é˜¶æ®µã€‚å› æ­¤è¦æƒ³æé«˜é¡µé¢æ€§èƒ½ï¼ˆæˆ–FPSï¼‰ï¼Œéœ€è¦å‡å°‘æ¯ä¸€å¸§çš„æ—¶é—´ã€‚è€Œåœ¨è¿™ä¸‰ä¸ªé˜¶æ®µä¸­ï¼Œlayoutå’Œpaintæ¯”è¾ƒè€—æ—¶é—´ï¼Œè€Œåˆæˆéœ€è¦çš„æ—¶é—´ç›¸å¯¹è¾ƒå°‘ä¸€äº›ã€‚\n\n#### layout\nå¦‚æœä¿®æ”¹ä¸€ä¸ªDOMå…ƒç´ çš„â€layoutâ€å±æ€§ï¼Œä¹Ÿå°±æ˜¯æ”¹å˜äº†å…ƒç´ çš„æ ·å¼ï¼ˆæ¯”å¦‚å®½åº¦ã€é«˜åº¦æˆ–è€…ä½ç½®ç­‰ï¼‰ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šæ£€æŸ¥å“ªäº›å…ƒç´ éœ€è¦é‡æ–°å¸ƒå±€ï¼Œç„¶åå¯¹é¡µé¢æ¿€å‘ä¸€ä¸ªreflowè¿‡ç¨‹å®Œæˆé‡æ–°å¸ƒå±€ã€‚è¢«reflowçš„å…ƒç´ ï¼Œæ¥ä¸‹æ¥ä¹Ÿä¼šæ¿€å‘ç»˜åˆ¶è¿‡ç¨‹ï¼Œæœ€åæ¿€å‘æ¸²æŸ“å±‚åˆå¹¶è¿‡ç¨‹ï¼Œç”Ÿæˆæœ€åçš„ç”»é¢ã€‚\n![](https://developers.google.com/web/fundamentals/performance/rendering/images/intro/frame-full.jpg)\n#### paint\nå¦‚æœä¿®æ”¹äº†â€œpaint onlyâ€å±æ€§ï¼ˆä¾‹å¦‚èƒŒæ™¯å›¾ç‰‡ã€æ–‡å­—é¢œè‰²æˆ–é˜´å½±ç­‰ï¼‰ï¼Œå³ä¸ä¼šå½±å“é¡µé¢å¸ƒå±€çš„å±æ€§ï¼Œåˆ™æµè§ˆå™¨ä¼šè·³è¿‡å¸ƒå±€ï¼Œä½†ä»å°†æ‰§è¡Œç»˜åˆ¶ã€‚\n![](https://developers.google.com/web/fundamentals/performance/rendering/images/intro/frame-no-layout.jpg)\n#### composite\nå¦‚æœæ›´æ”¹äº†ä¸€ä¸ªæ—¢ä¸è¦å¸ƒå±€ä¹Ÿä¸è¦ç»˜åˆ¶çš„å±æ€§ï¼Œåˆ™æµè§ˆå™¨å°†è·³åˆ°åªæ‰§è¡Œåˆæˆã€‚è¿™ä¸ªæœ€åçš„ç‰ˆæœ¬å¼€é”€æœ€å°ï¼Œæœ€é€‚åˆäºåº”ç”¨ç”Ÿå‘½å‘¨æœŸä¸­çš„é«˜å‹åŠ›ç‚¹ï¼Œä¾‹å¦‚åŠ¨ç”»æˆ–æ»šåŠ¨ã€‚\n\n![](https://developers.google.com/web/fundamentals/performance/rendering/images/intro/frame-no-layout-paint.jpg)\n\n**å¦‚æœæƒ³çŸ¥é“æ›´æ”¹ä»»ä½•æŒ‡å®šCSSå±æ€§å°†è§¦å‘layoutã€paintã€compositeä¸­çš„å“ªä¸€ä¸ªï¼Œè¯·æŸ¥çœ‹[CSSè§¦å‘å™¨](https://csstriggers.com/)ã€‚**\n\n#### ä¼˜åŒ–\nå¯ä»¥é€šè¿‡ä»€ä¹ˆé€”å¾„è¿›è¡Œä¼˜åŒ–ï¼Œå‡å°‘æ¯ä¸€å¸§çš„æ—¶é—´ï¼ˆé¿å…è¿‡å¤šlayoutæˆ–paintï¼‰ï¼š\n\n - ä½¿ç”¨é€‚åˆçš„ç½‘é¡µåˆ†å±‚æŠ€æœ¯å‡å°‘layoutå’Œpaintã€‚ä¸€æ—¦æœ‰è¯·æ±‚æ›´æ–°ï¼Œå¦‚æœæ²¡æœ‰åˆ†å±‚ï¼Œæ¸²æŸ“å¼•æ“å¯èƒ½éœ€è¦é‡æ–°ç»˜åˆ¶æ‰€æœ‰åŒºåŸŸï¼Œå› ä¸ºè®¡ç®—æ›´æ–°éƒ¨åˆ†å¯¹GPUæ¥è¯´å¯èƒ½æ¶ˆè€—æ›´å¤šçš„æ—¶é—´ã€‚è€Œç½‘é¡µåˆ†å±‚ä¹‹åï¼Œéƒ¨åˆ†åŒºåŸŸçš„æ›´æ–°å¯èƒ½åªåœ¨ç½‘é¡µçš„ä¸€å±‚æˆ–å‡ å±‚ï¼Œè€Œä¸éœ€è¦å°†æ•´ä¸ªç½‘é¡µé‡æ–°ç»˜åˆ¶ã€‚é€šè¿‡é‡æ–°ç»˜åˆ¶ç½‘é¡µçš„ä¸€å±‚æˆ–å‡ å±‚ï¼Œå¹¶å°†å®ƒä»¬å’Œå…¶ä»–ä¹‹å‰ç»˜åˆ¶å®Œçš„å±‚åˆå¹¶èµ·æ¥ï¼Œæ—¢èƒ½ä½¿ç”¨GPUçš„èƒ½åŠ›ï¼Œåˆèƒ½å¤Ÿå‡å°‘é‡ç»˜çš„å¼€é”€ã€‚\n - ä½¿ç”¨åˆæˆå±æ€§æ ·å¼ï¼ˆopcityã€tansformï¼‰æ¥å®Œæˆtansitionæˆ–animationã€‚å½“åˆæˆå™¨åˆæˆæ—¶å€™ï¼Œæ¯ä¸ªåˆæˆå±‚éƒ½å¯ä»¥è®¾ç½®å˜å½¢å±æ€§ï¼šä½ç§»ï¼ˆTranslateï¼‰ã€ç¼©æ”¾ï¼ˆScaleï¼‰ã€æ—‹è½¬ï¼ˆRotationï¼‰ã€opacityï¼Œè¿™äº›å±æ€§ä»…ä»…æ”¹å˜åˆæˆå±‚çš„å˜æ¢å‚æ•°ï¼Œè€Œä¸éœ€è¦layoutå’Œpaintæ“ä½œï¼Œæå¤§åœ°å‡å°‘æ¯ä¸€å¸§çš„æ¸²æŸ“æ—¶é—´ã€‚\n\n å³ä½¿ç”¨GPUç¡¬ä»¶åŠ é€Ÿï¼Œä¸ºæŸäº›RenderLayeråˆ›å»ºå¯¹åº”GraphicsLayerã€‚é€šè¿‡ä¸ºæ¯ä¸€ä¸ªåˆæˆå±‚è®¾ç½®å˜å½¢å±æ€§æ¥å®Œæˆtansitionæˆ–animationï¼Œæœ‰æ•ˆåœ°é¿å…relayoutå’Œrepaintçš„å¼€é”€ã€‚\n\n ![](https://www.html5rocks.com/zh/tutorials/speed/high-performance-animations/cheap-operations.jpg)\n\n\n\n\n\n\n\n## æ€»ç»“\næœ¬æ–‡æ˜¯ç”±å‡ ç¯‡å…³äºæµè§ˆå™¨æ¸²æŸ“çš„æ–‡ç« ç»„åˆè€Œæˆï¼Œå¯èƒ½æœ‰äº›æ¦‚å¿µæ¯”è¾ƒæŠ½è±¡ï¼Œä¸å¥½ç†è§£ï¼Œå¯ä»¥æŸ¥çœ‹**å‚è€ƒæ–‡ç« **å°èŠ‚ï¼Œè·å–æ›´å¤šä¿¡æ¯ã€‚æœ¬æ–‡é‡ç‚¹ä»‹ç»äº†æµè§ˆå™¨æ¸²æŸ“å¼•æ“çš„æ¸²æŸ“è¿‡ç¨‹ï¼Œæ¶‰åŠäº†DOMæ ‘ã€CSSOMæ ‘ã€RenderObjectæ ‘ã€RenderLayeræ ‘ã€GraphicsLayeræ ‘ã€‚å¹¶å¯¹å„ç§æ¸²æŸ“æ¨¡å¼è¿›è¡Œäº†ç®€å•ä»‹ç»ï¼Œå…¶ä¸­å¼•å…¥äº†ç¡¬ä»¶åŠ é€Ÿæœºåˆ¶ï¼Œè¿˜ç»™å‡ºä¸€äº›ä¼˜åŒ–å»ºè®®ã€‚äº†è§£è¿™äº›çŸ¥è¯†ç‚¹å¯¹æˆ‘ä»¬å¼€å‘é«˜æ€§èƒ½çš„webåº”ç”¨ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚\n\n## å‚è€ƒæ–‡ç« ï¼š\n- [GPU Accelerated Compositing in Chrome](http://www.chromium.org/developers/design-documents/gpu-accelerated-compositing-in-chrome)\n- [æµè§ˆå™¨çš„å·¥ä½œåŸç†ï¼šæ–°å¼ç½‘ç»œæµè§ˆå™¨å¹•åæ­ç§˜](https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/)\n- [æ„å»ºå¯¹è±¡æ¨¡å‹](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/constructing-the-object-model?hl=zh-cn)\n- [How Rendering Work (in WebKit and Blink)](https://rogeryi.wordpress.com/2014/04/16/how-rendering-work-in-webkit-and-blink/)\n- [WebKitæŠ€æœ¯å†…å¹•](http://blog.csdn.net/milado_nju)\n- [æ¸²æŸ“æ€§èƒ½](https://developers.google.com/web/fundamentals/performance/rendering/)\n- [High Performance Animations](https://www.html5rocks.com/zh/tutorials/speed/high-performance-animations/)","slug":"æµè§ˆå™¨æ¸²æŸ“ç®€è¿°","published":1,"updated":"2018-08-22T08:06:45.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjl4vatan000h1hn9y2ms2g1k","content":"<p>è¦ç¼–å†™é«˜æ€§èƒ½çš„ç½‘ç«™å’Œåº”ç”¨ï¼Œé™¤äº†ç¡®ä¿ç¼–å†™çš„ä»£ç èƒ½é«˜æ•ˆåœ°è¿è¡Œå¤–ï¼Œè¿˜éœ€è¦äº†è§£æµè§ˆå™¨æ˜¯å¦‚ä½•è¿›è¡Œæ¸²æŸ“å·¥ä½œçš„ã€‚</p>\n<h2 id=\"æµè§ˆå™¨ä¸»è¦ç»„æˆç»“æ„\"><a href=\"#æµè§ˆå™¨ä¸»è¦ç»„æˆç»“æ„\" class=\"headerlink\" title=\"æµè§ˆå™¨ä¸»è¦ç»„æˆç»“æ„\"></a>æµè§ˆå™¨ä¸»è¦ç»„æˆç»“æ„</h2><p><img src=\"https://skmukhiya.files.wordpress.com/2013/06/fb76d-layers-pagespeed-ce-mfe5f8ctav.png\" alt=\"\"></p>\n<ol>\n<li>ç”¨æˆ·ç•Œé¢(User Interface)ï¼šåŒ…æ‹¬åœ°å€æ ã€å‰è¿›/åé€€æŒ‰é’®ã€ä¹¦ç­¾èœå•ç­‰ã€‚é™¤äº†æµè§ˆå™¨ä¸»çª—å£æ˜¾ç¤ºçš„æ‚¨è¯·æ±‚çš„é¡µé¢å¤–ï¼Œå…¶ä»–æ˜¾ç¤ºçš„å„ä¸ªéƒ¨åˆ†éƒ½å±äºç”¨æˆ·ç•Œé¢ã€‚</li>\n<li>æµè§ˆå™¨å¼•æ“(Browser engine)ï¼šåœ¨ç”¨æˆ·ç•Œé¢(User Interface)å’Œæ¸²æŸ“å¼•æ“(Rendering engine)ä¹‹é—´ä¼ é€æŒ‡ä»¤ã€‚</li>\n<li>æ¸²æŸ“å¼•æ“(Rendering engine)ï¼šè´Ÿè´£æ˜¾ç¤ºè¯·æ±‚çš„å†…å®¹ã€‚å¦‚æœè¯·æ±‚çš„å†…å®¹æ˜¯HTMLï¼Œå®ƒå°±è´Ÿè´£è§£æHTMLå’ŒCSSå†…å®¹ï¼Œå¹¶å°†è§£æåçš„å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚</li>\n<li>ç½‘ç»œ(Networking)ï¼šç”¨äºç½‘ç»œè°ƒç”¨ï¼Œæ¯”å¦‚HTTPè¯·æ±‚ã€‚å…¶æ¥å£ä¸å¹³å°æ— å…³ï¼Œå¹¶ä¸ºæ‰€æœ‰å¹³å°æä¾›åº•å±‚å®ç°ã€‚</li>\n<li>JavaScriptè§£é‡Šå™¨(JavaScript Interperter)ï¼šç”¨äºè§£æå’Œæ‰§è¡ŒJavaScriptä»£ç ã€‚</li>\n<li>ç”¨æˆ·ç•Œé¢åç«¯(UI Backend)ï¼šç”¨äºç»˜åˆ¶åŸºæœ¬çš„çª—å£å°éƒ¨ä»¶ï¼Œæ¯”å¦‚ç»„åˆæ¡†å’Œçª—å£ã€‚å…¶å…¬å¼€äº†ä¸å¹³å°æ— å…³çš„é€šç”¨æ¥å£ï¼Œè€Œåœ¨åº•å±‚ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ç”¨æˆ·ç•Œé¢æ–¹æ³•ã€‚</li>\n<li>æ•°æ®å­˜å‚¨(Data storage)ï¼šè¿™æ˜¯æŒä¹…å±‚ã€‚æµè§ˆå™¨éœ€è¦åœ¨ç¡¬ç›˜ä¸Šä¿å­˜å„ç§æ•°æ®ï¼Œä¾‹å¦‚Cookiesã€‚æµè§ˆå™¨è¿˜æ”¯æŒè¯¸å¦‚localStorageï¼ŒIndexedDBï¼ŒWebSQLå’ŒFileSystemä¹‹ç±»çš„å­˜å‚¨æœºåˆ¶ã€‚</li>\n</ol>\n<h2 id=\"æ–‡æ¡£å¯¹è±¡æ¨¡å‹-DOMï¼šDocument-Object-Modelï¼‰\"><a href=\"#æ–‡æ¡£å¯¹è±¡æ¨¡å‹-DOMï¼šDocument-Object-Modelï¼‰\" class=\"headerlink\" title=\"æ–‡æ¡£å¯¹è±¡æ¨¡å‹(DOMï¼šDocument Object Modelï¼‰\"></a>æ–‡æ¡£å¯¹è±¡æ¨¡å‹(DOMï¼šDocument Object Modelï¼‰</h2><p>æœ¬æ–‡ä¸»è¦ä»‹ç»æµè§ˆå™¨çš„æ¸²æŸ“ï¼Œå³æ¸²æŸ“å¼•æ“(Rendering engine)è´Ÿè´£çš„å·¥ä½œ: å°†è¯·æ±‚çš„HTMLå†…å®¹è§£æå¹¶æ¸²æŸ“åœ¨å±å¹•ä¸Šã€‚<br>å¦‚ä¸‹HTMLç»“æ„ï¼Œä¸€ä¸ªåŒ…å«ä¸€äº›æ–‡æœ¬å’Œä¸€å¼ å›¾ç‰‡ï¼š<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width,initial-scale=1\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">href</span>=<span class=\"string\">\"style.css\"</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Critical Path<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Hello <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>web performance<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span> students!<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"awesome-photo.jpg\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>æµè§ˆå™¨æ˜¯å¦‚ä½•å¤„ç†è¿™ä¸ªHTMLé¡µé¢ï¼š</p>\n<p>\b<img src=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/full-process.png\" alt=\"\"></p>\n<ol>\n<li>è½¬æ¢(Conversion)ï¼šæµè§ˆå™¨ä»ç£ç›˜æˆ–ç½‘ç»œè¯»å–HTMLçš„åŸå§‹å­—èŠ‚ç ï¼Œå¹¶æ ¹æ®æ–‡ä»¶çš„æŒ‡å®šç¼–ç ï¼ˆä¾‹å¦‚ UTF-8ï¼‰å°†å®ƒä»¬è½¬æ¢æˆå¯¹åº”çš„å­—ç¬¦ã€‚</li>\n<li>ä»¤ç‰ŒåŒ–(Tokenizing)ï¼šæµè§ˆå™¨å°†å­—ç¬¦ä¸²è½¬æ¢æˆ<a href=\"http://www.w3.org/TR/html5/\" target=\"_blank\" rel=\"external\">W3C HTML5æ ‡å‡†</a>è§„å®šçš„å„ç§ä»¤ç‰Œï¼Œä¾‹å¦‚<code>&lt;html&gt;</code>ã€<code>&lt;body&gt;</code>ï¼Œä»¥åŠå…¶ä»–å°–æ‹¬å·å†…çš„å­—ç¬¦ä¸²ã€‚æ¯ä¸ªä»¤ç‰Œéƒ½å…·æœ‰ç‰¹æ®Šå«ä¹‰å’Œä¸€ç»„è§„åˆ™ã€‚</li>\n<li>è¯æ³•åˆ†æ(Lexing)ï¼šå‘å‡ºçš„ä»¤ç‰Œè½¬æ¢æˆå®šä¹‰å…¶å±æ€§å’Œè§„åˆ™çš„â€œå¯¹è±¡â€ã€‚</li>\n<li>DOMæ„å»º(DOM construction)ï¼šHTMLæ ‡è®°å®šä¹‰ä¸åŒæ ‡è®°ä¹‹é—´çš„å…³ç³»ï¼ˆä¸€äº›æ ‡è®°åŒ…å«åœ¨å…¶ä»–æ ‡è®°å†…ï¼‰ï¼Œåˆ›å»ºçš„å¯¹è±¡é“¾æ¥åœ¨ä¸€ä¸ªæ ‘æ•°æ®ç»“æ„å†…ï¼Œæ­¤ç»“æ„ä¹Ÿä¼šæ•è·åŸå§‹æ ‡è®°ä¸­å®šä¹‰çš„çˆ¶é¡¹-å­é¡¹å…³ç³»ï¼šHTMLå¯¹è±¡æ˜¯bodyå¯¹è±¡çš„çˆ¶é¡¹ï¼Œbodyæ˜¯paragraphå¯¹è±¡çš„çˆ¶é¡¹ï¼Œä¾æ­¤ç±»æ¨ã€‚</li>\n</ol>\n<p>æ•´ä¸ªè¿‡ç¨‹çš„æœ€ç»ˆè¾“å‡ºæ˜¯HTMLé¡µé¢çš„æ–‡æ¡£å¯¹è±¡æ¨¡å‹ (DOM)ï¼Œæµè§ˆå™¨å¯¹é¡µé¢è¿›è¡Œçš„æ‰€æœ‰è¿›ä¸€æ­¥å¤„ç†éƒ½ä¼šç”¨åˆ°å®ƒã€‚æµè§ˆå™¨æ¯æ¬¡å¤„ç†HTMLæ ‡è®°æ—¶ï¼Œéƒ½ä¼šå®Œæˆä»¥ä¸Šæ‰€æœ‰æ­¥éª¤ï¼šå°†å­—èŠ‚è½¬æ¢æˆå­—ç¬¦ï¼Œç¡®å®šä»¤ç‰Œï¼Œå°†ä»¤ç‰Œè½¬æ¢æˆèŠ‚ç‚¹ï¼Œç„¶åæ„å»ºDOMæ ‘ã€‚DOMæ ‘æ•è·æ–‡æ¡£æ ‡è®°çš„å±æ€§å’Œå…³ç³»ï¼Œä½†å¹¶æœªå¤„ç†å…ƒç´ åœ¨æ¸²æŸ“åå‘ˆç°çš„å¤–è§‚ã€‚é‚£æ˜¯CSSOMçš„è´£ä»»ã€‚</p>\n<h2 id=\"CSSå¯¹è±¡æ¨¡å‹-CSSOMï¼šCSS-Object-Model\"><a href=\"#CSSå¯¹è±¡æ¨¡å‹-CSSOMï¼šCSS-Object-Model\" class=\"headerlink\" title=\"CSSå¯¹è±¡æ¨¡å‹(CSSOMï¼šCSS Object Model)\"></a>CSSå¯¹è±¡æ¨¡å‹(CSSOMï¼šCSS Object Model)</h2><p>åœ¨æµè§ˆå™¨æ„å»ºDOMé‡åˆ°linkæ ‡è®°æ—¶ï¼Œè¯¥æ ‡è®°å¼•ç”¨ä¸€ä¸ªå¤–éƒ¨CSSæ ·å¼è¡¨ï¼šstyle.cssã€‚ç”±äºé¢„è§åˆ°éœ€è¦åˆ©ç”¨è¯¥èµ„æºæ¥æ¸²æŸ“é¡µé¢ï¼Œå®ƒä¼šç«‹å³å‘å‡ºå¯¹è¯¥èµ„æºçš„è¯·æ±‚ï¼Œå¹¶è¿”å›ä»¥ä¸‹å†…å®¹ï¼š</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">body</span> &#123; <span class=\"attribute\">font-size</span>: <span class=\"number\">16px</span> &#125;</div><div class=\"line\"><span class=\"selector-tag\">p</span> &#123; <span class=\"attribute\">font-weight</span>: bold &#125;</div><div class=\"line\"><span class=\"selector-tag\">span</span> &#123; <span class=\"attribute\">color</span>: red &#125;</div><div class=\"line\"><span class=\"selector-tag\">p</span> <span class=\"selector-tag\">span</span> &#123; <span class=\"attribute\">display</span>: none &#125;</div><div class=\"line\"><span class=\"selector-tag\">img</span> &#123; <span class=\"attribute\">float</span>: right &#125;</div></pre></td></tr></table></figure>\n<p>ä¸å¤„ç†HTMLæ—¶ç±»ä¼¼ï¼Œéœ€è¦å°†æ”¶åˆ°çš„CSSè§„åˆ™è½¬æ¢æˆæŸç§æµè§ˆå™¨èƒ½å¤Ÿç†è§£å’Œå¤„ç†çš„ä¸œè¥¿ã€‚å› æ­¤ä¼šé‡å¤HTMLè¿‡ç¨‹ï¼Œä¸è¿‡æ˜¯ä¸ºCSSè€Œä¸æ˜¯HTMLï¼š</p>\n<p><img src=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/cssom-construction.png?hl=zh-cn\" alt=\"\"></p>\n<p>CSSå­—èŠ‚è½¬æ¢æˆå­—ç¬¦ï¼Œæ¥ç€è½¬æ¢æˆä»¤ç‰Œå’ŒèŠ‚ç‚¹ï¼Œæœ€åé“¾æ¥åˆ°CSSOMæ ‘ç»“æ„å†…ï¼š</p>\n<p><img src=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/cssom-tree.png\" alt=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/cssom-tree.png\"></p>\n<p>CSSOMä¸ºä½•å…·æœ‰æ ‘ç»“æ„ï¼Ÿç”¨äºç¡®å®šèŠ‚ç‚¹å¯¹è±¡çš„è®¡ç®—æ ·å¼ã€‚å¦‚spanæ ‡è®°åŒ…å«äº†<code>color:red</code>æ ·å¼å’Œç»§æ‰¿äºbodyæ ‡è®°çš„<code>font-size:16px</code>æ ·å¼;</p>\n<p><u>æ³¨æ„ï¼šä»¥ä¸Šæ ‘å¹¶éå®Œæ•´çš„CSSOMæ ‘ï¼Œå®ƒåªæ˜¯æ›¿ä»£é»˜è®¤æ ·å¼çš„è‡ªå®šä¹‰æ ·å¼ã€‚æ¯ä¸ªæµè§ˆå™¨éƒ½æä¾›ä¸€ç»„é»˜è®¤æ ·å¼ï¼ˆä¹Ÿç§°ä¸ºâ€œUser Agent æ ·å¼â€ï¼‰ï¼Œå³ä¸æä¾›ä»»ä½•è‡ªå®šä¹‰æ ·å¼æ—¶æ‰€çœ‹åˆ°çš„æ ·å¼ï¼Œè‡ªå®šä¹‰æ ·å¼åªæ˜¯æ›¿æ¢è¿™äº›é»˜è®¤æ ·å¼</u></p>\n<p>CSSOMæ˜¯åœ¨DOMä¸­çš„ä¸€äº›æ¥å£ä¸­ï¼ŒåŠ å…¥è·å–å’Œæ“ä½œCSSå±æ€§æˆ–æ¥å£çš„JavaScriptæ¥å£ï¼Œå› è€ŒJavaScriptå¯ä»¥åŠ¨æ€æ“ä½œCSSæ ·å¼ã€‚DOMæä¾›äº†æ¥å£è®©JavaScriptä¿®æ”¹HTMLæ–‡æ¡£ï¼ŒCSSOMæä¾›äº†æ¥å£è®©JavaScriptè·å¾—å’Œä¿®æ”¹CSSä»£ç è®¾ç½®çš„æ ·å¼ä¿¡æ¯ã€‚</p>\n<h2 id=\"æ¸²æŸ“æ ‘-RenderObject-treeï¼Œä¹Ÿç§°ä¸ºRender-tree\"><a href=\"#æ¸²æŸ“æ ‘-RenderObject-treeï¼Œä¹Ÿç§°ä¸ºRender-tree\" class=\"headerlink\" title=\"æ¸²æŸ“æ ‘(RenderObject treeï¼Œä¹Ÿç§°ä¸ºRender tree)\"></a>æ¸²æŸ“æ ‘(RenderObject treeï¼Œä¹Ÿç§°ä¸ºRender tree)</h2><p>åœ¨DOMæ ‘ä¸­ï¼Œå­˜åœ¨ä¸å¯è§ä¸å¯è§èŠ‚ç‚¹ä¹‹åˆ†ã€‚é¡¾åæ€ä¹‰ï¼Œä¸å¯è§èŠ‚ç‚¹æ˜¯ä¸éœ€è¦ç»˜åˆ¶æœ€ç»ˆé¡µé¢ä¸­çš„èŠ‚ç‚¹ï¼Œå¦‚<code>meta</code>ã€<code>head</code>ã€<code>script</code>ç­‰ï¼Œä»¥åŠé€šè¿‡CSSæ ·å¼<code>display:none</code>éšè—çš„èŠ‚ç‚¹ã€‚ç›¸åå¯è§èŠ‚ç‚¹æ˜¯ç”¨æˆ·å¯è§çš„ï¼Œå¦‚<code>body</code>ã€<code>div</code>ã€<code>span</code>ã€<code>canvas</code>ã€<code>img</code>ç­‰ã€‚<br>å¯¹äºè¿™äº›å¯è§èŠ‚ç‚¹ï¼Œæµè§ˆå™¨éœ€è¦å°†å®ƒä»¬çš„å†…å®¹ç»˜åˆ¶åˆ°æœ€ç»ˆçš„é¡µé¢ä¸­ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¼šä¸ºå®ƒä»¬å»ºç«‹å¯¹åº”çš„RenderObjectå¯¹è±¡ã€‚ä¸€ä¸ªRenderObjectå¯¹è±¡ä¿å­˜äº†ä¸ºç»˜åˆ¶DOMèŠ‚ç‚¹çš„å„ç§ä¿¡æ¯ã€‚è¿™äº›RenderObjectå¯¹è±¡ä¸DOMå¯¹è±¡ç±»ä¼¼ï¼Œä¹Ÿæ„æˆä¸€æ£µæ ‘ï¼Œç§°ä¸º<strong>RenderObject tree</strong>ã€‚RenderObjectæ ‘æ˜¯åŸºäºDOMæ ‘å»ºç«‹èµ·æ¥çš„ä¸€æ£µæ–°æ ‘ï¼Œæ˜¯ä¸ºäº†å¸ƒå±€è®¡ç®—å’Œæ¸²æŸ“ç­‰æœºåˆ¶è€Œæ„å»ºçš„ä¸€ç§æ–°çš„å†…éƒ¨è¡¨ç¤ºã€‚RenderObjectæ ‘èŠ‚ç‚¹ä¸DOMæ ‘èŠ‚ç‚¹ä¸æ˜¯ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚å› ä¸ºåˆ›å»ºä¸€ä¸ªRenderObjectå¯¹è±¡éœ€è¦æ»¡è¶³å¦‚ä¸‹è§„åˆ™ï¼š</p>\n<ul>\n<li>DOMæ ‘çš„documentèŠ‚ç‚¹</li>\n<li>DOMæ ‘ä¸­çš„å¯è§èŠ‚ç‚¹ï¼Œå¦‚<code>html</code>ã€<code>body</code>ã€<code>div</code>ç­‰ã€‚è€Œæµè§ˆå™¨ä¸ä¼šä¸ºä¸å¯è§èŠ‚ç‚¹åˆ›å»ºRenderObjectèŠ‚ç‚¹ã€‚</li>\n<li>æŸäº›æƒ…å†µä¸‹æµè§ˆå™¨éœ€è¦åˆ›å»ºåŒ¿åçš„RenderObjectèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¸å¯¹åº”DOMæ ‘ä¸­çš„ä»»ä½•èŠ‚ç‚¹ã€‚</li>\n</ul>\n<p>RenderObjectå¯¹è±¡æ„æˆäº†RenderObjectæ ‘ï¼Œæ¯ä¸ªRenderObjectå¯¹è±¡ä¿å­˜äº†ä¸ºç»˜åˆ¶DOMèŠ‚ç‚¹çš„è®¡ç®—æ ·å¼ã€‚RenderObjectæ ‘ä¹Ÿå¯ä»¥ç†è§£æˆç”±CSSOMæ ‘å’ŒDOMæ ‘åˆå¹¶æˆï¼š</p>\n<p><img src=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/render-tree-construction.png?hl=zh-cn\" alt=\"\"></p>\n<h2 id=\"å¸ƒå±€-loayout\"><a href=\"#å¸ƒå±€-loayout\" class=\"headerlink\" title=\"å¸ƒå±€(loayout)\"></a>å¸ƒå±€(loayout)</h2><p>å½“æµè§ˆå™¨åˆ›å»ºRenderObjectå¯¹è±¡ä¹‹åï¼Œæ¯ä¸ªå¯¹è±¡å¹¶ä¸çŸ¥é“è‡ªå·±åœ¨è®¾å¤‡è§†å£å†…çš„ä½ç½®ã€å¤§å°ç­‰ä¿¡æ¯ã€‚æµè§ˆå™¨æ ¹æ®<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Box_Model\" target=\"_blank\" rel=\"external\">ç›’æ¨¡å‹(Box-model)</a>æ¥è®¡ç®—å®ƒä»¬çš„ä½ç½®ã€å¤§å°ç­‰ä¿¡æ¯çš„è¿‡ç¨‹ç§°ä¸ºå¸ƒå±€è®¡ç®—ï¼ˆé‡æ’ï¼‰ã€‚<br>å¸ƒå±€è®¡ç®—æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œè¿™æ˜¯å› ä¸ºä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°é€šå¸¸éœ€è¦å…ˆè®¡ç®—å®ƒçš„å­©å­èŠ‚ç‚¹çš„ä½ç½®ã€å¤§å°ç­‰ä¿¡æ¯ã€‚ä¸ºäº†è®¡ç®—èŠ‚ç‚¹åœ¨é¡µé¢ä¸­çš„ç¡®åˆ‡å¤§å°å’Œä½ç½®ï¼Œæµè§ˆå™¨ä¼šä»RenderObjectæ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹è¿›è¡Œéå†ã€‚</p>\n<p>å®ä¾‹ï¼š<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width,initial-scale=1\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Critial Path: Hello world!<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 50%\"</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 50%\"</span>&gt;</span>Hello world!<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>é¡µé¢åŒ…å«äº†ä¸¤ä¸ªåµŒå¥—divï¼šçˆ¶divå°†å…¶çš„æ˜¾ç¤ºå°ºå¯¸è®¾ç½®ä¸ºè§†å£å®½åº¦çš„50%ï¼Œå­divå°†å…¶å®½åº¦è®¾ç½®ä¸ºå…¶çˆ¶é¡¹çš„50%ï¼Œå³è§†å£å®½åº¦çš„25%ã€‚</p>\n<p><img src=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/layout-viewport.png?hl=zh-cn\" alt=\"\"></p>\n<h2 id=\"RenderLayeræ ‘-RenderLayer-tree\"><a href=\"#RenderLayeræ ‘-RenderLayer-tree\" class=\"headerlink\" title=\"RenderLayeræ ‘(RenderLayer tree)\"></a>RenderLayeræ ‘(RenderLayer tree)</h2><p>æµè§ˆå™¨æ¸²æŸ“å¼•æ“å¹¶ä¸æ˜¯ç›´æ¥ä½¿ç”¨RenderObjectæ ‘è¿›è¡Œç»˜åˆ¶ï¼Œä¸ºäº†æ–¹ä¾¿å¤„ç†Positioning(å®šä½)ï¼ŒClipping(è£å‰ª)ï¼ŒOverflow-scroll(é¡µå…§æ»šåŠ¨)ï¼ŒCSS Transform/Opacity/Animation/Filterï¼ŒMask or Reflectionï¼ŒZ-indexing(Zæ’åº)ç­‰ï¼Œæµè§ˆå™¨éœ€è¦ä¼šä¸ºä¸€äº›ç‰¹å®šçš„RenderObjectç”Ÿæˆå¯¹åº”çš„RenderLayerï¼Œå¹¶ç”Ÿæˆä¸€æ£µå¯¹åº”çš„RenderLayeræ ‘ã€‚è€Œè¿™äº›ç‰¹å®šçš„RenderObjectè·Ÿå¯¹åº”çš„RenderLayerå°±æ˜¯ç›´å±çš„å…³ç³»ï¼Œå¦‚æœå®ƒä»¬çš„å­èŠ‚ç‚¹å¦‚æœæ²¡æœ‰å¯¹åº”çš„RenderLayerï¼Œå°±ä»å±äºçˆ¶èŠ‚ç‚¹çš„RenderLayerã€‚æœ€ç»ˆï¼Œæ¯ä¸€ä¸ªRenderObjectéƒ½ä¼šç›´æ¥æˆ–è€…é—´æ¥åœ°ä»å±äºä¸€ä¸ªRenderLayerã€‚å› æ­¤RenderObjectèŠ‚ç‚¹ä¸RenderLayerèŠ‚ç‚¹ä¸æ˜¯ä¸€ä¸€å¯¹åº”å…³ç³»ï¼Œè€Œæ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚é‚£éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Œæ¸²æŸ“å¼•æ“æ‰ä¸ºRenderObjectå»ºç«‹å¯¹åº”çš„RenderLayerï¼š</p>\n<ul>\n<li>Itâ€™s the root object for the page</li>\n<li>It has explicit CSS position properties (relative, absolute or a transform)</li>\n<li>It is transparent</li>\n<li>Has overflow, an alpha mask or reflection</li>\n<li>Has a CSS filter</li>\n<li>Corresponds to <code>&lt;canvas&gt;</code> element that has a 3D (WebGL) context or an accelerated 2D context</li>\n<li>Corresponds to a <code>&lt;video&gt;</code> element</li>\n</ul>\n<p>ç¿»è¯‘ï¼š</p>\n<ul>\n<li>DOMæ ‘çš„DocumentèŠ‚ç‚¹å¯¹åº”çš„RenderObjectèŠ‚ç‚¹å’ŒHTMLèŠ‚ç‚¹å¯¹åº”çš„RenderObjectèŠ‚ç‚¹</li>\n<li>æ˜¾å¼æŒ‡å®šCSS positionå±æ€§çš„RenderObjectèŠ‚ç‚¹</li>\n<li>æœ‰é€æ˜åº¦çš„RenderObjectèŠ‚ç‚¹</li>\n<li>æœ‰overflowï¼Œalphaå’Œreflectionçš„æ ·å¼RenderObjectèŠ‚ç‚¹</li>\n<li>æœ‰filteræ ·å¼çš„RenderObjectèŠ‚ç‚¹</li>\n<li>ä½¿ç”¨Canvas 2Då’Œ3D(WebGL)æŠ€æœ¯çš„RenderObjectèŠ‚ç‚¹</li>\n<li>videoå…ƒç´ å¯¹åº”çš„RenderObjectèŠ‚ç‚¹</li>\n</ul>\n<p>æ¯ä¸ªRenderLayerå¯¹è±¡å¯ä»¥æƒ³è±¡æˆå›¾åƒä¸­ä¸€ä¸ªå›¾å±‚ï¼Œå„ä¸ªå›¾å±‚å åŠ æ„æˆäº†ä¸€ä¸ªå›¾åƒã€‚æµè§ˆå™¨ä¼šéå†RenderLayeræ ‘ï¼Œå†éå†ä»å±è¿™ä¸ªRenderLayerçš„RenderObjectï¼ŒRenderObjectå¯¹è±¡å­˜å‚¨æœ‰ç»˜åˆ¶ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œç»˜åˆ¶ã€‚RenderLayerå’ŒRenderObjectå…±åŒå†³å®šäº†æœ€ç»ˆå‘ˆç°çš„ç½‘é¡µå†…å®¹ï¼ŒRenderLayeræ ‘å†³å®šäº†ç½‘é¡µçš„ç»˜åˆ¶çš„å±‚æ¬¡é¡ºåºï¼Œè€Œä»å±äºRenderLayerçš„RenderObjectå†³å®šäº†è¯¥RenderLayerçš„å†…å®¹ã€‚</p>\n<h2 id=\"æ¸²æŸ“æ–¹å¼\"><a href=\"#æ¸²æŸ“æ–¹å¼\" class=\"headerlink\" title=\"æ¸²æŸ“æ–¹å¼\"></a>æ¸²æŸ“æ–¹å¼</h2><p>åœ¨å®Œæˆæ„å»ºRenderLayeræ ‘ä¹‹åï¼Œæµè§ˆå™¨ä¼šä½¿ç”¨å›¾å½¢åº“å°†å…¶æ„å»ºçš„æ¸²æŸ“æ¨¡å‹ç»˜åˆ¶å‡ºæ¥ï¼Œè¯¥è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>\n<ul>\n<li>ç»˜åˆ¶ï¼šå°†ä»å±æ¯ä¸ªRenderLayerå›¾å±‚ä¸Šçš„RenderObjectç»˜åˆ¶åœ¨å…¶RenderLayerä¸Šã€‚å³ç»˜åˆ¶ï¼ˆPaintï¼‰æˆ–è€…å…‰æ …åŒ–ï¼ˆRasterizationï¼‰ï¼Œå°†ä¸€äº›ç»˜å›¾æŒ‡ä»¤è½¬æ¢æˆçœŸæ­£çš„åƒç´ é¢œè‰²å€¼ã€‚<ul>\n<li>è½¯ä»¶ç»˜å›¾ï¼šCPUæ¥å®Œæˆç»˜å›¾æ“ä½œ</li>\n<li>ç¡¬ä»¶åŠ é€Ÿç»˜å›¾ï¼šGPUæ¥å®Œæˆç»˜å›¾æ“ä½œ</li>\n</ul>\n</li>\n<li>åˆæˆ(compositing)ï¼šå°†å„ä¸ªRenderLayerå›¾å±‚åˆå¹¶æˆåˆ°ä¸€ä¸ªä½å›¾(Bitmap)ä¸­ã€‚åŒæ—¶è¿˜å¯èƒ½åŒ…æ‹¬ä½ç§»ï¼ˆTranslationï¼‰ï¼Œç¼©æ”¾ï¼ˆScaleï¼‰ï¼Œæ—‹è½¬ï¼ˆRotationï¼‰ï¼ŒAlpha åˆæˆç­‰æ“ä½œã€‚</li>\n</ul>\n<p>æ¸²æŸ“å¼•æ“çš„æ¸²æŸ“ï¼Œç›®å‰æœ‰ä¸‰ç§ç½‘é¡µçš„æ¸²æŸ“æ–¹å¼ï¼š</p>\n<blockquote>\n<ul>\n<li>ç¡¬ä»¶åŠ é€Ÿåˆæˆ(Accelerated Compositing)ï¼šä½¿ç”¨GPUæ¥å®Œæˆåˆæˆå·¥ä½œã€‚</li>\n<li>åˆæˆåŒ–æ¸²æŸ“ï¼šä½¿ç”¨åˆæˆ(compositing)æŠ€æœ¯çš„æ¸²æŸ“ç§°ã€‚</li>\n</ul>\n</blockquote>\n<ul>\n<li>è½¯ä»¶æ¸²æŸ“æ–¹å¼ï¼šä½¿ç”¨CPUæ¥ç»˜åˆ¶æ¯ä¸ªRenderLayerå›¾å±‚çš„å†…å®¹(RenderObject)åˆ°ä¸€ä¸ªä½å›¾ï¼Œå³ä¸€å—CPUä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚ç»˜åˆ¶æ¯ä¸€å±‚çš„æ—¶å€™éƒ½ä¼šä½¿ç”¨è¯¥ä½å›¾ï¼ŒåŒºåˆ«åœ¨äºç»˜åˆ¶çš„ä½ç½®å¯èƒ½ä¸ä¸€æ ·ï¼Œç»˜åˆ¶é¡ºåºæŒ‰ç…§ä»ååˆ°å‰ã€‚å› æ­¤è½¯ä»¶æ¸²æŸ“æœºåˆ¶æ˜¯æ²¡æœ‰åˆæˆé˜¶æ®µçš„ã€‚</li>\n<li>ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“çš„åˆæˆåŒ–æ¸²æŸ“æ–¹å¼ï¼šä½¿ç”¨GPUæ¥ç»˜åˆ¶æ‰€æœ‰åˆæˆå±‚ï¼Œå¹¶ä½¿ç”¨GPUç¡¬ä»¶æ¥åŠ é€Ÿåˆæˆã€‚</li>\n<li>è½¯ä»¶ç»˜å›¾çš„åˆæˆåŒ–æ¸²æŸ“æ–¹å¼ï¼š æŸäº›åˆæˆå±‚ä½¿ç”¨CPUæ¥ç»˜å›¾ï¼Œå¦å¤–ä¸€äº›ä½¿ç”¨GPUæ¥ç»˜åˆ¶ã€‚å¯¹äºä½¿ç”¨CPUæ¥ç»˜åˆ¶çš„å›¾å±‚ï¼Œè¯¥å±‚çš„ç»˜åˆ¶ç»“æœä¼šå…ˆä¿å­˜åœ¨CPUå†…å­˜ä¸­ï¼Œä¹‹åä¼šè¢«ä¼ è¾“åˆ°GPUå†…å­˜ä¸­ï¼Œç„¶åå†ä½¿ç”¨GPUæ¥å®Œæˆåˆæˆå·¥ä½œã€‚</li>\n</ul>\n<p><img src=\"./render.png\" alt=\"\"></p>\n<p>ç¬¬äºŒç§å’Œç¬¬ä¸‰ç§æ¸²æŸ“æ–¹å¼ï¼Œéƒ½æ˜¯ä½¿ç”¨äº†åˆæˆåŒ–æ¸²æŸ“æŠ€æœ¯ï¼Œåˆæˆå·¥ä½œä¹Ÿéƒ½æ˜¯ç”±GPUæ¥åšã€‚å¯¹äºå¸¸è§çš„2Dç»˜å›¾æ“ä½œï¼Œä½¿ç”¨GPUæ¥ç»˜å›¾ä¸ä¸€å®šæ¯”ä½¿ç”¨CPUç»˜å›¾åœ¨æ€§èƒ½ä¸Šæœ‰ä¼˜åŠ¿ï¼Œä¾‹å¦‚ç»˜åˆ¶æ–‡å­—ã€ç‚¹ã€çº¿ç­‰ï¼ŒåŸå› æ˜¯CPUçš„ä½¿ç”¨ç¼“å†²æœºåˆ¶æœ‰æ•ˆå‡å°‘äº†é‡å¤ç»˜åˆ¶çš„å¼€é”€è€Œä¸”ä¸éœ€è¦è€ƒè™‘ä¸GPUå¹¶è¡Œã€‚å¦å¤–ï¼ŒGPUçš„å†…å­˜èµ„æºç›¸å¯¹CPUçš„å†…å­˜èµ„æºæ¥è¯´æ¯”è¾ƒç´§å¼ ï¼Œè€Œä¸”ç½‘é¡µçš„åˆ†å±‚ä½¿å¾—GPUçš„å†…å­˜ä½¿ç”¨ç›¸å¯¹æ¯”è¾ƒå¤šã€‚é‰´äºæ­¤ï¼Œå°±ç›®å‰çš„æƒ…å†µæ¥çœ‹ï¼Œä¸‰è€…éƒ½å­˜åœ¨æ˜¯æœ‰å…¶åˆç†æ€§çš„ï¼Œä¸‹é¢åˆ†æä¸€ä¸‹å®ƒä»¬çš„ç‰¹ç‚¹ï¼š</p>\n<ul>\n<li>è½¯ä»¶æ¸²æŸ“æ˜¯ç›®å‰å¾ˆå¸¸è§çš„æŠ€æœ¯ï¼Œä¹Ÿæ˜¯æµè§ˆå™¨æœ€æ—©ä½¿ç”¨çš„æ¸²æŸ“æ–¹å¼ã€‚è¿™ä¸€æŠ€æœ¯æ¯”è¾ƒèŠ‚çœå†…å­˜ï¼Œç‰¹åˆ«æ˜¯å®è´µçš„GPUå†…å­˜ï¼Œä½†æ˜¯è½¯ä»¶æ¸²æŸ“åªèƒ½å¤„ç†2Dæ–¹é¢çš„æ“ä½œã€‚ç®€å•çš„ç½‘é¡µæ²¡æœ‰å¤æ‚ç»˜å›¾æˆ–è€…å¤šåª’ä½“æ–¹é¢çš„éœ€æ±‚ï¼Œè½¯ä»¶æ¸²æŸ“æ–¹å¼å°±æ¯”è¾ƒåˆé€‚æ¥æ¸²æŸ“è¯¥ç±»å‹çš„ç½‘é¡µã€‚é—®é¢˜æ˜¯ï¼Œä¸€æ—¦é‡ä¸Šäº†HTML5çš„å¾ˆå¤šæ–°æŠ€æœ¯ï¼Œè½¯ä»¶æ¸²æŸ“æ˜¾å¾—æ— èƒ½ä¸ºåŠ›ï¼Œä¸€æ˜¯å› ä¸ºèƒ½åŠ›ä¸è¶³ï¼›äºŒæ˜¯å› ä¸ºæ€§èƒ½ä¸å¥½ï¼Œä¾‹å¦‚è§†é¢‘ã€Canvas 2Dç­‰ã€‚æ‰€ä»¥ï¼Œè½¯ä»¶æ¸²æŸ“æŠ€æœ¯è¢«ç”¨çš„è¶Šæ¥è¶Šå°‘ï¼Œç‰¹åˆ«æ˜¯åœ¨ç§»åŠ¨é¢†åŸŸã€‚è½¯ä»¶æ¸²æŸ“åŒç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“å¦å¤–ä¸€ä¸ªå¾ˆä¸åŒçš„åœ°æ–¹å°±æ˜¯å¯¹æ›´æ–°åŒºåŸŸçš„å¤„ç†ã€‚å½“ç½‘é¡µä¸­æœ‰ä¸€ä¸ªæ›´æ–°å°å‹åŒºåŸŸçš„è¯·æ±‚ï¼ˆå¦‚åŠ¨ç”»ï¼‰æ—¶ï¼Œè½¯ä»¶æ¸²æŸ“å¯èƒ½åªéœ€è¦è®¡ç®—ä¸€ä¸ªæå°çš„åŒºåŸŸï¼Œè€Œç¡¬ä»¶æ¸²æŸ“å¯èƒ½éœ€è¦é‡æ–°ç»˜åˆ¶å…¶ä¸­çš„ä¸€å±‚æˆ–è€…å¤šå±‚ï¼Œç„¶åå†åˆæˆè¿™äº›å±‚ã€‚ç¡¬ä»¶æ¸²æŸ“çš„ä»£ä»·å¯èƒ½ä¼šå¤§å¾—å¤šã€‚</li>\n<li>å¯¹äºç¡¬ä»¶åŠ é€Ÿçš„åˆæˆåŒ–æ¸²æŸ“æ–¹å¼æ¥è¯´ï¼Œæ¯ä¸ªå±‚çš„ç»˜åˆ¶å’Œæ‰€æœ‰å±‚çš„åˆæˆå‡ä½¿ç”¨GPUç¡¬ä»¶æ¥å®Œæˆï¼Œè¿™å¯¹éœ€è¦ä½¿ç”¨3Dç»˜å›¾çš„æ“ä½œæ¥è¯´ç‰¹åˆ«åˆé€‚ã€‚è¿™ç§æ–¹å¼ä¸‹ï¼Œåœ¨RenderLayeræ ‘ä¹‹åï¼Œæµè§ˆå™¨è¿˜éœ€è¦å»ºç«‹æ›´å¤šçš„å†…éƒ¨è¡¨ç¤ºï¼Œç›®çš„æ˜¯æ”¯æŒç¡¬ä»¶åŠ é€Ÿæœºåˆ¶ï¼Œè¿™æ˜¾ç„¶ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜èµ„æºã€‚ä½†æ˜¯ï¼Œä¸€æ–¹é¢ï¼Œç¡¬ä»¶åŠ é€Ÿæœºåˆ¶èƒ½å¤Ÿæ”¯æŒç°åœ¨æ‰€æœ‰çš„HTML5å®šä¹‰çš„2Dæˆ–è€…3Dç»˜å›¾æ ‡å‡†ï¼›å¦ä¸€æ–¹é¢ï¼Œå…³äºæ›´æ–°åŒºåŸŸçš„è®¨è®ºï¼Œå¦‚æœéœ€è¦æ›´æ–°æŸä¸ªå±‚çš„ä¸€ä¸ªåŒºåŸŸï¼Œå› ä¸ºè½¯ä»¶æ¸²æŸ“æ²¡æœ‰ä¸ºæ¯ä¸€å±‚æä¾›åç«¯å­˜å‚¨ï¼Œå› è€Œå®ƒéœ€è¦å°†å’Œè¿™ä¸ªåŒºåŸŸæœ‰é‡å éƒ¨åˆ†çš„æ‰€æœ‰å±‚æ¬¡çš„ç›¸å…³åŒºåŸŸä¸€æ¬¡ä»åå¾€å‰é‡æ–°ç»˜åˆ¶ä¸€éï¼Œè€Œç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“åªéœ€è¦é‡æ–°ç»˜åˆ¶æ›´æ–°å‘ç”Ÿçš„å±‚æ¬¡ï¼Œå› è€Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè½¯ä»¶æ¸²æŸ“çš„ä»£ä»·åˆå˜å¾—æ›´å¤§ã€‚å½“ç„¶ï¼Œè¿™å–å†³äºç½‘é¡µçš„ç»“æ„å’Œæ¸²æŸ“ç­–ç•¥ã€‚</li>\n<li>è½¯ä»¶ç»˜å›¾çš„åˆæˆåŒ–æ¸²æŸ“æ–¹å¼ç»“åˆäº†å‰é¢ä¸¤ç§æ–¹å¼çš„ä¼˜ç‚¹ï¼Œè¿™æ—¶å› ä¸ºå¾ˆå¤šç½‘é¡µå¯èƒ½æ—¢åŒ…å«åŸºæœ¬çš„HTMLå…ƒç´ ï¼Œä¹ŸåŒ…å«ä¸€äº›HTML5æ–°åŠŸèƒ½ï¼Œä½¿ç”¨CPUç»˜å›¾æ–¹å¼æ¥ç»˜åˆ¶æŸäº›å±‚ï¼Œä½¿ç”¨GPUæ¥ç»˜åˆ¶å…¶ä»–ä¸€äº›å±‚ã€‚åŸå› å½“ç„¶æ˜¯å‰é¢æ‰€è¿°çš„åŸºäºæ€§èƒ½å’Œå†…å­˜æ–¹é¢ç»¼åˆè€ƒè™‘çš„ç»“æœã€‚</li>\n</ul>\n<blockquote>\n<p>æµè§ˆå™¨è¿˜å¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹çš„æ¸²æŸ“æ¶æ„ï¼Œå°†ç½‘é¡µå†…å®¹ç»˜åˆ¶åˆ°åç«¯å­˜å‚¨çš„æ“ä½œæ”¾åˆ°å¦å¤–ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼ˆç»˜åˆ¶çº¿ç¨‹ï¼‰ï¼Œè€ŒåŸæ¥çº¿ç¨‹è½¬ä¸ºåˆæˆçº¿ç¨‹ï¼Œç»˜åˆ¶çº¿ç¨‹è·Ÿåˆæˆçº¿ç¨‹ä¹‹é—´å¯ä»¥ä½¿ç”¨åŒæ­¥ï¼Œéƒ¨åˆ†åŒæ­¥ï¼Œå®Œå…¨å¼‚æ­¥ç­‰ä½œä¸šæ¨¡å¼ï¼Œè®©æµè§ˆå™¨å¯ä»¥åœ¨æ€§èƒ½ä¸æ•ˆæœä¹‹é—´æ ¹æ®éœ€è¦è¿›è¡Œé€‰æ‹©ã€‚</p>\n</blockquote>\n<h2 id=\"GrphicsLayer-tree-GrphicsLayeræ ‘\"><a href=\"#GrphicsLayer-tree-GrphicsLayeræ ‘\" class=\"headerlink\" title=\"GrphicsLayer tree(GrphicsLayeræ ‘)\"></a>GrphicsLayer tree(GrphicsLayeræ ‘)</h2><p>å¯¹äºè½¯ä»¶æ¸²æŸ“è€Œè¨€ï¼Œåˆ°RenderLayeræ ‘å°±ç»“æŸäº†ï¼Œåé¢ä¸ä¼šå»ºç«‹å…¶å®ƒé¢å¤–çš„æ ‘æ¥å¯¹åº”äºRenderLayeræ ‘ã€‚ä½†æ˜¯ï¼Œå¯¹äºç¡¬ä»¶æ¸²æŸ“æ¥è¯´ï¼Œåœ¨RenderLayeræ ‘ä¹‹åï¼Œæµè§ˆå™¨æ¸²æŸ“å¼•æ“ä¸ºç¡¬ä»¶æ¸²æŸ“æä¾›äº†æ›´å¤šçš„å†…éƒ¨ç»“æ„æ¥æ”¯æŒè¿™ä¸ªæœºåˆ¶ã€‚</p>\n<p>åœ¨ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“çš„åˆæˆåŒ–æ¸²æŸ“å’Œè½¯ä»¶ç»˜å›¾çš„åˆæˆåŒ–æ¸²æŸ“æ¶æ„ä¸‹ï¼Œä¸€ä¸ªRenderLayerå¯¹è±¡å¦‚æœéœ€è¦åç«¯å­˜å‚¨ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªRenderLayerBackingå¯¹è±¡ï¼Œè¯¥å¯¹è±¡è´Ÿè´£Renderlayerå¯¹è±¡æ‰€éœ€è¦çš„å„ç§å­˜å‚¨ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œæ¯ä¸ªRenderLayeréƒ½å¯ä»¥åˆ›å»ºè‡ªå·±çš„åç«¯å­˜å‚¨ï¼Œäº‹å®ä¸Šä¸æ˜¯æ‰€æœ‰RenderLayeréƒ½æœ‰è‡ªå·±çš„RenderLayerBackingå¯¹è±¡ã€‚å¦‚æœä¸€ä¸ªRenderLayerå¯¹è±¡è¢«åƒæ ·çš„åˆ›å»ºåç«¯å­˜å‚¨ï¼Œé‚£ä¹ˆå°†è¯¥RenderLayerç§°ä¸ºåˆæˆå±‚ï¼ˆCompositing Layerï¼‰ã€‚</p>\n<p>å“ªäº›RenderLayerå¯¹è±¡å¯ä»¥æ˜¯åˆæˆå±‚ï¼Ÿå¦‚æœä¸€ä¸ªRenderLayerå¯¹è±¡å…·æœ‰ä»¥ä¸‹çš„ç‰¹å¾ä¹‹ä¸€ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯åˆæˆå±‚ï¼š</p>\n<ul>\n<li>Layer has 3D or perspective transform CSS properties</li>\n<li>Layer is used by &lt; video&gt; element using accelerated video decoding</li>\n<li>Layer is used by a &lt; canvas&gt; element with a 3D context or accelerated 2D context</li>\n<li>Layer is used for a composited plugin</li>\n<li>Layer uses a CSS animation for its opacity or uses an animated webkit transform</li>\n<li>Layer uses accelerated CSS filters</li>\n<li>Layer with a composited descendant has information that needs to be in the composited layer tree, such as a clip or reflection</li>\n<li>Layer has a sibling with a lower z-index which has a compositing layer (in other words the layer is rendered on top of a composited layer)</li>\n</ul>\n<p>ç¿»è¯‘:</p>\n<ul>\n<li>RenderLayerå…·æœ‰3Dæˆ–é€è§†è½¬æ¢çš„CSSå±æ€§</li>\n<li>RenderLayeråŒ…å«ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„è§†é¢‘è§£ç æŠ€æœ¯çš„<code>&lt;video&gt;</code>å…ƒç´ </li>\n<li>RenderLayeråŒ…å«ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„2Dæˆ–WebGL-3DæŠ€æœ¯çš„<code>&lt;canvas&gt;</code>å…ƒç´ </li>\n<li>RenderLayerä½¿ç”¨äº†åˆæˆæ’ä»¶ã€‚</li>\n<li>RenderLayerä½¿ç”¨äº†<code>opacity</code>æˆ–<code>transform</code>åŠ¨ç”»</li>\n<li>RenderLayerä½¿ç”¨äº†ç¡¬ä»¶åŠ é€Ÿçš„CSS FiltersæŠ€æœ¯</li>\n<li>RenderLayeråä»£ä¸­åŒ…å«äº†ä¸€ä¸ªåˆæˆå±‚ï¼ˆå¦‚æœ‰clipæˆ–reflectionå±æ€§ï¼‰</li>\n<li>RenderLayeræœ‰ä¸ªä¸€ä¸ªz-indexæ¯”è‡ªå·±å°çš„åˆæˆå±‚ï¼ˆå³åœ¨ä¸€ä¸ªåˆæˆå±‚ä¹‹ä¸Šï¼‰</li>\n</ul>\n<p>æ¯ä¸ªåˆæˆå±‚éƒ½æœ‰ä¸€ä¸ªRenderLayerBackingï¼ŒRenderLayerBackingè´Ÿè´£ç®¡ç†RenderLayeræ‰€éœ€è¦çš„æ‰€æœ‰åç«¯å­˜å‚¨ï¼Œå› ä¸ºåç«¯å­˜å‚¨å¯èƒ½éœ€è¦å¤šä¸ªå­˜å‚¨ç©ºé—´ã€‚åœ¨æµè§ˆå™¨(WebKit)ä¸­ï¼Œå­˜å‚¨ç©ºé—´ä½¿ç”¨ç±»GraphicsLayeræ¥è¡¨ç¤ºã€‚æµè§ˆå™¨ä¼šä¸ºè¿™äº›RenderLayeråˆ›å»ºå¯¹åº”çš„GraphicsLayerï¼Œä¸åŒçš„æµè§ˆå™¨éœ€è¦æä¾›è‡ªå·±çš„GrphicsLayerå®ç°ç”¨äºç®¡ç†å­˜å‚¨ç©ºé—´çš„åˆ†é…ï¼Œé‡Šæ”¾ï¼Œæ›´æ–°ç­‰ç­‰ã€‚æ‹¥æœ‰GrphicsLayerçš„RenderLayerä¼šè¢«ç»˜åˆ¶åˆ°è‡ªå·±çš„åç«¯å­˜å‚¨ï¼Œè€Œæ²¡æœ‰GrphicsLayerçš„RenderLayerå®ƒä»¬ä¼šå‘ä¸Šè¿½æº¯æœ‰GrphicsLayerçš„çˆ¶/ç¥–å…ˆRenderLayerï¼Œç›´åˆ°Root RenderLayerä¸ºæ­¢ï¼Œç„¶åç»˜åˆ¶åœ¨æœ‰GrphicsLayerçš„çˆ¶/ç¥–å…ˆRenderLayerçš„å­˜å‚¨ç©ºé—´ï¼Œè€ŒRoot RenderLayeræ€»æ˜¯ä¼šåˆ›å»ºä¸€ä¸ªGrphicsLayerå¹¶æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å­˜å‚¨ç©ºé—´ã€‚åœ¨å°†æ¯ä¸ªåˆæˆå›¾å±‚åŒ…å«çš„RenderLayerå†…å®¹ç»˜åˆ¶åœ¨åˆæˆå±‚çš„åç«¯å­˜å‚¨ä¸­ï¼Œè¿™é‡Œç»˜åˆ¶å¯ä»¥æ˜¯è½¯ä»¶ç»˜åˆ¶æˆ–ç¡¬ä»¶ç»˜åˆ¶ã€‚æ¥ç€ç”±åˆæˆå™¨(Compositor)å°†å¤šä¸ªåˆæˆå±‚åˆæˆèµ·æ¥ï¼Œå½¢æˆæœ€ç»ˆç”¨æˆ·å¯è§çš„ç½‘é¡µï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€å¼ å›¾ç‰‡ã€‚</p>\n<p>GraphicsLayeråˆæ„æˆäº†ä¸€æ£µä¸RenderLayerå¹¶è¡Œçš„æ ‘ï¼Œè€ŒRenderLayerä¸GraphicsLayerçš„å…³ç³»æœ‰äº›ç±»ä¼¼äºRenderObjectä¸RenderLayerä¹‹é—´çš„å…³ç³»ã€‚å¦‚ä¸‹æ˜¯DOMæ ‘ã€RenderObjectæ ‘ã€RenderLayeræ ‘ã€GraphicsLayeræ ‘å…³ç³»å›¾ï¼š</p>\n<p><img src=\"http://www.chromium.org/_/rsrc/1479245083354/developers/design-documents/gpu-accelerated-compositing-in-chrome/the_compositing_forest.png\" alt=\"\"></p>\n<p>è¿™æ ·å¯ä»¥åˆå¹¶ä¸€äº›RenderLayerå±‚ï¼Œä»è€Œå‡å°‘å†…å­˜çš„æ¶ˆè€—ã€‚å…¶æ¬¡ï¼Œåˆå¹¶ä¹‹åï¼Œå‡å°‘äº†åˆå¹¶å¸¦æ¥çš„é‡ç»˜æ€§èƒ½å’Œå¤„ç†ä¸Šçš„å›°éš¾ã€‚<br>åœ¨ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“çš„åˆæˆåŒ–æ¸²æŸ“å’Œè½¯ä»¶ç»˜å›¾çš„åˆæˆåŒ–æ¸²æŸ“æ¶æ„ä¸‹ï¼ŒRenderLayerçš„å†…å®¹å˜åŒ–ï¼Œåªéœ€è¦æ›´æ–°æ‰€å±çš„GraphicsLayerçš„ç¼“å­˜å³å¯ï¼Œè€Œç¼“å­˜çš„æ›´æ–°ï¼Œä¹Ÿåªéœ€è¦ç»˜åˆ¶ç›´æ¥æˆ–è€…é—´æ¥å±äºè¿™ä¸ªGraphicsLayerçš„RenderLayerï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„RenderLayerã€‚ç‰¹åˆ«æ˜¯ä¸€äº›ç‰¹å®šçš„CSSæ ·å¼å±æ€§çš„å˜åŒ–ï¼Œå®é™…ä¸Šå¹¶ä¸å¼•èµ·å†…å®¹çš„å˜åŒ–ï¼Œåªéœ€è¦æ”¹å˜ä¸€äº›GraphicsLayerçš„æ··åˆå‚æ•°ï¼Œç„¶åé‡æ–°æ··åˆå³å¯ï¼Œè€Œæ··åˆç›¸å¯¹ç»˜åˆ¶è€Œè¨€æ˜¯å¾ˆå¿«çš„ï¼Œè¿™äº›ç‰¹å®šçš„CSSæ ·å¼å±æ€§æˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºæ˜¯è¢«åŠ é€Ÿçš„ï¼Œä¸åŒçš„æµè§ˆå™¨æ”¯æŒçš„çŠ¶å†µä¸å¤ªä¸€æ ·ï¼Œä½†åŸºæœ¬ä¸ŠCSS Transform &amp; Opacityåœ¨æ‰€æœ‰æ”¯æŒæ··åˆåŠ é€Ÿçš„æµè§ˆå™¨ä¸Šéƒ½æ˜¯è¢«åŠ é€Ÿçš„ã€‚è¢«åŠ é€Ÿçš„CSSæ ·å¼å±æ€§çš„åŠ¨ç”»ï¼Œå°±æ¯”è¾ƒå®¹æ˜“è¾¾åˆ°60å¸§/æ¯ç§’çš„æµç•…æ•ˆæœäº†ã€‚</p>\n<p><img src=\"http://img.blog.csdn.net/20140416142656281\" alt=\"\"></p>\n<p>ä¸è¿‡å¹¶ä¸æ˜¯æ‹¥æœ‰ç‹¬ç«‹ç¼“å­˜çš„RenderLayerè¶Šå¤šè¶Šå¥½ï¼Œå¤ªå¤šæ‹¥æœ‰ç‹¬ç«‹ç¼“å­˜çš„RenderLayerä¼šå¸¦æ¥ä¸€äº›ä¸¥é‡çš„å‰¯ä½œç”¨:</p>\n<ul>\n<li>å®ƒå¤§å¤§å¢åŠ äº†å†…å­˜çš„å¼€é”€ï¼Œè¿™ç‚¹åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šçš„å½±å“æ›´å¤§ï¼Œç”šè‡³å¯¼è‡´æµè§ˆå™¨åœ¨ä¸€äº›å†…å­˜è¾ƒå°‘çš„ç§»åŠ¨è®¾å¤‡ä¸Šæ— æ³•å¾ˆå¥½åœ°æ”¯æŒå›¾å±‚åˆæˆåŠ é€Ÿï¼›</li>\n<li>å®ƒåŠ å¤§äº†åˆæˆçš„æ—¶é—´å¼€é”€ï¼Œå¯¼è‡´åˆæˆæ€§èƒ½çš„ä¸‹é™ï¼Œè€Œåˆæˆæ€§èƒ½è·Ÿç½‘é¡µæ»šåŠ¨/ç¼©æ”¾æ“ä½œçš„æµç•…åº¦åˆæ¯æ¯ç›¸å…³ï¼Œæœ€ç»ˆå¯¼è‡´ç½‘é¡µæ»šåŠ¨/ç¼©æ”¾çš„æµç•…åº¦ä¸‹é™ï¼Œè®©ç”¨æˆ·è§‰å¾—æ“ä½œä¸å¤Ÿæµç•…ã€‚</li>\n</ul>\n<h2 id=\"Tile-Rendering-ç“¦ç‰‡æ¸²æŸ“\"><a href=\"#Tile-Rendering-ç“¦ç‰‡æ¸²æŸ“\" class=\"headerlink\" title=\"Tile Rendering(ç“¦ç‰‡æ¸²æŸ“)\"></a>Tile Rendering(ç“¦ç‰‡æ¸²æŸ“)</h2><p>é€šå¸¸ä¸€ä¸ªåˆæˆå±‚çš„åç«¯å­˜å‚¨è¢«åˆ†å‰²æˆå¤šä¸ªå¤§å°ç›¸åŒçš„ç“¦ç‰‡çŠ¶çš„å°å­˜å‚¨ç©ºé—´ï¼Œæ¯ä¸ªç“¦ç‰‡å¯ä»¥ç†è§£ä¸ºOpenGLä¸­çš„ä¸€ä¸ªçº¹ç†ï¼Œåˆæˆå±‚çš„ç»“æœè¢«åˆ†å¼€å­˜å‚¨åœ¨è¿™äº›ç“¦ç‰‡ä¸­ã€‚ä¸ºä»€ä¹ˆä½¿ç”¨ç“¦ç‰‡åŒ–çš„åç«¯å­˜å‚¨ï¼Ÿ</p>\n<ul>\n<li>DOMæ ‘ç§çš„htmlå…ƒç´ æ‰€åœ¨çš„å±‚å¯èƒ½ä¼šæ¯”è¾ƒå¤§ï¼Œå› ä¸ºç½‘é¡µçš„é«˜åº¦å¾ˆå¤§ï¼Œå¦‚æœåªæ˜¯ä½¿ç”¨ä¸€ä¸ªåç«¯å­˜å‚¨çš„è¯ï¼Œé‚£ä¹ˆéœ€è¦ä¸€ä¸ªå¾ˆå¤§çš„çº¹ç†å¯¹è±¡ï¼Œä½†æ˜¯å®é™…çš„GPUç¡¬ä»¶å¯èƒ½åªæ”¯æŒéå¸¸æœ‰é™çš„çº¹ç†å¤§å°ã€‚</li>\n<li>åœ¨ä¸€ä¸ªæ¯”è¾ƒå¤§çš„åˆæˆå±‚ä¸­ï¼Œå¯èƒ½åªæ˜¯å…¶ä¸­ä¸€éƒ¨åˆ†å‘ç”Ÿå˜åŒ–ï¼Œæ ¹æ®ä¹‹å‰çš„ä»‹ç»ï¼Œéœ€è¦é‡æ–°ç»˜åˆ¶æ•´ä¸ªå±‚ï¼Œè¿™æ ·å¿…ç„¶äº§ç”Ÿé¢å¤–çš„å¼€é”€ï¼Œä½¿ç”¨ç“¦ç‰‡è¯çš„åç«¯å­˜å‚¨ï¼Œå°±åªéœ€è¦é‡ç»˜ä¸€äº›å­˜åœ¨æ›´æ–°çš„ç“¦ç‰‡ã€‚</li>\n<li>å½“å±‚å‘ç”Ÿæ»šåŠ¨çš„æ—¶å€™ï¼Œä¸€äº›ç“¦ç‰‡å¯èƒ½ä¸å†éœ€è¦ï¼Œç„¶åæ¸²æŸ“å¼•æ“éœ€è¦ä¸€äº›æ–°çš„ç“¦ç‰‡æ¥ç»˜åˆ¶æ–°çš„åŒºåŸŸï¼Œè¿™äº›å¤§å°ç›¸åŒçš„åç«¯å­˜å‚¨å¾ˆå®¹æ˜“é‡å¤åˆ©ç”¨ã€‚</li>\n</ul>\n<p><img src=\"./tiles.png\" alt=\"\"></p>\n<h2 id=\"æµç•…åŠ¨ç”»\"><a href=\"#æµç•…åŠ¨ç”»\" class=\"headerlink\" title=\"æµç•…åŠ¨ç”»\"></a>æµç•…åŠ¨ç”»</h2><p>ç½‘é¡µåŠ è½½åï¼Œç»˜åˆ¶æ–°çš„æ¯ä¸€å¸§ï¼Œä¸€èˆ¬éƒ½éœ€è¦ç»è¿‡è®¡ç®—å¸ƒå±€(layout)ã€ç»˜å›¾(paint)ã€åˆæˆï¼ˆcompositeï¼‰ä¸‰é˜¶æ®µã€‚å› æ­¤è¦æƒ³æé«˜é¡µé¢æ€§èƒ½ï¼ˆæˆ–FPSï¼‰ï¼Œéœ€è¦å‡å°‘æ¯ä¸€å¸§çš„æ—¶é—´ã€‚è€Œåœ¨è¿™ä¸‰ä¸ªé˜¶æ®µä¸­ï¼Œlayoutå’Œpaintæ¯”è¾ƒè€—æ—¶é—´ï¼Œè€Œåˆæˆéœ€è¦çš„æ—¶é—´ç›¸å¯¹è¾ƒå°‘ä¸€äº›ã€‚</p>\n<h4 id=\"layout\"><a href=\"#layout\" class=\"headerlink\" title=\"layout\"></a>layout</h4><p>å¦‚æœä¿®æ”¹ä¸€ä¸ªDOMå…ƒç´ çš„â€layoutâ€å±æ€§ï¼Œä¹Ÿå°±æ˜¯æ”¹å˜äº†å…ƒç´ çš„æ ·å¼ï¼ˆæ¯”å¦‚å®½åº¦ã€é«˜åº¦æˆ–è€…ä½ç½®ç­‰ï¼‰ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šæ£€æŸ¥å“ªäº›å…ƒç´ éœ€è¦é‡æ–°å¸ƒå±€ï¼Œç„¶åå¯¹é¡µé¢æ¿€å‘ä¸€ä¸ªreflowè¿‡ç¨‹å®Œæˆé‡æ–°å¸ƒå±€ã€‚è¢«reflowçš„å…ƒç´ ï¼Œæ¥ä¸‹æ¥ä¹Ÿä¼šæ¿€å‘ç»˜åˆ¶è¿‡ç¨‹ï¼Œæœ€åæ¿€å‘æ¸²æŸ“å±‚åˆå¹¶è¿‡ç¨‹ï¼Œç”Ÿæˆæœ€åçš„ç”»é¢ã€‚<br><img src=\"https://developers.google.com/web/fundamentals/performance/rendering/images/intro/frame-full.jpg\" alt=\"\"></p>\n<h4 id=\"paint\"><a href=\"#paint\" class=\"headerlink\" title=\"paint\"></a>paint</h4><p>å¦‚æœä¿®æ”¹äº†â€œpaint onlyâ€å±æ€§ï¼ˆä¾‹å¦‚èƒŒæ™¯å›¾ç‰‡ã€æ–‡å­—é¢œè‰²æˆ–é˜´å½±ç­‰ï¼‰ï¼Œå³ä¸ä¼šå½±å“é¡µé¢å¸ƒå±€çš„å±æ€§ï¼Œåˆ™æµè§ˆå™¨ä¼šè·³è¿‡å¸ƒå±€ï¼Œä½†ä»å°†æ‰§è¡Œç»˜åˆ¶ã€‚<br><img src=\"https://developers.google.com/web/fundamentals/performance/rendering/images/intro/frame-no-layout.jpg\" alt=\"\"></p>\n<h4 id=\"composite\"><a href=\"#composite\" class=\"headerlink\" title=\"composite\"></a>composite</h4><p>å¦‚æœæ›´æ”¹äº†ä¸€ä¸ªæ—¢ä¸è¦å¸ƒå±€ä¹Ÿä¸è¦ç»˜åˆ¶çš„å±æ€§ï¼Œåˆ™æµè§ˆå™¨å°†è·³åˆ°åªæ‰§è¡Œåˆæˆã€‚è¿™ä¸ªæœ€åçš„ç‰ˆæœ¬å¼€é”€æœ€å°ï¼Œæœ€é€‚åˆäºåº”ç”¨ç”Ÿå‘½å‘¨æœŸä¸­çš„é«˜å‹åŠ›ç‚¹ï¼Œä¾‹å¦‚åŠ¨ç”»æˆ–æ»šåŠ¨ã€‚</p>\n<p><img src=\"https://developers.google.com/web/fundamentals/performance/rendering/images/intro/frame-no-layout-paint.jpg\" alt=\"\"></p>\n<p><strong>å¦‚æœæƒ³çŸ¥é“æ›´æ”¹ä»»ä½•æŒ‡å®šCSSå±æ€§å°†è§¦å‘layoutã€paintã€compositeä¸­çš„å“ªä¸€ä¸ªï¼Œè¯·æŸ¥çœ‹<a href=\"https://csstriggers.com/\" target=\"_blank\" rel=\"external\">CSSè§¦å‘å™¨</a>ã€‚</strong></p>\n<h4 id=\"ä¼˜åŒ–\"><a href=\"#ä¼˜åŒ–\" class=\"headerlink\" title=\"ä¼˜åŒ–\"></a>ä¼˜åŒ–</h4><p>å¯ä»¥é€šè¿‡ä»€ä¹ˆé€”å¾„è¿›è¡Œä¼˜åŒ–ï¼Œå‡å°‘æ¯ä¸€å¸§çš„æ—¶é—´ï¼ˆé¿å…è¿‡å¤šlayoutæˆ–paintï¼‰ï¼š</p>\n<ul>\n<li>ä½¿ç”¨é€‚åˆçš„ç½‘é¡µåˆ†å±‚æŠ€æœ¯å‡å°‘layoutå’Œpaintã€‚ä¸€æ—¦æœ‰è¯·æ±‚æ›´æ–°ï¼Œå¦‚æœæ²¡æœ‰åˆ†å±‚ï¼Œæ¸²æŸ“å¼•æ“å¯èƒ½éœ€è¦é‡æ–°ç»˜åˆ¶æ‰€æœ‰åŒºåŸŸï¼Œå› ä¸ºè®¡ç®—æ›´æ–°éƒ¨åˆ†å¯¹GPUæ¥è¯´å¯èƒ½æ¶ˆè€—æ›´å¤šçš„æ—¶é—´ã€‚è€Œç½‘é¡µåˆ†å±‚ä¹‹åï¼Œéƒ¨åˆ†åŒºåŸŸçš„æ›´æ–°å¯èƒ½åªåœ¨ç½‘é¡µçš„ä¸€å±‚æˆ–å‡ å±‚ï¼Œè€Œä¸éœ€è¦å°†æ•´ä¸ªç½‘é¡µé‡æ–°ç»˜åˆ¶ã€‚é€šè¿‡é‡æ–°ç»˜åˆ¶ç½‘é¡µçš„ä¸€å±‚æˆ–å‡ å±‚ï¼Œå¹¶å°†å®ƒä»¬å’Œå…¶ä»–ä¹‹å‰ç»˜åˆ¶å®Œçš„å±‚åˆå¹¶èµ·æ¥ï¼Œæ—¢èƒ½ä½¿ç”¨GPUçš„èƒ½åŠ›ï¼Œåˆèƒ½å¤Ÿå‡å°‘é‡ç»˜çš„å¼€é”€ã€‚</li>\n<li><p>ä½¿ç”¨åˆæˆå±æ€§æ ·å¼ï¼ˆopcityã€tansformï¼‰æ¥å®Œæˆtansitionæˆ–animationã€‚å½“åˆæˆå™¨åˆæˆæ—¶å€™ï¼Œæ¯ä¸ªåˆæˆå±‚éƒ½å¯ä»¥è®¾ç½®å˜å½¢å±æ€§ï¼šä½ç§»ï¼ˆTranslateï¼‰ã€ç¼©æ”¾ï¼ˆScaleï¼‰ã€æ—‹è½¬ï¼ˆRotationï¼‰ã€opacityï¼Œè¿™äº›å±æ€§ä»…ä»…æ”¹å˜åˆæˆå±‚çš„å˜æ¢å‚æ•°ï¼Œè€Œä¸éœ€è¦layoutå’Œpaintæ“ä½œï¼Œæå¤§åœ°å‡å°‘æ¯ä¸€å¸§çš„æ¸²æŸ“æ—¶é—´ã€‚</p>\n<p>å³ä½¿ç”¨GPUç¡¬ä»¶åŠ é€Ÿï¼Œä¸ºæŸäº›RenderLayeråˆ›å»ºå¯¹åº”GraphicsLayerã€‚é€šè¿‡ä¸ºæ¯ä¸€ä¸ªåˆæˆå±‚è®¾ç½®å˜å½¢å±æ€§æ¥å®Œæˆtansitionæˆ–animationï¼Œæœ‰æ•ˆåœ°é¿å…relayoutå’Œrepaintçš„å¼€é”€ã€‚</p>\n<p><img src=\"https://www.html5rocks.com/zh/tutorials/speed/high-performance-animations/cheap-operations.jpg\" alt=\"\"></p>\n</li>\n</ul>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>æœ¬æ–‡æ˜¯ç”±å‡ ç¯‡å…³äºæµè§ˆå™¨æ¸²æŸ“çš„æ–‡ç« ç»„åˆè€Œæˆï¼Œå¯èƒ½æœ‰äº›æ¦‚å¿µæ¯”è¾ƒæŠ½è±¡ï¼Œä¸å¥½ç†è§£ï¼Œå¯ä»¥æŸ¥çœ‹<strong>å‚è€ƒæ–‡ç« </strong>å°èŠ‚ï¼Œè·å–æ›´å¤šä¿¡æ¯ã€‚æœ¬æ–‡é‡ç‚¹ä»‹ç»äº†æµè§ˆå™¨æ¸²æŸ“å¼•æ“çš„æ¸²æŸ“è¿‡ç¨‹ï¼Œæ¶‰åŠäº†DOMæ ‘ã€CSSOMæ ‘ã€RenderObjectæ ‘ã€RenderLayeræ ‘ã€GraphicsLayeræ ‘ã€‚å¹¶å¯¹å„ç§æ¸²æŸ“æ¨¡å¼è¿›è¡Œäº†ç®€å•ä»‹ç»ï¼Œå…¶ä¸­å¼•å…¥äº†ç¡¬ä»¶åŠ é€Ÿæœºåˆ¶ï¼Œè¿˜ç»™å‡ºä¸€äº›ä¼˜åŒ–å»ºè®®ã€‚äº†è§£è¿™äº›çŸ¥è¯†ç‚¹å¯¹æˆ‘ä»¬å¼€å‘é«˜æ€§èƒ½çš„webåº”ç”¨ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚</p>\n<h2 id=\"å‚è€ƒæ–‡ç« ï¼š\"><a href=\"#å‚è€ƒæ–‡ç« ï¼š\" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« ï¼š\"></a>å‚è€ƒæ–‡ç« ï¼š</h2><ul>\n<li><a href=\"http://www.chromium.org/developers/design-documents/gpu-accelerated-compositing-in-chrome\" target=\"_blank\" rel=\"external\">GPU Accelerated Compositing in Chrome</a></li>\n<li><a href=\"https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/\" target=\"_blank\" rel=\"external\">æµè§ˆå™¨çš„å·¥ä½œåŸç†ï¼šæ–°å¼ç½‘ç»œæµè§ˆå™¨å¹•åæ­ç§˜</a></li>\n<li><a href=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/constructing-the-object-model?hl=zh-cn\" target=\"_blank\" rel=\"external\">æ„å»ºå¯¹è±¡æ¨¡å‹</a></li>\n<li><a href=\"https://rogeryi.wordpress.com/2014/04/16/how-rendering-work-in-webkit-and-blink/\" target=\"_blank\" rel=\"external\">How Rendering Work (in WebKit and Blink)</a></li>\n<li><a href=\"http://blog.csdn.net/milado_nju\" target=\"_blank\" rel=\"external\">WebKitæŠ€æœ¯å†…å¹•</a></li>\n<li><a href=\"https://developers.google.com/web/fundamentals/performance/rendering/\" target=\"_blank\" rel=\"external\">æ¸²æŸ“æ€§èƒ½</a></li>\n<li><a href=\"https://www.html5rocks.com/zh/tutorials/speed/high-performance-animations/\" target=\"_blank\" rel=\"external\">High Performance Animations</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p>è¦ç¼–å†™é«˜æ€§èƒ½çš„ç½‘ç«™å’Œåº”ç”¨ï¼Œé™¤äº†ç¡®ä¿ç¼–å†™çš„ä»£ç èƒ½é«˜æ•ˆåœ°è¿è¡Œå¤–ï¼Œè¿˜éœ€è¦äº†è§£æµè§ˆå™¨æ˜¯å¦‚ä½•è¿›è¡Œæ¸²æŸ“å·¥ä½œçš„ã€‚</p>\n<h2 id=\"æµè§ˆå™¨ä¸»è¦ç»„æˆç»“æ„\"><a href=\"#æµè§ˆå™¨ä¸»è¦ç»„æˆç»“æ„\" class=\"headerlink\" title=\"æµè§ˆå™¨ä¸»è¦ç»„æˆç»“æ„\"></a>æµè§ˆå™¨ä¸»è¦ç»„æˆç»“æ„</h2><p><img src=\"https://skmukhiya.files.wordpress.com/2013/06/fb76d-layers-pagespeed-ce-mfe5f8ctav.png\" alt=\"\"></p>\n<ol>\n<li>ç”¨æˆ·ç•Œé¢(User Interface)ï¼šåŒ…æ‹¬åœ°å€æ ã€å‰è¿›/åé€€æŒ‰é’®ã€ä¹¦ç­¾èœå•ç­‰ã€‚é™¤äº†æµè§ˆå™¨ä¸»çª—å£æ˜¾ç¤ºçš„æ‚¨è¯·æ±‚çš„é¡µé¢å¤–ï¼Œå…¶ä»–æ˜¾ç¤ºçš„å„ä¸ªéƒ¨åˆ†éƒ½å±äºç”¨æˆ·ç•Œé¢ã€‚</li>\n<li>æµè§ˆå™¨å¼•æ“(Browser engine)ï¼šåœ¨ç”¨æˆ·ç•Œé¢(User Interface)å’Œæ¸²æŸ“å¼•æ“(Rendering engine)ä¹‹é—´ä¼ é€æŒ‡ä»¤ã€‚</li>\n<li>æ¸²æŸ“å¼•æ“(Rendering engine)ï¼šè´Ÿè´£æ˜¾ç¤ºè¯·æ±‚çš„å†…å®¹ã€‚å¦‚æœè¯·æ±‚çš„å†…å®¹æ˜¯HTMLï¼Œå®ƒå°±è´Ÿè´£è§£æHTMLå’ŒCSSå†…å®¹ï¼Œå¹¶å°†è§£æåçš„å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚</li>\n<li>ç½‘ç»œ(Networking)ï¼šç”¨äºç½‘ç»œè°ƒç”¨ï¼Œæ¯”å¦‚HTTPè¯·æ±‚ã€‚å…¶æ¥å£ä¸å¹³å°æ— å…³ï¼Œå¹¶ä¸ºæ‰€æœ‰å¹³å°æä¾›åº•å±‚å®ç°ã€‚</li>\n<li>JavaScriptè§£é‡Šå™¨(JavaScript Interperter)ï¼šç”¨äºè§£æå’Œæ‰§è¡ŒJavaScriptä»£ç ã€‚</li>\n<li>ç”¨æˆ·ç•Œé¢åç«¯(UI Backend)ï¼šç”¨äºç»˜åˆ¶åŸºæœ¬çš„çª—å£å°éƒ¨ä»¶ï¼Œæ¯”å¦‚ç»„åˆæ¡†å’Œçª—å£ã€‚å…¶å…¬å¼€äº†ä¸å¹³å°æ— å…³çš„é€šç”¨æ¥å£ï¼Œè€Œåœ¨åº•å±‚ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ç”¨æˆ·ç•Œé¢æ–¹æ³•ã€‚</li>\n<li>æ•°æ®å­˜å‚¨(Data storage)ï¼šè¿™æ˜¯æŒä¹…å±‚ã€‚æµè§ˆå™¨éœ€è¦åœ¨ç¡¬ç›˜ä¸Šä¿å­˜å„ç§æ•°æ®ï¼Œä¾‹å¦‚Cookiesã€‚æµè§ˆå™¨è¿˜æ”¯æŒè¯¸å¦‚localStorageï¼ŒIndexedDBï¼ŒWebSQLå’ŒFileSystemä¹‹ç±»çš„å­˜å‚¨æœºåˆ¶ã€‚</li>\n</ol>\n<h2 id=\"æ–‡æ¡£å¯¹è±¡æ¨¡å‹-DOMï¼šDocument-Object-Modelï¼‰\"><a href=\"#æ–‡æ¡£å¯¹è±¡æ¨¡å‹-DOMï¼šDocument-Object-Modelï¼‰\" class=\"headerlink\" title=\"æ–‡æ¡£å¯¹è±¡æ¨¡å‹(DOMï¼šDocument Object Modelï¼‰\"></a>æ–‡æ¡£å¯¹è±¡æ¨¡å‹(DOMï¼šDocument Object Modelï¼‰</h2><p>æœ¬æ–‡ä¸»è¦ä»‹ç»æµè§ˆå™¨çš„æ¸²æŸ“ï¼Œå³æ¸²æŸ“å¼•æ“(Rendering engine)è´Ÿè´£çš„å·¥ä½œ: å°†è¯·æ±‚çš„HTMLå†…å®¹è§£æå¹¶æ¸²æŸ“åœ¨å±å¹•ä¸Šã€‚<br>å¦‚ä¸‹HTMLç»“æ„ï¼Œä¸€ä¸ªåŒ…å«ä¸€äº›æ–‡æœ¬å’Œä¸€å¼ å›¾ç‰‡ï¼š<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width,initial-scale=1\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">href</span>=<span class=\"string\">\"style.css\"</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Critical Path<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Hello <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>web performance<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span> students!<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"awesome-photo.jpg\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>æµè§ˆå™¨æ˜¯å¦‚ä½•å¤„ç†è¿™ä¸ªHTMLé¡µé¢ï¼š</p>\n<p>\b<img src=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/full-process.png\" alt=\"\"></p>\n<ol>\n<li>è½¬æ¢(Conversion)ï¼šæµè§ˆå™¨ä»ç£ç›˜æˆ–ç½‘ç»œè¯»å–HTMLçš„åŸå§‹å­—èŠ‚ç ï¼Œå¹¶æ ¹æ®æ–‡ä»¶çš„æŒ‡å®šç¼–ç ï¼ˆä¾‹å¦‚ UTF-8ï¼‰å°†å®ƒä»¬è½¬æ¢æˆå¯¹åº”çš„å­—ç¬¦ã€‚</li>\n<li>ä»¤ç‰ŒåŒ–(Tokenizing)ï¼šæµè§ˆå™¨å°†å­—ç¬¦ä¸²è½¬æ¢æˆ<a href=\"http://www.w3.org/TR/html5/\" target=\"_blank\" rel=\"external\">W3C HTML5æ ‡å‡†</a>è§„å®šçš„å„ç§ä»¤ç‰Œï¼Œä¾‹å¦‚<code>&lt;html&gt;</code>ã€<code>&lt;body&gt;</code>ï¼Œä»¥åŠå…¶ä»–å°–æ‹¬å·å†…çš„å­—ç¬¦ä¸²ã€‚æ¯ä¸ªä»¤ç‰Œéƒ½å…·æœ‰ç‰¹æ®Šå«ä¹‰å’Œä¸€ç»„è§„åˆ™ã€‚</li>\n<li>è¯æ³•åˆ†æ(Lexing)ï¼šå‘å‡ºçš„ä»¤ç‰Œè½¬æ¢æˆå®šä¹‰å…¶å±æ€§å’Œè§„åˆ™çš„â€œå¯¹è±¡â€ã€‚</li>\n<li>DOMæ„å»º(DOM construction)ï¼šHTMLæ ‡è®°å®šä¹‰ä¸åŒæ ‡è®°ä¹‹é—´çš„å…³ç³»ï¼ˆä¸€äº›æ ‡è®°åŒ…å«åœ¨å…¶ä»–æ ‡è®°å†…ï¼‰ï¼Œåˆ›å»ºçš„å¯¹è±¡é“¾æ¥åœ¨ä¸€ä¸ªæ ‘æ•°æ®ç»“æ„å†…ï¼Œæ­¤ç»“æ„ä¹Ÿä¼šæ•è·åŸå§‹æ ‡è®°ä¸­å®šä¹‰çš„çˆ¶é¡¹-å­é¡¹å…³ç³»ï¼šHTMLå¯¹è±¡æ˜¯bodyå¯¹è±¡çš„çˆ¶é¡¹ï¼Œbodyæ˜¯paragraphå¯¹è±¡çš„çˆ¶é¡¹ï¼Œä¾æ­¤ç±»æ¨ã€‚</li>\n</ol>\n<p>æ•´ä¸ªè¿‡ç¨‹çš„æœ€ç»ˆè¾“å‡ºæ˜¯HTMLé¡µé¢çš„æ–‡æ¡£å¯¹è±¡æ¨¡å‹ (DOM)ï¼Œæµè§ˆå™¨å¯¹é¡µé¢è¿›è¡Œçš„æ‰€æœ‰è¿›ä¸€æ­¥å¤„ç†éƒ½ä¼šç”¨åˆ°å®ƒã€‚æµè§ˆå™¨æ¯æ¬¡å¤„ç†HTMLæ ‡è®°æ—¶ï¼Œéƒ½ä¼šå®Œæˆä»¥ä¸Šæ‰€æœ‰æ­¥éª¤ï¼šå°†å­—èŠ‚è½¬æ¢æˆå­—ç¬¦ï¼Œç¡®å®šä»¤ç‰Œï¼Œå°†ä»¤ç‰Œè½¬æ¢æˆèŠ‚ç‚¹ï¼Œç„¶åæ„å»ºDOMæ ‘ã€‚DOMæ ‘æ•è·æ–‡æ¡£æ ‡è®°çš„å±æ€§å’Œå…³ç³»ï¼Œä½†å¹¶æœªå¤„ç†å…ƒç´ åœ¨æ¸²æŸ“åå‘ˆç°çš„å¤–è§‚ã€‚é‚£æ˜¯CSSOMçš„è´£ä»»ã€‚</p>\n<h2 id=\"CSSå¯¹è±¡æ¨¡å‹-CSSOMï¼šCSS-Object-Model\"><a href=\"#CSSå¯¹è±¡æ¨¡å‹-CSSOMï¼šCSS-Object-Model\" class=\"headerlink\" title=\"CSSå¯¹è±¡æ¨¡å‹(CSSOMï¼šCSS Object Model)\"></a>CSSå¯¹è±¡æ¨¡å‹(CSSOMï¼šCSS Object Model)</h2><p>åœ¨æµè§ˆå™¨æ„å»ºDOMé‡åˆ°linkæ ‡è®°æ—¶ï¼Œè¯¥æ ‡è®°å¼•ç”¨ä¸€ä¸ªå¤–éƒ¨CSSæ ·å¼è¡¨ï¼šstyle.cssã€‚ç”±äºé¢„è§åˆ°éœ€è¦åˆ©ç”¨è¯¥èµ„æºæ¥æ¸²æŸ“é¡µé¢ï¼Œå®ƒä¼šç«‹å³å‘å‡ºå¯¹è¯¥èµ„æºçš„è¯·æ±‚ï¼Œå¹¶è¿”å›ä»¥ä¸‹å†…å®¹ï¼š</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">body</span> &#123; <span class=\"attribute\">font-size</span>: <span class=\"number\">16px</span> &#125;</div><div class=\"line\"><span class=\"selector-tag\">p</span> &#123; <span class=\"attribute\">font-weight</span>: bold &#125;</div><div class=\"line\"><span class=\"selector-tag\">span</span> &#123; <span class=\"attribute\">color</span>: red &#125;</div><div class=\"line\"><span class=\"selector-tag\">p</span> <span class=\"selector-tag\">span</span> &#123; <span class=\"attribute\">display</span>: none &#125;</div><div class=\"line\"><span class=\"selector-tag\">img</span> &#123; <span class=\"attribute\">float</span>: right &#125;</div></pre></td></tr></table></figure>\n<p>ä¸å¤„ç†HTMLæ—¶ç±»ä¼¼ï¼Œéœ€è¦å°†æ”¶åˆ°çš„CSSè§„åˆ™è½¬æ¢æˆæŸç§æµè§ˆå™¨èƒ½å¤Ÿç†è§£å’Œå¤„ç†çš„ä¸œè¥¿ã€‚å› æ­¤ä¼šé‡å¤HTMLè¿‡ç¨‹ï¼Œä¸è¿‡æ˜¯ä¸ºCSSè€Œä¸æ˜¯HTMLï¼š</p>\n<p><img src=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/cssom-construction.png?hl=zh-cn\" alt=\"\"></p>\n<p>CSSå­—èŠ‚è½¬æ¢æˆå­—ç¬¦ï¼Œæ¥ç€è½¬æ¢æˆä»¤ç‰Œå’ŒèŠ‚ç‚¹ï¼Œæœ€åé“¾æ¥åˆ°CSSOMæ ‘ç»“æ„å†…ï¼š</p>\n<p><img src=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/cssom-tree.png\" alt=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/cssom-tree.png\"></p>\n<p>CSSOMä¸ºä½•å…·æœ‰æ ‘ç»“æ„ï¼Ÿç”¨äºç¡®å®šèŠ‚ç‚¹å¯¹è±¡çš„è®¡ç®—æ ·å¼ã€‚å¦‚spanæ ‡è®°åŒ…å«äº†<code>color:red</code>æ ·å¼å’Œç»§æ‰¿äºbodyæ ‡è®°çš„<code>font-size:16px</code>æ ·å¼;</p>\n<p><u>æ³¨æ„ï¼šä»¥ä¸Šæ ‘å¹¶éå®Œæ•´çš„CSSOMæ ‘ï¼Œå®ƒåªæ˜¯æ›¿ä»£é»˜è®¤æ ·å¼çš„è‡ªå®šä¹‰æ ·å¼ã€‚æ¯ä¸ªæµè§ˆå™¨éƒ½æä¾›ä¸€ç»„é»˜è®¤æ ·å¼ï¼ˆä¹Ÿç§°ä¸ºâ€œUser Agent æ ·å¼â€ï¼‰ï¼Œå³ä¸æä¾›ä»»ä½•è‡ªå®šä¹‰æ ·å¼æ—¶æ‰€çœ‹åˆ°çš„æ ·å¼ï¼Œè‡ªå®šä¹‰æ ·å¼åªæ˜¯æ›¿æ¢è¿™äº›é»˜è®¤æ ·å¼</u></p>\n<p>CSSOMæ˜¯åœ¨DOMä¸­çš„ä¸€äº›æ¥å£ä¸­ï¼ŒåŠ å…¥è·å–å’Œæ“ä½œCSSå±æ€§æˆ–æ¥å£çš„JavaScriptæ¥å£ï¼Œå› è€ŒJavaScriptå¯ä»¥åŠ¨æ€æ“ä½œCSSæ ·å¼ã€‚DOMæä¾›äº†æ¥å£è®©JavaScriptä¿®æ”¹HTMLæ–‡æ¡£ï¼ŒCSSOMæä¾›äº†æ¥å£è®©JavaScriptè·å¾—å’Œä¿®æ”¹CSSä»£ç è®¾ç½®çš„æ ·å¼ä¿¡æ¯ã€‚</p>\n<h2 id=\"æ¸²æŸ“æ ‘-RenderObject-treeï¼Œä¹Ÿç§°ä¸ºRender-tree\"><a href=\"#æ¸²æŸ“æ ‘-RenderObject-treeï¼Œä¹Ÿç§°ä¸ºRender-tree\" class=\"headerlink\" title=\"æ¸²æŸ“æ ‘(RenderObject treeï¼Œä¹Ÿç§°ä¸ºRender tree)\"></a>æ¸²æŸ“æ ‘(RenderObject treeï¼Œä¹Ÿç§°ä¸ºRender tree)</h2><p>åœ¨DOMæ ‘ä¸­ï¼Œå­˜åœ¨ä¸å¯è§ä¸å¯è§èŠ‚ç‚¹ä¹‹åˆ†ã€‚é¡¾åæ€ä¹‰ï¼Œä¸å¯è§èŠ‚ç‚¹æ˜¯ä¸éœ€è¦ç»˜åˆ¶æœ€ç»ˆé¡µé¢ä¸­çš„èŠ‚ç‚¹ï¼Œå¦‚<code>meta</code>ã€<code>head</code>ã€<code>script</code>ç­‰ï¼Œä»¥åŠé€šè¿‡CSSæ ·å¼<code>display:none</code>éšè—çš„èŠ‚ç‚¹ã€‚ç›¸åå¯è§èŠ‚ç‚¹æ˜¯ç”¨æˆ·å¯è§çš„ï¼Œå¦‚<code>body</code>ã€<code>div</code>ã€<code>span</code>ã€<code>canvas</code>ã€<code>img</code>ç­‰ã€‚<br>å¯¹äºè¿™äº›å¯è§èŠ‚ç‚¹ï¼Œæµè§ˆå™¨éœ€è¦å°†å®ƒä»¬çš„å†…å®¹ç»˜åˆ¶åˆ°æœ€ç»ˆçš„é¡µé¢ä¸­ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¼šä¸ºå®ƒä»¬å»ºç«‹å¯¹åº”çš„RenderObjectå¯¹è±¡ã€‚ä¸€ä¸ªRenderObjectå¯¹è±¡ä¿å­˜äº†ä¸ºç»˜åˆ¶DOMèŠ‚ç‚¹çš„å„ç§ä¿¡æ¯ã€‚è¿™äº›RenderObjectå¯¹è±¡ä¸DOMå¯¹è±¡ç±»ä¼¼ï¼Œä¹Ÿæ„æˆä¸€æ£µæ ‘ï¼Œç§°ä¸º<strong>RenderObject tree</strong>ã€‚RenderObjectæ ‘æ˜¯åŸºäºDOMæ ‘å»ºç«‹èµ·æ¥çš„ä¸€æ£µæ–°æ ‘ï¼Œæ˜¯ä¸ºäº†å¸ƒå±€è®¡ç®—å’Œæ¸²æŸ“ç­‰æœºåˆ¶è€Œæ„å»ºçš„ä¸€ç§æ–°çš„å†…éƒ¨è¡¨ç¤ºã€‚RenderObjectæ ‘èŠ‚ç‚¹ä¸DOMæ ‘èŠ‚ç‚¹ä¸æ˜¯ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚å› ä¸ºåˆ›å»ºä¸€ä¸ªRenderObjectå¯¹è±¡éœ€è¦æ»¡è¶³å¦‚ä¸‹è§„åˆ™ï¼š</p>\n<ul>\n<li>DOMæ ‘çš„documentèŠ‚ç‚¹</li>\n<li>DOMæ ‘ä¸­çš„å¯è§èŠ‚ç‚¹ï¼Œå¦‚<code>html</code>ã€<code>body</code>ã€<code>div</code>ç­‰ã€‚è€Œæµè§ˆå™¨ä¸ä¼šä¸ºä¸å¯è§èŠ‚ç‚¹åˆ›å»ºRenderObjectèŠ‚ç‚¹ã€‚</li>\n<li>æŸäº›æƒ…å†µä¸‹æµè§ˆå™¨éœ€è¦åˆ›å»ºåŒ¿åçš„RenderObjectèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¸å¯¹åº”DOMæ ‘ä¸­çš„ä»»ä½•èŠ‚ç‚¹ã€‚</li>\n</ul>\n<p>RenderObjectå¯¹è±¡æ„æˆäº†RenderObjectæ ‘ï¼Œæ¯ä¸ªRenderObjectå¯¹è±¡ä¿å­˜äº†ä¸ºç»˜åˆ¶DOMèŠ‚ç‚¹çš„è®¡ç®—æ ·å¼ã€‚RenderObjectæ ‘ä¹Ÿå¯ä»¥ç†è§£æˆç”±CSSOMæ ‘å’ŒDOMæ ‘åˆå¹¶æˆï¼š</p>\n<p><img src=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/render-tree-construction.png?hl=zh-cn\" alt=\"\"></p>\n<h2 id=\"å¸ƒå±€-loayout\"><a href=\"#å¸ƒå±€-loayout\" class=\"headerlink\" title=\"å¸ƒå±€(loayout)\"></a>å¸ƒå±€(loayout)</h2><p>å½“æµè§ˆå™¨åˆ›å»ºRenderObjectå¯¹è±¡ä¹‹åï¼Œæ¯ä¸ªå¯¹è±¡å¹¶ä¸çŸ¥é“è‡ªå·±åœ¨è®¾å¤‡è§†å£å†…çš„ä½ç½®ã€å¤§å°ç­‰ä¿¡æ¯ã€‚æµè§ˆå™¨æ ¹æ®<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Box_Model\" target=\"_blank\" rel=\"external\">ç›’æ¨¡å‹(Box-model)</a>æ¥è®¡ç®—å®ƒä»¬çš„ä½ç½®ã€å¤§å°ç­‰ä¿¡æ¯çš„è¿‡ç¨‹ç§°ä¸ºå¸ƒå±€è®¡ç®—ï¼ˆé‡æ’ï¼‰ã€‚<br>å¸ƒå±€è®¡ç®—æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œè¿™æ˜¯å› ä¸ºä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°é€šå¸¸éœ€è¦å…ˆè®¡ç®—å®ƒçš„å­©å­èŠ‚ç‚¹çš„ä½ç½®ã€å¤§å°ç­‰ä¿¡æ¯ã€‚ä¸ºäº†è®¡ç®—èŠ‚ç‚¹åœ¨é¡µé¢ä¸­çš„ç¡®åˆ‡å¤§å°å’Œä½ç½®ï¼Œæµè§ˆå™¨ä¼šä»RenderObjectæ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹è¿›è¡Œéå†ã€‚</p>\n<p>å®ä¾‹ï¼š<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width,initial-scale=1\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Critial Path: Hello world!<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 50%\"</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 50%\"</span>&gt;</span>Hello world!<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>é¡µé¢åŒ…å«äº†ä¸¤ä¸ªåµŒå¥—divï¼šçˆ¶divå°†å…¶çš„æ˜¾ç¤ºå°ºå¯¸è®¾ç½®ä¸ºè§†å£å®½åº¦çš„50%ï¼Œå­divå°†å…¶å®½åº¦è®¾ç½®ä¸ºå…¶çˆ¶é¡¹çš„50%ï¼Œå³è§†å£å®½åº¦çš„25%ã€‚</p>\n<p><img src=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/layout-viewport.png?hl=zh-cn\" alt=\"\"></p>\n<h2 id=\"RenderLayeræ ‘-RenderLayer-tree\"><a href=\"#RenderLayeræ ‘-RenderLayer-tree\" class=\"headerlink\" title=\"RenderLayeræ ‘(RenderLayer tree)\"></a>RenderLayeræ ‘(RenderLayer tree)</h2><p>æµè§ˆå™¨æ¸²æŸ“å¼•æ“å¹¶ä¸æ˜¯ç›´æ¥ä½¿ç”¨RenderObjectæ ‘è¿›è¡Œç»˜åˆ¶ï¼Œä¸ºäº†æ–¹ä¾¿å¤„ç†Positioning(å®šä½)ï¼ŒClipping(è£å‰ª)ï¼ŒOverflow-scroll(é¡µå…§æ»šåŠ¨)ï¼ŒCSS Transform/Opacity/Animation/Filterï¼ŒMask or Reflectionï¼ŒZ-indexing(Zæ’åº)ç­‰ï¼Œæµè§ˆå™¨éœ€è¦ä¼šä¸ºä¸€äº›ç‰¹å®šçš„RenderObjectç”Ÿæˆå¯¹åº”çš„RenderLayerï¼Œå¹¶ç”Ÿæˆä¸€æ£µå¯¹åº”çš„RenderLayeræ ‘ã€‚è€Œè¿™äº›ç‰¹å®šçš„RenderObjectè·Ÿå¯¹åº”çš„RenderLayerå°±æ˜¯ç›´å±çš„å…³ç³»ï¼Œå¦‚æœå®ƒä»¬çš„å­èŠ‚ç‚¹å¦‚æœæ²¡æœ‰å¯¹åº”çš„RenderLayerï¼Œå°±ä»å±äºçˆ¶èŠ‚ç‚¹çš„RenderLayerã€‚æœ€ç»ˆï¼Œæ¯ä¸€ä¸ªRenderObjectéƒ½ä¼šç›´æ¥æˆ–è€…é—´æ¥åœ°ä»å±äºä¸€ä¸ªRenderLayerã€‚å› æ­¤RenderObjectèŠ‚ç‚¹ä¸RenderLayerèŠ‚ç‚¹ä¸æ˜¯ä¸€ä¸€å¯¹åº”å…³ç³»ï¼Œè€Œæ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚é‚£éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Œæ¸²æŸ“å¼•æ“æ‰ä¸ºRenderObjectå»ºç«‹å¯¹åº”çš„RenderLayerï¼š</p>\n<ul>\n<li>Itâ€™s the root object for the page</li>\n<li>It has explicit CSS position properties (relative, absolute or a transform)</li>\n<li>It is transparent</li>\n<li>Has overflow, an alpha mask or reflection</li>\n<li>Has a CSS filter</li>\n<li>Corresponds to <code>&lt;canvas&gt;</code> element that has a 3D (WebGL) context or an accelerated 2D context</li>\n<li>Corresponds to a <code>&lt;video&gt;</code> element</li>\n</ul>\n<p>ç¿»è¯‘ï¼š</p>\n<ul>\n<li>DOMæ ‘çš„DocumentèŠ‚ç‚¹å¯¹åº”çš„RenderObjectèŠ‚ç‚¹å’ŒHTMLèŠ‚ç‚¹å¯¹åº”çš„RenderObjectèŠ‚ç‚¹</li>\n<li>æ˜¾å¼æŒ‡å®šCSS positionå±æ€§çš„RenderObjectèŠ‚ç‚¹</li>\n<li>æœ‰é€æ˜åº¦çš„RenderObjectèŠ‚ç‚¹</li>\n<li>æœ‰overflowï¼Œalphaå’Œreflectionçš„æ ·å¼RenderObjectèŠ‚ç‚¹</li>\n<li>æœ‰filteræ ·å¼çš„RenderObjectèŠ‚ç‚¹</li>\n<li>ä½¿ç”¨Canvas 2Då’Œ3D(WebGL)æŠ€æœ¯çš„RenderObjectèŠ‚ç‚¹</li>\n<li>videoå…ƒç´ å¯¹åº”çš„RenderObjectèŠ‚ç‚¹</li>\n</ul>\n<p>æ¯ä¸ªRenderLayerå¯¹è±¡å¯ä»¥æƒ³è±¡æˆå›¾åƒä¸­ä¸€ä¸ªå›¾å±‚ï¼Œå„ä¸ªå›¾å±‚å åŠ æ„æˆäº†ä¸€ä¸ªå›¾åƒã€‚æµè§ˆå™¨ä¼šéå†RenderLayeræ ‘ï¼Œå†éå†ä»å±è¿™ä¸ªRenderLayerçš„RenderObjectï¼ŒRenderObjectå¯¹è±¡å­˜å‚¨æœ‰ç»˜åˆ¶ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œç»˜åˆ¶ã€‚RenderLayerå’ŒRenderObjectå…±åŒå†³å®šäº†æœ€ç»ˆå‘ˆç°çš„ç½‘é¡µå†…å®¹ï¼ŒRenderLayeræ ‘å†³å®šäº†ç½‘é¡µçš„ç»˜åˆ¶çš„å±‚æ¬¡é¡ºåºï¼Œè€Œä»å±äºRenderLayerçš„RenderObjectå†³å®šäº†è¯¥RenderLayerçš„å†…å®¹ã€‚</p>\n<h2 id=\"æ¸²æŸ“æ–¹å¼\"><a href=\"#æ¸²æŸ“æ–¹å¼\" class=\"headerlink\" title=\"æ¸²æŸ“æ–¹å¼\"></a>æ¸²æŸ“æ–¹å¼</h2><p>åœ¨å®Œæˆæ„å»ºRenderLayeræ ‘ä¹‹åï¼Œæµè§ˆå™¨ä¼šä½¿ç”¨å›¾å½¢åº“å°†å…¶æ„å»ºçš„æ¸²æŸ“æ¨¡å‹ç»˜åˆ¶å‡ºæ¥ï¼Œè¯¥è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>\n<ul>\n<li>ç»˜åˆ¶ï¼šå°†ä»å±æ¯ä¸ªRenderLayerå›¾å±‚ä¸Šçš„RenderObjectç»˜åˆ¶åœ¨å…¶RenderLayerä¸Šã€‚å³ç»˜åˆ¶ï¼ˆPaintï¼‰æˆ–è€…å…‰æ …åŒ–ï¼ˆRasterizationï¼‰ï¼Œå°†ä¸€äº›ç»˜å›¾æŒ‡ä»¤è½¬æ¢æˆçœŸæ­£çš„åƒç´ é¢œè‰²å€¼ã€‚<ul>\n<li>è½¯ä»¶ç»˜å›¾ï¼šCPUæ¥å®Œæˆç»˜å›¾æ“ä½œ</li>\n<li>ç¡¬ä»¶åŠ é€Ÿç»˜å›¾ï¼šGPUæ¥å®Œæˆç»˜å›¾æ“ä½œ</li>\n</ul>\n</li>\n<li>åˆæˆ(compositing)ï¼šå°†å„ä¸ªRenderLayerå›¾å±‚åˆå¹¶æˆåˆ°ä¸€ä¸ªä½å›¾(Bitmap)ä¸­ã€‚åŒæ—¶è¿˜å¯èƒ½åŒ…æ‹¬ä½ç§»ï¼ˆTranslationï¼‰ï¼Œç¼©æ”¾ï¼ˆScaleï¼‰ï¼Œæ—‹è½¬ï¼ˆRotationï¼‰ï¼ŒAlpha åˆæˆç­‰æ“ä½œã€‚</li>\n</ul>\n<p>æ¸²æŸ“å¼•æ“çš„æ¸²æŸ“ï¼Œç›®å‰æœ‰ä¸‰ç§ç½‘é¡µçš„æ¸²æŸ“æ–¹å¼ï¼š</p>\n<blockquote>\n<ul>\n<li>ç¡¬ä»¶åŠ é€Ÿåˆæˆ(Accelerated Compositing)ï¼šä½¿ç”¨GPUæ¥å®Œæˆåˆæˆå·¥ä½œã€‚</li>\n<li>åˆæˆåŒ–æ¸²æŸ“ï¼šä½¿ç”¨åˆæˆ(compositing)æŠ€æœ¯çš„æ¸²æŸ“ç§°ã€‚</li>\n</ul>\n</blockquote>\n<ul>\n<li>è½¯ä»¶æ¸²æŸ“æ–¹å¼ï¼šä½¿ç”¨CPUæ¥ç»˜åˆ¶æ¯ä¸ªRenderLayerå›¾å±‚çš„å†…å®¹(RenderObject)åˆ°ä¸€ä¸ªä½å›¾ï¼Œå³ä¸€å—CPUä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚ç»˜åˆ¶æ¯ä¸€å±‚çš„æ—¶å€™éƒ½ä¼šä½¿ç”¨è¯¥ä½å›¾ï¼ŒåŒºåˆ«åœ¨äºç»˜åˆ¶çš„ä½ç½®å¯èƒ½ä¸ä¸€æ ·ï¼Œç»˜åˆ¶é¡ºåºæŒ‰ç…§ä»ååˆ°å‰ã€‚å› æ­¤è½¯ä»¶æ¸²æŸ“æœºåˆ¶æ˜¯æ²¡æœ‰åˆæˆé˜¶æ®µçš„ã€‚</li>\n<li>ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“çš„åˆæˆåŒ–æ¸²æŸ“æ–¹å¼ï¼šä½¿ç”¨GPUæ¥ç»˜åˆ¶æ‰€æœ‰åˆæˆå±‚ï¼Œå¹¶ä½¿ç”¨GPUç¡¬ä»¶æ¥åŠ é€Ÿåˆæˆã€‚</li>\n<li>è½¯ä»¶ç»˜å›¾çš„åˆæˆåŒ–æ¸²æŸ“æ–¹å¼ï¼š æŸäº›åˆæˆå±‚ä½¿ç”¨CPUæ¥ç»˜å›¾ï¼Œå¦å¤–ä¸€äº›ä½¿ç”¨GPUæ¥ç»˜åˆ¶ã€‚å¯¹äºä½¿ç”¨CPUæ¥ç»˜åˆ¶çš„å›¾å±‚ï¼Œè¯¥å±‚çš„ç»˜åˆ¶ç»“æœä¼šå…ˆä¿å­˜åœ¨CPUå†…å­˜ä¸­ï¼Œä¹‹åä¼šè¢«ä¼ è¾“åˆ°GPUå†…å­˜ä¸­ï¼Œç„¶åå†ä½¿ç”¨GPUæ¥å®Œæˆåˆæˆå·¥ä½œã€‚</li>\n</ul>\n<p><img src=\"./render.png\" alt=\"\"></p>\n<p>ç¬¬äºŒç§å’Œç¬¬ä¸‰ç§æ¸²æŸ“æ–¹å¼ï¼Œéƒ½æ˜¯ä½¿ç”¨äº†åˆæˆåŒ–æ¸²æŸ“æŠ€æœ¯ï¼Œåˆæˆå·¥ä½œä¹Ÿéƒ½æ˜¯ç”±GPUæ¥åšã€‚å¯¹äºå¸¸è§çš„2Dç»˜å›¾æ“ä½œï¼Œä½¿ç”¨GPUæ¥ç»˜å›¾ä¸ä¸€å®šæ¯”ä½¿ç”¨CPUç»˜å›¾åœ¨æ€§èƒ½ä¸Šæœ‰ä¼˜åŠ¿ï¼Œä¾‹å¦‚ç»˜åˆ¶æ–‡å­—ã€ç‚¹ã€çº¿ç­‰ï¼ŒåŸå› æ˜¯CPUçš„ä½¿ç”¨ç¼“å†²æœºåˆ¶æœ‰æ•ˆå‡å°‘äº†é‡å¤ç»˜åˆ¶çš„å¼€é”€è€Œä¸”ä¸éœ€è¦è€ƒè™‘ä¸GPUå¹¶è¡Œã€‚å¦å¤–ï¼ŒGPUçš„å†…å­˜èµ„æºç›¸å¯¹CPUçš„å†…å­˜èµ„æºæ¥è¯´æ¯”è¾ƒç´§å¼ ï¼Œè€Œä¸”ç½‘é¡µçš„åˆ†å±‚ä½¿å¾—GPUçš„å†…å­˜ä½¿ç”¨ç›¸å¯¹æ¯”è¾ƒå¤šã€‚é‰´äºæ­¤ï¼Œå°±ç›®å‰çš„æƒ…å†µæ¥çœ‹ï¼Œä¸‰è€…éƒ½å­˜åœ¨æ˜¯æœ‰å…¶åˆç†æ€§çš„ï¼Œä¸‹é¢åˆ†æä¸€ä¸‹å®ƒä»¬çš„ç‰¹ç‚¹ï¼š</p>\n<ul>\n<li>è½¯ä»¶æ¸²æŸ“æ˜¯ç›®å‰å¾ˆå¸¸è§çš„æŠ€æœ¯ï¼Œä¹Ÿæ˜¯æµè§ˆå™¨æœ€æ—©ä½¿ç”¨çš„æ¸²æŸ“æ–¹å¼ã€‚è¿™ä¸€æŠ€æœ¯æ¯”è¾ƒèŠ‚çœå†…å­˜ï¼Œç‰¹åˆ«æ˜¯å®è´µçš„GPUå†…å­˜ï¼Œä½†æ˜¯è½¯ä»¶æ¸²æŸ“åªèƒ½å¤„ç†2Dæ–¹é¢çš„æ“ä½œã€‚ç®€å•çš„ç½‘é¡µæ²¡æœ‰å¤æ‚ç»˜å›¾æˆ–è€…å¤šåª’ä½“æ–¹é¢çš„éœ€æ±‚ï¼Œè½¯ä»¶æ¸²æŸ“æ–¹å¼å°±æ¯”è¾ƒåˆé€‚æ¥æ¸²æŸ“è¯¥ç±»å‹çš„ç½‘é¡µã€‚é—®é¢˜æ˜¯ï¼Œä¸€æ—¦é‡ä¸Šäº†HTML5çš„å¾ˆå¤šæ–°æŠ€æœ¯ï¼Œè½¯ä»¶æ¸²æŸ“æ˜¾å¾—æ— èƒ½ä¸ºåŠ›ï¼Œä¸€æ˜¯å› ä¸ºèƒ½åŠ›ä¸è¶³ï¼›äºŒæ˜¯å› ä¸ºæ€§èƒ½ä¸å¥½ï¼Œä¾‹å¦‚è§†é¢‘ã€Canvas 2Dç­‰ã€‚æ‰€ä»¥ï¼Œè½¯ä»¶æ¸²æŸ“æŠ€æœ¯è¢«ç”¨çš„è¶Šæ¥è¶Šå°‘ï¼Œç‰¹åˆ«æ˜¯åœ¨ç§»åŠ¨é¢†åŸŸã€‚è½¯ä»¶æ¸²æŸ“åŒç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“å¦å¤–ä¸€ä¸ªå¾ˆä¸åŒçš„åœ°æ–¹å°±æ˜¯å¯¹æ›´æ–°åŒºåŸŸçš„å¤„ç†ã€‚å½“ç½‘é¡µä¸­æœ‰ä¸€ä¸ªæ›´æ–°å°å‹åŒºåŸŸçš„è¯·æ±‚ï¼ˆå¦‚åŠ¨ç”»ï¼‰æ—¶ï¼Œè½¯ä»¶æ¸²æŸ“å¯èƒ½åªéœ€è¦è®¡ç®—ä¸€ä¸ªæå°çš„åŒºåŸŸï¼Œè€Œç¡¬ä»¶æ¸²æŸ“å¯èƒ½éœ€è¦é‡æ–°ç»˜åˆ¶å…¶ä¸­çš„ä¸€å±‚æˆ–è€…å¤šå±‚ï¼Œç„¶åå†åˆæˆè¿™äº›å±‚ã€‚ç¡¬ä»¶æ¸²æŸ“çš„ä»£ä»·å¯èƒ½ä¼šå¤§å¾—å¤šã€‚</li>\n<li>å¯¹äºç¡¬ä»¶åŠ é€Ÿçš„åˆæˆåŒ–æ¸²æŸ“æ–¹å¼æ¥è¯´ï¼Œæ¯ä¸ªå±‚çš„ç»˜åˆ¶å’Œæ‰€æœ‰å±‚çš„åˆæˆå‡ä½¿ç”¨GPUç¡¬ä»¶æ¥å®Œæˆï¼Œè¿™å¯¹éœ€è¦ä½¿ç”¨3Dç»˜å›¾çš„æ“ä½œæ¥è¯´ç‰¹åˆ«åˆé€‚ã€‚è¿™ç§æ–¹å¼ä¸‹ï¼Œåœ¨RenderLayeræ ‘ä¹‹åï¼Œæµè§ˆå™¨è¿˜éœ€è¦å»ºç«‹æ›´å¤šçš„å†…éƒ¨è¡¨ç¤ºï¼Œç›®çš„æ˜¯æ”¯æŒç¡¬ä»¶åŠ é€Ÿæœºåˆ¶ï¼Œè¿™æ˜¾ç„¶ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜èµ„æºã€‚ä½†æ˜¯ï¼Œä¸€æ–¹é¢ï¼Œç¡¬ä»¶åŠ é€Ÿæœºåˆ¶èƒ½å¤Ÿæ”¯æŒç°åœ¨æ‰€æœ‰çš„HTML5å®šä¹‰çš„2Dæˆ–è€…3Dç»˜å›¾æ ‡å‡†ï¼›å¦ä¸€æ–¹é¢ï¼Œå…³äºæ›´æ–°åŒºåŸŸçš„è®¨è®ºï¼Œå¦‚æœéœ€è¦æ›´æ–°æŸä¸ªå±‚çš„ä¸€ä¸ªåŒºåŸŸï¼Œå› ä¸ºè½¯ä»¶æ¸²æŸ“æ²¡æœ‰ä¸ºæ¯ä¸€å±‚æä¾›åç«¯å­˜å‚¨ï¼Œå› è€Œå®ƒéœ€è¦å°†å’Œè¿™ä¸ªåŒºåŸŸæœ‰é‡å éƒ¨åˆ†çš„æ‰€æœ‰å±‚æ¬¡çš„ç›¸å…³åŒºåŸŸä¸€æ¬¡ä»åå¾€å‰é‡æ–°ç»˜åˆ¶ä¸€éï¼Œè€Œç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“åªéœ€è¦é‡æ–°ç»˜åˆ¶æ›´æ–°å‘ç”Ÿçš„å±‚æ¬¡ï¼Œå› è€Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè½¯ä»¶æ¸²æŸ“çš„ä»£ä»·åˆå˜å¾—æ›´å¤§ã€‚å½“ç„¶ï¼Œè¿™å–å†³äºç½‘é¡µçš„ç»“æ„å’Œæ¸²æŸ“ç­–ç•¥ã€‚</li>\n<li>è½¯ä»¶ç»˜å›¾çš„åˆæˆåŒ–æ¸²æŸ“æ–¹å¼ç»“åˆäº†å‰é¢ä¸¤ç§æ–¹å¼çš„ä¼˜ç‚¹ï¼Œè¿™æ—¶å› ä¸ºå¾ˆå¤šç½‘é¡µå¯èƒ½æ—¢åŒ…å«åŸºæœ¬çš„HTMLå…ƒç´ ï¼Œä¹ŸåŒ…å«ä¸€äº›HTML5æ–°åŠŸèƒ½ï¼Œä½¿ç”¨CPUç»˜å›¾æ–¹å¼æ¥ç»˜åˆ¶æŸäº›å±‚ï¼Œä½¿ç”¨GPUæ¥ç»˜åˆ¶å…¶ä»–ä¸€äº›å±‚ã€‚åŸå› å½“ç„¶æ˜¯å‰é¢æ‰€è¿°çš„åŸºäºæ€§èƒ½å’Œå†…å­˜æ–¹é¢ç»¼åˆè€ƒè™‘çš„ç»“æœã€‚</li>\n</ul>\n<blockquote>\n<p>æµè§ˆå™¨è¿˜å¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹çš„æ¸²æŸ“æ¶æ„ï¼Œå°†ç½‘é¡µå†…å®¹ç»˜åˆ¶åˆ°åç«¯å­˜å‚¨çš„æ“ä½œæ”¾åˆ°å¦å¤–ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼ˆç»˜åˆ¶çº¿ç¨‹ï¼‰ï¼Œè€ŒåŸæ¥çº¿ç¨‹è½¬ä¸ºåˆæˆçº¿ç¨‹ï¼Œç»˜åˆ¶çº¿ç¨‹è·Ÿåˆæˆçº¿ç¨‹ä¹‹é—´å¯ä»¥ä½¿ç”¨åŒæ­¥ï¼Œéƒ¨åˆ†åŒæ­¥ï¼Œå®Œå…¨å¼‚æ­¥ç­‰ä½œä¸šæ¨¡å¼ï¼Œè®©æµè§ˆå™¨å¯ä»¥åœ¨æ€§èƒ½ä¸æ•ˆæœä¹‹é—´æ ¹æ®éœ€è¦è¿›è¡Œé€‰æ‹©ã€‚</p>\n</blockquote>\n<h2 id=\"GrphicsLayer-tree-GrphicsLayeræ ‘\"><a href=\"#GrphicsLayer-tree-GrphicsLayeræ ‘\" class=\"headerlink\" title=\"GrphicsLayer tree(GrphicsLayeræ ‘)\"></a>GrphicsLayer tree(GrphicsLayeræ ‘)</h2><p>å¯¹äºè½¯ä»¶æ¸²æŸ“è€Œè¨€ï¼Œåˆ°RenderLayeræ ‘å°±ç»“æŸäº†ï¼Œåé¢ä¸ä¼šå»ºç«‹å…¶å®ƒé¢å¤–çš„æ ‘æ¥å¯¹åº”äºRenderLayeræ ‘ã€‚ä½†æ˜¯ï¼Œå¯¹äºç¡¬ä»¶æ¸²æŸ“æ¥è¯´ï¼Œåœ¨RenderLayeræ ‘ä¹‹åï¼Œæµè§ˆå™¨æ¸²æŸ“å¼•æ“ä¸ºç¡¬ä»¶æ¸²æŸ“æä¾›äº†æ›´å¤šçš„å†…éƒ¨ç»“æ„æ¥æ”¯æŒè¿™ä¸ªæœºåˆ¶ã€‚</p>\n<p>åœ¨ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“çš„åˆæˆåŒ–æ¸²æŸ“å’Œè½¯ä»¶ç»˜å›¾çš„åˆæˆåŒ–æ¸²æŸ“æ¶æ„ä¸‹ï¼Œä¸€ä¸ªRenderLayerå¯¹è±¡å¦‚æœéœ€è¦åç«¯å­˜å‚¨ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªRenderLayerBackingå¯¹è±¡ï¼Œè¯¥å¯¹è±¡è´Ÿè´£Renderlayerå¯¹è±¡æ‰€éœ€è¦çš„å„ç§å­˜å‚¨ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œæ¯ä¸ªRenderLayeréƒ½å¯ä»¥åˆ›å»ºè‡ªå·±çš„åç«¯å­˜å‚¨ï¼Œäº‹å®ä¸Šä¸æ˜¯æ‰€æœ‰RenderLayeréƒ½æœ‰è‡ªå·±çš„RenderLayerBackingå¯¹è±¡ã€‚å¦‚æœä¸€ä¸ªRenderLayerå¯¹è±¡è¢«åƒæ ·çš„åˆ›å»ºåç«¯å­˜å‚¨ï¼Œé‚£ä¹ˆå°†è¯¥RenderLayerç§°ä¸ºåˆæˆå±‚ï¼ˆCompositing Layerï¼‰ã€‚</p>\n<p>å“ªäº›RenderLayerå¯¹è±¡å¯ä»¥æ˜¯åˆæˆå±‚ï¼Ÿå¦‚æœä¸€ä¸ªRenderLayerå¯¹è±¡å…·æœ‰ä»¥ä¸‹çš„ç‰¹å¾ä¹‹ä¸€ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯åˆæˆå±‚ï¼š</p>\n<ul>\n<li>Layer has 3D or perspective transform CSS properties</li>\n<li>Layer is used by &lt; video&gt; element using accelerated video decoding</li>\n<li>Layer is used by a &lt; canvas&gt; element with a 3D context or accelerated 2D context</li>\n<li>Layer is used for a composited plugin</li>\n<li>Layer uses a CSS animation for its opacity or uses an animated webkit transform</li>\n<li>Layer uses accelerated CSS filters</li>\n<li>Layer with a composited descendant has information that needs to be in the composited layer tree, such as a clip or reflection</li>\n<li>Layer has a sibling with a lower z-index which has a compositing layer (in other words the layer is rendered on top of a composited layer)</li>\n</ul>\n<p>ç¿»è¯‘:</p>\n<ul>\n<li>RenderLayerå…·æœ‰3Dæˆ–é€è§†è½¬æ¢çš„CSSå±æ€§</li>\n<li>RenderLayeråŒ…å«ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„è§†é¢‘è§£ç æŠ€æœ¯çš„<code>&lt;video&gt;</code>å…ƒç´ </li>\n<li>RenderLayeråŒ…å«ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„2Dæˆ–WebGL-3DæŠ€æœ¯çš„<code>&lt;canvas&gt;</code>å…ƒç´ </li>\n<li>RenderLayerä½¿ç”¨äº†åˆæˆæ’ä»¶ã€‚</li>\n<li>RenderLayerä½¿ç”¨äº†<code>opacity</code>æˆ–<code>transform</code>åŠ¨ç”»</li>\n<li>RenderLayerä½¿ç”¨äº†ç¡¬ä»¶åŠ é€Ÿçš„CSS FiltersæŠ€æœ¯</li>\n<li>RenderLayeråä»£ä¸­åŒ…å«äº†ä¸€ä¸ªåˆæˆå±‚ï¼ˆå¦‚æœ‰clipæˆ–reflectionå±æ€§ï¼‰</li>\n<li>RenderLayeræœ‰ä¸ªä¸€ä¸ªz-indexæ¯”è‡ªå·±å°çš„åˆæˆå±‚ï¼ˆå³åœ¨ä¸€ä¸ªåˆæˆå±‚ä¹‹ä¸Šï¼‰</li>\n</ul>\n<p>æ¯ä¸ªåˆæˆå±‚éƒ½æœ‰ä¸€ä¸ªRenderLayerBackingï¼ŒRenderLayerBackingè´Ÿè´£ç®¡ç†RenderLayeræ‰€éœ€è¦çš„æ‰€æœ‰åç«¯å­˜å‚¨ï¼Œå› ä¸ºåç«¯å­˜å‚¨å¯èƒ½éœ€è¦å¤šä¸ªå­˜å‚¨ç©ºé—´ã€‚åœ¨æµè§ˆå™¨(WebKit)ä¸­ï¼Œå­˜å‚¨ç©ºé—´ä½¿ç”¨ç±»GraphicsLayeræ¥è¡¨ç¤ºã€‚æµè§ˆå™¨ä¼šä¸ºè¿™äº›RenderLayeråˆ›å»ºå¯¹åº”çš„GraphicsLayerï¼Œä¸åŒçš„æµè§ˆå™¨éœ€è¦æä¾›è‡ªå·±çš„GrphicsLayerå®ç°ç”¨äºç®¡ç†å­˜å‚¨ç©ºé—´çš„åˆ†é…ï¼Œé‡Šæ”¾ï¼Œæ›´æ–°ç­‰ç­‰ã€‚æ‹¥æœ‰GrphicsLayerçš„RenderLayerä¼šè¢«ç»˜åˆ¶åˆ°è‡ªå·±çš„åç«¯å­˜å‚¨ï¼Œè€Œæ²¡æœ‰GrphicsLayerçš„RenderLayerå®ƒä»¬ä¼šå‘ä¸Šè¿½æº¯æœ‰GrphicsLayerçš„çˆ¶/ç¥–å…ˆRenderLayerï¼Œç›´åˆ°Root RenderLayerä¸ºæ­¢ï¼Œç„¶åç»˜åˆ¶åœ¨æœ‰GrphicsLayerçš„çˆ¶/ç¥–å…ˆRenderLayerçš„å­˜å‚¨ç©ºé—´ï¼Œè€ŒRoot RenderLayeræ€»æ˜¯ä¼šåˆ›å»ºä¸€ä¸ªGrphicsLayerå¹¶æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å­˜å‚¨ç©ºé—´ã€‚åœ¨å°†æ¯ä¸ªåˆæˆå›¾å±‚åŒ…å«çš„RenderLayerå†…å®¹ç»˜åˆ¶åœ¨åˆæˆå±‚çš„åç«¯å­˜å‚¨ä¸­ï¼Œè¿™é‡Œç»˜åˆ¶å¯ä»¥æ˜¯è½¯ä»¶ç»˜åˆ¶æˆ–ç¡¬ä»¶ç»˜åˆ¶ã€‚æ¥ç€ç”±åˆæˆå™¨(Compositor)å°†å¤šä¸ªåˆæˆå±‚åˆæˆèµ·æ¥ï¼Œå½¢æˆæœ€ç»ˆç”¨æˆ·å¯è§çš„ç½‘é¡µï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€å¼ å›¾ç‰‡ã€‚</p>\n<p>GraphicsLayeråˆæ„æˆäº†ä¸€æ£µä¸RenderLayerå¹¶è¡Œçš„æ ‘ï¼Œè€ŒRenderLayerä¸GraphicsLayerçš„å…³ç³»æœ‰äº›ç±»ä¼¼äºRenderObjectä¸RenderLayerä¹‹é—´çš„å…³ç³»ã€‚å¦‚ä¸‹æ˜¯DOMæ ‘ã€RenderObjectæ ‘ã€RenderLayeræ ‘ã€GraphicsLayeræ ‘å…³ç³»å›¾ï¼š</p>\n<p><img src=\"http://www.chromium.org/_/rsrc/1479245083354/developers/design-documents/gpu-accelerated-compositing-in-chrome/the_compositing_forest.png\" alt=\"\"></p>\n<p>è¿™æ ·å¯ä»¥åˆå¹¶ä¸€äº›RenderLayerå±‚ï¼Œä»è€Œå‡å°‘å†…å­˜çš„æ¶ˆè€—ã€‚å…¶æ¬¡ï¼Œåˆå¹¶ä¹‹åï¼Œå‡å°‘äº†åˆå¹¶å¸¦æ¥çš„é‡ç»˜æ€§èƒ½å’Œå¤„ç†ä¸Šçš„å›°éš¾ã€‚<br>åœ¨ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“çš„åˆæˆåŒ–æ¸²æŸ“å’Œè½¯ä»¶ç»˜å›¾çš„åˆæˆåŒ–æ¸²æŸ“æ¶æ„ä¸‹ï¼ŒRenderLayerçš„å†…å®¹å˜åŒ–ï¼Œåªéœ€è¦æ›´æ–°æ‰€å±çš„GraphicsLayerçš„ç¼“å­˜å³å¯ï¼Œè€Œç¼“å­˜çš„æ›´æ–°ï¼Œä¹Ÿåªéœ€è¦ç»˜åˆ¶ç›´æ¥æˆ–è€…é—´æ¥å±äºè¿™ä¸ªGraphicsLayerçš„RenderLayerï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„RenderLayerã€‚ç‰¹åˆ«æ˜¯ä¸€äº›ç‰¹å®šçš„CSSæ ·å¼å±æ€§çš„å˜åŒ–ï¼Œå®é™…ä¸Šå¹¶ä¸å¼•èµ·å†…å®¹çš„å˜åŒ–ï¼Œåªéœ€è¦æ”¹å˜ä¸€äº›GraphicsLayerçš„æ··åˆå‚æ•°ï¼Œç„¶åé‡æ–°æ··åˆå³å¯ï¼Œè€Œæ··åˆç›¸å¯¹ç»˜åˆ¶è€Œè¨€æ˜¯å¾ˆå¿«çš„ï¼Œè¿™äº›ç‰¹å®šçš„CSSæ ·å¼å±æ€§æˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºæ˜¯è¢«åŠ é€Ÿçš„ï¼Œä¸åŒçš„æµè§ˆå™¨æ”¯æŒçš„çŠ¶å†µä¸å¤ªä¸€æ ·ï¼Œä½†åŸºæœ¬ä¸ŠCSS Transform &amp; Opacityåœ¨æ‰€æœ‰æ”¯æŒæ··åˆåŠ é€Ÿçš„æµè§ˆå™¨ä¸Šéƒ½æ˜¯è¢«åŠ é€Ÿçš„ã€‚è¢«åŠ é€Ÿçš„CSSæ ·å¼å±æ€§çš„åŠ¨ç”»ï¼Œå°±æ¯”è¾ƒå®¹æ˜“è¾¾åˆ°60å¸§/æ¯ç§’çš„æµç•…æ•ˆæœäº†ã€‚</p>\n<p><img src=\"http://img.blog.csdn.net/20140416142656281\" alt=\"\"></p>\n<p>ä¸è¿‡å¹¶ä¸æ˜¯æ‹¥æœ‰ç‹¬ç«‹ç¼“å­˜çš„RenderLayerè¶Šå¤šè¶Šå¥½ï¼Œå¤ªå¤šæ‹¥æœ‰ç‹¬ç«‹ç¼“å­˜çš„RenderLayerä¼šå¸¦æ¥ä¸€äº›ä¸¥é‡çš„å‰¯ä½œç”¨:</p>\n<ul>\n<li>å®ƒå¤§å¤§å¢åŠ äº†å†…å­˜çš„å¼€é”€ï¼Œè¿™ç‚¹åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šçš„å½±å“æ›´å¤§ï¼Œç”šè‡³å¯¼è‡´æµè§ˆå™¨åœ¨ä¸€äº›å†…å­˜è¾ƒå°‘çš„ç§»åŠ¨è®¾å¤‡ä¸Šæ— æ³•å¾ˆå¥½åœ°æ”¯æŒå›¾å±‚åˆæˆåŠ é€Ÿï¼›</li>\n<li>å®ƒåŠ å¤§äº†åˆæˆçš„æ—¶é—´å¼€é”€ï¼Œå¯¼è‡´åˆæˆæ€§èƒ½çš„ä¸‹é™ï¼Œè€Œåˆæˆæ€§èƒ½è·Ÿç½‘é¡µæ»šåŠ¨/ç¼©æ”¾æ“ä½œçš„æµç•…åº¦åˆæ¯æ¯ç›¸å…³ï¼Œæœ€ç»ˆå¯¼è‡´ç½‘é¡µæ»šåŠ¨/ç¼©æ”¾çš„æµç•…åº¦ä¸‹é™ï¼Œè®©ç”¨æˆ·è§‰å¾—æ“ä½œä¸å¤Ÿæµç•…ã€‚</li>\n</ul>\n<h2 id=\"Tile-Rendering-ç“¦ç‰‡æ¸²æŸ“\"><a href=\"#Tile-Rendering-ç“¦ç‰‡æ¸²æŸ“\" class=\"headerlink\" title=\"Tile Rendering(ç“¦ç‰‡æ¸²æŸ“)\"></a>Tile Rendering(ç“¦ç‰‡æ¸²æŸ“)</h2><p>é€šå¸¸ä¸€ä¸ªåˆæˆå±‚çš„åç«¯å­˜å‚¨è¢«åˆ†å‰²æˆå¤šä¸ªå¤§å°ç›¸åŒçš„ç“¦ç‰‡çŠ¶çš„å°å­˜å‚¨ç©ºé—´ï¼Œæ¯ä¸ªç“¦ç‰‡å¯ä»¥ç†è§£ä¸ºOpenGLä¸­çš„ä¸€ä¸ªçº¹ç†ï¼Œåˆæˆå±‚çš„ç»“æœè¢«åˆ†å¼€å­˜å‚¨åœ¨è¿™äº›ç“¦ç‰‡ä¸­ã€‚ä¸ºä»€ä¹ˆä½¿ç”¨ç“¦ç‰‡åŒ–çš„åç«¯å­˜å‚¨ï¼Ÿ</p>\n<ul>\n<li>DOMæ ‘ç§çš„htmlå…ƒç´ æ‰€åœ¨çš„å±‚å¯èƒ½ä¼šæ¯”è¾ƒå¤§ï¼Œå› ä¸ºç½‘é¡µçš„é«˜åº¦å¾ˆå¤§ï¼Œå¦‚æœåªæ˜¯ä½¿ç”¨ä¸€ä¸ªåç«¯å­˜å‚¨çš„è¯ï¼Œé‚£ä¹ˆéœ€è¦ä¸€ä¸ªå¾ˆå¤§çš„çº¹ç†å¯¹è±¡ï¼Œä½†æ˜¯å®é™…çš„GPUç¡¬ä»¶å¯èƒ½åªæ”¯æŒéå¸¸æœ‰é™çš„çº¹ç†å¤§å°ã€‚</li>\n<li>åœ¨ä¸€ä¸ªæ¯”è¾ƒå¤§çš„åˆæˆå±‚ä¸­ï¼Œå¯èƒ½åªæ˜¯å…¶ä¸­ä¸€éƒ¨åˆ†å‘ç”Ÿå˜åŒ–ï¼Œæ ¹æ®ä¹‹å‰çš„ä»‹ç»ï¼Œéœ€è¦é‡æ–°ç»˜åˆ¶æ•´ä¸ªå±‚ï¼Œè¿™æ ·å¿…ç„¶äº§ç”Ÿé¢å¤–çš„å¼€é”€ï¼Œä½¿ç”¨ç“¦ç‰‡è¯çš„åç«¯å­˜å‚¨ï¼Œå°±åªéœ€è¦é‡ç»˜ä¸€äº›å­˜åœ¨æ›´æ–°çš„ç“¦ç‰‡ã€‚</li>\n<li>å½“å±‚å‘ç”Ÿæ»šåŠ¨çš„æ—¶å€™ï¼Œä¸€äº›ç“¦ç‰‡å¯èƒ½ä¸å†éœ€è¦ï¼Œç„¶åæ¸²æŸ“å¼•æ“éœ€è¦ä¸€äº›æ–°çš„ç“¦ç‰‡æ¥ç»˜åˆ¶æ–°çš„åŒºåŸŸï¼Œè¿™äº›å¤§å°ç›¸åŒçš„åç«¯å­˜å‚¨å¾ˆå®¹æ˜“é‡å¤åˆ©ç”¨ã€‚</li>\n</ul>\n<p><img src=\"./tiles.png\" alt=\"\"></p>\n<h2 id=\"æµç•…åŠ¨ç”»\"><a href=\"#æµç•…åŠ¨ç”»\" class=\"headerlink\" title=\"æµç•…åŠ¨ç”»\"></a>æµç•…åŠ¨ç”»</h2><p>ç½‘é¡µåŠ è½½åï¼Œç»˜åˆ¶æ–°çš„æ¯ä¸€å¸§ï¼Œä¸€èˆ¬éƒ½éœ€è¦ç»è¿‡è®¡ç®—å¸ƒå±€(layout)ã€ç»˜å›¾(paint)ã€åˆæˆï¼ˆcompositeï¼‰ä¸‰é˜¶æ®µã€‚å› æ­¤è¦æƒ³æé«˜é¡µé¢æ€§èƒ½ï¼ˆæˆ–FPSï¼‰ï¼Œéœ€è¦å‡å°‘æ¯ä¸€å¸§çš„æ—¶é—´ã€‚è€Œåœ¨è¿™ä¸‰ä¸ªé˜¶æ®µä¸­ï¼Œlayoutå’Œpaintæ¯”è¾ƒè€—æ—¶é—´ï¼Œè€Œåˆæˆéœ€è¦çš„æ—¶é—´ç›¸å¯¹è¾ƒå°‘ä¸€äº›ã€‚</p>\n<h4 id=\"layout\"><a href=\"#layout\" class=\"headerlink\" title=\"layout\"></a>layout</h4><p>å¦‚æœä¿®æ”¹ä¸€ä¸ªDOMå…ƒç´ çš„â€layoutâ€å±æ€§ï¼Œä¹Ÿå°±æ˜¯æ”¹å˜äº†å…ƒç´ çš„æ ·å¼ï¼ˆæ¯”å¦‚å®½åº¦ã€é«˜åº¦æˆ–è€…ä½ç½®ç­‰ï¼‰ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šæ£€æŸ¥å“ªäº›å…ƒç´ éœ€è¦é‡æ–°å¸ƒå±€ï¼Œç„¶åå¯¹é¡µé¢æ¿€å‘ä¸€ä¸ªreflowè¿‡ç¨‹å®Œæˆé‡æ–°å¸ƒå±€ã€‚è¢«reflowçš„å…ƒç´ ï¼Œæ¥ä¸‹æ¥ä¹Ÿä¼šæ¿€å‘ç»˜åˆ¶è¿‡ç¨‹ï¼Œæœ€åæ¿€å‘æ¸²æŸ“å±‚åˆå¹¶è¿‡ç¨‹ï¼Œç”Ÿæˆæœ€åçš„ç”»é¢ã€‚<br><img src=\"https://developers.google.com/web/fundamentals/performance/rendering/images/intro/frame-full.jpg\" alt=\"\"></p>\n<h4 id=\"paint\"><a href=\"#paint\" class=\"headerlink\" title=\"paint\"></a>paint</h4><p>å¦‚æœä¿®æ”¹äº†â€œpaint onlyâ€å±æ€§ï¼ˆä¾‹å¦‚èƒŒæ™¯å›¾ç‰‡ã€æ–‡å­—é¢œè‰²æˆ–é˜´å½±ç­‰ï¼‰ï¼Œå³ä¸ä¼šå½±å“é¡µé¢å¸ƒå±€çš„å±æ€§ï¼Œåˆ™æµè§ˆå™¨ä¼šè·³è¿‡å¸ƒå±€ï¼Œä½†ä»å°†æ‰§è¡Œç»˜åˆ¶ã€‚<br><img src=\"https://developers.google.com/web/fundamentals/performance/rendering/images/intro/frame-no-layout.jpg\" alt=\"\"></p>\n<h4 id=\"composite\"><a href=\"#composite\" class=\"headerlink\" title=\"composite\"></a>composite</h4><p>å¦‚æœæ›´æ”¹äº†ä¸€ä¸ªæ—¢ä¸è¦å¸ƒå±€ä¹Ÿä¸è¦ç»˜åˆ¶çš„å±æ€§ï¼Œåˆ™æµè§ˆå™¨å°†è·³åˆ°åªæ‰§è¡Œåˆæˆã€‚è¿™ä¸ªæœ€åçš„ç‰ˆæœ¬å¼€é”€æœ€å°ï¼Œæœ€é€‚åˆäºåº”ç”¨ç”Ÿå‘½å‘¨æœŸä¸­çš„é«˜å‹åŠ›ç‚¹ï¼Œä¾‹å¦‚åŠ¨ç”»æˆ–æ»šåŠ¨ã€‚</p>\n<p><img src=\"https://developers.google.com/web/fundamentals/performance/rendering/images/intro/frame-no-layout-paint.jpg\" alt=\"\"></p>\n<p><strong>å¦‚æœæƒ³çŸ¥é“æ›´æ”¹ä»»ä½•æŒ‡å®šCSSå±æ€§å°†è§¦å‘layoutã€paintã€compositeä¸­çš„å“ªä¸€ä¸ªï¼Œè¯·æŸ¥çœ‹<a href=\"https://csstriggers.com/\" target=\"_blank\" rel=\"external\">CSSè§¦å‘å™¨</a>ã€‚</strong></p>\n<h4 id=\"ä¼˜åŒ–\"><a href=\"#ä¼˜åŒ–\" class=\"headerlink\" title=\"ä¼˜åŒ–\"></a>ä¼˜åŒ–</h4><p>å¯ä»¥é€šè¿‡ä»€ä¹ˆé€”å¾„è¿›è¡Œä¼˜åŒ–ï¼Œå‡å°‘æ¯ä¸€å¸§çš„æ—¶é—´ï¼ˆé¿å…è¿‡å¤šlayoutæˆ–paintï¼‰ï¼š</p>\n<ul>\n<li>ä½¿ç”¨é€‚åˆçš„ç½‘é¡µåˆ†å±‚æŠ€æœ¯å‡å°‘layoutå’Œpaintã€‚ä¸€æ—¦æœ‰è¯·æ±‚æ›´æ–°ï¼Œå¦‚æœæ²¡æœ‰åˆ†å±‚ï¼Œæ¸²æŸ“å¼•æ“å¯èƒ½éœ€è¦é‡æ–°ç»˜åˆ¶æ‰€æœ‰åŒºåŸŸï¼Œå› ä¸ºè®¡ç®—æ›´æ–°éƒ¨åˆ†å¯¹GPUæ¥è¯´å¯èƒ½æ¶ˆè€—æ›´å¤šçš„æ—¶é—´ã€‚è€Œç½‘é¡µåˆ†å±‚ä¹‹åï¼Œéƒ¨åˆ†åŒºåŸŸçš„æ›´æ–°å¯èƒ½åªåœ¨ç½‘é¡µçš„ä¸€å±‚æˆ–å‡ å±‚ï¼Œè€Œä¸éœ€è¦å°†æ•´ä¸ªç½‘é¡µé‡æ–°ç»˜åˆ¶ã€‚é€šè¿‡é‡æ–°ç»˜åˆ¶ç½‘é¡µçš„ä¸€å±‚æˆ–å‡ å±‚ï¼Œå¹¶å°†å®ƒä»¬å’Œå…¶ä»–ä¹‹å‰ç»˜åˆ¶å®Œçš„å±‚åˆå¹¶èµ·æ¥ï¼Œæ—¢èƒ½ä½¿ç”¨GPUçš„èƒ½åŠ›ï¼Œåˆèƒ½å¤Ÿå‡å°‘é‡ç»˜çš„å¼€é”€ã€‚</li>\n<li><p>ä½¿ç”¨åˆæˆå±æ€§æ ·å¼ï¼ˆopcityã€tansformï¼‰æ¥å®Œæˆtansitionæˆ–animationã€‚å½“åˆæˆå™¨åˆæˆæ—¶å€™ï¼Œæ¯ä¸ªåˆæˆå±‚éƒ½å¯ä»¥è®¾ç½®å˜å½¢å±æ€§ï¼šä½ç§»ï¼ˆTranslateï¼‰ã€ç¼©æ”¾ï¼ˆScaleï¼‰ã€æ—‹è½¬ï¼ˆRotationï¼‰ã€opacityï¼Œè¿™äº›å±æ€§ä»…ä»…æ”¹å˜åˆæˆå±‚çš„å˜æ¢å‚æ•°ï¼Œè€Œä¸éœ€è¦layoutå’Œpaintæ“ä½œï¼Œæå¤§åœ°å‡å°‘æ¯ä¸€å¸§çš„æ¸²æŸ“æ—¶é—´ã€‚</p>\n<p>å³ä½¿ç”¨GPUç¡¬ä»¶åŠ é€Ÿï¼Œä¸ºæŸäº›RenderLayeråˆ›å»ºå¯¹åº”GraphicsLayerã€‚é€šè¿‡ä¸ºæ¯ä¸€ä¸ªåˆæˆå±‚è®¾ç½®å˜å½¢å±æ€§æ¥å®Œæˆtansitionæˆ–animationï¼Œæœ‰æ•ˆåœ°é¿å…relayoutå’Œrepaintçš„å¼€é”€ã€‚</p>\n<p><img src=\"https://www.html5rocks.com/zh/tutorials/speed/high-performance-animations/cheap-operations.jpg\" alt=\"\"></p>\n</li>\n</ul>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>æœ¬æ–‡æ˜¯ç”±å‡ ç¯‡å…³äºæµè§ˆå™¨æ¸²æŸ“çš„æ–‡ç« ç»„åˆè€Œæˆï¼Œå¯èƒ½æœ‰äº›æ¦‚å¿µæ¯”è¾ƒæŠ½è±¡ï¼Œä¸å¥½ç†è§£ï¼Œå¯ä»¥æŸ¥çœ‹<strong>å‚è€ƒæ–‡ç« </strong>å°èŠ‚ï¼Œè·å–æ›´å¤šä¿¡æ¯ã€‚æœ¬æ–‡é‡ç‚¹ä»‹ç»äº†æµè§ˆå™¨æ¸²æŸ“å¼•æ“çš„æ¸²æŸ“è¿‡ç¨‹ï¼Œæ¶‰åŠäº†DOMæ ‘ã€CSSOMæ ‘ã€RenderObjectæ ‘ã€RenderLayeræ ‘ã€GraphicsLayeræ ‘ã€‚å¹¶å¯¹å„ç§æ¸²æŸ“æ¨¡å¼è¿›è¡Œäº†ç®€å•ä»‹ç»ï¼Œå…¶ä¸­å¼•å…¥äº†ç¡¬ä»¶åŠ é€Ÿæœºåˆ¶ï¼Œè¿˜ç»™å‡ºä¸€äº›ä¼˜åŒ–å»ºè®®ã€‚äº†è§£è¿™äº›çŸ¥è¯†ç‚¹å¯¹æˆ‘ä»¬å¼€å‘é«˜æ€§èƒ½çš„webåº”ç”¨ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚</p>\n<h2 id=\"å‚è€ƒæ–‡ç« ï¼š\"><a href=\"#å‚è€ƒæ–‡ç« ï¼š\" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« ï¼š\"></a>å‚è€ƒæ–‡ç« ï¼š</h2><ul>\n<li><a href=\"http://www.chromium.org/developers/design-documents/gpu-accelerated-compositing-in-chrome\" target=\"_blank\" rel=\"external\">GPU Accelerated Compositing in Chrome</a></li>\n<li><a href=\"https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/\" target=\"_blank\" rel=\"external\">æµè§ˆå™¨çš„å·¥ä½œåŸç†ï¼šæ–°å¼ç½‘ç»œæµè§ˆå™¨å¹•åæ­ç§˜</a></li>\n<li><a href=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/constructing-the-object-model?hl=zh-cn\" target=\"_blank\" rel=\"external\">æ„å»ºå¯¹è±¡æ¨¡å‹</a></li>\n<li><a href=\"https://rogeryi.wordpress.com/2014/04/16/how-rendering-work-in-webkit-and-blink/\" target=\"_blank\" rel=\"external\">How Rendering Work (in WebKit and Blink)</a></li>\n<li><a href=\"http://blog.csdn.net/milado_nju\" target=\"_blank\" rel=\"external\">WebKitæŠ€æœ¯å†…å¹•</a></li>\n<li><a href=\"https://developers.google.com/web/fundamentals/performance/rendering/\" target=\"_blank\" rel=\"external\">æ¸²æŸ“æ€§èƒ½</a></li>\n<li><a href=\"https://www.html5rocks.com/zh/tutorials/speed/high-performance-animations/\" target=\"_blank\" rel=\"external\">High Performance Animations</a></li>\n</ul>\n"}],"PostAsset":[{"_id":"source/_posts/JavaScriptå†…å­˜é‚£ç‚¹äº‹/mark-sweep.gif","slug":"mark-sweep.gif","post":"cjl4vata000011hn9mizjdgi0","modified":1,"renderable":0},{"_id":"source/_posts/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure4.png","slug":"closure4.png","post":"cjl4vatak000c1hn9x1b4gpqr","modified":1,"renderable":0},{"_id":"source/_posts/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure5.png","slug":"closure5.png","post":"cjl4vatak000c1hn9x1b4gpqr","modified":1,"renderable":0},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹Listeners/listeners_fixed.png","slug":"listeners_fixed.png","post":"cjl4vatal000d1hn9kh575zzi","modified":1,"renderable":0},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹Listeners/listeners_resize.png","slug":"listeners_resize.png","post":"cjl4vatal000d1hn9kh575zzi","modified":1,"renderable":0},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹jQuery-cache/jquery1_x.png","slug":"jquery1_x.png","post":"cjl4vatam000f1hn9rven9ng7","modified":1,"renderable":0},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹jQuery-cache/jquery2_x.png","slug":"jquery2_x.png","post":"cjl4vatam000f1hn9rven9ng7","modified":1,"renderable":0},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.mindnode/style.mindnodestyle/contents.xml","slug":"style-sheet.mindnode/style.mindnodestyle/contents.xml","post":"cjl4vatah00091hn9zz0oy1h3","modified":1,"renderable":0},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.mindnode/style.mindnodestyle/metadata.plist","slug":"style-sheet.mindnode/style.mindnodestyle/metadata.plist","post":"cjl4vatah00091hn9zz0oy1h3","modified":1,"renderable":0},{"_id":"source/_posts/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure1.png","slug":"closure1.png","post":"cjl4vatak000c1hn9x1b4gpqr","modified":1,"renderable":0},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹Listeners/listeners_resize_after.png","slug":"listeners_resize_after.png","post":"cjl4vatal000d1hn9kh575zzi","modified":1,"renderable":0},{"_id":"source/_posts/IE-8å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„éœ²/leakage.png","slug":"leakage.png","post":"cjl4vat9x00001hn9nsy7m8yf","modified":1,"renderable":0},{"_id":"source/_posts/requestAnimationFrame/arf.png","post":"cjl4vatae00081hn93k24rqhh","slug":"arf.png","modified":1,"renderable":1},{"_id":"source/_posts/æµè§ˆå™¨æ¸²æŸ“ç®€è¿°/render.png","post":"cjl4vatan000h1hn9y2ms2g1k","slug":"render.png","modified":1,"renderable":1},{"_id":"source/_posts/æµè§ˆå™¨æ¸²æŸ“ç®€è¿°/tiles.png","slug":"tiles.png","post":"cjl4vatan000h1hn9y2ms2g1k","modified":1,"renderable":0},{"_id":"source/_posts/JavaScriptå†…å­˜é‚£ç‚¹äº‹/cycle.png","post":"cjl4vata000011hn9mizjdgi0","slug":"cycle.png","modified":1,"renderable":1},{"_id":"source/_posts/JavaScriptå†…å­˜é‚£ç‚¹äº‹/life-cycle.png","post":"cjl4vata000011hn9mizjdgi0","slug":"life-cycle.png","modified":1,"renderable":1},{"_id":"source/_posts/JavaScriptå†…å­˜é‚£ç‚¹äº‹/no-cycle.png","post":"cjl4vata000011hn9mizjdgi0","slug":"no-cycle.png","modified":1,"renderable":1},{"_id":"source/_posts/async-vs-defer/legend.svg","post":"cjl4vata400031hn9uzcj3lzi","slug":"legend.svg","modified":1,"renderable":1},{"_id":"source/_posts/async-vs-defer/script-async.svg","post":"cjl4vata400031hn9uzcj3lzi","slug":"script-async.svg","modified":1,"renderable":1},{"_id":"source/_posts/async-vs-defer/script-defer.svg","post":"cjl4vata400031hn9uzcj3lzi","slug":"script-defer.svg","modified":1,"renderable":1},{"_id":"source/_posts/async-vs-defer/script.svg","post":"cjl4vata400031hn9uzcj3lzi","slug":"script.svg","modified":1,"renderable":1},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹jQuery-cache/jquery.jpg","post":"cjl4vatam000f1hn9rven9ng7","slug":"jquery.jpg","modified":1,"renderable":1},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹jQuery-cache/jquery_cache_1_x.png","post":"cjl4vatam000f1hn9rven9ng7","slug":"jquery_cache_1_x.png","modified":1,"renderable":1},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹jQuery-cache/jquery_cache_2_x.png","post":"cjl4vatam000f1hn9rven9ng7","slug":"jquery_cache_2_x.png","modified":1,"renderable":1},{"_id":"source/_posts/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure.png","post":"cjl4vatak000c1hn9x1b4gpqr","slug":"closure.png","modified":1,"renderable":1},{"_id":"source/_posts/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure2.png","post":"cjl4vatak000c1hn9x1b4gpqr","slug":"closure2.png","modified":1,"renderable":1},{"_id":"source/_posts/å…³äºé—­åŒ…ä¹Ÿè®¸ä½ ä¸çŸ¥é“çš„äº‹/closure3.png","post":"cjl4vatak000c1hn9x1b4gpqr","slug":"closure3.png","modified":1,"renderable":1},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹Listeners/listener_location.png","post":"cjl4vatal000d1hn9kh575zzi","slug":"listener_location.png","modified":1,"renderable":1},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹Listeners/listeners_event.png","post":"cjl4vatal000d1hn9kh575zzi","slug":"listeners_event.png","modified":1,"renderable":1},{"_id":"source/_posts/å†…å­˜æ³„éœ²ä¹‹Listeners/listeners_performance.png","slug":"listeners_performance.png","post":"cjl4vatal000d1hn9kh575zzi","modified":1,"renderable":0},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.mindnode/QuickLook/Preview.jpg","slug":"style-sheet.mindnode/QuickLook/Preview.jpg","post":"cjl4vatah00091hn9zz0oy1h3","modified":1,"renderable":0},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/async-network.png","post":"cjl4vatah00091hn9zz0oy1h3","slug":"async-network.png","modified":1,"renderable":1},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/async-network1.png","post":"cjl4vatah00091hn9zz0oy1h3","slug":"async-network1.png","modified":1,"renderable":1},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/async.png","post":"cjl4vatah00091hn9zz0oy1h3","slug":"async.png","modified":1,"renderable":1},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/default-network.png","post":"cjl4vatah00091hn9zz0oy1h3","slug":"default-network.png","modified":1,"renderable":1},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/media-network.png","post":"cjl4vatah00091hn9zz0oy1h3","slug":"media-network.png","modified":1,"renderable":1},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/media.png","post":"cjl4vatah00091hn9zz0oy1h3","slug":"media.png","modified":1,"renderable":1},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/script-network.png","post":"cjl4vatah00091hn9zz0oy1h3","slug":"script-network.png","modified":1,"renderable":1},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/script.png","post":"cjl4vatah00091hn9zz0oy1h3","slug":"script.png","modified":1,"renderable":1},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet-default.png","post":"cjl4vatah00091hn9zz0oy1h3","slug":"style-sheet-default.png","modified":1,"renderable":1},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.mindnode/contents.xml","post":"cjl4vatah00091hn9zz0oy1h3","slug":"style-sheet.mindnode/contents.xml","modified":1,"renderable":1},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.mindnode/viewState.plist","post":"cjl4vatah00091hn9zz0oy1h3","slug":"style-sheet.mindnode/viewState.plist","modified":1,"renderable":1},{"_id":"source/_posts/å…³äºexternal-style-sheetsä½ ä¸çŸ¥é“çš„äº‹/style-sheet.png","post":"cjl4vatah00091hn9zz0oy1h3","slug":"style-sheet.png","modified":1,"renderable":1}],"PostCategory":[{"post_id":"cjl4vata000011hn9mizjdgi0","category_id":"cjl4vata600041hn96fz5igqm","_id":"cjl4vatak000b1hn99029ke35"}],"PostTag":[{"post_id":"cjl4vat9x00001hn9nsy7m8yf","tag_id":"cjl4vata200021hn92xm7j9gj","_id":"cjl4vatan000g1hn9fn8ypprn"},{"post_id":"cjl4vat9x00001hn9nsy7m8yf","tag_id":"cjl4vatac00071hn9ke2q36zt","_id":"cjl4vatan000i1hn9ooq5134r"},{"post_id":"cjl4vat9x00001hn9nsy7m8yf","tag_id":"cjl4vatai000a1hn9jx2s7glx","_id":"cjl4vatao000k1hn9yhnn5hye"},{"post_id":"cjl4vata000011hn9mizjdgi0","tag_id":"cjl4vatal000e1hn9xi39jgwc","_id":"cjl4vatao000n1hn9ljyu29i6"},{"post_id":"cjl4vata000011hn9mizjdgi0","tag_id":"cjl4vatao000j1hn97izh86hq","_id":"cjl4vatap000o1hn9olr1cvy9"},{"post_id":"cjl4vata000011hn9mizjdgi0","tag_id":"cjl4vatao000l1hn9a20bb224","_id":"cjl4vatap000q1hn9j8z0yu4j"},{"post_id":"cjl4vata400031hn9uzcj3lzi","tag_id":"cjl4vatao000m1hn92cdlmofi","_id":"cjl4vataq000t1hn9i8e1gqb9"},{"post_id":"cjl4vata400031hn9uzcj3lzi","tag_id":"cjl4vatap000p1hn9duff0dye","_id":"cjl4vataq000u1hn9jw3ncvuw"},{"post_id":"cjl4vata400031hn9uzcj3lzi","tag_id":"cjl4vatai000a1hn9jx2s7glx","_id":"cjl4vatar000w1hn9rrrfcplb"},{"post_id":"cjl4vata700051hn94qwnhaqt","tag_id":"cjl4vataq000s1hn94s4yq1sx","_id":"cjl4vatar000x1hn9dci0owte"},{"post_id":"cjl4vatae00081hn93k24rqhh","tag_id":"cjl4vataq000v1hn9ooygt6q2","_id":"cjl4vatar00101hn9u5ol04vq"},{"post_id":"cjl4vatae00081hn93k24rqhh","tag_id":"cjl4vatar000y1hn97adt0me8","_id":"cjl4vatar00111hn9775nc1jo"},{"post_id":"cjl4vatah00091hn9zz0oy1h3","tag_id":"cjl4vatar000z1hn9sbq94vqp","_id":"cjl4vatas00141hn974962z53"},{"post_id":"cjl4vatah00091hn9zz0oy1h3","tag_id":"cjl4vatai000a1hn9jx2s7glx","_id":"cjl4vatas00151hn93zmpuo3d"},{"post_id":"cjl4vatak000c1hn9x1b4gpqr","tag_id":"cjl4vatas00131hn9r7jppkjc","_id":"cjl4vatat00181hn9wmvexlpz"},{"post_id":"cjl4vatak000c1hn9x1b4gpqr","tag_id":"cjl4vatat00161hn9pnu3hr7r","_id":"cjl4vatat00191hn9a6e0ni81"},{"post_id":"cjl4vatal000d1hn9kh575zzi","tag_id":"cjl4vatat00171hn98jcihvls","_id":"cjl4vatau001b1hn9jrfwfsia"},{"post_id":"cjl4vatal000d1hn9kh575zzi","tag_id":"cjl4vatai000a1hn9jx2s7glx","_id":"cjl4vatau001c1hn922ymvayi"},{"post_id":"cjl4vatal000d1hn9kh575zzi","tag_id":"cjl4vatac00071hn9ke2q36zt","_id":"cjl4vatau001e1hn9jflcik20"},{"post_id":"cjl4vatam000f1hn9rven9ng7","tag_id":"cjl4vatat001a1hn9mgnu7gj6","_id":"cjl4vatav001g1hn9diujy0wm"},{"post_id":"cjl4vatam000f1hn9rven9ng7","tag_id":"cjl4vatau001d1hn90f9gh21w","_id":"cjl4vatav001h1hn9krhvibeg"},{"post_id":"cjl4vatam000f1hn9rven9ng7","tag_id":"cjl4vatai000a1hn9jx2s7glx","_id":"cjl4vatav001j1hn9zsrjeson"},{"post_id":"cjl4vatam000f1hn9rven9ng7","tag_id":"cjl4vatac00071hn9ke2q36zt","_id":"cjl4vataw001k1hn9ioy28f99"},{"post_id":"cjl4vatan000h1hn9y2ms2g1k","tag_id":"cjl4vatav001f1hn9vk86qgcl","_id":"cjl4vataw001m1hn9mnzqyzlu"},{"post_id":"cjl4vatan000h1hn9y2ms2g1k","tag_id":"cjl4vatai000a1hn9jx2s7glx","_id":"cjl4vataw001n1hn998fhmrru"},{"post_id":"cjl4vatan000h1hn9y2ms2g1k","tag_id":"cjl4vatav001i1hn9f9eezisr","_id":"cjl4vataw001o1hn9cahzsswg"},{"post_id":"cjl4vatan000h1hn9y2ms2g1k","tag_id":"cjl4vataw001l1hn9crm2xoy0","_id":"cjl4vataw001p1hn9cjndeb0w"}],"Tag":[{"name":"IE6","_id":"cjl4vata200021hn92xm7j9gj"},{"name":"å†…å­˜æ³„éœ²","_id":"cjl4vatac00071hn9ke2q36zt"},{"name":"ä¼˜åŒ–","_id":"cjl4vatai000a1hn9jx2s7glx"},{"name":"å†…å­˜","_id":"cjl4vatal000e1hn9xi39jgwc"},{"name":"CG","_id":"cjl4vatao000j1hn97izh86hq"},{"name":"åƒåœ¾å›æ”¶","_id":"cjl4vatao000l1hn9a20bb224"},{"name":"defer","_id":"cjl4vatao000m1hn92cdlmofi"},{"name":"async","_id":"cjl4vatap000p1hn9duff0dye"},{"name":"css","_id":"cjl4vataq000s1hn94s4yq1sx"},{"name":"requestAnimationFrame","_id":"cjl4vataq000v1hn9ooygt6q2"},{"name":"åŠ¨ç”»","_id":"cjl4vatar000y1hn97adt0me8"},{"name":"style-sheet","_id":"cjl4vatar000z1hn9sbq94vqp"},{"name":"é—­åŒ…","_id":"cjl4vatas00131hn9r7jppkjc"},{"name":"closure","_id":"cjl4vatat00161hn9pnu3hr7r"},{"name":"listeners","_id":"cjl4vatat00171hn98jcihvls"},{"name":"$.cache","_id":"cjl4vatat001a1hn9mgnu7gj6"},{"name":"jquery","_id":"cjl4vatau001d1hn90f9gh21w"},{"name":"æ¸²æŸ“","_id":"cjl4vatav001f1hn9vk86qgcl"},{"name":"render","_id":"cjl4vatav001i1hn9f9eezisr"},{"name":"ç¡¬ä»¶åŠ é€Ÿ","_id":"cjl4vataw001l1hn9crm2xoy0"}]}}