<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-192x192.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">






  <meta name="keywords" content="webP,">










<meta name="description" content="åœ¨æ­å»º blog è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ lighthouse å®¡æŸ¥ç«™ç‚¹ã€‚åœ¨æ€§èƒ½é¡¹ä¸Šæç¤ºServe images in next-gen formatsä¼˜åŒ–å»ºè®®ã€‚  Image formats like JPEG 2000, JPEG XR, and webp often provide better compression than PNG or JPEG, which means faster dow">
<meta name="keywords" content="webP">
<meta property="og:type" content="article">
<meta property="og:title" content="WebPå®æˆ˜">
<meta property="og:url" content="http://123fe.com/2019/08/14/WebPå®æˆ˜/index.html">
<meta property="og:site_name" content="Sogou.dh.fe">
<meta property="og:description" content="åœ¨æ­å»º blog è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ lighthouse å®¡æŸ¥ç«™ç‚¹ã€‚åœ¨æ€§èƒ½é¡¹ä¸Šæç¤ºServe images in next-gen formatsä¼˜åŒ–å»ºè®®ã€‚  Image formats like JPEG 2000, JPEG XR, and webp often provide better compression than PNG or JPEG, which means faster dow">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://123fe.com/2019/08/14/WebPå®æˆ˜/webp.png">
<meta property="og:image" content="http://123fe.com/2019/08/14/WebPå®æˆ˜/images/webp-supports.png">
<meta property="og:updated_time" content="2020-06-09T10:27:57.303Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WebPå®æˆ˜">
<meta name="twitter:description" content="åœ¨æ­å»º blog è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ lighthouse å®¡æŸ¥ç«™ç‚¹ã€‚åœ¨æ€§èƒ½é¡¹ä¸Šæç¤ºServe images in next-gen formatsä¼˜åŒ–å»ºè®®ã€‚  Image formats like JPEG 2000, JPEG XR, and webp often provide better compression than PNG or JPEG, which means faster dow">
<meta name="twitter:image" content="http://123fe.com/2019/08/14/WebPå®æˆ˜/webp.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://123fe.com/2019/08/14/WebPå®æˆ˜/">





  <title>WebPå®æˆ˜ | Sogou.dh.fe</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Sogou.dh.fe</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">fe blogs</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-github">
          <a href="https://github.com/sgdh-fe" rel="section">
            
            Github
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
            About
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://123fe.com/2019/08/14/WebPå®æˆ˜/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sgdhfe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sogou.dh.fe">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">WebPå®æˆ˜</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-08-14T14:25:09+08:00">
                2019-08-14
              </time>
            

            

            
          </span>

          
          <span> ï½œ </span><span class="fa fa-user-o"> </span><span style="color:#222;"> singsong</span>
          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="/2019/08/14/WebPå®æˆ˜/webp.png" alt="webp"></p>
<p>åœ¨æ­å»º blog è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ <a href="https://github.com/GoogleChrome/lighthouse" target="_blank" rel="noopener">lighthouse</a> å®¡æŸ¥ç«™ç‚¹ã€‚åœ¨æ€§èƒ½é¡¹ä¸Šæç¤º<code>Serve images in next-gen formats</code>ä¼˜åŒ–å»ºè®®ã€‚</p>
<blockquote>
<p>Image formats like JPEG 2000, JPEG XR, and webp often provide better compression than PNG or JPEG, which means faster downloads and less data consumption.<a href="https://developers.google.com/web/tools/lighthouse/audits/webp" target="_blank" rel="noopener">Learn more</a></p>
</blockquote>
<p>JPEG 2000, JPEG XR, å’Œ WebP ä¸ä¼ ç»Ÿçš„ JPEGã€PNG ç›¸æ¯”å…·æœ‰é«˜å‹ç¼©æ¯”ã€é«˜è´¨é‡çš„ç‰¹ç‚¹ã€‚è¿™è®©å›¾ç‰‡åŠ è½½æ›´å¿«ï¼Œå¸¦å®½æ¶ˆè€—æ›´å°‘ã€‚å½“å‰æµè§ˆå™¨å¯¹ JPEG 2000, JPEG XR, å’Œ WebP çš„æ”¯æŒæƒ…å†µï¼š</p>
<a id="more"></a>
<ul>
<li><a href="https://caniuse.com/#feat=webp" target="_blank" rel="noopener">WebP</a>ï¼šChromeã€Opreaã€UCã€QQã€‚å…¶ä¸­ Firefox æ–°ç‰ˆå·²æ”¯æŒï¼ŒSafari å·²å¼€å§‹å°è¯•æ”¯æŒã€‚</li>
<li><a href="https://caniuse.com/#feat=jpeg2000" target="_blank" rel="noopener">JPEG 2000</a>ï¼šSafari</li>
<li><a href="https://caniuse.com/#feat=jpegxr" target="_blank" rel="noopener">JPEG XR</a>ï¼šIE</li>
</ul>
<p>ç»“åˆæµè§ˆå™¨çš„æ”¯æŒæƒ…å†µï¼Œæœ€ç»ˆé€‰æ‹©æ”¯æŒ WebP æ¥ä¼˜åŒ–ï¼š</p>
<ul>
<li>æ”¯æŒæœ‰æŸå’Œæ— æŸå‹ç¼©</li>
<li>æ”¯æŒåŠ¨ç”»</li>
<li>å¼€æº</li>
<li>æŠ€æœ¯æ”¯æŒå›¢é˜Ÿæ˜¯ Google</li>
<li><a href="https://developers.google.com/speed/webp/faq#how_can_i_detect_browser_support_for_webp" target="_blank" rel="noopener">æ›´å¤šå…³äº WebP</a></li>
</ul>
<h2 id="å¦‚ä½•æ”¯æŒ-WebP"><a href="#å¦‚ä½•æ”¯æŒ-WebP" class="headerlink" title="å¦‚ä½•æ”¯æŒ WebP"></a>å¦‚ä½•æ”¯æŒ WebP</h2><p>æ”¯æŒ WebP æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ol>
<li><p>å®¢æˆ·ç«¯å¤„ç†ï¼Œè¿™ç§å¤„ç†æ–¹å¼éœ€è¦æå‰å‡†å¤‡å¥½ WebP å›¾ç‰‡ã€‚<a href="https://developers.google.com/speed/webp/docs/using" target="_blank" rel="noopener">å¦‚ä½•å°†å›¾ç‰‡è½¬æ¢ä¸º WebP æ ¼å¼</a></p>
<ul>
<li>ä½¿ç”¨ js æ£€æµ‹æ˜¯å¦æ”¯æŒ WebPã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// check_webp_feature:</span></span><br><span class="line"><span class="comment">//   'feature' can be one of 'lossy', 'lossless', 'alpha' or 'animation'.</span></span><br><span class="line"><span class="comment">//   'callback(feature, result)' will be passed back the detection result (in an asynchronous way!)</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_webp_feature</span>(<span class="params">feature, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> kTestImages = &#123;</span><br><span class="line">    lossy: <span class="string">"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"</span>,</span><br><span class="line">    lossless: <span class="string">"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA=="</span>,</span><br><span class="line">    alpha:</span><br><span class="line">      <span class="string">"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA=="</span>,</span><br><span class="line">    animation:</span><br><span class="line">      <span class="string">"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">  img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = img.width &gt; <span class="number">0</span> &amp;&amp; img.height &gt; <span class="number">0</span>;</span><br><span class="line">    callback(feature, result);</span><br><span class="line">  &#125;;</span><br><span class="line">  img.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    callback(feature, <span class="literal">false</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  img.src = <span class="string">"data:image/webp;base64,"</span> + kTestImages[feature];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨ HTML5 å’Œ CSS3 ç‰¹æ€§æ”¯æŒæ£€æµ‹åº“: <a href="https://modernizr.com/" target="_blank" rel="noopener">Modernizr</a> ã€‚Modernizr.webpï¼ŒModernizr.webp.losslessï¼ŒModernizr.webp.alpha å’Œ Modernizr.webp.animationã€‚</li>
<li>ä½¿ç”¨ <code>&lt;picture&gt;</code> å…ƒç´ </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;picture&gt;</span><br><span class="line">    &lt;source type=&quot;image/webp&quot; srcset=&quot;demo.webp&quot;&gt;</span><br><span class="line">    &lt;source type=&quot;image/png&quot; media=&quot;demo.png&quot;&gt;</span><br><span class="line">    &lt;img src=&quot;demo.png&quot; alt=&quot;demo&quot;&gt;</span><br><span class="line">&lt;/picture&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æœåŠ¡ç«¯å¤„ç†ã€‚ç›¸æ¯”å®¢æˆ·ç«¯å¤„ç†ï¼Œåœ¨æœåŠ¡ç«¯å¤„ç†æ›´åŠ çµæ´»ã€‚å› ä¸ºå®ƒå¯ä»¥é€šè¿‡å†…å®¹ç±»å‹åå•†ï¼Œèƒ½æå‰çŸ¥é“å®¢æˆ·ç«¯æ˜¯å¦æ”¯æŒ WebPï¼ˆè¯·æ±‚å¤´ä¸­<code>Accept</code>å­—æ®µï¼‰ã€‚å¦‚æœæ”¯æŒå°±ä¼˜å…ˆå“åº” Web æ ¼å¼å›¾ç‰‡ï¼Œå¦åˆ™å°±å“åº”è¯·æ±‚å›¾ç‰‡ã€‚</p>
<ul>
<li><a href="https://www.igvita.com/2012/12/18/deploying-new-image-formats-on-the-web/" target="_blank" rel="noopener">Deploying New Image Formats on the Web</a></li>
</ul>
</li>
</ol>
<p>å¯¹æ¯”ä¸¤ç§å¤„ç†æ–¹å¼ï¼Œé€šè¿‡æœåŠ¡ç«¯æ¥æ”¯æŒ WebP å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿:</p>
<ul>
<li>æå‰çŸ¥é“å®¢æˆ·ç«¯æ˜¯å¦æ”¯æŒ WebPã€‚å¤„ç†æ›´çµæ´»ï¼Œæ›´å¯é ã€‚è€Œå®¢æˆ·ç«¯è¿˜éœ€è¦æ ¹æ®æ˜¯å¦æ”¯æŒ WebPï¼Œå¯¹é“¾æ¥åšé¢å¤–çš„æ›¿æ¢å¤„ç†ã€‚</li>
<li>åŠ¨æ€æ”¯æŒ WebPã€‚å¦‚æœæ”¯æŒ WebPï¼ŒæŸ¥çœ‹æœ¬åœ°æ˜¯å¦æœ‰å¯¹åº” WebP å›¾ç‰‡ï¼Œå¦‚æœæ²¡æœ‰åŠ¨æ€ç”Ÿæˆå“åº”ã€‚</li>
</ul>
<h2 id="æœåŠ¡ç«¯åŠ¨æ€æ”¯æŒ-WebP"><a href="#æœåŠ¡ç«¯åŠ¨æ€æ”¯æŒ-WebP" class="headerlink" title="æœåŠ¡ç«¯åŠ¨æ€æ”¯æŒ WebP"></a>æœåŠ¡ç«¯åŠ¨æ€æ”¯æŒ WebP</h2><p>æœåŠ¡ç«¯è¦åŠ¨æ€æ”¯æŒ WebPï¼Œå¯ä»¥ç”±ä»£ç†æœåŠ¡å™¨ Nginxï¼Œæˆ– Backend æ¥å®Œæˆã€‚</p>
<blockquote>
<p>singsongï¼šå›¾ç‰‡å¤„ç†é€»è¾‘æœ€å¥½äº¤ç»™ä¸‹æ¸¸ Backend æ¥å®Œæˆï¼ŒNGINX å°±è´Ÿè´£è½¬å‘å³å¯ã€‚å½“ç„¶ä¹Ÿæœ‰è‡ªåŠ¨å¤„ç†å›¾ç‰‡ nginx ï¼š<a href="https://github.com/apache/incubator-pagespeed-ngx" target="_blank" rel="noopener">ngx_pagespeed</a></p>
</blockquote>
<h3 id="Nginx-å¤„ç†"><a href="#Nginx-å¤„ç†" class="headerlink" title="Nginx å¤„ç†"></a>Nginx å¤„ç†</h3><ol>
<li>ç¡®ä¿<code>mime.types</code>ä¸­æœ‰ WebPã€‚å› ä¸ºå¦‚æœæ²¡æœ‰ WebP ç±»å‹ï¼ŒWebP å›¾ç‰‡ä¼šä½œä¸º<code>application/octet-stream</code> è¾“å‡ºã€‚</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">image/webp  webp;</span><br></pre></td></tr></table></figure>
<ol>
<li>è·å–è¯·æ±‚å¤´ <code>Accept</code> å­—æ®µä¸­çš„ <code>webp</code></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">map $http_accept $webp_suffix &#123;</span><br><span class="line">  <span class="keyword">default</span>   <span class="string">""</span>;</span><br><span class="line">  <span class="string">"~*webp"</span>  <span class="string">".webp"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä½¿ç”¨ map(æ›´å¤šå‚è€ƒ<a href="http://nginx.org/en/docs/http/ngx_http_map_module.html" target="_blank" rel="noopener">ngx_http_map_module</a>)å®šä¹‰äº†ä¸€ä¸ª<code>$webp_suffix</code>å˜é‡ï¼Œå¦‚æœ WebP å­˜åœ¨ï¼Œ<code>$webp_suffix</code>å€¼ä¸º<code>&quot;.webp&quot;</code>ï¼Œå¦åˆ™ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</p>
<ol>
<li><p>è¾“å‡ºå›¾ç‰‡</p>
<ul>
<li>æŸ¥çœ‹æ˜¯å¦å­˜åœ¨<code>.webp</code>çš„æ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨å°±ç›´æ¥è¾“å‡ºã€‚</li>
<li>æŸ¥çœ‹æ˜¯å¦å­˜åœ¨è¯·æ±‚æ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨å°±ç›´æ¥è¾“å‡ºã€‚</li>
<li>å¦‚æœä¸Šè¿°æ–‡ä»¶éƒ½ä¸å­˜åœ¨ï¼Œå°±å“åº”<code>404</code>ã€‚</li>
</ul>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">try_files <span class="variable">$uri</span><span class="variable">$webp_suffix</span> <span class="variable">$uri</span> =404;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè¿˜å¯ä»¥å°†å“åº”æ“ä½œåä»£ç†ç»™ Backendï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$http_accept</span> ~* <span class="string">"webp"</span>)    &#123; <span class="built_in">set</span> <span class="variable">$webp_accept</span> <span class="string">"true"</span>; &#125;</span><br><span class="line"></span><br><span class="line">location ~ ^/imgs.*\.(png|jpe?g)$ &#123;</span><br><span class="line">  <span class="comment"># Pass WebP support header to backend</span></span><br><span class="line">  proxy_set_header  WebP  <span class="variable">$webp_accept</span>;</span><br><span class="line">  proxy_pass http://127.0.0.1:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/igrigorik/webp-detect/blob/master/nginx.conf" target="_blank" rel="noopener">å®Œæ•´ä»£ç ï¼š</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">worker_processes 1;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">  worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">  include mime.types;</span><br><span class="line">  default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># &lt; regular Nginx configuration here &gt;</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># For a hands-on explanation of using Accept negotiation, see:</span></span><br><span class="line">  <span class="comment"># http://www.igvita.com/2013/05/01/deploying-webp-via-accept-content-negotiation/</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># For an explanation of how to use maps for that, see:</span></span><br><span class="line">  <span class="comment"># http://www.lazutkin.com/blog/2014/02/23/serve-files-with-nginx-conditionally/</span></span><br><span class="line"></span><br><span class="line">  map <span class="variable">$http_accept</span> <span class="variable">$webp_suffix</span> &#123;</span><br><span class="line">    <span class="string">"~*webp"</span>  <span class="string">".webp"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  map <span class="variable">$msie</span> <span class="variable">$cache_control</span> &#123;</span><br><span class="line">      <span class="string">"1"</span>     <span class="string">"private"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  map <span class="variable">$msie</span> <span class="variable">$vary_header</span> &#123;</span><br><span class="line">      default <span class="string">"Accept"</span>;</span><br><span class="line">      <span class="string">"1"</span>     <span class="string">""</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># if proxying to another backend and using nginx as cache</span></span><br><span class="line">  proxy_cache_path  /tmp/cache levels=1:2 keys_zone=my-cache:8m max_size=1000m inactive=600m;</span><br><span class="line">  proxy_temp_path /tmp/cache/tmp;</span><br><span class="line"></span><br><span class="line">  server &#123;</span><br><span class="line">    listen       8081;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    location ~ \.(png|jpe?g)$ &#123;</span><br><span class="line">      <span class="comment"># set response headers specially treating MSIE</span></span><br><span class="line">      add_header Vary <span class="variable">$vary_header</span>;</span><br><span class="line">      add_header Cache-Control <span class="variable">$cache_control</span>;</span><br><span class="line">      <span class="comment"># now serve our images</span></span><br><span class="line">      try_files <span class="variable">$uri</span><span class="variable">$webp_suffix</span> <span class="variable">$uri</span> =404;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># if proxying to another backend and using nginx as cache</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$http_accept</span> ~* <span class="string">"webp"</span>)    &#123; <span class="built_in">set</span> <span class="variable">$webp_accept</span> <span class="string">"true"</span>; &#125;</span><br><span class="line">    proxy_cache_key <span class="variable">$scheme</span><span class="variable">$proxy_host</span><span class="variable">$request_uri</span><span class="variable">$webp_local</span><span class="variable">$webp_accept</span>;</span><br><span class="line"></span><br><span class="line">    location ~ ^/proxy.*\.(png|jpe?g)$ &#123;</span><br><span class="line">      <span class="comment"># Pass WebP support header to backend</span></span><br><span class="line">      proxy_set_header  WebP  <span class="variable">$webp_accept</span>;</span><br><span class="line">      proxy_pass http://127.0.0.1:8080;</span><br><span class="line">      proxy_cache my-cache;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æƒ³äº†è§£æ›´å¤šå¯ä»¥å‚è€ƒå¦‚ä¸‹æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://www.igvita.com/2012/12/18/deploying-new-image-formats-on-the-web/" target="_blank" rel="noopener">Ilya Grigorik: Deploying New Image Formats on the Web - webp</a></li>
<li><a href="http://www.lazutkin.com/blog/2014/02/23/serve-files-with-nginx-conditionally/" target="_blank" rel="noopener">Eugene Lazutkin: Serve files with nginx conditionally - webp</a></li>
<li><a href="https://github.com/igrigorik/webp-detect" target="_blank" rel="noopener">Webp Detect - WebP with Accept negotiation</a></li>
<li><a href="https://corydowdy.com/blog/webp-jxr-nginx-content-negotiation-test" target="_blank" rel="noopener">my post on conditionally serving webp and jxr with nginx</a></li>
</ul>
<h3 id="Backend-å¤„ç†"><a href="#Backend-å¤„ç†" class="headerlink" title="Backend å¤„ç†"></a>Backend å¤„ç†</h3><p>Backend æ˜¯åŸºäº <a href="https://github.com/koajs/koa" target="_blank" rel="noopener">KOA</a> æ¡†æ¶æ­å»ºçš„ï¼Œè¦é›†æˆåŠ¨æ€æ”¯æŒ WebPï¼Œéœ€è¦å®Œæˆå¦‚ä¸‹ä¸¤ä¸ªä»»åŠ¡ï¼š</p>
<ul>
<li>è·å–è¯·æ±‚å¤´ä¸­çš„<code>Accept</code>å­—æ®µï¼Œåˆ¤æ–­æ˜¯å¦æ”¯æŒ WebPã€‚è¿™ä¸€æ­¥ä¹Ÿå¯ç”± Nginx æ¥åšã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–è¯·æ±‚å¤´ï¼šctx.header.accept, ctx.headers.acceptã€ctx.req.headers.acceptã€ctx.request.headers.acceptã€ctx.request.header.accept</span></span><br><span class="line"><span class="keyword">const</span> isWebp = <span class="regexp">/webp/i</span>.test(ctx.header.accept);</span><br><span class="line"><span class="comment">// æ³¨æ„: è™½ç„¶ KOA æä¾›`ctx.accept('webp')`æ–¹æ³•æ¥åˆ¤æ–­accept typeã€‚ä½†æ˜¯è¯¥æ–¹æ³•å¯¹webpåˆ¤æ–­å­˜åœ¨bugï¼Œå®ƒä¼šå°†`*/*`ä½œä¸ºæ”¯æŒæ¥å¤„ç†ã€‚</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>æ·»åŠ å›¾ç‰‡å¤„ç†åŠŸèƒ½ã€‚è¦åŠ¨æ€æ”¯æŒ WebPï¼Œè¿™å°±éœ€è¦ Backend å…·å¤‡å›¾ç‰‡å¤„ç†åŠŸèƒ½ã€‚node ç›¸å…³çš„å›¾ç‰‡å¤„ç†åº“ï¼š</p>
<ul>
<li><a href="https://github.com/lovell/sharp" target="_blank" rel="noopener">sharp</a></li>
<li><a href="https://github.com/oliver-moran/jimp" target="_blank" rel="noopener">jimp</a></li>
<li><a href="https://github.com/aheckmann/gm" target="_blank" rel="noopener">gm</a></li>
</ul>
</li>
</ul>
<p>sharp ç›¸æ¯”äº jimpã€gm ç»¼åˆæ€§èƒ½æ›´å¥½ï¼Œå¯¹ WebP æ”¯æŒæ›´å‹å¥½ã€‚å› æ­¤è¿™é‡Œä½¿ç”¨ sharp æ¥å®ç°å›¾ç‰‡æ ¼å¼è½¬æ¢ã€ç¼©æ”¾ã€æ°´å°ç­‰åŠŸèƒ½ã€‚npm å¯¹æ¯”æ•°æ®ï¼š<a href="https://www.npmtrends.com/gm-vs-jimp-vs-sharp" target="_blank" rel="noopener">gm vs jimp vs sharp</a> ã€‚</p>
<h2 id="å…³é”®ä»£ç "><a href="#å…³é”®ä»£ç " class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs-extra"</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> send = <span class="built_in">require</span>(<span class="string">"koa-send"</span>);</span><br><span class="line"><span class="keyword">const</span> sharp = <span class="built_in">require</span>(<span class="string">"sharp"</span>);</span><br><span class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">"glob"</span>);</span><br><span class="line"><span class="keyword">const</span> TextToSvg = <span class="built_in">require</span>(<span class="string">"text-to-svg"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é…ç½®sharp</span></span><br><span class="line">sharp.concurrency(<span class="number">1</span>);</span><br><span class="line">sharp.cache(<span class="number">50</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  <span class="comment">// getSvgByText</span></span><br><span class="line">  <span class="keyword">const</span> getSvgByText = <span class="function">(<span class="params">text, fontSize, color</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> textToSVG = TextToSvg.loadSync();</span><br><span class="line">    <span class="keyword">const</span> svg = textToSVG.getSVG(text, &#123;</span><br><span class="line">      fontSize,</span><br><span class="line">      anchor: <span class="string">"top"</span>,</span><br><span class="line">      attributes: &#123;</span><br><span class="line">        fill: color</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> Buffer.from(svg);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> originals = glob.sync(</span><br><span class="line">    path.join(__dirname, <span class="string">".."</span>, <span class="string">"public"</span>, <span class="string">"originals"</span>, <span class="string">"*.+(png|jpeg|svg|jpg)"</span>)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> nameMapOriginal = &#123;&#125;;</span><br><span class="line">  originals.forEach(<span class="function"><span class="params">original</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> metas = path.parse(original);</span><br><span class="line">    nameMapOriginal[metas.name] = original;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// getOriginals</span></span><br><span class="line">  <span class="keyword">const</span> getOriginalsByName = <span class="function"><span class="params">name</span> =&gt;</span> nameMapOriginal[name];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> imgProcessor = <span class="keyword">async</span> (</span><br><span class="line">    inputPath,</span><br><span class="line">    outputPath,</span><br><span class="line">    &#123; overlay, width, blur &#125;</span><br><span class="line">  ) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> image = sharp(inputPath);</span><br><span class="line">    <span class="keyword">const</span> metadata = <span class="keyword">await</span> image.clone().metadata(); <span class="comment">// è·å–åŸå›¾ç‰‡çš„å…ƒæ•°æ®</span></span><br><span class="line">    <span class="keyword">const</span> rawWidth = width || metadata.width;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      overlay !== <span class="string">"off"</span> &amp;&amp;</span><br><span class="line">      metadata.width &gt; <span class="number">160</span> &amp;&amp;</span><br><span class="line">      metadata.height &gt; <span class="number">80</span> &amp;&amp;</span><br><span class="line">      rawWidth &gt; <span class="number">160</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">const</span> tempFontSize = (rawWidth * <span class="number">0.03</span>) | <span class="number">0</span>; <span class="comment">// eslint-disable-line</span></span><br><span class="line">      <span class="keyword">const</span> fontSize = tempFontSize &lt; <span class="number">12</span> ? <span class="number">12</span> : tempFontSize;</span><br><span class="line">      overlay = getSvgByText(</span><br><span class="line">        <span class="string">"zhansingsong.com"</span>,</span><br><span class="line">        fontSize,</span><br><span class="line">        <span class="string">"rgba(255, 255, 255, 0.3)"</span></span><br><span class="line">      ); <span class="comment">// eslint-disable-line</span></span><br><span class="line">      <span class="keyword">await</span> image</span><br><span class="line">        .clone()</span><br><span class="line">        .overlayWith(overlay, &#123; <span class="attr">gravity</span>: sharp.gravity.southeast &#125;)</span><br><span class="line">        .resize(&#123; <span class="attr">width</span>: <span class="built_in">parseInt</span>(width, <span class="number">10</span>) &#125;)</span><br><span class="line">        .toFile(outputPath)</span><br><span class="line">        .catch(<span class="function"><span class="params">err</span> =&gt;</span> ctx.app.emit(<span class="string">"error"</span>, err));</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!blur) &#123;</span><br><span class="line">      <span class="keyword">await</span> image</span><br><span class="line">        .clone()</span><br><span class="line">        .resize(&#123; <span class="attr">width</span>: <span class="built_in">parseInt</span>(width, <span class="number">10</span>) &#125;)</span><br><span class="line">        .toFile(outputPath)</span><br><span class="line">        .catch(<span class="function"><span class="params">err</span> =&gt;</span> ctx.app.emit(<span class="string">"error"</span>, err));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> image</span><br><span class="line">        .clone()</span><br><span class="line">        .resize(&#123; <span class="attr">width</span>: <span class="built_in">parseInt</span>(width, <span class="number">10</span>) &#125;)</span><br><span class="line">        .blur(<span class="number">1.3</span>)</span><br><span class="line">        .toFile(outputPath)</span><br><span class="line">        .catch(<span class="function"><span class="params">err</span> =&gt;</span> ctx.app.emit(<span class="string">"error"</span>, err));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> &#123; join, parse &#125; = path;</span><br><span class="line">  <span class="keyword">const</span> &#123; existsSync, ensureDirSync &#125; = fs;</span><br><span class="line">  <span class="comment">// ç¼–ç ä¸­æ–‡ä¹±ç </span></span><br><span class="line">  <span class="keyword">const</span> url = <span class="built_in">decodeURIComponent</span>(ctx.path);</span><br><span class="line">  <span class="keyword">const</span> metas = parse(url);</span><br><span class="line">  <span class="keyword">const</span> isWebp = <span class="regexp">/webp/i</span>.test(ctx.header.accept); <span class="comment">// åˆ¤æ–­æ˜¯å¦æ”¯æŒwebp</span></span><br><span class="line">  <span class="keyword">const</span> isThumbnail = <span class="regexp">/^\/public\/thumbnails\//</span>.test(url);</span><br><span class="line">  <span class="keyword">const</span> fileDir = isThumbnail</span><br><span class="line">    ? join.apply(path, [</span><br><span class="line">        __dirname,</span><br><span class="line">        <span class="string">".."</span>,</span><br><span class="line">        <span class="string">"public"</span>,</span><br><span class="line">        <span class="string">"thumbnails"</span>,</span><br><span class="line">        <span class="string">`<span class="subst">$&#123;ctx.query.width || <span class="number">20</span>&#125;</span>`</span></span><br><span class="line">      ])</span><br><span class="line">    : join.apply(path, [</span><br><span class="line">        __dirname,</span><br><span class="line">        <span class="string">".."</span>,</span><br><span class="line">        <span class="string">"public"</span>,</span><br><span class="line">        <span class="string">"imgs"</span>,</span><br><span class="line">        ...Object.values(ctx.query)</span><br><span class="line">      ]);</span><br><span class="line">  <span class="keyword">const</span> filePath = join(</span><br><span class="line">    fileDir,</span><br><span class="line">    <span class="string">`<span class="subst">$&#123;metas.name&#125;</span><span class="subst">$&#123;isWebp ? <span class="string">".webp"</span> : metas.ext&#125;</span>`</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> options = isThumbnail</span><br><span class="line">    ? &#123;</span><br><span class="line">        width: ctx.query.width || <span class="number">20</span>,</span><br><span class="line">        overlay: ctx.query.overlay || <span class="string">"off"</span>,</span><br><span class="line">        blur: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    : ctx.query;</span><br><span class="line"></span><br><span class="line">  ensureDirSync(fileDir);</span><br><span class="line">  <span class="keyword">if</span> (!existsSync(filePath)) &#123;</span><br><span class="line">    <span class="keyword">await</span> imgProcessor(getOriginalsByName(metas.name), filePath, options); <span class="comment">// eslint-disable-line</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">await</span> send(ctx, filePath, &#123; <span class="attr">root</span>: <span class="string">"/"</span> &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="å®ç°æ•ˆæœ"><a href="#å®ç°æ•ˆæœ" class="headerlink" title="å®ç°æ•ˆæœ"></a>å®ç°æ•ˆæœ</h2><p>é€šè¿‡ sharp ä¸º Backend å®ç°äº†ä¸€äº›ç®€å•å›¾ç‰‡å¤„ç†æ¥å£ï¼šå›¾ç‰‡å‹ç¼©ã€æ°´å°ã€æ ¼å¼è½¬æ¢ã€‚è¿™ä¹Ÿä¸ºåé¢ç¼©ç•¥å›¾çš„ä½¿ç”¨æä¾›äº†æ”¯æŒã€‚å¤„ç†æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="./images/webp-supports.png" alt="webp-support"><br>ä»ä¸Šå›¾å¯çŸ¥:</p>
<ul>
<li>Safari å’Œ Chrome æµè§ˆå™¨åˆ†åˆ«è¯·æ±‚åŒä¸€å›¾ç‰‡ï¼Œå“åº”ç»“æœå„ä¸ç›¸åŒã€‚æµè§ˆå™¨æ”¯æŒ WebP æ—¶ï¼Œä¼šç›´æ¥å“åº” WebP å›¾ç‰‡ã€‚å¦åˆ™å°±å“åº”è¯·æ±‚å›¾ç‰‡ã€‚</li>
<li>ç›¸åŒè´¨é‡çš„å›¾ç‰‡ï¼ŒWebP æ ¼å¼å¤§å°çº¦ä¸º png æ ¼å¼å¤§å°çš„ 0.43ã€‚</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡æ˜¯è‡ªå·±åœ¨ä½¿ç”¨ WebP çš„ä¸€äº›å¿ƒå¾—æ€»ç»“ã€‚ä¸»è¦å¯¹ WebP çš„ä½¿ç”¨åšä¸ªç®€å•ä»‹ç»ã€‚è‡³äºä¸ºä»€ä¹ˆè¦ç”¨ WebPï¼Œæœ¬æ–‡ä¹Ÿåšäº†ç›¸å…³ä»‹ç»ã€‚ä½†è¿™å¹¶ä¸ä»£è¡¨ WebP æ²¡æœ‰ç¼ºç‚¹ã€‚å¦‚åœ¨ç¼–è§£ç æ•ˆç‡ä¸Šå°±å­˜åœ¨ä¸è¶³ã€‚ä¸è¿‡éšç€ç¡¬ä»¶è®¾å¤‡çš„æå‡ï¼Œè¿™ä¹Ÿåœ¨å¯æ¥å—èŒƒå›´å†…ã€‚éšç€ç§»åŠ¨äº’è”ç½‘çš„å¿«é€Ÿå‘å±•ï¼ŒPWA(Progressive Web App)å¿…æˆä¸º Web App çš„ä¸»æµã€‚è€Œ WebP æ˜¯ PWA ä¸€ä¸ªç»„æˆéƒ¨åˆ†ï¼Œäº†è§£å¹¶æ”¯æŒ WebP å·²æˆå¤§è¶‹åŠ¿ã€‚ç›®å‰å¾ˆå¤šä¸»æµçš„ç«™ç‚¹å·²å…¨ç«™æˆ–éƒ¨åˆ†æ”¯æŒ WebPã€‚</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/webP/" rel="tag"># webP</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/08/14/virtual-listï¼ˆè™šæ‹ŸåŒ–åˆ—è¡¨ï¼‰/" rel="next" title="virtual listï¼ˆè™šæ‹ŸåŒ–åˆ—è¡¨ï¼‰">
                <i class="fa fa-chevron-left"></i> virtual listï¼ˆè™šæ‹ŸåŒ–åˆ—è¡¨ï¼‰
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/08/14/Medium-æ¸è¿›æ€§å›¾ç‰‡åŠ è½½-ï¼ˆMedium-progressive-image-loadingï¼‰/" rel="prev" title="Medium æ¸è¿›æ€§å›¾ç‰‡åŠ è½½ ï¼ˆMedium progressive image loadingï¼‰">
                Medium æ¸è¿›æ€§å›¾ç‰‡åŠ è½½ ï¼ˆMedium progressive image loadingï¼‰ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/logo.png" alt="sgdhfe">
            
              <p class="site-author-name" itemprop="name">sgdhfe</p>
              <p class="site-description motion-element" itemprop="description">ğŸ³ğŸ³ æœç‹—å¯¼èˆªå‰ç«¯å¼€å‘ç»„ ğŸ¬ğŸ¬</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">39</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/sgdh-fe" target="_blank" title="github">
                      
                        <i class="fa fa-fw fa-github"></i>github</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://123.sogou.com/" title="123sogou" target="_blank">123sogou</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å¦‚ä½•æ”¯æŒ-WebP"><span class="nav-number">1.</span> <span class="nav-text">å¦‚ä½•æ”¯æŒ WebP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æœåŠ¡ç«¯åŠ¨æ€æ”¯æŒ-WebP"><span class="nav-number">2.</span> <span class="nav-text">æœåŠ¡ç«¯åŠ¨æ€æ”¯æŒ WebP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Nginx-å¤„ç†"><span class="nav-number">2.1.</span> <span class="nav-text">Nginx å¤„ç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Backend-å¤„ç†"><span class="nav-number">2.2.</span> <span class="nav-text">Backend å¤„ç†</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å…³é”®ä»£ç "><span class="nav-number">3.</span> <span class="nav-text">å…³é”®ä»£ç </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®ç°æ•ˆæœ"><span class="nav-number">4.</span> <span class="nav-text">å®ç°æ•ˆæœ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ€»ç»“"><span class="nav-number">5.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">sgdhfe</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
